<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Denoæé€Ÿå…¥é—¨</title>
    <url>/%E8%BD%AC%E8%BD%BD/Deno%E6%9E%81%E9%80%9F%E5%85%A5%E9%97%A8.html</url>
    <content><![CDATA[<blockquote>
<h5 id="æ¨èé˜…è¯»å®˜æ–¹æ‰‹å†Œ"><a href="#æ¨èé˜…è¯»å®˜æ–¹æ‰‹å†Œ" class="headerlink" title="æ¨èé˜…è¯»å®˜æ–¹æ‰‹å†Œ"></a>æ¨èé˜…è¯»<a href="https://deno.land/manual" target="_blank" rel="noopener">å®˜æ–¹æ‰‹å†Œ</a></h5></blockquote>
<h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>é‰´äºå›½å†…çš„ç½‘é€ŸåŸå› ï¼Œ<a href="https://github.com/denocn/deno_install/commits?author=justjavac" target="_blank" rel="noopener">@justjavac</a> å¤§ä½¬æäº†å›½å†…çš„<a href="https://github.com/denocn/deno_install" target="_blank" rel="noopener">é•œåƒåŠ é€Ÿ</a>ï¼š</p>
<p>Mac/Linux</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://x.deno.js.cn/install.sh | sh</span><br></pre></td></tr></table></figure>
<p>Windows</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iwr https://x.deno.js.cn/install.ps1 -useb -outf install.ps1; .\install.ps1</span><br><span class="line"><span class="meta">#</span> iwr https://x.deno.js.cn/install.ps1 -useb | iex</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>deno æ²¡æœ‰ node ä¸­çš„ node_modules ç›®å½•åšä¸ºåŒ…å­˜æ”¾çš„åœ°æ–¹ï¼Œä½†ä¹Ÿéœ€è¦ä¸€ä¸ªåœ°æ–¹å­˜åœ¨å®‰è£…çš„æ¨¡å—ï¼š</p>
<p><code>DENO_DIR</code> é»˜è®¤ä¸º <code>$HOME/.deno</code>ï¼Œå°±æ˜¯ Deno å­˜æ”¾ç”Ÿæˆçš„ä»£ç å’Œç¼“å­˜çš„æºç çš„è·¯å¾„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> mac / linux</span><br><span class="line">echo 'export DENO_DIR=$HOME/.deno' &gt;&gt; ~/.bash_profile</span><br><span class="line">source ~/.bash_profile # å¦‚æœæ˜¯ zsh åˆ™ï¼šsource ~/.zshrc</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…-VSCode-æ’ä»¶"><a href="#å®‰è£…-VSCode-æ’ä»¶" class="headerlink" title="å®‰è£… VSCode æ’ä»¶"></a>å®‰è£… VSCode æ’ä»¶</h3><p>ç”±äº <code>import url</code> çš„å½¢å¼å’Œ Deno å…¨å±€å¯¹è±¡å¹¶æœªè¢« vscode æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©æ’ä»¶ <a href="https://marketplace.visualstudio.com/items?itemName=axetroy.vscode-deno" target="_blank" rel="noopener">Deno</a> è¿›è¡Œæ”¯æŒï¼š</p>
<blockquote>
<ol>
<li>åœ¨æ‚¨çš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶<code>.vscode/settings.json</code>ï¼›</li>
<li>åœ¨<code>settings.json</code>æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚</li>
</ol>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&gt; // .vscode/settings.json</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;   "deno.enable": true,</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run https://deno.land/std/examples/welcome.ts</span><br></pre></td></tr></table></figure>
<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Download https://deno.land/std/examples/welcome.ts</span><br><span class="line">Compile https://deno.land/std/examples/welcome.ts</span><br><span class="line">Welcome to Deno ğŸ¦•</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé‡æ–°æ‰§è¡Œä¸€éï¼Œä½ ä¼šçœ‹åˆ° <code>Download</code> å’Œ <code>Compile</code> è¿‡ç¨‹æ²¡äº†ï¼Œç›´æ¥æ˜¯ç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Welcome to Deno ğŸ¦•</span><br></pre></td></tr></table></figure>
<h2 id="æ·±å…¥"><a href="#æ·±å…¥" class="headerlink" title="æ·±å…¥"></a>æ·±å…¥</h2><h3 id="Deno-å†…ç½®-API-ä½¿ç”¨"><a href="#Deno-å†…ç½®-API-ä½¿ç”¨" class="headerlink" title="Deno å†…ç½® API ä½¿ç”¨"></a>Deno å†…ç½® API ä½¿ç”¨</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯»å–æ–‡ä»¶ç›®å½•çš„ä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dir = Deno.readDirSync(Deno.cwd())</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> dir) &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯ï¼š<code>Deno.cwd()</code> è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œ<code>Deno.readDirSync</code> è¡¨ç¤ºè¯»å–ç›®å½•ä¿¡æ¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>for of</code> è¿›è¡Œè¾“å‡ºã€‚æ‰§è¡Œå‘½ä»¤ä¸€ä¸‹å‘½ä»¤å³å¯çœ‹åˆ°ç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run --allow-read mod.ts</span><br><span class="line">&#123; name: "mod.ts", isFile: true, isDirectory: false, isSymlink: false &#125;</span><br><span class="line">&#123; name: ".vscode", isFile: false, isDirectory: true, isSymlink: false &#125;</span><br><span class="line">&#123; name: "server.ts", isFile: true, isDirectory: false, isSymlink: false &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹åˆ° deno å¹¶æœªåƒ node ä¸€æ ·ä½¿ç”¨å¼•å…¥æ¨¡å—çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨å…¨å±€çš„ <code>Deno</code> å¯¹è±¡ï¼Œæˆ‘ä»¬è¾“å‡ºå³å¯çœ‹åˆ°å…¨éƒ¨å†…ç½® APIï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(Deno);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä½¿ç”¨ vscode æ’ä»¶å•å‡» Deno å¯¹è±¡å³å¯è·³è½¬å…¶ ts å®šä¹‰ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/20200515091024689.gif" alt=""></p>
<p>å¦‚æœè§‰å¾—æ˜¯è‹±æ–‡çœ‹ä¸æ‡‚ï¼Œåˆ™å¯ä»¥å‚è€ƒæˆ–æ›¿æ¢<a href="https://github.com/denodev/typedoc/blob/master/lib.deno.ns.d.ts" target="_blank" rel="noopener">ä¸­æ–‡ç‰ˆ</a>ã€‚</p>
<p>å¦‚æœä»ç„¶è§‰å¾—ä¸å¤Ÿç›´è§‚ï¼Œå¯ä»¥å‚è€ƒ typedocï¼š<a href="https://deno.dev/typedoc/" target="_blank" rel="noopener">ä¸­æ–‡</a> æˆ– <a href="https://doc.deno.land/https/github.com/denoland/deno/releases/latest/download/lib.deno.d.ts" target="_blank" rel="noopener">è‹±æ–‡</a></p>
<h3 id="æ”¯æŒ-TS"><a href="#æ”¯æŒ-TS" class="headerlink" title="æ”¯æŒ TS"></a>æ”¯æŒ TS</h3><p>åœ¨ Deno ä¸­ï¼ŒTS å’Œ JS éƒ½æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œéƒ½å¯ä»¥å®Œç¾æ”¯æŒã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">let</span> name: <span class="built_in">string</span> = <span class="string">'ry'</span></span><br><span class="line">name = <span class="number">123</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run index.ts</span><br></pre></td></tr></table></figure>
<p>ç»“æœ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Compile file:///Users/Xiuming/Desktop/demo/index.ts</span><br><span class="line">error: TS2322 [ERROR]: Type '123' is not assignable to type 'string'.</span><br><span class="line">name = 123;</span><br><span class="line">~~~~</span><br><span class="line">    at file:///Users/Xiuming/Desktop/demo/index.ts:2:1</span><br></pre></td></tr></table></figure>
<h3 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h3><p>Deno é»˜è®¤æ˜¯æ²¡æœ‰ ç½‘ç»œã€æ–‡ä»¶è¯»ã€æ–‡ä»¶å†™ã€ç¯å¢ƒå˜é‡è¯»å–ç­‰æƒé™ï¼Œéœ€è¦æ˜¾ç¤ºçš„æŒ‡æ˜ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">fetch(<span class="string">'http://jsonplaceholder.typicode.com/posts/1'</span>)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run index.js</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåï¼Œå‘ç°ä¸€ä¸²æŠ¥é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">error: Uncaught PermissionDenied: network access to "http://jsonplaceholder.typicode.com/posts/1", run again with the --allow-net flag</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åŠ ä¸Šæƒé™è¯•è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run --allow-net index.js</span><br><span class="line">&#123;</span><br><span class="line"> userId: 1,</span><br><span class="line"> id: 1,</span><br><span class="line"> title: "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",</span><br><span class="line"> body: "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas..."</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè§‰å¾—éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>-A</code> å‚æ•°å…è®¸å…¨éƒ¨æƒé™ã€‚</p>
<h3 id="import-URL"><a href="#import-URL" class="headerlink" title="import URL"></a>import URL</h3><p>Deno ç›¸å¯¹äº NodeJS ä¸€å¤§äº®ç‚¹æ˜¯æ²¡æœ‰ <code>node_modules</code>ï¼Œæ²¡æœ‰ <code>package.json</code>ï¼Œé€šè¿‡ import URL çš„å½¢å¼è¿›è¡Œç¬¬ä¸‰æ–¹æ¨¡å—çš„å¼•ç”¨ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; white, bgRed &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std/fmt/colors.ts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bgRed(white(<span class="string">"ä½ å¥½ï¼Œä¸–ç•Œ"</span>)));</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run --allow-net mod.ts </span><br><span class="line">Compile file:///Users/Xiuming/Desktop/demo/mod.ts</span><br><span class="line">Download https://deno.land/std/fmt/colors.ts</span><br><span class="line">ä½ å¥½ï¼Œä¸–ç•Œ # å‡è£…æœ‰é¢œè‰²</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶çœ‹ä¼¼ç®€å•äº†ï¼Œä½†ä¹Ÿç»†å¿ƒçš„ä½ ä¼šå‘ç°å¾ˆå¤šé—®é¢˜ï¼š</p>
<p>1.æœ‰ <code>Compile</code> å’Œ <code>Download</code> çš„è¿‡ç¨‹ï¼Œé€Ÿåº¦æ…¢ï¼Ÿ</p>
<p>å…¶å®å®ƒåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™éœ€è¦ä¸‹è½½ï¼Œç„¶åä¼šå°†å…¶ç¼“å­˜èµ·æ¥ï¼Œä½ é‡æ–°æ‰§è¡Œï¼Œå°±ä¼šå‘ç°é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run mod.ts</span><br><span class="line">ä½ å¥½ï¼Œä¸–ç•Œ # å‡è£…æœ‰é¢œè‰²</span><br></pre></td></tr></table></figure>
<p>2.æ²¡æœ‰ç½‘ç»œæ€ä¹ˆåŠï¼Ÿ</p>
<p>ä¸Šé¢è¯´çš„ï¼Œåœ¨ç¬¬ä¸€æ¬¡ä¸‹è½½åï¼ŒDeno ä¼šå°†å…¶ç¼“å­˜èµ·æ¥ï¼Œå…·ä½“ç¼“å­˜ç›®å½•å°±æ˜¯æˆ‘ä»¬å‰é¢è®¾ç½®çš„ç¯å¢ƒå˜é‡ <code>$HOME/.deno</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>tree</code> å‘½ä»¤çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tree $HOME/.deno</span><br><span class="line">/Users/Xiuming/.deno</span><br><span class="line">â”œâ”€â”€ deps</span><br><span class="line">â”‚Â Â  â””â”€â”€ https</span><br><span class="line">â”‚Â Â      â””â”€â”€ deno.land</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 3574883d8acbaf00e28990ec8e83d71084c4c668c1dc7794be25208c60cfc935</span><br><span class="line">â”‚Â Â          â””â”€â”€ 3574883d8acbaf00e28990ec8e83d71084c4c668c1dc7794be25208c60cfc935.metadata.json</span><br><span class="line">â””â”€â”€ gen</span><br><span class="line">    # ...</span><br><span class="line"></span><br><span class="line">13 directories, 8 files</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦å°†ä»£ç éƒ¨ç½²åˆ°ä¸€ä¸ªæ²¡æœ‰å¤–ç½‘è®¿é—®çš„ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥å°†æ­¤ç›®å½•ä¸‹çš„å†…å®¹æ‹·è´åˆ°ç›¸åº”çš„ç›®å½•ï¼Œå¹¶å°†ç¯å¢ƒå˜é‡æŒ‡å®šåˆ°ç›®å½•å³å¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæ˜¯ä½ åœ¨å®‰è£…ä¾èµ–ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä¾‹å¦‚ <code>https://deno.land</code> å®•æœºäº†ï¼Œé‚£åªèƒ½ GGï¼Œæ²¡å¾—åŠæ³•ï¼ˆPSï¼šæ¦‚ç‡å¾ˆå°ï¼Œå°±åƒ npmjs.com å®•æœºä½ ä¹Ÿä¸èƒ½å®‰è£…åŒ…ä¸€æ ·ï¼‰ã€‚</p>
<p>3.å¦‚ä½•æ›´æ–°ä¾èµ–ï¼Ÿ</p>
<p>å¦‚æœä¾èµ–çš„æ–‡ä»¶æ›´æ–°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>--reload</code> å‘½ä»¤è¿›è¡Œæ›´æ–°ï¼Œè¿˜å¯ä»¥é€šè¿‡<strong>ç™½åå•</strong>çš„å½¢å¼ï¼Œåªæ›´æ–°éƒ¨åˆ†ä¾èµ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno run --reload=https://deno.land mod.ts</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥æ“ä½œè¿”å›-Promise"><a href="#å¼‚æ­¥æ“ä½œè¿”å›-Promise" class="headerlink" title="å¼‚æ­¥æ“ä½œè¿”å› Promise"></a>å¼‚æ­¥æ“ä½œè¿”å› Promise</h3><p>Deno ä¸­å¼‚æ­¥æ“ä½œéƒ½æ˜¯è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¹¶ä¸”æ”¯æŒ <code>top-level-await</code>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> file = <span class="keyword">await</span> Deno.create(<span class="string">"./foo.txt"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(file);</span><br></pre></td></tr></table></figure>
<h3 id="æ ‡å‡†æ¨¡å—"><a href="#æ ‡å‡†æ¨¡å—" class="headerlink" title="æ ‡å‡†æ¨¡å—"></a>æ ‡å‡†æ¨¡å—</h3><p>Deno ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„ã€å®ç”¨çš„ã€é«˜é¢‘çš„å¼€å‘åº“ï¼Œå‡è½»æˆ‘ä»¬å¼€å‘çš„è´Ÿæ‹…ï¼š</p>
<ul>
<li><a href="https://deno.land/std/node" target="_blank" rel="noopener">node</a>ï¼šnode API å…¼å®¹æ¨¡å—ï¼›</li>
<li><a href="https://deno.land/std/io" target="_blank" rel="noopener">io</a>ï¼šäºŒè¿›åˆ¶è¯»å†™æ“ä½œï¼›</li>
<li><a href="https://deno.land/std/http" target="_blank" rel="noopener">http</a>ï¼šç½‘ç»œå’Œ web æœåŠ¡ç›¸å…³ï¼›</li>
<li><a href="https://deno.land/std/path" target="_blank" rel="noopener">path</a>ï¼šæ–‡ä»¶è·¯å¾„ç›¸å…³ï¼›</li>
<li><a href="https://github.com/denoland/deno/blob/master/std/fmt/colors.ts" target="_blank" rel="noopener">colors</a>ï¼šè¾“å‡ºæœ‰é¢œè‰²çš„æ–‡å­—ï¼Œç±»ä¼¼ chalk åº“ï¼›</li>
<li><a href="https://github.com/denoland/deno/blob/master/std/fmt/sprintf.ts" target="_blank" rel="noopener">printf</a>ï¼šæ ¼å¼åŒ–è¾“å‡ºï¼Œç±»ä¼¼ C è¯­è¨€çš„ printfï¼›</li>
<li><a href="https://github.com/denoland/deno/blob/master/std/archive/tar.ts" target="_blank" rel="noopener">tar</a>ï¼šè§£å‹ä¸å‹ç¼©ï¼›</li>
<li><a href="https://deno.land/std/async" target="_blank" rel="noopener">async</a>ï¼šç”Ÿæˆå¼‚æ­¥å‡½æ•°çš„ï¼›</li>
<li><a href="https://deno.land/std/bytes" target="_blank" rel="noopener">bytes</a>ï¼šäºŒè¿›åˆ¶æ¯”è¾ƒå’ŒæŸ¥æ‰¾ç­‰ï¼›</li>
<li><a href="https://deno.land/std/datetime" target="_blank" rel="noopener">datetime</a>ï¼šæ—¥æœŸç›¸å…³ï¼›</li>
<li><a href="https://deno.land/std/encoding" target="_blank" rel="noopener">encoding</a>ï¼šæ–‡æœ¬çš„ä¸äºŒè¿›åˆ¶çš„è½¬åŒ–ã€CSVå’Œå¯¹è±¡è½¬åŒ–ã€yarml å’Œå¯¹è±¡è½¬åŒ–ç­‰ï¼›</li>
<li><a href="https://deno.land/std/flags" target="_blank" rel="noopener">flags</a>ï¼šå‘½ä»¤è¡Œå‚æ•°è§£æï¼›</li>
<li><a href="https://deno.land/std/hash" target="_blank" rel="noopener">hash</a>ï¼šå­—ç¬¦è½¬ sha1 å’Œ sha256ï¼›</li>
<li><a href="https://deno.land/std/fs" target="_blank" rel="noopener">fs</a>ï¼šæ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œç±»ä¼¼ node çš„ fs æ¨¡å—ï¼›</li>
<li><a href="https://deno.land/std/log" target="_blank" rel="noopener">log</a>ï¼šæ—¥å¿—ç®¡ç†ï¼›</li>
<li><a href="https://deno.land/std/permissions" target="_blank" rel="noopener">permissions</a>ï¼šæƒé™ç›¸å…³ï¼›</li>
<li><a href="https://deno.land/std/testing" target="_blank" rel="noopener">testing</a>ï¼šæµ‹è¯•å’Œæ–­è¨€ç›¸å…³ï¼›</li>
<li><a href="https://deno.land/std/uuid" target="_blank" rel="noopener">uuid</a>ï¼šç”¨äºç”Ÿæˆ UUIDï¼›</li>
<li><a href="https://deno.land/std/ws" target="_blank" rel="noopener">ws</a>ï¼šWebSocket ç›¸å…³ï¼›</li>
</ul>
<p>è¿™ä¸ªåº“ä¼šæ ¹æ®å®é™…éœ€è¦ä¸æ–­çš„å®Œå–„å’Œæ‰©å……ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è´¡çŒ®è‡ªå·±çš„ä¸€åˆ†åŠ›é‡ã€‚</p>
<h3 id="å†…ç½®å·¥å…·"><a href="#å†…ç½®å·¥å…·" class="headerlink" title="å†…ç½®å·¥å…·"></a>å†…ç½®å·¥å…·</h3><p>Deno æœ¬ç€å»å¼€å‘ä¾èµ–çš„æ€æƒ³ï¼Œæä¾›äº†ä¸€ç»„å®ç”¨çš„å·¥å…·ï¼š</p>
<ul>
<li>deno bundle: æ‰“åŒ…æ–‡ä»¶</li>
<li>deno fmt: æ ¼å¼åŒ–</li>
<li>deno lint: ä»£ç æ£€æŸ¥ï¼ˆè¿˜æœªå®ç°ï¼‰</li>
<li>deno test: æµ‹è¯•</li>
</ul>
<h4 id="deno-bundle"><a href="#deno-bundle" class="headerlink" title="deno bundle"></a><strong>deno bundle</strong></h4><p>ä½ å¯ä»¥ç†è§£ä¸º webpack æ‰“åŒ…æ–‡ä»¶ä¸€æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// foo.ts</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">'foo'</span> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> obj</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> æ‰“åŒ…</span><br><span class="line">deno bundle foo.ts foo.bundle.js</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js å¼•å…¥æ‰“åŒ…åçš„æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'./foo.bundle.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(foo)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">deno run index.js</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"foo"</span> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="deno-fmt"><a href="#deno-fmt" class="headerlink" title="deno fmt"></a><strong>deno fmt</strong></h4><p>ä½ å¯ä»¥ç†è§£ä¸º Prettier çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line"><span class="meta">#</span> æ³¨æ„å·¦ä¾§æœ‰ç©ºæ ¼</span><br><span class="line">echo "console.log( 'foo')" &gt; index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> æ ¼å¼åŒ–</span><br><span class="line">deno fmt index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹æ–‡ä»¶</span><br><span class="line">cat index.js</span><br><span class="line">console.log("foo"); # å·¦ä¾§ç©ºæ ¼æ²¡äº† ğŸ˜Š</span><br></pre></td></tr></table></figure>
<h4 id="deno-test"><a href="#deno-test" class="headerlink" title="deno test"></a><strong>deno test</strong></h4><blockquote>
<p>ä½ å¯ä»¥ç†è§£ä¸º Jest çš„åŠŸèƒ½ï¼š</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥æ–­è¨€æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> &#123; assertEquals &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std/testing/asserts.ts"</span>;</span><br><span class="line"></span><br><span class="line">Deno.test(<span class="string">"hello test"</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="string">'hello'</span> + <span class="string">' test'</span>;</span><br><span class="line">  assertEquals(x, <span class="string">'hello test'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="å­¦ä¹ å’Œèµ„æ–™"><a href="#å­¦ä¹ å’Œèµ„æ–™" class="headerlink" title="å­¦ä¹ å’Œèµ„æ–™"></a>å­¦ä¹ å’Œèµ„æ–™</h2><ul>
<li><a href="https://deno.land/" target="_blank" rel="noopener">å®˜ç½‘</a>: æƒå¨ä¸€æ‰‹ä¿¡æ¯ï¼›</li>
<li><a href="https://deno.land/manual" target="_blank" rel="noopener">å…¥é—¨æ–‡æ¡£</a>ï¼šä»äº†è§£åˆ°å…¥é—¨ï¼›</li>
<li><a href="https://deno.land/std" target="_blank" rel="noopener">æ ‡å‡†æ¨¡å—</a>ï¼šä¸‡ç‰©ä¹‹æºï¼›</li>
<li><a href="https://deno.land/x" target="_blank" rel="noopener">ç¬¬ä¸‰æ–¹æ¨¡å—</a>ï¼šç¾¤è‹±èŸèƒï¼›</li>
<li><a href="https://github.com/denocn/deno_install" target="_blank" rel="noopener">å›½å†…å®‰è£…åŠ é€Ÿ</a>ï¼šå‘Šåˆ«å®‰è£…æ…¢ï¼›</li>
<li><a href="https://nugine.github.io/deno-manual-cn/" target="_blank" rel="noopener">ä¸­æ–‡æ‰‹å†Œ</a>ï¼šè‹±è¯­çŠ¯å›°è€…çš„ç¦éŸ³ï¼›</li>
<li><a href="https://github.com/denodev/typedoc" target="_blank" rel="noopener">ts å®šä¹‰ä¸­æ–‡</a>ï¼šåŒä¸Šï¼Œä¸­æ–‡è§£é‡Šçš„ ts å®šä¹‰ã€‚</li>
</ul>
<blockquote>
<p>ä½œè€…ï¼šdream2023<br>é“¾æ¥ï¼š<a href="https://juejin.im/post/5ebcabb2e51d454da74185a9" target="_blank" rel="noopener">https://juejin.im/post/5ebcabb2e51d454da74185a9</a><br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>Denoæ­£å¼å‘å¸ƒï¼Œå½»åº•å¼„æ˜ç™½å’ŒNodeçš„åŒºåˆ«</title>
    <url>/%E8%BD%AC%E8%BD%BD/Deno%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%EF%BC%8C%E5%BD%BB%E5%BA%95%E5%BC%84%E6%98%8E%E7%99%BD%E5%92%8CNode%E7%9A%84%E5%8C%BA%E5%88%AB.html</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Deno å·²ç»æ­£å¼å‘å¸ƒäº†ğŸ‰ï¼<a href="https://deno.land/" target="_blank" rel="noopener">å®˜ç½‘åœ°å€</a></p>
<p>æˆ‘è¯´è¿™å¥è¯æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤šå‰ç«¯ å’Œ NodeJS å·¥ï¼ˆç ï¼‰ç¨‹ï¼ˆå†œï¼‰å¸ˆå·²ç»æŒ‰ä¸ä½è‡ªå·±çš„40ç±³å¤§åˆ€äº†ã€‚å¿ƒä¸­çš„ä¸ä»…æ„Ÿæ…¨å‰ç«¯æ˜¯çœŸçš„ä¼šé€ è½®å­ï¼Œæœ‰äº† node è¿˜ä¸å¤Ÿå—ï¼Œè¿˜æ²¡å­¦ä¼š node åˆæäº†ä¸ª denoï¼Œnode å’Œ deno å•¥åŒºåˆ«ï¼Ÿï¼</p>
<p>çš„ç¡®ï¼Œdeno å’Œ node å½¢æ€å¾ˆç›¸ä¼¼ï¼Œè¦è§£å†³çš„é—®é¢˜ä¼¼ä¹ä¹Ÿç›¸åŒï¼Œé‚£ä»–ä»¬åˆ°åº•æœ‰å•¥åŒºåˆ«ï¼Œè¿™ä¸€åˆ‡ç©¶ç«Ÿæ˜¯é“å¾·çš„æ²¦ä¸§è¿˜æ˜¯ ry ï¼ˆä½œè€…ï¼‰äººæ€§çš„æ‰­æ›²ï¼Œè®©æˆ‘ä»¬èµ°è¿›æœ¬ç¯‡æ–‡ç« ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚</p>
<h2 id="Deno-VS-Node"><a href="#Deno-VS-Node" class="headerlink" title="Deno VS Node"></a>Deno VS Node</h2><table>
<thead>
<tr>
<th></th>
<th>Node</th>
<th>Deno</th>
</tr>
</thead>
<tbody>
<tr>
<td>API å¼•ç”¨æ–¹å¼</td>
<td>æ¨¡å—å¯¼å…¥</td>
<td>å…¨å±€å¯¹è±¡</td>
</tr>
<tr>
<td>æ¨¡å—ç³»ç»Ÿ</td>
<td>CommonJS &amp; æ–°ç‰ˆ node å®éªŒæ€§ ES Module</td>
<td>ES Module æµè§ˆå™¨å®ç°</td>
</tr>
<tr>
<td>å®‰å…¨</td>
<td>æ— å®‰å…¨é™åˆ¶</td>
<td>é»˜è®¤å®‰å…¨</td>
</tr>
<tr>
<td>Typescript</td>
<td>ç¬¬ä¸‰æ–¹ï¼Œå¦‚é€šè¿‡ ts-node æ”¯æŒ</td>
<td>åŸç”Ÿæ”¯æŒ</td>
</tr>
<tr>
<td>åŒ…ç®¡ç†</td>
<td>npm + node_modules</td>
<td>åŸç”Ÿæ”¯æŒ</td>
</tr>
<tr>
<td>å¼‚æ­¥æ“ä½œ</td>
<td>å›è°ƒ</td>
<td>Promise</td>
</tr>
<tr>
<td>åŒ…åˆ†å‘</td>
<td>ä¸­å¿ƒåŒ– npmjs.com</td>
<td>å»ä¸­å¿ƒåŒ– import url</td>
</tr>
<tr>
<td>å…¥å£</td>
<td>package.json é…ç½®</td>
<td>import url ç›´æ¥å¼•å…¥</td>
</tr>
<tr>
<td>æ‰“åŒ…ã€æµ‹è¯•ã€æ ¼å¼åŒ–</td>
<td>ç¬¬ä¸‰æ–¹å¦‚ eslintã€gulpã€webpackã€babel ç­‰</td>
<td>åŸç”Ÿæ”¯æŒ</td>
</tr>
</tbody>
</table>
<h3 id="1-å†…ç½®-API-å¼•ç”¨æ–¹å¼ä¸åŒ"><a href="#1-å†…ç½®-API-å¼•ç”¨æ–¹å¼ä¸åŒ" class="headerlink" title="1.å†…ç½® API å¼•ç”¨æ–¹å¼ä¸åŒ"></a>1.å†…ç½® API å¼•ç”¨æ–¹å¼ä¸åŒ</h3><h4 id="node-æ¨¡å—å¯¼å…¥"><a href="#node-æ¨¡å—å¯¼å…¥" class="headerlink" title="node æ¨¡å—å¯¼å…¥"></a>node æ¨¡å—å¯¼å…¥</h4><p>node å†…ç½® API é€šè¿‡æ¨¡å—å¯¼å…¥çš„æ–¹å¼å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">fs.readFileSync(<span class="string">"./data.txt"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="deno-å…¨å±€å¯¹è±¡"><a href="#deno-å…¨å±€å¯¹è±¡" class="headerlink" title="deno å…¨å±€å¯¹è±¡"></a>deno å…¨å±€å¯¹è±¡</h4><p>è€Œ deno åˆ™æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ <code>Deno</code> çš„å±æ€§å’Œæ–¹æ³•ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Deno.readFileSync(<span class="string">"./data.txt"</span>);</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ deno æœ‰å“ªäº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>repl</code> çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deno # æˆ– deno repl</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ <code>repl</code> åï¼Œè¾“å…¥ <code>Deno</code> å›è½¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> Buffer: [Function: Buffer],</span><br><span class="line"> readAll: [AsyncFunction: readAll],</span><br><span class="line"> readAllSync: [Function: readAllSync],</span><br><span class="line"> writeAll: [AsyncFunction: writeAll],</span><br><span class="line"> writeAllSync: [Function: writeAllSync],</span><br><span class="line"><span class="meta"> #</span> .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§å¤„ç†çš„æ–¹å¼å¥½å¤„æ˜¯ç®€å•ã€æ–¹ä¾¿ï¼Œåå¤„æ˜¯æ²¡æœ‰åˆ†ç±»ï¼Œæƒ³æŸ¥æ‰¾å¿˜è®°çš„ API æ¯”è¾ƒå›°éš¾ã€‚æ€»ä½“æ¥è¯´è§ä»è§æ™ºã€‚</p>
<h3 id="2-æ¨¡å—ç³»ç»Ÿ"><a href="#2-æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="2.æ¨¡å—ç³»ç»Ÿ"></a>2.æ¨¡å—ç³»ç»Ÿ</h3><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¨¡å—ç³»ç»Ÿï¼Œè¿™ä¹Ÿæ˜¯ deno å’Œ node å·®åˆ«æœ€å¤§çš„åœ°æ–¹ï¼ŒåŒæ ·ä¹Ÿæ˜¯ deno å’Œ node ä¸å…¼å®¹çš„åœ°æ–¹ã€‚</p>
<h4 id="node-CommonJS-è§„èŒƒ"><a href="#node-CommonJS-è§„èŒƒ" class="headerlink" title="node CommonJS è§„èŒƒ"></a>node CommonJS è§„èŒƒ</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ node é‡‡ç”¨çš„æ˜¯ <a href="https://javascript.ruanyifeng.com/nodejs/module.html" target="_blank" rel="noopener">CommonJS</a> è§„èŒƒï¼Œè€Œ deno åˆ™æ˜¯é‡‡ç”¨çš„ ES Module çš„æµè§ˆå™¨å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆæ¥è®¤è¯†ä¸€ä¸‹ï¼š</p>
<h4 id="ES-Module-çš„æµè§ˆå™¨å®ç°"><a href="#ES-Module-çš„æµè§ˆå™¨å®ç°" class="headerlink" title="ES Module çš„æµè§ˆå™¨å®ç°"></a>ES Module çš„æµè§ˆå™¨å®ç°</h4><p>è€Œ deno åˆ™é‡‡ç”¨ <strong>ES Module çš„æµè§ˆå™¨å®ç°</strong>ï¼Œå…·ä½“å…³äº <a href="https://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener">ES Module</a> æƒ³å¿…å¤§å®¶éƒ½æ—©å·²ç†ŸçŸ¥ï¼Œä½†å…¶æµè§ˆå™¨å®ç°å¯èƒ½å¤§å®¶è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å…¶æµè§ˆå™¨å®ç°ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ³¨æ„è¿™é‡Œä¸€å®šè¦åŠ ä¸Š type="module" --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// ä» URL å¯¼å…¥</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"https://unpkg.com/vue@2.6.11/dist/vue.esm.browser.js"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ä»ç›¸å¯¹è·¯å¾„å¯¼å…¥</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> * <span class="keyword">as</span> utils <span class="keyword">from</span> <span class="string">"./utils.js"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ä»ç»å¯¹è·¯å¾„å¯¼å…¥</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> <span class="string">"/index.js"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// ä¸æ”¯æŒ</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">"foo.js"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> bar <span class="keyword">from</span> <span class="string">"bar/index.js"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> zoo <span class="keyword">from</span> <span class="string">"./index"</span>; <span class="comment">// æ²¡æœ‰ .js åç¼€</span></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="deno-çš„æ¨¡å—è§„èŒƒ"><a href="#deno-çš„æ¨¡å—è§„èŒƒ" class="headerlink" title="deno çš„æ¨¡å—è§„èŒƒ"></a>deno çš„æ¨¡å—è§„èŒƒ</h4><p>deno å®Œå…¨éµå¾ª es module æµè§ˆå™¨å®ç°ï¼Œdeno ä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ”¯æŒ</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">"https://deno.land/std/fs/mod.ts"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; deepCopy &#125; <span class="keyword">from</span> <span class="string">"./deepCopy.js"</span>;</span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">"/foo.ts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸æ”¯æŒ</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">"foo.ts"</span>;</span><br><span class="line"><span class="keyword">import</span> bar <span class="keyword">from</span> <span class="string">"./bar"</span>; <span class="comment">// å¿…é¡»æŒ‡å®šæ‰©å±•å</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°å…¶å’Œæˆ‘ä»¬å¹³å¸¸åœ¨ webpack æˆ–è€… ts ä½¿ç”¨ es module æœ€å¤§çš„<strong>ä¸åŒ</strong>ï¼š</p>
<ul>
<li>å¯ä»¥é€šè¿‡ import url ç›´æ¥å¼•ç”¨çº¿ä¸Šèµ„æºï¼›</li>
<li>èµ„æºä¸å¯çœç•¥æ‰©å±•åå’Œæ–‡ä»¶åã€‚</li>
</ul>
<p>å…³äºç¬¬ 1 ç‚¹ï¼Œäº‰è®®éå¸¸å¤§ï¼Œæœ‰äººå¾ˆçœ‹å¥½ï¼Œè§‰å¾—æå¤§çš„æ‰©å±•äº† deno åº“çš„èŒƒå›´ï¼›æœ‰äººåˆ™ä¸å¤ªçœ‹å¥½ï¼Œè§‰å¾—å›½å†…ç½‘é€Ÿçš„åŸå› ï¼Œå¹¶ä¸å®ç”¨ã€‚å¤§å®¶çš„çœ‹æ³•å¦‚ä½•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºå‘è¡¨ ğŸ¤”</p>
<h3 id="3-å®‰å…¨"><a href="#3-å®‰å…¨" class="headerlink" title="3.å®‰å…¨"></a>3.å®‰å…¨</h3><p>å¦‚æœæ¨¡å—è§„èŒƒæ˜¯ node å’Œ deno æœ€å¤§çš„ä¸åŒï¼Œé‚£ä¹ˆå¯¹å®‰å…¨çš„å¤„ç†ï¼Œåˆ™æ˜¯å¦å¤–ä¸€ä¸ªè®©äººæ‘¸ä¸ç€å¤´è„‘çš„åœ°æ–¹ã€‚</p>
<h4 id="æ¨¡æ‹Ÿç›—å·"><a href="#æ¨¡æ‹Ÿç›—å·" class="headerlink" title="æ¨¡æ‹Ÿç›—å·"></a>æ¨¡æ‹Ÿç›—å·</h4><p>åœ¨ä»‹ç»ä¹‹å‰æˆ‘ä»¬å…ˆæ€è€ƒä¸€ä¸‹è¿™ä¸ªåœºæ™¯ä¼šä¸ä¼šå‡ºç°ï¼š</p>
<p>æˆ‘åšäº†ä¸€ä¸ªåŸºäºå‘½ä»¤è¡Œçš„ä¸€é”®ä¸Šç½‘å·¥å…· <code>breakwall</code>ï¼Œæ¯æœˆ 1 ä¸ª G å…è´¹æµé‡ï¼Œç„¶åå°†å‹ç¼©åçš„ JS ä»£ç å‘å¸ƒåˆ° npm ä¸Šï¼Œç„¶åååœ¨å„ç§æ¸ é“å®£ä¼ ä¸€æ³¢ã€‚</p>
<p>ç¾Šæ¯›å…šå…´é«˜å½©çƒˆçš„ <code>cnpm install -g breakwall</code>ï¼Œç„¶åæ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘å·å·çš„å°†è¯¸ä½çš„ ssh å¯†é’¥å’Œå„ç§èƒ½å·çš„æ–‡æ¡£åŠå›¾ç‰‡å·å·ä¸Šä¼ åˆ°æˆ‘çš„æœåŠ¡å™¨ï¼Œåœ¨è®¾å®šæœŸé™åˆ°æœŸåï¼Œåˆ é™¤ç”µè„‘ä¸Šèµ„æ–™ï¼Œç•™ä¸‹ä¸€å¥æ‹¿é’±æ¢èµ„æ–™ï¼Œä»…æ”¯æŒæ¯”ç‰¹å¸ã€‚</p>
<h4 id="é»˜è®¤å®‰å…¨çš„-deno"><a href="#é»˜è®¤å®‰å…¨çš„-deno" class="headerlink" title="é»˜è®¤å®‰å…¨çš„ deno"></a>é»˜è®¤å®‰å…¨çš„ deno</h4><p>å¦‚æœä½ è§‰å¾—ä»¥ä¸Šæƒ…å†µæœ‰å¯èƒ½å‡ºç°ï¼Œåˆ™ä¼šè§‰å¾—ä¸‹é¢çš„åŠŸèƒ½å¾ˆå®ç”¨ã€‚æˆ‘ä»¬å…ˆç”¨ deno æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">let</span> rsa = Deno.readFileSync(Deno.dir(<span class="string">"home"</span>) + <span class="string">"/.ssh/id_rsa"</span>);</span><br><span class="line"></span><br><span class="line">rsa = <span class="keyword">new</span> TextDecoder().decode(rsa);</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">"http://jsonplaceholder.typicode.com/posts/1"</span>, &#123;</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(rsa)</span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"å¯†é’¥å‘é€æˆåŠŸï¼Œå˜¿å˜¿å˜¿ğŸ˜œ"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"start breakwall..."</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS:<code>--unstable</code> æ˜¯ç”±äº<code>Deno.dir</code> API ä¸ç¨³å®š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --unstable index.js</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†ä¼šå¾—åˆ°å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --unstable  index.js</span><br><span class="line">error: Uncaught PermissionDenied: access to environment variables, run again with the --allow-env flag</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æ„æ€å°±æ˜¯æƒé™å¼‚å¸¸ï¼Œéœ€è¦è®¿é—®ç¯å¢ƒå˜é‡ï¼Œéœ€è¦åŠ ä¸Š <code>--allow-env</code>ï¼Œæˆ‘ä»¬åŠ ä¸Šè¿™ä¸ªå‚æ•°å†è¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --unstable --allow-env index.js</span><br><span class="line">error: Uncaught PermissionDenied: read access to "/Users/Xiuming/.ssh/id_rsa", run again with the --allow-read flag</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å¦‚æ­¤åå¤ï¼Œè¿˜éœ€åŠ ä¸Š <code>--allow-read</code>ã€<code>--allow-net</code> ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --unstable --allow-env --allow-read --allow-net  index.js</span><br><span class="line">start breakwall...</span><br><span class="line">å¯†é’¥å‘é€æˆåŠŸï¼Œå˜¿å˜¿å˜¿ğŸ˜œ</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œæ€»ç®—æ˜¯å‘é€æˆåŠŸäº†ï¼Œè¦æƒ³ç›—å–å¯†é’¥å®å±ä¸æ˜“ã€‚</p>
<h4 id="ç™½åå•"><a href="#ç™½åå•" class="headerlink" title="ç™½åå•"></a>ç™½åå•</h4><p>é‚£æœ‰äººå°±è¯´äº†ï¼Œå¦‚æœæˆ‘çš„åº”ç”¨ç¡®å®éœ€è¦è®¿é—®ç½‘ç»œå’Œæ–‡ä»¶ï¼Œä½†æ˜¯æœ‰ä¸æƒ³è®©å®ƒè®¿é—® .ssh æ–‡ä»¶æœ‰æ²¡æœ‰åŠæ³•ï¼Ÿ</p>
<p>å½“ç„¶æœ‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ <code>--allow-read</code> å’Œ <code>--allow-net</code> æŒ‡å®šç™½åå•ï¼Œåå•ä¹‹å¤–éƒ½ä¸å¯è®¿é—®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --unstable --allow-env --allow-read --allow-net=https://www.baidu.com  index.js</span><br><span class="line">start breakwall...</span><br><span class="line">error: Uncaught PermissionDenied: network access to "http://jsonplaceholder.typicode.com/posts/1", run again with the --allow-net flag</span><br><span class="line">    at unwrapResponse ($deno$/ops/dispatch_json.ts:43:11)</span><br><span class="line">    at Object.sendAsync ($deno$/ops/dispatch_json.ts:98:10)</span><br><span class="line">    at async fetch ($deno$/web/fetch.ts:591:27)</span><br></pre></td></tr></table></figure>
<h4 id="ç®€åŒ–å‚æ•°"><a href="#ç®€åŒ–å‚æ•°" class="headerlink" title="ç®€åŒ–å‚æ•°"></a>ç®€åŒ–å‚æ•°</h4><p>å¦‚æœç¡®è®¤æ˜¯æ²¡é—®é¢˜ï¼Œæˆ–è€…æ˜¯è‡ªå·±å¼€å‘è½¯ä»¶æ—¶ï¼Œå›¾ä¸ªæ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-A</code> æˆ– <code>--allow-all</code> å‚æ•°å…è®¸æ‰€æœ‰æƒé™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno -A --unstable index.js</span><br><span class="line">start breakwall...</span><br><span class="line">å¯†é’¥å‘é€æˆåŠŸï¼Œå˜¿å˜¿å˜¿ğŸ˜œ</span><br></pre></td></tr></table></figure>
<p>å®‰å…¨è¿™æ–¹é¢è§ä»è§æ™ºï¼Œæœ‰äººè§‰å¾—æ˜¯å¤šä½™ï¼Œæœ‰äººè§‰å¾—å¾ˆå¥½ç”¨ï¼Œæå¤§çš„å¢å¼ºäº†å®‰å…¨æ€§ã€‚å¦‚æœä½ å±äºè§‰å¾—è¿™ä¸ªåŠŸèƒ½å¤šä½™çš„ï¼Œå¯ä»¥ <code>deno run -A xxx</code> å³å¯ã€‚</p>
<h3 id="4-å…¼å®¹æµè§ˆå™¨-API"><a href="#4-å…¼å®¹æµè§ˆå™¨-API" class="headerlink" title="4.å…¼å®¹æµè§ˆå™¨ API"></a>4.å…¼å®¹æµè§ˆå™¨ API</h3><p>å¾ˆå¤šäººä¸ç†è§£ï¼Œä¸ºä»€ä¹ˆä½ ä¸€ä¸ªæœåŠ¡ç«¯è¯­è¨€è¦å…¼å®¹æµè§ˆå™¨ APIï¼Œä»¥åŠæ€ä¹ˆå…¼å®¹ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦å…¼å®¹æµè§ˆå™¨-API"><a href="#ä¸ºä»€ä¹ˆè¦å…¼å®¹æµè§ˆå™¨-API" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å…¼å®¹æµè§ˆå™¨ API"></a>ä¸ºä»€ä¹ˆè¦å…¼å®¹æµè§ˆå™¨ API</h4><p>å…³äºä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸¾ä¸ªæ —å­å¤§å®¶å°±æ˜ç™½äº†ï¼šåœ¨è®¾è®¡ node ä¹‹å¤„ï¼Œå…³äºè¾“å‡ºå‡½æ•°æœ¬æ¥å« <code>print</code> ä¹‹ç±»çš„ï¼Œåæ¥æœ‰äººæè®®ä¸ºä»€ä¹ˆä¸å« <code>console.log</code>ï¼Œry è§‰å¾—æŒºä¸é”™ï¼Œäºæ˜¯å°±æ¥çº³äº†æ„è§ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™ä¸ªè®¾è®¡å¹¶ä¸æ˜¯åˆ»æ„ä¸ºä¹‹ï¼Œè€Œ deno çš„è®¾è®¡åˆ™å¯ä»¥ä¸ºä¹‹ï¼Œé€šè¿‡ä¸æµè§ˆå™¨ API ä¿æŒä¸€è‡´ï¼Œæ¥<strong>å‡å°‘å¤§å®¶çš„è®¤çŸ¥</strong>ã€‚</p>
<h4 id="æ€ä¹ˆå…¼å®¹æµè§ˆå™¨-API"><a href="#æ€ä¹ˆå…¼å®¹æµè§ˆå™¨-API" class="headerlink" title="æ€ä¹ˆå…¼å®¹æµè§ˆå™¨ API"></a>æ€ä¹ˆå…¼å®¹æµè§ˆå™¨ API</h4><h5 id="æ¦‚å¿µä¸Šå…¼å®¹"><a href="#æ¦‚å¿µä¸Šå…¼å®¹" class="headerlink" title="æ¦‚å¿µä¸Šå…¼å®¹"></a>æ¦‚å¿µä¸Šå…¼å®¹</h5><ul>
<li>æ¨¡å—ç³»ç»Ÿï¼Œä»ä¸Šé¢ä»‹ç»çœ‹å‡º deno æ˜¯å®Œå…¨éµå¾ªæµè§ˆå™¨å®ç°çš„ï¼›</li>
<li>é»˜è®¤å®‰å…¨ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯è‡ªå·±åˆ›é€ çš„æ¦‚å¿µï¼Œw3c æ—©å·²åšå‡º<a href="https://w3c.github.io/permissions/#permission-registry" target="_blank" rel="noopener">æµè§ˆå™¨æƒé™</a>çš„è§„å®šï¼Œæˆ‘ä»¬åœ¨åšå°ç¨‹åºçš„æ—¶å€™å°¤ä¸ºæ˜æ˜¾ï¼Œéœ€è¦è·å–å„ç§æƒé™ï¼›</li>
<li>å¯¹äºå¼‚æ­¥æ“ä½œè¿”å› Promiseï¼›</li>
<li>ä½¿ç”¨ ArrayBuffer å¤„ç†äºŒè¿›åˆ¶ï¼›</li>
<li>ç­‰ç­‰â€¦</li>
</ul>
<h5 id="å­˜åœ¨-window-å…¨å±€å˜é‡"><a href="#å­˜åœ¨-window-å…¨å±€å˜é‡" class="headerlink" title="å­˜åœ¨ window å…¨å±€å˜é‡"></a>å­˜åœ¨ window å…¨å±€å˜é‡</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span> === <span class="keyword">this</span>, <span class="built_in">window</span> === self, <span class="built_in">window</span> === globalThis);</span><br></pre></td></tr></table></figure>
<h5 id="å®ç°äº†-WindowOrWorkerGlobalScope-çš„å…¨éƒ¨æ–¹æ³•"><a href="#å®ç°äº†-WindowOrWorkerGlobalScope-çš„å…¨éƒ¨æ–¹æ³•" class="headerlink" title="å®ç°äº† WindowOrWorkerGlobalScope çš„å…¨éƒ¨æ–¹æ³•"></a>å®ç°äº† <a href="[developer.mozilla.org/zh-CN/docs/â€¦](https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope">WindowOrWorkerGlobalScope</a> çš„å…¨éƒ¨æ–¹æ³•</h5><p>å…·ä½“æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/denoland/deno/blob/master/cli/js/lib.deno.shared_globals.d.ts" target="_blank" rel="noopener">lib.deno.shared_globals.d.ts</a> å’Œ <a href="https://github.com/denoland/deno/blob/master/cli/js/lib.deno.window.d.ts" target="_blank" rel="noopener">lib.deno.window.d.ts</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚æ–¹æ³•</span></span><br><span class="line">fetch(<span class="string">"https://baidu.com"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// base64 è½¬åŒ–</span></span><br><span class="line"><span class="keyword">let</span> encodedData = btoa(<span class="string">"Hello, world"</span>); <span class="comment">// ç¼–ç </span></span><br><span class="line"><span class="keyword">let</span> decodedData = atob(encodedData); <span class="comment">// è§£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾®ä»»åŠ¡</span></span><br><span class="line">queueMicrotask(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ç­‰...</span></span><br></pre></td></tr></table></figure>
<h5 id="å¤§è¶‹åŠ¿"><a href="#å¤§è¶‹åŠ¿" class="headerlink" title="å¤§è¶‹åŠ¿"></a>å¤§è¶‹åŠ¿</h5><p>æ€»ä½“è€Œè¨€ï¼Œå¦‚æœæœåŠ¡ç«¯å’Œæµè§ˆå™¨ç«¯å­˜åœ¨ç›¸åŒæ¦‚å¿µï¼Œdeno å°±ä¸ä¼šåˆ›é€ æ–°çš„æ¦‚å¿µã€‚è¿™ä¸€ç‚¹å…¶å® node ä¹Ÿåœ¨åšï¼Œæ–°çš„ <a href="https://github.com/nodejs/node/blob/master/doc/changelogs/CHANGELOG_V14.md" target="_blank" rel="noopener">node 14.0 CHANGELOG</a> å°±ä¹ŸæåŠè¦å®ç° <code>Universal JavaScript</code> å’Œ <code>Spec compliance and Web Compatibility</code>çš„æ€æƒ³ï¼Œæ‰€ä»¥è¿™ç‚¹å¤§å®¶åº”è¯¥éƒ½ä¼šæ¥å—å§ï¼Œæ¯•ç«Ÿå¤§åŠ¿æ‰€è¶‹è¶‹åŠ¿ã€‚</p>
<h3 id="5-æ”¯æŒ-typescript"><a href="#5-æ”¯æŒ-typescript" class="headerlink" title="5.æ”¯æŒ typescript"></a>5.æ”¯æŒ typescript</h3><p>ä¸ç®¡ä½ å–œæ¬¢ä¸å¦ï¼Œ2020 å¹´äº†ï¼Œå¿…é¡»å­¦ä¹  TS äº†ï¼ˆèµ·ç åœ¨é¢è¯•çš„æ—¶å€™æ˜¯äº®ç‚¹ï¼‰ã€‚å­¦å®Œä¹‹åä½ æ‰ä¼šæ˜ç™½<strong>çœŸé¦™å®šå¾‹</strong>çœŸçš„æ— å¤„ä¸åœ¨ã€‚</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">let</span> str: <span class="built_in">string</span> = <span class="string">"çœŸé¦™å®šå¾‹"</span>;</span><br><span class="line">str = <span class="number">132</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run index.js</span><br><span class="line">error TS2322: Type '123' is not assignable to type 'string'.</span><br><span class="line"></span><br><span class="line">â–º file:///Users/Xiuming/Desktop/index.ts:2:1</span><br><span class="line"></span><br><span class="line">2 str = 123</span><br><span class="line">  ~~~</span><br></pre></td></tr></table></figure>
<h3 id="6-å»-node-modules"><a href="#6-å»-node-modules" class="headerlink" title="6.å» node_modules"></a>6.å» node_modules</h3><p>deno æ²¡æœ‰ node_modulesï¼Œé‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆè¿›è¡ŒåŒ…ç®¡ç†çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; white, bgRed &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std/fmt/colors.ts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bgRed(white(<span class="string">"hello world!"</span>)));</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run index.js</span><br><span class="line">Download https://deno.land/std/fmt/colors.ts</span><br><span class="line">Compile https://deno.land/std/fmt/colors.ts</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°å…¶æœ‰ <code>Download</code> å’Œ <code>Compile</code> ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬ä¼šäº§ç”Ÿå‡ ä¸ªç–‘é—®ï¼š</p>
<p><strong>1ã€æ¯æ¬¡æ‰§è¡Œéƒ½è¦ä¸‹è½½å—ï¼Ÿ</strong> è§£ï¼šæˆ‘ä»¬åªéœ€è¦<strong>å†æ‰§è¡Œä¸€æ¬¡</strong>å°±èƒ½æ˜ç™½ï¼Œä¸éœ€è¦æ¯æ¬¡ä¸‹è½½ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run index.js</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure>
<p><strong>2ã€Download å’Œ Compile çš„æ–‡ä»¶åœ¨å“ªé‡Œå‘¢ï¼Ÿ</strong> è§£ï¼šæˆ‘ä»¬ä¼šå‘ç°ï¼Œå½“å‰æ‰§è¡Œçš„ç›®å½•ï¼Œå¹¶æ²¡æœ‰ Download å’Œ Compile æ–‡ä»¶ï¼Œé‚£æ–‡ä»¶æ”¾åœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ <code>deno --help</code> å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno --help</span><br><span class="line">SUBCOMMANDS:</span><br><span class="line"><span class="meta">#</span> ...</span><br><span class="line">info           Show info about cache or info related to source file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ...</span><br><span class="line">ENVIRONMENT VARIABLES:</span><br><span class="line">    DENO_DIR   Set deno's base directory (defaults to $HOME/.deno)</span><br></pre></td></tr></table></figure>
<p><code>deno info</code> å‘½ä»¤å±•ç¤ºäº†ä¾èµ–å…³ç³»ï¼Œç±»ä¼¼ <code>package.json</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno info index.js</span><br><span class="line">local: /Users/Xiuming/Desktop/index.js</span><br><span class="line">type: JavaScript</span><br><span class="line">deps:</span><br><span class="line">file:///Users/Xiuming/Desktop/index.js</span><br><span class="line">  â””â”€â”€ https://deno.land/std/fmt/colors.ts</span><br></pre></td></tr></table></figure>
<p><code>DENO_DIR</code> åˆ™ä¸ºå®é™…çš„å®‰è£…å’Œç¼–è¯‘ç›®å½•ï¼Œç›¸å½“äº <code>node_modules</code>ï¼Œé»˜è®¤ä¸º <code>$HOME/.deno</code>ï¼ˆå‘½ä»¤æç¤ºæ˜¯è¿™æ ·çš„ï¼Œä½†å®é™…éœ€è¦æŒ‡å®šä¸€ä¸‹ç¯å¢ƒå˜é‡ <code>export DENO_DIR=$HOME/.deno</code>ï¼‰ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> tree $HOME/.deno</span><br><span class="line">/Users/Xiuming/.deno</span><br><span class="line">â”œâ”€â”€ deps</span><br><span class="line">â”‚Â Â  â””â”€â”€ https</span><br><span class="line">â”‚Â Â      â””â”€â”€ deno.land</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ 3574883d8acbaf00e28990ec8e83d71084c4c668c1dc7794be25208c60cfc935</span><br><span class="line">â”‚Â Â          â””â”€â”€ 3574883d8acbaf00e28990ec8e83d71084c4c668c1dc7794be25208c60cfc935.metadata.json</span><br><span class="line">â””â”€â”€ gen</span><br><span class="line">    â””â”€â”€ https</span><br><span class="line">        â””â”€â”€ deno.land</span><br><span class="line">            â””â”€â”€ std</span><br><span class="line">                â””â”€â”€ fmt</span><br><span class="line">                    â”œâ”€â”€ colors.ts.js</span><br><span class="line">                    â”œâ”€â”€ colors.ts.js.map</span><br><span class="line">                    â””â”€â”€ colors.ts.meta</span><br><span class="line"></span><br><span class="line">8 directories, 5 files</span><br></pre></td></tr></table></figure>
<p><strong>3ã€æ²¡ç½‘ç»œäº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>æˆ‘ä»¬æœ‰äº›åœºæ™¯æ˜¯å°†æœ¬åœ°å†™å¥½çš„ä»£ç éƒ¨ç½²åˆ°æ²¡æœ‰ç½‘ç»œçš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå½“æ‰§è¡Œ <code>deno run xxx</code> æ—¶ï¼Œå°±æ˜¯æç¤º error sending requestã€‚</p>
<p><code>è§£ï¼š</code>å°†ä¸Šé¢çš„ç¼“å­˜ç›®å½•å†…å®¹ï¼Œç›´æ¥<strong>æ‹·è´åˆ°æœåŠ¡å™¨</strong>å¹¶æŒ‡å®šç¯å¢ƒå˜é‡åˆ°å…¶ç›®å½•å³å¯ã€‚</p>
<p><strong>4ã€ä¾èµ–ä»£ç æ›´æ–°äº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p><code>è§£ï¼š</code>å½“ä¾èµ–æ¨¡å—æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>--reload</code> è¿›è¡Œæ›´æ–°ç¼“å­˜ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --reload index.js</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<strong>ç™½åå•</strong>çš„æ–¹å¼ï¼Œåªæ›´æ–°éƒ¨åˆ†ä¾èµ–ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> deno run --reload=https://deno.land index.js</span><br></pre></td></tr></table></figure>
<p><strong>5ã€ä»…ç¼“å­˜ä¾èµ–ï¼Œä¸æ‰§è¡Œä»£ç æœ‰åŠæ³•å—ï¼Ÿ</strong></p>
<p><code>è§£ï¼š</code>æœ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>deno cache index.js</code> è¿›è¡Œä¾èµ–ç¼“å­˜ã€‚</p>
<h3 id="7-æ ‡å‡†æ¨¡å—-ä¸-node-API-å…¼å®¹"><a href="#7-æ ‡å‡†æ¨¡å—-ä¸-node-API-å…¼å®¹" class="headerlink" title="7.æ ‡å‡†æ¨¡å— ä¸ node API å…¼å®¹"></a>7.æ ‡å‡†æ¨¡å— ä¸ node API å…¼å®¹</h3><p>æˆ‘ä»¬é€šè¿‡ç¬¬ 1 ç‚¹å¯ä»¥çœ‹åˆ°ï¼Œå…¶å® deno çš„ API ç›¸å¯¹äº node å…¶å®æ˜¯å°‘ä¸€äº›çš„ï¼Œé€šè¿‡å…¶æ–‡ä»¶å¤§å°ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> ll /usr/local/bin/node /Users/Xiuming/.local/bin/deno</span><br><span class="line">-rwxr-xr-x  1   42M   /Users/Xiuming/.local/bin/deno</span><br><span class="line">-rwxr-xr-x  1   70M   /usr/local/bin/node</span><br></pre></td></tr></table></figure>
<p>é‚£è¿™äº›å°‘çš„ API åªèƒ½è‡ªå·±å†™æˆ–è€…æ±‚åŠ©äºç¤¾åŒºå—ï¼Ÿ</p>
<p>deno å¯¹äºè‡ªèº«ç›¸å¯¹äº node å°‘çš„å’Œç¤¾åŒºä¸­å¸¸ç”¨çš„åŠŸèƒ½ï¼Œæä¾›äº†<a href="https://deno.land/std/" target="_blank" rel="noopener">æ ‡å‡†æ¨¡å—</a>ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¸ä¾èµ–éæ ‡å‡†æ¨¡å—çš„å†…å®¹ï¼Œè¾¾åˆ°ç¤¾åŒºå†…çš„æ¨¡å—å¼•ç”¨æœ€åéƒ½æ”¶æ•›äºæ ‡å‡†æ¨¡å—çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»ä¼¼ node ä¸­ chalk åŒ…</span></span><br><span class="line"><span class="keyword">import</span> &#123; bgRed, white &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std/fmt/colors.ts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼ node ä¸­çš„ uuid åŒ…</span></span><br><span class="line"><span class="keyword">import</span> &#123; v4 &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std/uuid/mod.ts"</span>;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ä¸ºäº†å¯¹ node ç”¨æˆ·å‹å¥½ï¼Œæä¾›äº† node API çš„å…¼å®¹</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">"https://deno.land/std/node/path.ts"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">"https://deno.land/std/node/fs.ts"</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œå¤§å®¶åœ¨ä¸º deno ç¤¾åŒºåšè´¡çŒ®çš„æ—¶å€™ï¼Œé¦–å…ˆè¦çœ‹ä¸€ä¸‹æ ‡å‡†æ¨¡å—æœ‰æ²¡æœ‰æä¾›ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå¦‚æœå·²ç»æä¾›äº†å¯ä»¥è¿›è¡Œå¼•ç”¨ã€‚</p>
<h3 id="8-å¼‚æ­¥æ“ä½œ"><a href="#8-å¼‚æ­¥æ“ä½œ" class="headerlink" title="8.å¼‚æ­¥æ“ä½œ"></a>8.å¼‚æ­¥æ“ä½œ</h3><blockquote>
<p>æ ¹æ® ry è‡ªå·±æ˜¯è¯´æ³•ï¼Œåœ¨è®¾è®¡ node æ˜¯æœ‰äººæè®® Promise å¤„ç†å›è°ƒï¼Œä½†æ˜¯ä»–æ²¡å¬ï¼Œç”¨ä»–è‡ªå·±çš„è¯è¯´å°±æ˜¯æ„šè ¢çš„æ‹’ç»äº†</p>
</blockquote>
<p>node ç”¨å›è°ƒçš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œã€deno åˆ™é€‰æ‹©ç”¨ Promise</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// node æ–¹å¼</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">fs.readFile(<span class="string">"./data.txt"</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¦å¤– deno æ”¯æŒ top-level-awaitï¼Œæ‰€ä»¥ä»¥ä¸Šè¯»å–æ–‡ä»¶çš„ä»£ç å¯ä»¥ä¸ºï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// deno æ–¹å¼</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> Deno.readFile(<span class="string">"./data.txt"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br></pre></td></tr></table></figure>
<p>node å…³äºè¿™æ–¹é¢ä¹Ÿåœ¨ä¸€ç›´æ”¹è¿›ï¼Œä¾‹å¦‚ç¤¾åŒºä¸Šå¾ˆå¤š <code>promisify</code> è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡åŒ…è£¹ä¸€å±‚å‡½æ•°ï¼Œå®ç°ç›®çš„ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// node API promisify</span></span><br><span class="line"><span class="keyword">const</span> &#123; promisify &#125; = <span class="built_in">require</span>(<span class="string">"es6-promisify"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> readFile = promisify(fs.readFile);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> readFile(<span class="string">"./data.txt"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure>
<h3 id="9-å•æ–‡ä»¶åˆ†å‘"><a href="#9-å•æ–‡ä»¶åˆ†å‘" class="headerlink" title="9.å•æ–‡ä»¶åˆ†å‘"></a>9.å•æ–‡ä»¶åˆ†å‘</h3><p>æˆ‘ä»¬çŸ¥é“ npm åŒ…å¿…é¡»æœ‰ <code>package.json</code> æ–‡ä»¶ï¼Œé‡Œé¢ä¸ä»…éœ€è¦æŒ‡æ˜ <code>main</code> æˆ– <code>module</code> æˆ– <code>browser</code> ç­‰å­—æ®µæ¥æ ‡æ˜å…¥å£æ–‡ä»¶ï¼Œè¿˜éœ€è¦æŒ‡æ˜ <code>name</code> ã€<code>license</code> ã€<code>description</code> ç­‰å­—æ®µæ¥è¯´æ˜è¿™ä¸ªåŒ…ã€‚</p>
<p>ry è§‰å¾—è¿™äº›å­—æ®µæ‰°ä¹±äº†å¼€å‘è€…çš„è§†å¬ï¼Œæ‰€ä»¥åœ¨ deno ä¸­ï¼Œå…¶æ¨¡å—ä¸éœ€è¦ä»»ä½•é…ç½®æ–‡ä»¶ï¼Œç›´æ¥æ˜¯ import url çš„å½¢å¼ã€‚</p>
<h3 id="10-å»ä¸­å¿ƒåŒ–ä»“åº“"><a href="#10-å»ä¸­å¿ƒåŒ–ä»“åº“" class="headerlink" title="10.å»ä¸­å¿ƒåŒ–ä»“åº“"></a>10.å»ä¸­å¿ƒåŒ–ä»“åº“</h3><p>å¯¹äº <a href="http://www.npmjs.com" target="_blank" rel="noopener">www.npmjs.com</a> æˆ‘ä»¬è‚¯å®šéƒ½ä¸é™Œç”Ÿï¼Œå®ƒæ˜¯æ¨åŠ¨ node è“¬å‹ƒå‘å±•çš„é‡è¦æ”¯ç‚¹ã€‚ä½†ä½œè€…è®¤ä¸ºå®ƒæ˜¯ä¸­å¿ƒåŒ–ä»“åº“ï¼Œè¿èƒŒäº†äº’è”ç½‘å»ä¸­å¿ƒåŒ–åŸåˆ™ã€‚</p>
<p>æ‰€ä»¥ deno å¹¶æ²¡æœ‰ä¸€ä¸ªåƒ npmjs.com çš„ä»“åº“ï¼Œé€šè¿‡<code>import url</code>çš„æ–¹å¼å°†äº’è”ç½‘ä»»ä½•ä¸€å¤„çš„ä»£ç éƒ½å¯ä»¥å¼•ç”¨ã€‚</p>
<h3 id="11-å»å¼€å‘ä¾èµ–"><a href="#11-å»å¼€å‘ä¾èµ–" class="headerlink" title="11.å»å¼€å‘ä¾èµ–"></a>11.å»å¼€å‘ä¾èµ–</h3><p>æˆ‘ä»¬åœ¨å†™ä¸€ä¸ª node åº“æˆ–è€…å·¥å…·æ—¶ï¼Œå¼€å‘ä¾èµ–æ˜¯å°‘ä¸äº†çš„ï¼Œä¾‹å¦‚ babel åšè½¬åŒ–å’Œæ‰“åŒ…ã€jest åšæµ‹è¯•ã€prettier åšä»£ç æ ¼å¼åŒ–ã€eslint åšä»£ç æ ¼å¼æ ¡æ£€ã€gulp æˆ–è€… webpack åšæ„å»ºç­‰ç­‰ï¼Œè®©æˆ‘ä»¬åœ¨å¼€å‘å‰å°±æå¾—ç­‹ç–²åŠ›å°½ã€‚</p>
<p>deno é€šè¿‡å†…ç½®äº†ä¸€äº›å·¥å…·ï¼Œè§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>
<ul>
<li><code>deno bundle</code>ï¼šæ‰“åŒ…å‘½ä»¤ï¼Œç”¨æ¥æ›¿æ¢ <code>babel</code>ã€<code>gulp</code> ä¸€ç±»å·¥å…·: ä¾‹å¦‚ï¼š<code>deno bundle ./mod.ts</code>ï¼›</li>
<li><code>deno fmt</code>ï¼šæ ¼å¼åŒ–å‘½ä»¤ï¼Œç”¨æ¥æ›¿æ¢ <code>prettier</code> ä¸€ç±»å·¥å…·ï¼Œä¾‹å¦‚ï¼š<code>deno fmt ./mod.ts</code>ï¼›</li>
<li><code>deno test</code>ï¼šè¿è¡Œæµ‹è¯•ä»£ç ï¼Œç”¨æ¥æ›¿æ¢ <code>jest</code> ä¸€ç±»å·¥å…·ï¼Œä¾‹å¦‚ <code>deno test ./test.ts</code>ï¼›</li>
<li><code>deno lint</code>ï¼šä»£ç æ ¡æ£€ï¼ˆæš‚æœªå®ç°ï¼‰ï¼Œç”¨æ¥æ›¿æ¢ <code>eslint</code> ä¸€ç±»å·¥å…·ï¼Œä¾‹å¦‚ï¼š<code>deno lint ./mod.ts</code>ã€‚</li>
</ul>
<blockquote>
<p>ä½œè€…ï¼šdream2023<br>é“¾æ¥ï¼š<a href="https://juejin.im/post/5ebcad19f265da7bb07656c7" target="_blank" rel="noopener">https://juejin.im/post/5ebcad19f265da7bb07656c7</a><br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>æŠ“å–Bilibiliå“”å“©å“”å“©ç½‘ç«™è§†é¢‘(Javaå’ŒPythonåŒç‰ˆæœ¬å®ç°)</title>
    <url>/Java/Python/%E6%8A%93%E5%8F%96Bilibili%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E7%BD%91%E7%AB%99%E8%A7%86%E9%A2%91-Java%E5%92%8CPython%E5%8F%8C%E7%89%88%E6%9C%AC%E5%AE%9E%E7%8E%B0.html</url>
    <content><![CDATA[<h2 id="1ã€Bç«™è§†é¢‘çœŸå®åœ°å€åˆ†æ"><a href="#1ã€Bç«™è§†é¢‘çœŸå®åœ°å€åˆ†æ" class="headerlink" title="1ã€Bç«™è§†é¢‘çœŸå®åœ°å€åˆ†æ"></a>1ã€Bç«™è§†é¢‘çœŸå®åœ°å€åˆ†æ</h2><blockquote>
<p>æˆ‘ä¸€ç›´è§‰å¾—ç¼–ç¨‹è¯­è¨€åªæ˜¯ä¸€ç§å·¥å…·ï¼Œé‡è¦çš„æ˜¯æ€æƒ³ğŸ¶ã€‚ä¸‹é¢å…ˆæ¥åˆ†æä¸‹Bç«™è§†é¢‘çš„çœŸå®åœ°å€ã€‚</p>
</blockquote>
<h3 id="1-1-è·å–è§†é¢‘çš„ä¿¡æ¯æ•°æ®"><a href="#1-1-è·å–è§†é¢‘çš„ä¿¡æ¯æ•°æ®" class="headerlink" title="1.1 è·å–è§†é¢‘çš„ä¿¡æ¯æ•°æ®"></a>1.1 è·å–è§†é¢‘çš„ä¿¡æ¯æ•°æ®</h3><p>ä½¿ç”¨PCé€šè¿‡æµè§ˆå™¨éšä¾¿æ‰“å¼€ä¸€ä¸ªBç«™çš„è§†é¢‘ï¼Œå³é”®<code>æ£€æŸ¥</code>æˆ–è€…æ˜¯æŒ‰<code>F12</code>ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ã€‚æˆ‘ä»¬ä¼šå‘ç°æœ‰ä¸€ä¸ª<code>script</code>æ ‡ç­¾å†…çš„å†…å®¹æ˜¯è¿™æ ·çš„ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/20200509195913920.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1hpdW1pbmdMZWU=,size_16,color_FFFFFF,t_70" alt=""></p>
<blockquote>
<p>å—¯ï¼Œä»¿ä½›è¿™å°±æ˜¯è§†é¢‘çš„ä¿¡æ¯äº†ã€‚ä¸‹é¢æˆ‘ä»¬å°†å…¶å¤åˆ¶å‡ºæ¥ï¼Œæ ¼å¼åŒ–ä¸€ä¸‹ã€‚</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.__playinfo__ = &#123;</span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"accept_format"</span>: <span class="string">"flv720,flv480,mp4"</span>,</span><br><span class="line">        <span class="string">"accept_description"</span>: [<span class="string">"é«˜æ¸… 720P"</span>, <span class="string">"æ¸…æ™° 480P"</span>, <span class="string">"æµç•… 360P"</span>],</span><br><span class="line">        <span class="string">"accept_quality"</span>: [<span class="number">64</span>, <span class="number">32</span>, <span class="number">16</span>],</span><br><span class="line">        <span class="string">"dash"</span>: &#123;</span><br><span class="line">            <span class="string">"video"</span>: [&#123;</span><br><span class="line">                <span class="string">"id"</span>: <span class="number">64</span>,</span><br><span class="line">                <span class="string">"baseUrl"</span>: <span class="string">"http://cn-sdbz-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=80000000"</span>,</span><br><span class="line">                <span class="string">"base_url"</span>: <span class="string">"http://cn-sdbz-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=80000000"</span>,</span><br><span class="line">                <span class="string">"backupUrl"</span>: [<span class="string">"http://cn-sdyt-cu-v-11.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>, <span class="string">"http://cn-hbcd2-cu-v-07.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>],</span><br><span class="line">                <span class="string">"backup_url"</span>: [<span class="string">"http://cn-sdyt-cu-v-11.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>, <span class="string">"http://cn-hbcd2-cu-v-07.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30064.m4s?expires=1589032200&amp;platform=pc&amp;ssig=7TagzkxicmXQCX-eJG1rWw&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>],</span><br><span class="line">                <span class="string">"bandwidth"</span>: <span class="number">1883922</span>,</span><br><span class="line">                <span class="string">"mimeType"</span>: <span class="string">"video/mp4"</span>,</span><br><span class="line">                <span class="string">"mime_type"</span>: <span class="string">"video/mp4"</span>,</span><br><span class="line">                <span class="string">"width"</span>: <span class="number">720</span>,</span><br><span class="line">                <span class="string">"height"</span>: <span class="number">1280</span>,</span><br><span class="line">                <span class="string">"SegmentBase"</span>: &#123;<span class="string">"Initialization"</span>: <span class="string">"0-974"</span>, <span class="string">"indexRange"</span>: <span class="string">"975-1162"</span>&#125;,</span><br><span class="line">                <span class="string">"segment_base"</span>: &#123;<span class="string">"initialization"</span>: <span class="string">"0-974"</span>, <span class="string">"index_range"</span>: <span class="string">"975-1162"</span>&#125;,</span><br><span class="line">                <span class="string">"codecid"</span>: <span class="number">7</span></span><br><span class="line">            &#125;,], </span><br><span class="line">            <span class="string">"audio"</span>: [&#123;</span><br><span class="line">                <span class="string">"id"</span>: <span class="number">30280</span>,</span><br><span class="line">                <span class="string">"baseUrl"</span>: <span class="string">"http://cn-sdyt-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=80000000"</span>,</span><br><span class="line">                <span class="string">"base_url"</span>: <span class="string">"http://cn-sdyt-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=80000000"</span>,</span><br><span class="line">                <span class="string">"backupUrl"</span>: [<span class="string">"http://cn-hbcd2-cu-v-14.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>, <span class="string">"http://cn-sdjn2-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>],</span><br><span class="line">                <span class="string">"backup_url"</span>: [<span class="string">"http://cn-hbcd2-cu-v-14.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>, <span class="string">"http://cn-sdjn2-cu-v-05.bilivideo.com/upgcxcode/18/80/187918018/187918018-1-30280.m4s?expires=1589032200&amp;platform=pc&amp;ssig=ud9zkd5aAUp7mB4yPjI_LA&amp;oi=1894210281&amp;trid=4b3d732f515544e49c843d5f2c87f64bu&amp;nfc=1&amp;nfb=maPYqpoel5MI3qOUX6YpRA==&amp;mid=388810686&amp;logo=40000000"</span>],</span><br><span class="line">                <span class="string">"bandwidth"</span>: <span class="number">319474</span>,</span><br><span class="line">                <span class="string">"mimeType"</span>: <span class="string">"audio/mp4"</span>,</span><br><span class="line">                <span class="string">"mime_type"</span>: <span class="string">"audio/mp4"</span>,</span><br><span class="line">                <span class="string">"SegmentBase"</span>: &#123;<span class="string">"Initialization"</span>: <span class="string">"0-919"</span>, <span class="string">"indexRange"</span>: <span class="string">"920-1107"</span>&#125;,</span><br><span class="line">                <span class="string">"segment_base"</span>: &#123;<span class="string">"initialization"</span>: <span class="string">"0-919"</span>, <span class="string">"index_range"</span>: <span class="string">"920-1107"</span>&#125;,</span><br><span class="line">            &#125;,]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">"session"</span>: <span class="string">"996ecc0413599104d175e5c254e70fb7"</span>, <span class="string">"videoFrame"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘åˆ é™¤äº†ä¸€äº›æ²¡æœ‰çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¸Šé¢çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ç‚¹ä¿¡æ¯ï¼š</p>
<ol>
<li>Bç«™çš„è§†é¢‘æ˜¯éŸ³è§†é¢‘åˆ†ç¦»çš„ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ä»jsä¸­è·å–çœŸå®éŸ³è§†é¢‘åœ°å€ã€‚</li>
<li>æä¾›äº†<code>&quot;é«˜æ¸… 720P&quot;, &quot;æ¸…æ™° 480P&quot;, &quot;æµç•… 360P&quot;</code>æ–¹å¼ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆæ²¡æœ‰<code>1080P</code>çš„ï¼Œä¿ºä¹Ÿä¸çŸ¥é“ğŸ˜¢ã€‚</li>
</ol>
</blockquote>
<p><strong>ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹Bç«™è‡ªå·±å‘é€è¯·æ±‚çš„ä¿¡æ¯ã€‚</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20200509201223561.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1hpdW1pbmdMZWU=,size_16,color_FFFFFF,t_70" alt=""></p>
<blockquote>
<p>æˆ‘ä»¬å‘ç°æ¯æ¬¡è¯·æ±‚æ—¶éƒ½æºå¸¦äº†ï¼Œæ­¤æ¬¡è¯·æ±‚æ–‡ä»¶çš„å­—èŠ‚ä½ç½®ä¿¡æ¯ã€‚</p>
</blockquote>
<h3 id="1-2-æŠ“å–Bç«™è§†é¢‘çš„æ€è·¯"><a href="#1-2-æŠ“å–Bç«™è§†é¢‘çš„æ€è·¯" class="headerlink" title="1.2 æŠ“å–Bç«™è§†é¢‘çš„æ€è·¯"></a>1.2 æŠ“å–Bç«™è§†é¢‘çš„æ€è·¯</h3><blockquote>
<ol>
<li>è¯·æ±‚æƒ³è¦ä¸‹è½½è§†é¢‘çš„åœ°å€ï¼Œè·å–é¡µé¢htmlã€‚</li>
<li>ä»é¡µé¢ä¸­è§£æå‡ºè§†é¢‘çš„åŸºæœ¬ä¿¡æ¯ï¼ŒéŸ³è§†é¢‘çš„urlåœ°å€ç­‰ä¿¡æ¯ã€‚</li>
<li>ä¸‹è½½éŸ³è§†é¢‘æ–‡ä»¶ï¼Œå‘é€è¯·æ±‚æ—¶å¸¦ä¸Šè¯·æ±‚çš„èŒƒå›´(<code>range</code>)ã€‚(<strong><code>æ³¨ï¼š</code>æœ¬æ–‡çš„å®ç°ä¸­ï¼Œæ²¡æœ‰ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œç›´æ¥è¯·æ±‚çš„æ•´ä¸ªæ–‡ä»¶</strong>)</li>
<li>å°†ä¸‹è½½å®Œæˆçš„éŸ³è§†é¢‘æ–‡ä»¶åˆå¹¶æˆå®Œæˆçš„è§†é¢‘æ–‡ä»¶ã€‚</li>
</ol>
</blockquote>
<h3 id="1-3-ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“å’Œè½¯ä»¶"><a href="#1-3-ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“å’Œè½¯ä»¶" class="headerlink" title="1.3 ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“å’Œè½¯ä»¶"></a>1.3 ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“å’Œè½¯ä»¶</h3><ol>
<li><h5 id="ç¬¬ä¸‰æ–¹è½¯ä»¶"><a href="#ç¬¬ä¸‰æ–¹è½¯ä»¶" class="headerlink" title="ç¬¬ä¸‰æ–¹è½¯ä»¶"></a>ç¬¬ä¸‰æ–¹è½¯ä»¶</h5></li>
</ol>
<blockquote>
<ul>
<li><strong><code>ffmpeg</code></strong>ï¼šç”¨äºåˆå¹¶éŸ³è§†é¢‘æ–‡ä»¶ã€‚å®˜æ–¹ç½‘å€ï¼š<a href="http://ffmpeg.org/ã€‚" target="_blank" rel="noopener">http://ffmpeg.org/ã€‚</a><ul>
<li><code>ffmpeg</code>ï¼šæ˜¯å¤„ç†éŸ³è§†é¢‘çš„åˆ©å™¨ï¼Œæ„Ÿå…´è¶£å¯ä»¥æœç´¢ç›¸å…³èµ„æ–™äº†è§£ä¸‹ã€‚æœ¬æ–‡åªè¦ä½ ä¸‹è½½ä¸‹æ¥ï¼Œå°†<code>ffmpeg</code>ä½ç½®å†™åˆ°ä»£ç å˜é‡é‡Œå°±å¯ä»¥äº†ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<ol start="2">
<li><h5 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h5></li>
</ol>
<blockquote>
<ul>
<li><code>requests</code>ï¼šç”¨äºå‘é€Httpè¯·æ±‚</li>
<li><code>ffmpeg-python</code>ï¼šæ–¹ä¾¿æ“ä½œ<code>ffmpeg</code></li>
<li><code>HTMLParser</code>ï¼špythonè‡ªå¸¦çš„HTMLè§£æå·¥å…·</li>
</ul>
</blockquote>
<ol start="3">
<li><h5 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h5></li>
</ol>
<blockquote>
<ul>
<li><p><code>hutool</code>ï¼šä¸€ä¸ªå›½äººå¼€æºçš„Javaå·¥å…·åŒ…ã€‚å¼ºçƒˆæ¨èã€‚</p>
</li>
<li><p><code>jsoup</code>ï¼šJavaè§£æHTMLçš„åˆ©å™¨</p>
</li>
</ul>
</blockquote>
<h2 id="2ã€ä»£ç å®ç°"><a href="#2ã€ä»£ç å®ç°" class="headerlink" title="2ã€ä»£ç å®ç°"></a>2ã€ä»£ç å®ç°</h2><blockquote>
<p><strong><code>æ³¨ï¼š</code>æœ¬æ–‡ä¸­ä»£ç ä¸‹è½½éŸ³è§†é¢‘å‡é‡‡ç”¨çš„å•çº¿ç¨‹çš„æ–¹å¼ï¼Œå¦‚æœä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä¸€å®šè¦è®¡ç®—å¥½æ¯ä¸ªè¯·æ±‚çš„è¯·æ±‚èŒƒå›´ï¼Œä»¥åŠä¸‹è½½å®Œæˆåï¼Œåˆå¹¶æ–‡ä»¶æ—¶çš„é¡ºåºã€‚</strong></p>
</blockquote>
<h3 id="2-1-Pythonçš„å®ç°"><a href="#2-1-Pythonçš„å®ç°" class="headerlink" title="2.1 Pythonçš„å®ç°"></a>2.1 Pythonçš„å®ç°</h3><h4 id="è§£æhtml"><a href="#è§£æhtml" class="headerlink" title="è§£æhtml"></a>è§£æhtml</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BiliHTMLParser</span><span class="params">(HTMLParser)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç»§æ‰¿è‡ªHTMLParserã€‚ç”¨äºè§£æhtml</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.isTitle = <span class="number">0</span></span><br><span class="line">        self.videoName = <span class="string">""</span>  <span class="comment"># è§†é¢‘åç§°</span></span><br><span class="line">        self.videoInfo = &#123;&#125;  <span class="comment"># è§†é¢‘ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_starttag</span><span class="params">(self, tag, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> tag != <span class="string">'title'</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.isTitle += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_endtag</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'title'</span> <span class="keyword">and</span> self.isTitle:</span><br><span class="line">            self.isTitle -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        è·å–å½“å‰é¡µé¢çš„è§†é¢‘ä¿¡æ¯</span></span><br><span class="line"><span class="string">        :param data: tagä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">and</span> self.isTitle:  <span class="comment"># ç”¨äºè·å–è§†é¢‘åç§°</span></span><br><span class="line">            self.videoName = data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data.startswith(<span class="string">'window.__playinfo__='</span>):</span><br><span class="line">            infoStr = data.split(<span class="string">'window.__playinfo__='</span>)[<span class="number">-1</span>]  <span class="comment"># æˆªå–`window.__playinfo__=`ä¹‹åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">            self.videoInfo = json.loads(infoStr)  <span class="comment"># å­—ç¬¦ä¸²è½¬å­—å…¸dict</span></span><br></pre></td></tr></table></figure>
<h4 id="è·å–è§†é¢‘ä¿¡æ¯"><a href="#è·å–è§†é¢‘ä¿¡æ¯" class="headerlink" title="è·å–è§†é¢‘ä¿¡æ¯"></a>è·å–è§†é¢‘ä¿¡æ¯</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getVideo</span><span class="params">(videoInfo, videoName)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param videoInfo: è§†é¢‘ä¿¡æ¯å­—å…¸dict</span></span><br><span class="line"><span class="string">    :param videoName: è§†é¢‘åç§°</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># è·å–è§†é¢‘çš„urlå’Œåˆå§‹çš„å¤§å°èŒƒå›´</span></span><br><span class="line">    videoBaseUrl = videoInfo[<span class="string">'data'</span>][<span class="string">'dash'</span>][<span class="string">'video'</span>][<span class="number">0</span>][<span class="string">'baseUrl'</span>]</span><br><span class="line">    videoBaseRange = videoInfo[<span class="string">'data'</span>][<span class="string">'dash'</span>][<span class="string">'video'</span>][<span class="number">0</span>][<span class="string">'SegmentBase'</span>][<span class="string">'Initialization'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–éŸ³é¢‘çš„urlå’Œåˆå§‹çš„å¤§å°èŒƒå›´</span></span><br><span class="line">    audioBaseUrl = videoInfo[<span class="string">'data'</span>][<span class="string">'dash'</span>][<span class="string">'audio'</span>][<span class="number">0</span>][<span class="string">'baseUrl'</span>]</span><br><span class="line">    audioBaseRange = videoInfo[<span class="string">'data'</span>][<span class="string">'dash'</span>][<span class="string">'audio'</span>][<span class="number">0</span>][<span class="string">'SegmentBase'</span>][<span class="string">'Initialization'</span>]</span><br><span class="line">    <span class="comment"># æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line">    videoSize = getVideoInfo(videoBaseUrl, videoBaseRange)</span><br><span class="line">    videoFileName = downloadFile(videoBaseUrl, videoSize, <span class="string">"video"</span>, videoName)</span><br><span class="line">    audioSize = getVideoInfo(audioBaseUrl, audioBaseRange)</span><br><span class="line">    audioFileName = downloadFile(audioBaseUrl, audioSize, <span class="string">"audio"</span>, videoName)</span><br><span class="line">    <span class="comment"># åˆå¹¶æ–‡ä»¶</span></span><br><span class="line">    outFilePath = <span class="string">"./%s/%s.mp4"</span> % (videoName, videoName)</span><br><span class="line">    mergeFiles(videoFileName, audioFileName, outFilePath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getVideoInfo</span><span class="params">(baseUrl, range)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è·å–è§†é¢‘æˆ–éŸ³é¢‘æ–‡ä»¶çš„æ€»å¤§å°</span></span><br><span class="line"><span class="string">    :param baseUrl:</span></span><br><span class="line"><span class="string">    :param range:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Referer'</span>: videoUrl,</span><br><span class="line">        <span class="string">'Range'</span>: <span class="string">'bytes=%s'</span> % (range),</span><br><span class="line">    &#125;</span><br><span class="line">    videoRes = requests.get(url=baseUrl, headers=headers)</span><br><span class="line">    <span class="comment"># è·å–è§†é¢‘æ€»å¤§å°</span></span><br><span class="line">    headersInfo = videoRes.headers</span><br><span class="line">    total = headersInfo[<span class="string">'Content-Range'</span>].split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    print(<span class="string">'èµ„æºçš„æ€»å­—èŠ‚æ•°ï¼š%s'</span> % total)</span><br><span class="line">    <span class="keyword">return</span> total</span><br></pre></td></tr></table></figure>
<h4 id="ä¸‹è½½éŸ³è§†é¢‘"><a href="#ä¸‹è½½éŸ³è§†é¢‘" class="headerlink" title="ä¸‹è½½éŸ³è§†é¢‘"></a>ä¸‹è½½éŸ³è§†é¢‘</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloadFile</span><span class="params">(url, totalSize, type, videoName)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸‹è½½èµ„æº</span></span><br><span class="line"><span class="string">    :param url: èµ„æºurl</span></span><br><span class="line"><span class="string">    :param totalSize: èµ„æºæ€»å¤§å°</span></span><br><span class="line"><span class="string">    :param type: video/audio</span></span><br><span class="line"><span class="string">    :param videoName: è§†é¢‘åç§°</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Referer'</span>: videoUrl,</span><br><span class="line">        <span class="string">'Range'</span>: <span class="string">"bytes=%s-%s"</span> % (str(<span class="number">0</span>), str(totalSize))</span><br><span class="line">    &#125;</span><br><span class="line">    fileDir = <span class="string">"./%s"</span> % videoName</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fileDir):</span><br><span class="line">        os.mkdir(fileDir)</span><br><span class="line"></span><br><span class="line">    fileName = <span class="string">"./%s/%s-%s.mp4"</span> % (videoName, videoName, type)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fileName):</span><br><span class="line">        res = requests.get(url=url, headers=headers, stream=<span class="keyword">True</span>)</span><br><span class="line">        print(<span class="string">"å¼€å§‹ä¸‹è½½ï¼š%s"</span> % type)</span><br><span class="line">        data = res.content</span><br><span class="line">        <span class="keyword">with</span> open(fileName, <span class="string">'wb'</span>) <span class="keyword">as</span> file_obj:</span><br><span class="line">            file_obj.write(data)</span><br><span class="line">    print(<span class="string">"å®Œæˆ%sçš„ä¸‹è½½"</span> % type)</span><br><span class="line">    <span class="keyword">return</span> fileName</span><br></pre></td></tr></table></figure>
<h4 id="åˆå¹¶éŸ³è§†é¢‘"><a href="#åˆå¹¶éŸ³è§†é¢‘" class="headerlink" title="åˆå¹¶éŸ³è§†é¢‘"></a>åˆå¹¶éŸ³è§†é¢‘</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeFiles</span><span class="params">(videoFilePath, audioFilePath, outFilePath)</span>:</span></span><br><span class="line">    <span class="string">"""åˆå¹¶éŸ³è§†é¢‘"""</span></span><br><span class="line">    print(<span class="string">"å¼€å§‹åˆå¹¶éŸ³è§†é¢‘"</span>)</span><br><span class="line">    videoFile = ffmpeg.input(videoFilePath)</span><br><span class="line">    audioFile = ffmpeg.input(audioFilePath)</span><br><span class="line">    stream = ffmpeg.output(videoFile, audioFile, outFilePath, vcodec=<span class="string">'copy'</span>, acodec=<span class="string">'copy'</span>)</span><br><span class="line">    ffmpeg.run(stream, cmd=ffmpegPath)</span><br><span class="line">    print(<span class="string">"åˆå¹¶éŸ³è§†é¢‘å®Œæˆ"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-Javaå®ç°"><a href="#2-2-Javaå®ç°" class="headerlink" title="2.2 Javaå®ç°"></a>2.2 Javaå®ç°</h3><h4 id="è§£æHtml"><a href="#è§£æHtml" class="headerlink" title="è§£æHtml"></a>è§£æHtml</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** è§£æHTMLè·å–ç›¸å…³ä¿¡æ¯ */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">htmlParser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HttpResponse res = HttpRequest.get(VIDEO_URL).timeout(<span class="number">2000</span>).execute();</span><br><span class="line">    String html = res.body();</span><br><span class="line">    Document document = Jsoup.parse(html);</span><br><span class="line">    Element title = document.getElementsByTag(<span class="string">"title"</span>).first();</span><br><span class="line">    <span class="comment">// è§†é¢‘åç§°</span></span><br><span class="line">    VIDEO_INFO.videoName = title.text();</span><br><span class="line">    <span class="comment">// æˆªå–è§†é¢‘ä¿¡æ¯</span></span><br><span class="line">    Pattern pattern = Pattern.compile(<span class="string">"(?&lt;=&lt;script&gt;window.__playinfo__=).*?(?=&lt;/script&gt;)"</span>);</span><br><span class="line">    Matcher matcher = pattern.matcher(html);</span><br><span class="line">    <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">        VIDEO_INFO.videoInfo = <span class="keyword">new</span> JSONObject(matcher.group());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">"æœªåŒ¹é…åˆ°è§†é¢‘ä¿¡æ¯ï¼Œé€€å‡ºç¨‹åºï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    getVideoInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è·å–è§†é¢‘ä¿¡æ¯-1"><a href="#è·å–è§†é¢‘ä¿¡æ¯-1" class="headerlink" title="è·å–è§†é¢‘ä¿¡æ¯"></a>è·å–è§†é¢‘ä¿¡æ¯</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** è§£æè§†é¢‘å’ŒéŸ³é¢‘çš„å…·ä½“ä¿¡æ¯ */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getVideoInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å–è§†é¢‘çš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    JSONObject videoInfo = VIDEO_INFO.videoInfo;</span><br><span class="line">    JSONArray videoInfoArr = videoInfo.getJSONObject(<span class="string">"data"</span>).getJSONObject(<span class="string">"dash"</span>).getJSONArray(<span class="string">"video"</span>);</span><br><span class="line">    VIDEO_INFO.videoBaseUrl = videoInfoArr.getJSONObject(<span class="number">0</span>).getStr(<span class="string">"baseUrl"</span>);</span><br><span class="line">    VIDEO_INFO.videoBaseRange = videoInfoArr.getJSONObject(<span class="number">0</span>).getJSONObject(<span class="string">"SegmentBase"</span>).getStr(<span class="string">"Initialization"</span>);</span><br><span class="line">    HttpResponse videoRes = HttpRequest.get(VIDEO_INFO.videoBaseUrl)</span><br><span class="line">            .header(<span class="string">"Referer"</span>, VIDEO_URL)</span><br><span class="line">            .header(<span class="string">"Range"</span>, <span class="string">"bytes="</span> + VIDEO_INFO.videoBaseRange)</span><br><span class="line">            .header(<span class="string">"User-Agent"</span>, USER_AGENT)</span><br><span class="line">            .timeout(<span class="number">2000</span>)</span><br><span class="line">            .execute();</span><br><span class="line">    VIDEO_INFO.videoSize = videoRes.header(<span class="string">"Content-Range"</span>).split(<span class="string">"/"</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–éŸ³é¢‘åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    JSONArray audioInfoArr = videoInfo.getJSONObject(<span class="string">"data"</span>).getJSONObject(<span class="string">"dash"</span>).getJSONArray(<span class="string">"audio"</span>);</span><br><span class="line">    VIDEO_INFO.audioBaseUrl = audioInfoArr.getJSONObject(<span class="number">0</span>).getStr(<span class="string">"baseUrl"</span>);</span><br><span class="line">    VIDEO_INFO.audioBaseRange = audioInfoArr.getJSONObject(<span class="number">0</span>).getJSONObject(<span class="string">"SegmentBase"</span>).getStr(<span class="string">"Initialization"</span>);</span><br><span class="line">    HttpResponse audioRes = HttpRequest.get(VIDEO_INFO.audioBaseUrl)</span><br><span class="line">            .header(<span class="string">"Referer"</span>, VIDEO_URL)</span><br><span class="line">            .header(<span class="string">"Range"</span>, <span class="string">"bytes="</span> + VIDEO_INFO.audioBaseRange)</span><br><span class="line">            .header(<span class="string">"User-Agent"</span>, USER_AGENT)</span><br><span class="line">            .timeout(<span class="number">2000</span>)</span><br><span class="line">            .execute();</span><br><span class="line">    VIDEO_INFO.audioSize = audioRes.header(<span class="string">"Content-Range"</span>).split(<span class="string">"/"</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    downloadFile();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸‹è½½éŸ³è§†é¢‘-1"><a href="#ä¸‹è½½éŸ³è§†é¢‘-1" class="headerlink" title="ä¸‹è½½éŸ³è§†é¢‘"></a>ä¸‹è½½éŸ³è§†é¢‘</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** ä¸‹è½½éŸ³è§†é¢‘ */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">downloadFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜éŸ³è§†é¢‘çš„ä½ç½®</span></span><br><span class="line">    SAVE_PATH = <span class="string">"."</span> + File.separator + VIDEO_INFO.videoName;</span><br><span class="line">    File fileDir = <span class="keyword">new</span> File(SAVE_PATH);</span><br><span class="line">    <span class="keyword">if</span> (!fileDir.exists())&#123;</span><br><span class="line">        fileDir.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½è§†é¢‘</span></span><br><span class="line">    File videoFile = <span class="keyword">new</span> File(SAVE_PATH + File.separator + VIDEO_INFO.videoName + <span class="string">"_video.mp4"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!videoFile.exists())&#123;</span><br><span class="line">        System.out.println(<span class="string">"--------------å¼€å§‹ä¸‹è½½è§†é¢‘æ–‡ä»¶--------------"</span>);</span><br><span class="line">        HttpResponse videoRes = HttpRequest.get(VIDEO_INFO.videoBaseUrl)</span><br><span class="line">                .header(<span class="string">"Referer"</span>, VIDEO_URL)</span><br><span class="line">                .header(<span class="string">"Range"</span>, <span class="string">"bytes=0-"</span> + VIDEO_INFO.videoSize)</span><br><span class="line">                .header(<span class="string">"User-Agent"</span>, USER_AGENT)</span><br><span class="line">                .execute();</span><br><span class="line">        videoRes.writeBody(videoFile);</span><br><span class="line">        System.out.println(<span class="string">"--------------è§†é¢‘æ–‡ä»¶ä¸‹è½½å®Œæˆ--------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹è½½éŸ³é¢‘</span></span><br><span class="line">    File audioFile = <span class="keyword">new</span> File(SAVE_PATH + File.separator + VIDEO_INFO.videoName + <span class="string">"_audio.mp4"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!audioFile.exists())&#123;</span><br><span class="line">        System.out.println(<span class="string">"--------------å¼€å§‹ä¸‹è½½éŸ³é¢‘æ–‡ä»¶--------------"</span>);</span><br><span class="line">        HttpResponse audioRes = HttpRequest.get(VIDEO_INFO.audioBaseUrl)</span><br><span class="line">                .header(<span class="string">"Referer"</span>, VIDEO_URL)</span><br><span class="line">                .header(<span class="string">"Range"</span>, <span class="string">"bytes=0-"</span> + VIDEO_INFO.audioSize)</span><br><span class="line">                .header(<span class="string">"User-Agent"</span>, USER_AGENT)</span><br><span class="line">                .execute();</span><br><span class="line">        audioRes.writeBody(audioFile);</span><br><span class="line">        System.out.println(<span class="string">"--------------éŸ³é¢‘æ–‡ä»¶ä¸‹è½½å®Œæˆ--------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mergeFiles(videoFile,audioFile);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åˆå¹¶è§†é¢‘"><a href="#åˆå¹¶è§†é¢‘" class="headerlink" title="åˆå¹¶è§†é¢‘"></a>åˆå¹¶è§†é¢‘</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeFiles</span><span class="params">(File videoFile,File audioFile)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"--------------å¼€å§‹åˆå¹¶éŸ³è§†é¢‘--------------"</span>);</span><br><span class="line">    String outFile = SAVE_PATH + File.separator + VIDEO_INFO.videoName + <span class="string">".mp4"</span>;</span><br><span class="line">    List&lt;String&gt; commend = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    commend.add(FFMPEG_PATH);</span><br><span class="line">    commend.add(<span class="string">"-i"</span>);</span><br><span class="line">    commend.add(videoFile.getAbsolutePath());</span><br><span class="line">    commend.add(<span class="string">"-i"</span>);</span><br><span class="line">    commend.add(audioFile.getAbsolutePath());</span><br><span class="line">    commend.add(<span class="string">"-vcodec"</span>);</span><br><span class="line">    commend.add(<span class="string">"copy"</span>);</span><br><span class="line">    commend.add(<span class="string">"-acodec"</span>);</span><br><span class="line">    commend.add(<span class="string">"copy"</span>);</span><br><span class="line">    commend.add(outFile);</span><br><span class="line"></span><br><span class="line">    ProcessBuilder builder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">    builder.command(commend);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        builder.inheritIO().start().waitFor();</span><br><span class="line">        System.out.println(<span class="string">"--------------éŸ³è§†é¢‘åˆå¹¶å®Œæˆ--------------"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | IOException e) &#123;</span><br><span class="line">        System.err.println(<span class="string">"éŸ³è§†é¢‘åˆå¹¶å¤±è´¥ï¼"</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3ã€æºç åœ°å€"><a href="#3ã€æºç åœ°å€" class="headerlink" title="3ã€æºç åœ°å€"></a>3ã€æºç åœ°å€</h2><p><a href="https://github.com/XiumingLee/MingRepository/tree/master/BiliVedioDownload" target="_blank" rel="noopener">GitHubæºç åœ°å€</a></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>çˆ¬è™«</tag>
        <tag>Python</tag>
        <tag>Bilibili</tag>
      </tags>
  </entry>
  <entry>
    <title>Java BeanéªŒè¯åŸºç¡€</title>
    <url>/Java/Java-Bean%E9%AA%8C%E8%AF%81%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨è¿™ç¯‡å¿«é€Ÿæ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨æ ‡å‡†æ¡†æ¶-JSR 380ï¼ˆä¹Ÿç§°ä¸ºBeanéªŒè¯2.0ï¼‰æ¥éªŒè¯Java Beançš„åŸºç¡€ã€‚<br>åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯ä¸€ä¸ªéå¸¸æ™®éçš„è¦æ±‚ï¼Œå¹¶ä¸”Java BeanéªŒè¯æ¡†æ¶å·²æˆä¸ºå¤„ç†è¿™ç§é€»è¾‘çš„å®é™…æ ‡å‡†ã€‚</p>
<h2 id="2-JSR380"><a href="#2-JSR380" class="headerlink" title="2. JSR380"></a>2. JSR380</h2><p>JSR380æ˜¯ç”¨äºJava BeanéªŒè¯çš„Java APIè§„èŒƒï¼Œæ˜¯Jakarta EEå’ŒJavaSEçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä½¿ç”¨@ NotNullï¼Œ@Minå’Œ@Maxç­‰æ³¨è§£æ¥ç¡®ä¿Beançš„å±æ€§æ»¡è¶³ç‰¹å®šæ¡ä»¶ã€‚<br>è¯¥ç‰ˆæœ¬éœ€è¦Java8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¹¶åˆ©ç”¨Java8ä¸­æ·»åŠ çš„æ–°åŠŸèƒ½ï¼ˆä¾‹å¦‚ç±»å‹æ³¨è§£ï¼‰ï¼Œå¹¶æ”¯æŒæ–°ç±»å‹ï¼ˆä¾‹å¦‚Optionalå’ŒLocalDateï¼‰ã€‚<br>æœ‰å…³è§„èŒƒçš„å®Œæ•´ä¿¡æ¯ï¼Œè¯·ç»§ç»­é˜…è¯»<a href="https://jcp.org/en/jsr/detail?id=380" target="_blank" rel="noopener">JSR380</a>ã€‚</p>
<h2 id="3-ä¾èµ–å…³ç³»"><a href="#3-ä¾èµ–å…³ç³»" class="headerlink" title="3. ä¾èµ–å…³ç³»"></a>3. ä¾èµ–å…³ç³»</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨Mavenç®¡ç†ä¾èµ–å…³ç³»ã€‚</p>
<h3 id="3-1-Validation-API"><a href="#3-1-Validation-API" class="headerlink" title="3.1. Validation API"></a>3.1. Validation API</h3><p>æ ¹æ®JSR380è§„èŒƒï¼Œvalidation-apiä¾èµ–é¡¹åŒ…å«æ ‡å‡†çš„éªŒè¯APIï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-2-Validation-APIçš„å‚è€ƒå®ç°"><a href="#3-2-Validation-APIçš„å‚è€ƒå®ç°" class="headerlink" title="3.2. Validation APIçš„å‚è€ƒå®ç°"></a>3.2. Validation APIçš„å‚è€ƒå®ç°</h3><p><code>Hibernate Validator</code>æ˜¯Validation APIçš„å‚è€ƒå®ç°ã€‚<br>è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.13.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜ï¼Œ<code>hibernate-validator</code>ä¸<code>Hibernate</code>çš„æ•°æ®æŒä¹…åŒ–æ–¹é¢æ˜¯å®Œå…¨åˆ†å¼€ï¼Œæ·»åŠ <code>hibernate-validator</code>çš„ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å°†æŒä¹…åŒ–æ–¹é¢çš„ä¾èµ–æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p>
<h3 id="3-3-è¡¨è¾¾è¯­è¨€ä¾èµ–é¡¹"><a href="#3-3-è¡¨è¾¾è¯­è¨€ä¾èµ–é¡¹" class="headerlink" title="3.3. è¡¨è¾¾è¯­è¨€ä¾èµ–é¡¹"></a>3.3. è¡¨è¾¾è¯­è¨€ä¾èµ–é¡¹</h3><p>JSR380æ”¯æŒå˜é‡æ’å€¼ï¼Œä»è€Œå…è®¸åœ¨è¿è§„æ¶ˆæ¯ä¸­ä½¿ç”¨è¡¨è¾¾å¼ã€‚<br>è¦è§£æè¿™äº›è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ å¯¹è¡¨è¾¾å¼è¯­è¨€APIä»¥åŠè¯¥APIå®ç°çš„ä¾èµ–ã€‚GlassFishæä¾›äº†å‚è€ƒå®ç°ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæœªæ·»åŠ è¿™äº›JARï¼Œåˆ™åœ¨è¿è¡Œæ—¶æ‚¨å°†æ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<blockquote>
<p>HV000183: Unable to load â€˜javax.el.ExpressionFactoryâ€™. Check that you have the EL dependencies on the classpath, or use ParameterMessageInterpolator instead</p>
</blockquote>
<h2 id="4-ä½¿ç”¨Validationæ³¨è§£"><a href="#4-ä½¿ç”¨Validationæ³¨è§£" class="headerlink" title="4. ä½¿ç”¨Validationæ³¨è§£"></a>4. ä½¿ç”¨Validationæ³¨è§£</h2><p>è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨<code>User</code>ç±»ä½œä¸ºä¸»è¦ç¤ºä¾‹ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ ä¸€äº›ç®€å•çš„éªŒè¯ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.constraints.AssertTrue;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Max;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"Name cannot be null"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@AssertTrue</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> working;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Size</span>(min = <span class="number">10</span>, max = <span class="number">200</span>, message </span><br><span class="line">      = <span class="string">"About Me must be between 10 and 200 characters"</span>)</span><br><span class="line">    <span class="keyword">private</span> String aboutMe;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">18</span>, message = <span class="string">"Age should not be less than 18"</span>)</span><br><span class="line">    <span class="meta">@Max</span>(value = <span class="number">150</span>, message = <span class="string">"Age should not be greater than 150"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Email</span>(message = <span class="string">"Email should be valid"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//setters/getters </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£éƒ½æ˜¯æ ‡å‡†çš„JSRæ³¨è§£ï¼š</p>
<ul>
<li><strong><code>@NotNull</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§å€¼ä¸ä¸ºnullã€‚</li>
<li><strong><code>@AssertTrue</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§å€¼ä¸ºtrueã€‚</li>
<li><strong><code>@Size</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§å€¼çš„å¤§å°ä»‹äºå±æ€§minå’Œmaxä¹‹é—´ï¼›å¯ä»¥åº”ç”¨äºStringï¼ŒCollectionï¼ŒMapå’Œæ•°ç»„å±æ€§</li>
<li><strong><code>@Min</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§çš„å€¼ä¸å°äºvalueå±æ€§ã€‚</li>
<li><strong><code>@Max</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§çš„å€¼ä¸å¤§äºvalueå±æ€§ã€‚</li>
<li><strong><code>@Email</code></strong>ï¼šéªŒè¯å¸¦æ³¨è§£çš„å±æ€§æ˜¯æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ã€‚</li>
</ul>
<p>ä¸€äº›æ³¨è§£æ¥å—å…¶ä»–å±æ€§ï¼Œä½†æ˜¯messageå±æ€§å¯¹æ‰€æœ‰æ³¨è§£éƒ½æ˜¯é€šç”¨çš„ã€‚è¿™æ˜¯é€šå¸¸åœ¨ç›¸åº”å±æ€§çš„å€¼æœªé€šè¿‡éªŒè¯æ—¶å‘ˆç°çš„æ¶ˆæ¯ã€‚<br>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ³¨è§£ï¼š</p>
<ul>
<li><strong><code>@NotEmpty</code></strong>ï¼šéªŒè¯è¯¥å±æ€§ä¸ä¸ºnullæˆ–ä¸ºç©ºï¼›å¯ä»¥åº”ç”¨äºString, Collection, Mapæˆ–è€…æ˜¯æ•°ç»„ã€‚</li>
<li><strong><code>@NotBlank</code></strong>ï¼šåªèƒ½åº”ç”¨äºæ–‡æœ¬å€¼ï¼Œå¹¶éªŒè¯è¯¥å±æ€§ä¸æ˜¯nullæˆ–æ˜¯ç©ºæ ¼ã€‚</li>
<li><strong><code>@Positive</code></strong>å’Œ<strong><code>@PositiveOrZero</code></strong>ï¼šé€‚ç”¨äºæ•°å€¼å¹¶éªŒè¯å…¶ä¸¥æ ¼ä¸ºæ­£ï¼Œæˆ–ä¸ºæ­£ï¼ˆåŒ…æ‹¬0ï¼‰ã€‚</li>
<li><strong><code>@Negative</code></strong>å’Œ<strong><code>@NegativeOrZero</code></strong>ï¼šé€‚ç”¨äºæ•°å€¼å¹¶éªŒè¯å…¶ä¸¥æ ¼ä¸ºè´Ÿæ•°ï¼Œæˆ–åŒ…å«0çš„è´Ÿæ•°ã€‚</li>
<li><strong><code>@Past</code></strong>å’Œ<strong><code>@PastOrPresent</code></strong>ï¼šéªŒè¯æ—¥æœŸå€¼æ˜¯è¿‡å»æ—¶æˆ–æ˜¯åŒ…æ‹¬ç°åœ¨çš„è¿‡å»æ—¶ï¼›å¯ä»¥åº”ç”¨äºæ—¥æœŸç±»å‹ï¼ŒåŒ…æ‹¬Java8ä¸­æ·»åŠ çš„æ—¥æœŸç±»å‹ã€‚</li>
<li><strong><code>@Future</code></strong>å’Œ<strong><code>@FutureOrPresent</code></strong>ï¼šéªŒè¯æ—¥æœŸå€¼æ˜¯å°†æ¥çš„æ—¥æœŸæˆ–æ˜¯åŒ…æ‹¬ç°åœ¨å°†æ¥çš„æ—¥æœŸã€‚<br>éªŒè¯æ³¨è§£ä¹Ÿå¯ä»¥åº”ç”¨äºé›†åˆçš„å…ƒç´ ï¼š<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;<span class="meta">@NotBlank</span> String&gt; preferences;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†éªŒè¯æ·»åŠ åˆ°preferencesåˆ—è¡¨çš„ä»»ä½•å€¼ã€‚<br>è¯¥è§„èŒƒè¿˜æ”¯æŒJava8ä¸­çš„æ–°<code>Optional</code>ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> LocalDate dateOfBirth;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Optional&lt;<span class="meta">@Past</span> LocalDate&gt; getDateOfBirth() &#123;</span><br><span class="line">    <span class="keyword">return</span> Optional.of(dateOfBirth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>éªŒè¯æ¡†æ¶å°†è‡ªåŠ¨è§£åŒ…LocalDateå€¼å¹¶å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚</p>
<h2 id="5-éªŒè¯Bean"><a href="#5-éªŒè¯Bean" class="headerlink" title="5. éªŒè¯Bean"></a>5. éªŒè¯Bean</h2><p>è¯¸å¦‚Springä¹‹ç±»çš„æŸäº›æ¡†æ¶å…·æœ‰ä»…é€šè¿‡ä½¿ç”¨æ³¨è§£æ¥è§¦å‘éªŒè¯è¿‡ç¨‹çš„ç®€å•æ–¹æ³•ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬ä¸å¿…ä¸ç¼–ç¨‹éªŒè¯APIè¿›è¡Œäº¤äº’ã€‚<br>ç°åœ¨è®©æˆ‘ä»¬èµ°æ‰‹åŠ¨è·¯çº¿ï¼Œä»¥ç¼–ç¨‹æ–¹å¼è¿›è¡Œè®¾ç½®ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ValidatorFactory factory = Validation.buildDefaultValidatorFactory();</span><br><span class="line">Validator validator = factory.getValidator();</span><br></pre></td></tr></table></figure></p>
<p>è¦éªŒè¯beanï¼Œé¦–å…ˆå¿…é¡»æœ‰ä¸€ä¸ªValidatorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä½¿ç”¨ValidatorFactoryæ„é€ çš„ã€‚<br>ä¸‹é¢çœ‹ä¸€ä¸‹å®Œæˆçš„éªŒè¯ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationIntegrationTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();</span><br><span class="line">        validator = factory.getValidator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> User <span class="title">createUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"John"</span>);</span><br><span class="line">        user.setWorking(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//user.setAge(18);</span></span><br><span class="line">        user.setEmail(<span class="string">"lxm"</span>);</span><br><span class="line">        <span class="comment">//user.setAboutMe(".......................!");</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = createUser();</span><br><span class="line">        Set&lt;ConstraintViolation&lt;User&gt;&gt; violations = validator.validate(user);</span><br><span class="line">        <span class="keyword">if</span> (!violations.isEmpty())&#123;</span><br><span class="line">            violations.forEach((tem)-&gt;&#123;</span><br><span class="line">                System.out.println(tem.getPropertyPath().toString() + <span class="string">"ï¼š"</span> + tem.getMessage());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ageï¼šAge should not be less than 18</span></span><br><span class="line"><span class="comment">emailï¼šEmail should be valid</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jackson ObjectMapperçš„ä½¿ç”¨</title>
    <url>/Jackson/Jackson-ObjectMapper%E7%9A%84%E4%BD%BF%E7%94%A8.html</url>
    <content><![CDATA[<h1 id="Jackson-ObjectMapperçš„ä½¿ç”¨"><a href="#Jackson-ObjectMapperçš„ä½¿ç”¨" class="headerlink" title="Jackson ObjectMapperçš„ä½¿ç”¨"></a>Jackson ObjectMapperçš„ä½¿ç”¨</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Jacksonçš„ObjectMapperç±»å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJsonä»¥åŠå°†Jsonååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p>
<h2 id="2-Mavenä¾èµ–"><a href="#2-Mavenä¾èµ–" class="headerlink" title="2. Mavenä¾èµ–"></a>2. Mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤ä¾èµ–é¡¹å°†åœ¨ç±»è·¯å¾„ä¸­å¯ä¼ é€’åœ°æ·»åŠ ä»¥ä¸‹åº“ï¼š</p>
<ul>
<li>jackson-annotations-2.10.1.jar</li>
<li>jackson-core-2.10.1.jar</li>
<li>jackson-databind-2.10.1.jar<h2 id="3-ä½¿ç”¨ObjectMapperè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#3-ä½¿ç”¨ObjectMapperè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="3. ä½¿ç”¨ObjectMapperè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>3. ä½¿ç”¨ObjectMapperè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2>è®©æˆ‘ä»¬ä»åŸºæœ¬çš„è¯»å†™æ“ä½œå¼€å§‹ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ObjectMapperçš„readValueæ¥å°†JSONå†…å®¹è§£ææˆ–ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨writeValueå°†ä»»ä½•Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONè¾“å‡ºã€‚<br>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å¸¦æœ‰ä¸¤ä¸ªå­—æ®µçš„Carç±»ä½œä¸ºå¯¹è±¡æ¥åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼š<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// getters/setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-1-Javaå¯¹è±¡è½¬JSON"><a href="#3-1-Javaå¯¹è±¡è½¬JSON" class="headerlink" title="3.1. Javaå¯¹è±¡è½¬JSON"></a>3.1. Javaå¯¹è±¡è½¬JSON</h3><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ObjectMapperç±»çš„writeValueæ–¹æ³•å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONçš„ç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">Car car = <span class="keyword">new</span> Car(<span class="string">"yellow"</span>, <span class="string">"renault"</span>);</span><br><span class="line">objectMapper.writeValue(<span class="keyword">new</span> File(<span class="string">"target/car.json"</span>), car);</span><br></pre></td></tr></table></figure></p>
<p>æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯ï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"color"</span>:<span class="string">"yellow"</span>,<span class="attr">"type"</span>:<span class="string">"renault"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>ObjectMapperç±»çš„writeValueAsStringå’ŒwriteValueAsBytesæ–¹æ³•ä»Javaå¯¹è±¡ç”Ÿæˆä¸€ä¸ªJSONï¼Œå¹¶å°†ç”Ÿæˆçš„JSONä½œä¸ºå­—ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„è¿”å›ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String carAsString = objectMapper.writeValueAsString(car);</span><br></pre></td></tr></table></figure></p>
<h3 id="3-2-JSONè½¬ä¸ºJsonå¯¹è±¡"><a href="#3-2-JSONè½¬ä¸ºJsonå¯¹è±¡" class="headerlink" title="3.2. JSONè½¬ä¸ºJsonå¯¹è±¡"></a>3.2. JSONè½¬ä¸ºJsonå¯¹è±¡</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ObjectMapperç±»å°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºJavaå¯¹è±¡çš„ç®€å•ç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">String json = <span class="string">"&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;"</span>;</span><br><span class="line">Car car = objectMapper.readValue(json, Car.class);</span><br></pre></td></tr></table></figure></p>
<p>readValue()å‡½æ•°è¿˜æ¥å—å…¶ä»–å½¢å¼çš„è¾“å…¥ï¼Œä¾‹å¦‚åŒ…å«JSONå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Car car = objectMapper.readValue(<span class="keyword">new</span> File(<span class="string">"src/test/resources/json_car.json"</span>), Car.class);</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…æ˜¯URL<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Car car = objectMapper.readValue(<span class="keyword">new</span> URL(<span class="string">"file:src/test/resources/json_car.json"</span>), Car.class);</span><br></pre></td></tr></table></figure></p>
<h3 id="3-3-JSONè½¬Jackson-JsonNode"><a href="#3-3-JSONè½¬Jackson-JsonNode" class="headerlink" title="3.3. JSONè½¬Jackson JsonNode"></a>3.3. JSONè½¬Jackson JsonNode</h3><p>å¦å¤–ï¼Œå¯ä»¥å°†JSONè§£æä¸ºJsonNodeå¯¹è±¡ï¼Œå¹¶ç”¨äºä»ç‰¹å®šèŠ‚ç‚¹æ£€ç´¢æ•°æ®ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">"&#123; \"color\" : \"Black\", \"type\" : \"FIAT\" &#125;"</span>;</span><br><span class="line">JsonNode jsonNode = objectMapper.readTree(json);</span><br><span class="line">String color = jsonNode.get(<span class="string">"color"</span>).asText();</span><br><span class="line"><span class="comment">// Black</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-4-Jsonè½¬ä¸ºJava-List"><a href="#3-4-Jsonè½¬ä¸ºJava-List" class="headerlink" title="3.4. Jsonè½¬ä¸ºJava List"></a>3.4. Jsonè½¬ä¸ºJava List</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨TypeReferenceå°†æ•°ç»„å½¢å¼çš„JSONè§£æä¸ºJavaå¯¹è±¡åˆ—è¡¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = <span class="string">"[&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;, &#123; \"color\" : \"Red\", \"type\" : \"FIAT\" &#125;]"</span>;</span><br><span class="line">List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="3-5-Jsonè½¬ä¸ºJava-Map"><a href="#3-5-Jsonè½¬ä¸ºJava-Map" class="headerlink" title="3.5. Jsonè½¬ä¸ºJava Map"></a>3.5. Jsonè½¬ä¸ºJava Map</h3><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†JSONè§£æä¸ºJava Mapï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">"&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;"</span>;</span><br><span class="line">Map&lt;String, Object&gt; map = objectMapper.readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String,Object&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="4-é«˜çº§ç‰¹æ€§"><a href="#4-é«˜çº§ç‰¹æ€§" class="headerlink" title="4. é«˜çº§ç‰¹æ€§"></a>4. é«˜çº§ç‰¹æ€§</h2><p>Jacksonåº“çš„æœ€å¤§ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯é«˜åº¦å¯å®šåˆ¶çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚<br>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå…¶ä¸­è¾“å…¥æˆ–è¾“å‡ºJSONæ•°æ®å¯èƒ½ä¸åŒäºç”Ÿæˆæˆ–ä½¿ç”¨æ•°æ®çš„å¯¹è±¡ã€‚</p>
<h3 id="4-1-é…ç½®åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#4-1-é…ç½®åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="4.1. é…ç½®åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>4.1. é…ç½®åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><p>åœ¨å°†JSONå¯¹è±¡è½¬æ¢ä¸ºJavaç±»æ—¶ï¼Œå¦‚æœJSONå­—ç¬¦ä¸²å…·æœ‰ä¸€äº›æ–°å­—æ®µï¼Œåˆ™é»˜è®¤è¿‡ç¨‹å°†å¯¼è‡´å¼‚å¸¸ï¼Œæ¯”å¦‚Carä¸­æ²¡æœ‰<code>year</code>å±æ€§ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonString = <span class="string">"&#123; \"color\" : \"Black\", \"type\" : \"Fiat\", \"year\" : \"1970\" &#125;"</span>;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„é»˜è®¤è§£æè¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹Class Carçš„Javaå¯¹è±¡çš„JSONå­—ç¬¦ä¸²å°†å¯¼è‡´UnrecognizedPropertyExceptionå¼‚å¸¸ã€‚</p>
<blockquote>
<p>é€šè¿‡<code>configure</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•é»˜è®¤è¿‡ç¨‹ä»¥å¿½ç•¥æ–°å­—æ®µï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br><span class="line">Car car = objectMapper.readValue(jsonString, Car.class);</span><br><span class="line"> </span><br><span class="line">JsonNode jsonNodeRoot = objectMapper.readTree(jsonString);</span><br><span class="line">JsonNode jsonNodeYear = jsonNodeRoot.get(<span class="string">"year"</span>);</span><br><span class="line">String year = jsonNodeYear.asText();</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><p>å¦ä¸€ä¸ªé€‰é¡¹æ˜¯<code>FAIL_ON_NULL_FOR_PRIMITIVES</code>çš„ï¼Œå®ƒå®šä¹‰äº†æ˜¯å¦å…è®¸ç±»çš„å±æ€§ä¸ºç©ºå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŒæ ·ï¼Œ<code>FAIL_ON_NUMBERS_FOR_ENUM</code>æ§åˆ¶æ˜¯å¦å…è®¸å°†æšä¸¾å€¼åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸ºæ•°å­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åœ¨<a href="https://github.com/FasterXML/jackson-databind/wiki/Serialization-Features" target="_blank" rel="noopener">å®˜æ–¹ç½‘ç«™</a>ä¸Šæ‰¾åˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½çš„å®Œæ•´åˆ—è¡¨ã€‚</p>
<h3 id="4-2-è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨"><a href="#4-2-è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨" class="headerlink" title="4.2. è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨"></a>4.2. è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨</h3><p>ObjectMapperç±»çš„å¦ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½æ˜¯èƒ½å¤Ÿæ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ã€‚åœ¨è¾“å…¥æˆ–è¾“å‡ºJSONçš„ç»“æ„ä¸åŒäºå¿…é¡»å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„Javaç±»çš„ç»“æ„æ—¶ï¼Œè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨éå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>ä»¥ä¸‹æ˜¯è‡ªå®šä¹‰JSONåºåˆ—åŒ–å™¨çš„ç¤ºä¾‹ï¼š</strong><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">(Class&lt;Car&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      Car car, JsonGenerator jsonGenerator, SerializerProvider serializer)</span> </span>&#123;</span><br><span class="line">        jsonGenerator.writeStartObject();</span><br><span class="line">        jsonGenerator.writeStringField(<span class="string">"car_brand"</span>, car.getType());</span><br><span class="line">        jsonGenerator.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">SimpleModule <span class="keyword">module</span> = <span class="keyword">new</span> SimpleModule(<span class="string">"CustomCarSerializer"</span>, <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line"><span class="keyword">module</span>.addSerializer(Car.class, <span class="keyword">new</span> CustomCarSerializer());</span><br><span class="line">mapper.registerModule(<span class="keyword">module</span>);</span><br><span class="line"></span><br><span class="line">Car car = <span class="keyword">new</span> Car(<span class="string">"yellow"</span>, <span class="string">"renault"</span>);</span><br><span class="line">String carJson = mapper.writeValueAsString(car);</span><br><span class="line">System.out.println(carJson); <span class="comment">// &#123;"car_brand":"renault"&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>æˆ‘ä»¬å†è‡ªå®šä¹‰JSONååºåˆ—åŒ–å™¨ï¼š</strong><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarDeserializer</span> <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">(Class&lt;?&gt; vc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(vc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">deserialize</span><span class="params">(JsonParser parser, DeserializationContext deserializer)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        ObjectCodec codec = parser.getCodec();</span><br><span class="line">        JsonNode node = codec.readTree(parser);</span><br><span class="line"></span><br><span class="line">        JsonNode colorNode = node.get(<span class="string">"color"</span>);</span><br><span class="line">        String color = colorNode.asText();</span><br><span class="line">        car.setColor(color);</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨æ­¤è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">"&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;"</span>;</span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">SimpleModule <span class="keyword">module</span> = <span class="keyword">new</span> SimpleModule(<span class="string">"CustomCarDeserializer"</span>, <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line"><span class="keyword">module</span>.addDeserializer(Car.class, <span class="keyword">new</span> CustomCarDeserializer());</span><br><span class="line">mapper.registerModule(<span class="keyword">module</span>);</span><br><span class="line"></span><br><span class="line">Car car = mapper.readValue(json, Car.class);</span><br><span class="line">System.out.println(car); <span class="comment">// Carç±»ä¸­åªæœ‰colorå±æ€§æœ‰å€¼</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-3-å¤„ç†æ—¥æœŸæ ¼å¼"><a href="#4-3-å¤„ç†æ—¥æœŸæ ¼å¼" class="headerlink" title="4.3. å¤„ç†æ—¥æœŸæ ¼å¼"></a>4.3. å¤„ç†æ—¥æœŸæ ¼å¼</h3><p><code>java.util.Date</code>çš„é»˜è®¤åºåˆ—åŒ–äº§ç”Ÿä¸€ä¸ªæ•°å­—ï¼Œå³çºªå…ƒæ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´1æœˆ1æ—¥èµ·ï¼Œä»¥UTCä¸ºå•ä½çš„æ¯«ç§’æ•°ï¼‰ã€‚ä½†è¿™ä¸æ˜¯äººç±»å¯è¯»çš„ï¼Œå¹¶ä¸”éœ€è¦è¿›ä¸€æ­¥è½¬æ¢ä»¥äººç±»å¯è¯»çš„æ ¼å¼æ˜¾ç¤ºã€‚<br>è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> Date datePurchased;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// getters/setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸åŠ æ—¥æœŸå¤„ç†æ—¶<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        <span class="keyword">final</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="keyword">final</span> Car car = <span class="keyword">new</span> Car(<span class="string">"yellow"</span>, <span class="string">"renault"</span>);</span><br><span class="line">        <span class="keyword">final</span> Request request = <span class="keyword">new</span> Request();</span><br><span class="line">        request.setCar(car);</span><br><span class="line">        request.setDatePurchased(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        String value = objectMapper.writeValueAsString(request);</span><br><span class="line">        System.out.println(value); </span><br><span class="line"><span class="comment">// &#123;"car":&#123;"color":"yellow","type":"renault"&#125;,"datePurchased":1583050561145&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>æ·»åŠ æ—¥æœŸæ ¼å¼å¤„ç†<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        <span class="keyword">final</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="keyword">final</span> Car car = <span class="keyword">new</span> Car(<span class="string">"yellow"</span>, <span class="string">"renault"</span>);</span><br><span class="line">        <span class="keyword">final</span> Request request = <span class="keyword">new</span> Request();</span><br><span class="line">        request.setCar(car);</span><br><span class="line">        request.setDatePurchased(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm a z"</span>);</span><br><span class="line">        objectMapper.setDateFormat(df);</span><br><span class="line"></span><br><span class="line">        String value = objectMapper.writeValueAsString(request);</span><br><span class="line">        System.out.println(value);</span><br><span class="line"><span class="comment">// &#123;"car":&#123;"color":"yellow","type":"renault"&#125;,"datePurchased":"2020-03-01 16:18 ä¸‹åˆ CST"&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-4-å¤„ç†é›†åˆ"><a href="#4-4-å¤„ç†é›†åˆ" class="headerlink" title="4.4. å¤„ç†é›†åˆ"></a>4.4. å¤„ç†é›†åˆ</h3><p><code>DeserializationFeature</code>ç±»æä¾›çš„å¦ä¸€ä¸ªå°è€Œæœ‰ç”¨çš„åŠŸèƒ½æ˜¯èƒ½å¤Ÿä»JSON Arrayç”Ÿæˆæ‰€éœ€ç±»å‹çš„é›†åˆçš„åŠŸèƒ½ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†Jsonç”Ÿæˆä¸ºæ•°ç»„ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = <span class="string">"[&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;, &#123; \"color\" : \"Red\", \"type\" : \"FIAT\" &#125;]"</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, <span class="keyword">true</span>);</span><br><span class="line">Car[] cars = objectMapper.readValue(jsonCarArray, Car[].class);</span><br><span class="line"></span><br><span class="line">System.out.println(cars);</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…è½¬æ¢ä¸ºJava List<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = </span><br><span class="line">  <span class="string">"[&#123; \"color\" : \"Black\", \"type\" : \"BMW\" &#125;, &#123; \"color\" : \"Red\", \"type\" : \"FIAT\" &#125;]"</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Jackson</category>
      </categories>
      <tags>
        <tag>Jackson</tag>
      </tags>
  </entry>
  <entry>
    <title>Jacksonæ³¨è§£ä½¿ç”¨ç¤ºä¾‹</title>
    <url>/Jackson/Jackson%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B.html</url>
    <content><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1 æ¦‚è¿°"></a>1 æ¦‚è¿°</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Jacksonæ³¨è§£ã€‚<br>æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨Jacksonç°æœ‰çš„æ³¨è§£ï¼Œå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ä»¥åŠå¦‚ä½•ç¦ç”¨å®ƒä»¬ã€‚</p>
<h2 id="2-Jacksonåºåˆ—åŒ–æ³¨è§£"><a href="#2-Jacksonåºåˆ—åŒ–æ³¨è§£" class="headerlink" title="2 Jacksonåºåˆ—åŒ–æ³¨è§£"></a>2 Jacksonåºåˆ—åŒ–æ³¨è§£</h2><h3 id="2-1-JsonAnyGetter"><a href="#2-1-JsonAnyGetter" class="headerlink" title="2.1 @JsonAnyGetter"></a>2.1 @JsonAnyGetter</h3><p>@JsonAnyGetteræ³¨è§£æä¾›äº†å°†Mapå­—æ®µè½¬æ¢ä¸ºæ ‡å‡†å±æ€§çš„çµæ´»æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹â€“ ExtendableBeanå®ä½“å…·æœ‰nameå±æ€§å’Œä¸€ç»„ä»¥K/Vå¯¹å½¢å¼çš„å¯æ‰©å±•å±æ€§ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; properties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExtendableBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        properties = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExtendableBean</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        properties = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnySetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String value)</span> </span>&#123;</span><br><span class="line">        properties.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnyGetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åºåˆ—åŒ–æ­¤å®ä½“çš„å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å°†Mapä¸­çš„æ‰€æœ‰é”®å€¼ä½œä¸ºæ ‡å‡†çš„çº¯å±æ€§è·å–ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"My bean"</span>,</span><br><span class="line">    <span class="attr">"attr2"</span>:<span class="string">"val2"</span>,</span><br><span class="line">    <span class="attr">"attr1"</span>:<span class="string">"val1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonAnyGetter_thenCorrect</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ExtendableBean bean = <span class="keyword">new</span> ExtendableBean(<span class="string">"My bean"</span>);</span><br><span class="line">    bean.add(<span class="string">"attr1"</span>, <span class="string">"val1"</span>);</span><br><span class="line">    bean.add(<span class="string">"attr2"</span>, <span class="string">"val2"</span>);</span><br><span class="line"></span><br><span class="line">    String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯ç”¨ä¸ºfalseçš„å¯é€‰å‚æ•°æ¥ç¦ç”¨@JsonAnyGetter()ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ°å›¾å°†è½¬æ¢ä¸ºJSONï¼Œå¹¶åœ¨åºåˆ—åŒ–åæ˜¾ç¤ºåœ¨propertieså˜é‡ä¸‹ã€‚<code>{&quot;name&quot;:&quot;My bean&quot;,&quot;properties&quot;:{&quot;attr2&quot;:&quot;val2&quot;,&quot;attr1&quot;:&quot;val1&quot;}}</code></p>
<h3 id="2-2-JsonGetter"><a href="#2-2-JsonGetter" class="headerlink" title="2.2 @JsonGetter"></a>2.2 @JsonGetter</h3><blockquote>
<p>@JsonGetteræ³¨è§£æ˜¯@JsonPropertyæ³¨è§£çš„æ›¿ä»£æ–¹æ³•ï¼Œç”¨äºå°†æ–¹æ³•æ ‡è®°ä¸ºgetteræ–¹æ³•ã€‚</p>
</blockquote>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ–¹æ³•getTheName()æŒ‡å®šä¸ºMyBeanå®ä½“çš„nameå±æ€§çš„getteræ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> id, <span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonGetter</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonSetter</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonGetter_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyBean bean = <span class="keyword">new</span> MyBean(<span class="number">1</span>, <span class="string">"My bean"</span>);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"id":1,"name":"My bean"&#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å› ä¸ºè¿™é‡Œ<code>name</code>å±æ€§æ˜¯ç§æœ‰çš„ï¼Œä¸”getå’Œsetæ–¹æ³•åä¸æ˜¯ä½¿ç”¨get/set+å±æ€§åã€‚è€Œjacksonåœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ç§æœ‰å±æ€§ä¼šè°ƒç”¨å®ƒçš„getæ–¹æ³•ï¼Œé»˜è®¤çš„getæ–¹æ³•åå°±æ˜¯<code>get+å±æ€§å</code>ã€‚å¦‚æœä¸ä½¿ç”¨@JsonGetteræ³¨è§£æŒ‡å®šï¼Œjacksonä¼šè®¤ä¸ºtheNameæ˜¯ä¸€ä¸ªå±æ€§ã€‚è¾“å‡ºå¦‚ä¸‹ï¼š<br><code>{&quot;id&quot;:1,&quot;theName&quot;:&quot;My bean&quot;}</code></p>
</blockquote>
<h3 id="2-3-JsonPropertyOrder"><a href="#2-3-JsonPropertyOrder" class="headerlink" title="2.3 @JsonPropertyOrder"></a>2.3 @JsonPropertyOrder</h3><blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonPropertyOrderæ³¨è§£æŒ‡å®šåºåˆ—åŒ–å±æ€§çš„é¡ºåºã€‚è®©æˆ‘ä»¬ä¸ºMyBeanå®ä½“çš„å±æ€§è®¾ç½®è‡ªå®šä¹‰é¡ºåºï¼š</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonPropertyOrder</span>(&#123; <span class="string">"name"</span>, <span class="string">"id"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•è¾“å‡ºå¦‚ä¸‹ï¼š<br><code>{&quot;name&quot;:&quot;My bean&quot;,&quot;id&quot;:1}</code><br>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>@JsonPropertyOrder(alphabetic = true)</code>æŒ‰å­—æ¯é¡ºåºå¯¹å±æ€§è¿›è¡Œæ’åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—åŒ–çš„è¾“å‡ºå°†æ˜¯ï¼š<code>{&quot;id&quot;:1,&quot;name&quot;:&quot;My bean&quot;}</code></p>
<h3 id="2-4-JsonRawValue"><a href="#2-4-JsonRawValue" class="headerlink" title="2.4 @JsonRawValue"></a>2.4 @JsonRawValue</h3><blockquote>
<p>@JsonRawValueæ³¨è§£å¯ä»¥ä½¿Jacksonå®Œå…¨æŒ‰åŸæ ·åºåˆ—åŒ–å±æ€§ã€‚</p>
</blockquote>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JsonRawValueåµŒå…¥ä¸€äº›è‡ªå®šä¹‰JSONä½œä¸ºå®ä½“çš„å€¼ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RawBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonRawValue</span></span><br><span class="line">    <span class="keyword">public</span> String json;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RawBean</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RawBean</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> String json)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.json = json;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonRawValue_thenCorrect</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> RawBean bean = <span class="keyword">new</span> RawBean(<span class="string">"My bean"</span>, <span class="string">"&#123;\"attr\":false&#125;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"name":"My bean","json":&#123;"attr":false&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä¸åŠ @JsonRawValueæ³¨è§£ï¼›è¾“å‡ºä¸ºï¼š&#123;"name":"My bean","json":"&#123;\"attr\":false&#125;"&#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯é€‰çš„å¸ƒå°”å‚æ•°å€¼(value)æ¥å®šä¹‰æ­¤æ³¨è§£æ˜¯å¦èµ·ä½œç”¨ã€‚</p>
</blockquote>
<h3 id="2-5-JsonValue"><a href="#2-5-JsonValue" class="headerlink" title="2.5 @JsonValue"></a>2.5 @JsonValue</h3><blockquote>
<p>@JsonValueæ³¨è§£çš„ä½œç”¨æ˜¯å‘Šè¯‰jacksonåºåˆ—åŒ–ç±»å®ä¾‹æ—¶ä½¿ç”¨å®ƒæ ‡æ³¨çš„çš„å•ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæšä¸¾ä¸­ï¼Œæˆ‘ä»¬ç”¨@JsonValueæ³¨é‡ŠgetNameï¼Œä»¥ä¾¿ä»»ä½•è¿™æ ·çš„å®ä½“éƒ½é€šè¿‡å…¶åç§°åºåˆ—åŒ–ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> TypeEnumWithValue &#123;</span><br><span class="line">    TYPE1(<span class="number">1</span>, <span class="string">"Type A"</span>),</span><br><span class="line">    TYPE2(<span class="number">2</span>, <span class="string">"Type 2"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    TypeEnumWithValue(Integer id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonValue_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonParseException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String enumAsString = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writeValueAsString(TypeEnumWithValue.TYPE1);</span><br><span class="line"></span><br><span class="line">        System.out.println(enumAsString);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// "Type A"</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä¸ä½¿ç”¨@JsonValueæ ‡è®°ï¼Œæšä¸¾åºåˆ—åŒ–å‡ºæ¥çš„æ˜¯<code>&quot;TYPE1&quot;</code></p>
<h3 id="2-6-JsonRootName"><a href="#2-6-JsonRootName" class="headerlink" title="2.6 @JsonRootName"></a>2.6 @JsonRootName</h3><blockquote>
<p>@JsonRootNameçš„ä½œç”¨å¯ä»¥ç†è§£ä¸ºï¼Œåœ¨åºåˆ—åŒ–å¥½çš„jsonä¸²å¤–é¢å†åŒ…è£¹ä¸€å±‚ã€‚<br>å‡è®¾ä¹‹å‰æˆ‘ä»¬çš„åºåˆ—åŒ–ä¹‹åæ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&gt; &#123;</span><br><span class="line">&gt;     "id": 1,</span><br><span class="line">&gt;     "name": "John"</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨@JsonRootNameåŒ…è£¹ä¸€å±‚ä¼šå˜æˆè¿™æ ·<br><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&gt; &#123;</span><br><span class="line">&gt;     "user": &#123;</span><br><span class="line">&gt;         "id": 1,</span><br><span class="line">&gt;         "name": "John"</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonRootName</span>(value = <span class="string">"user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»Jackson 2.4å¼€å§‹ï¼Œæ–°çš„å¯é€‰å‚æ•°åç§°ç©ºé—´å¯ç”¨äºXMLç­‰æ•°æ®æ ¼å¼ã€‚å¦‚æœæ·»åŠ å®ƒï¼Œå®ƒå°†æˆä¸ºå®Œå…¨é™å®šåç§°çš„ä¸€éƒ¨åˆ†ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonRootName</span>(value = <span class="string">"user"</span>, namespace=<span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRootNamespace</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>xmlæ•ˆæœæ˜¯è¿™æ ·çš„<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">xmlns</span>=<span class="string">"users"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">xmlns</span>=<span class="string">""</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span> <span class="attr">xmlns</span>=<span class="string">""</span>&gt;</span>John<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">items</span> <span class="attr">xmlns</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-7-JsonSerialize"><a href="#2-7-JsonSerialize" class="headerlink" title="2.7 @JsonSerialize"></a>2.7 @JsonSerialize</h3><blockquote>
<p>@JsonSerializeè¡¨ç¤ºåœ¨åºåˆ—åŒ–å®ä½“æ—¶è¦ä½¿ç”¨çš„è‡ªå®šä¹‰åºåˆ—åŒ–ç¨‹åºã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨@JsonSerializeé€šè¿‡CustomDateSerializeræ¥åºåˆ—åŒ–eventDateå±æ€§ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventWithSerializer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = CustomDateSerializer.class)</span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯ç®€å•çš„è‡ªå®šä¹‰Jacksonåºåˆ—åŒ–å™¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDateSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2894356342227378312L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"dd-MM-yyyy hh:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateSerializer</span><span class="params">(<span class="keyword">final</span> Class&lt;Date&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Date date,</span></span></span><br><span class="line"><span class="function"><span class="params">                          JsonGenerator jsonGenerator,</span></span></span><br><span class="line"><span class="function"><span class="params">                          SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        jsonGenerator.writeString(formatter.format(date));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è®©æˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonSerialize_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        EventWithSerializer event = <span class="keyword">new</span> EventWithSerializer(<span class="string">"party"</span>, date);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(event);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"name":"party","eventDate":"24-02-2020 02:34:26"&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-Jacksonååºåˆ—åŒ–æ³¨è§£"><a href="#3-Jacksonååºåˆ—åŒ–æ³¨è§£" class="headerlink" title="3 Jacksonååºåˆ—åŒ–æ³¨è§£"></a>3 Jacksonååºåˆ—åŒ–æ³¨è§£</h2><h3 id="3-1-JsonCreator"><a href="#3-1-JsonCreator" class="headerlink" title="3.1 @JsonCreator"></a>3.1 @JsonCreator</h3><blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonCreatoræ³¨è§£æ¥è°ƒæ•´ååºåˆ—åŒ–ä¸­ä½¿ç”¨çš„æ„é€ å‡½æ•°/å·¥å‚ã€‚</p>
</blockquote>
<p>å½“æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–æŸäº›ä¸æˆ‘ä»¬éœ€è¦è·å–çš„ç›®æ ‡å®ä½“ä¸å®Œå…¨åŒ¹é…çš„JSONæ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚<br>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼›å‡è®¾æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–çš„JSONå¦‚ä¸‹ï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">"theName"</span>:<span class="string">"My bean"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å®ä½“ä¸­æ²¡æœ‰<code>theName</code>å­—æ®µï¼Œåªæœ‰ä¸€ä¸ª<code>name</code>å­—æ®µã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¸æƒ³æ›´æ”¹å®ä½“æœ¬èº«ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹è§£ç»„è¿‡ç¨‹è¿›è¡Œæ›´å¤šæ§åˆ¶ï¼Œé€šè¿‡ä½¿ç”¨@JsonCreatoræ³¨é‡Šæ„é€ å‡½æ•°å¹¶åŒæ—¶ä½¿ç”¨@JsonPropertyæ³¨é‡Šï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCreator</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      @JsonProperty(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id, </span></span><br><span class="line"><span class="function">      @<span class="title">JsonProperty</span><span class="params">(<span class="string">"theName"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingUsingJsonCreator_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">"&#123;\"id\":1,\"theName\":\"My bean\"&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        BeanWithCreator bean = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .readerFor(BeanWithCreator.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line">        System.out.println(bean.name);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// My bean</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ã€‚</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-2-JacksonInject"><a href="#3-2-JacksonInject" class="headerlink" title="3.2 @JacksonInject"></a>3.2 @JacksonInject</h3><blockquote>
<p>@JacksonInjectè¡¨ç¤ºè¯¥å±æ€§å°†ä»æ³¨å…¥ä¸­è·å–è€Œä¸æ˜¯ä»JSONæ•°æ®è·å–å…¶å€¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithInject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JacksonInject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithInject</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithInject</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> id, <span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingUsingJsonInject_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">"&#123;\"name\":\"My bean\"&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨jacksonçš„InjectableValuesç±»è¿›è¡Œæ³¨å…¥</span></span><br><span class="line">        InjectableValues inject = <span class="keyword">new</span> InjectableValues.Std()</span><br><span class="line">                .addValue(<span class="keyword">int</span>.class, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        BeanWithInject bean = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .reader(inject)</span><br><span class="line">                .forType(BeanWithInject.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line"></span><br><span class="line">        System.out.println(bean);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// BeanWithInject&#123;id=1, name='My bean'&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-3-JsonAnySetter"><a href="#3-3-JsonAnySetter" class="headerlink" title="3.3 @JsonAnySetter"></a>3.3 @JsonAnySetter</h3><blockquote>
<p>@JsonAnySetterä½¿æˆ‘ä»¬å¯ä»¥çµæ´»åœ°ä½¿ç”¨Mapä½œä¸ºæ ‡å‡†å±æ€§ã€‚ååºåˆ—åŒ–æ—¶ï¼ŒJSONçš„å±æ€§å°†ç®€å•åœ°æ·»åŠ åˆ°åœ°å›¾ä¸­ã€‚å’Œä¹‹å‰ä»‹ç»çš„@JsonAnyGetteræ­£å¥½ç›¸åã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; properties;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonAnySetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        properties.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾æˆ‘ä»¬çš„jsonæ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"My bean"</span>,</span><br><span class="line">    <span class="attr">"attr2"</span>:<span class="string">"val2"</span>,</span><br><span class="line">    <span class="attr">"attr1"</span>:<span class="string">"val1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>é‚£ä¹ˆ<code>attr2</code>å’Œ<code>attr1</code>ä¼šæ³¨å…¥åˆ°Mapä¸­ã€‚</p>
</blockquote>
<h3 id="3-4-JsonSetter"><a href="#3-4-JsonSetter" class="headerlink" title="3.4 @JsonSetter"></a>3.4 @JsonSetter</h3><blockquote>
<p>å’Œä¹‹å‰ä»‹ç»çš„@JsonGetterç›¸åï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚</p>
</blockquote>
<h3 id="3-5-JsonDeserialize"><a href="#3-5-JsonDeserialize" class="headerlink" title="3.5 @JsonDeserialize"></a>3.5 @JsonDeserialize</h3><blockquote>
<p>è¿™ä¸ªæ˜¯ç”¨æ¥æŒ‡å®šè‡ªå®šä¹‰çš„ååºåˆ—åŒ–è§„åˆ™çš„ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨@JsonDeserializeä¸CustomDateDeserializerååºåˆ—åŒ–eventDateå±æ€§ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventWithSerializer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonDeserialize</span>(using = CustomDateDeserializer.class)</span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = CustomDateSerializer.class)</span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è‡ªå®šä¹‰çš„ååºåˆ—åŒ–å™¨ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDateDeserializer</span> <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5451717385630622729L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"dd-MM-yyyy hh:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateDeserializer</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; vc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(vc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">deserialize</span><span class="params">(JsonParser jsonParser,</span></span></span><br><span class="line"><span class="function"><span class="params">                            DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String date = jsonParser.getText();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> formatter.parse(date);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingUsingJsonDeserialize_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">"&#123;\"name\":\"party\",\"eventDate\":\"02-02-2020 02:30:00\"&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        EventWithSerializer event = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .readerFor(EventWithSerializer.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line"></span><br><span class="line">        System.out.println(event);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// EventWithSerializer&#123;name='party', eventDate=Sun Feb 02 02:30:00 CST 2020&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-6-JsonAlias"><a href="#3-6-JsonAlias" class="headerlink" title="3.6 @JsonAlias"></a>3.6 @JsonAlias</h3><blockquote>
<p>@JsonAliasåœ¨ååºåˆ—åŒ–æœŸé—´ä¸ºå±æ€§å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤‡ç”¨åç§°ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­çœ‹çœ‹è¿™ä¸ªæ³¨è§£æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliasBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonAlias</span>(&#123; <span class="string">"fName"</span>, <span class="string">"f_name"</span> &#125;)</span><br><span class="line">    <span class="keyword">private</span> String firstName;   </span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªPOJOï¼Œæˆ‘ä»¬æƒ³å°†JSONä¸­çš„fNameã€f_nameæˆ–firstNameå±æ€§çš„å€¼ååºåˆ—åŒ–åˆ°POJOçš„firstNameå˜é‡ä¸­ã€‚<br>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingUsingJsonAlias_thenCorrect</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json = <span class="string">"&#123;\"fName\": \"John\", \"lastName\": \"Green\"&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        AliasBean aliasBean = <span class="keyword">new</span> ObjectMapper().readerFor(AliasBean.class).readValue(json);</span><br><span class="line"></span><br><span class="line">        System.out.println(aliasBean);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// AliasBean&#123;firstName='John', lastName='Green'&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-Jacksonå±æ€§åŒ…å«æ³¨è§£"><a href="#4-Jacksonå±æ€§åŒ…å«æ³¨è§£" class="headerlink" title="4 Jacksonå±æ€§åŒ…å«æ³¨è§£"></a>4 Jacksonå±æ€§åŒ…å«æ³¨è§£</h2><h3 id="4-1-JsonIgnoreProperties"><a href="#4-1-JsonIgnoreProperties" class="headerlink" title="4.1 @JsonIgnoreProperties"></a>4.1 @JsonIgnoreProperties</h3><blockquote>
<p>@JsonIgnorePropertiesæ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºæ ‡è®°Jacksonå°†å¿½ç•¥çš„ä¸€ä¸ªå±æ€§æˆ–ä¸€ç³»åˆ—å±æ€§ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå¿½ç•¥åºåˆ—åŒ–ä¸­çš„å±æ€§IDï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIgnoreProperties</span>(&#123; <span class="string">"id"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithIgnore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-2-JsonIgnore"><a href="#4-2-JsonIgnore" class="headerlink" title="4.2 @JsonIgnore"></a>4.2 @JsonIgnore</h3><blockquote>
<p>@JsonIgnoreæ‰¹æ³¨ç”¨äºåœ¨å­—æ®µçº§åˆ«æ ‡è®°è¦å¿½ç•¥çš„å±æ€§ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithIgnore</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="4-3-JsonIgnoreType"><a href="#4-3-JsonIgnoreType" class="headerlink" title="4.3 @JsonIgnoreType"></a>4.3 @JsonIgnoreType</h3><blockquote>
<p>@JsonIgnoreTypeå°†å¸¦æ³¨è§£ç±»çš„æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºå¿½ç•¥ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonIgnoreType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String firstName;</span><br><span class="line">        <span class="keyword">public</span> String lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="4-4-JsonInclude"><a href="#4-4-JsonInclude" class="headerlink" title="4.4 @JsonInclude"></a>4.4 @JsonInclude</h3><blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonIncludeæ’é™¤å…·æœ‰<code>empty/null/default values</code>çš„å±æ€§ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»åºåˆ—åŒ–ä¸­æ’é™¤ç©ºå€¼ï¼š</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="4-5-JsonAutoDetect"><a href="#4-5-JsonAutoDetect" class="headerlink" title="4.5 @JsonAutoDetect"></a>4.5 @JsonAutoDetect</h3><blockquote>
<p>@JsonAutoDetectå¯ä»¥è¦†ç›–é»˜è®¤è¯­ä¹‰ï¼Œå³å“ªäº›å±æ€§å¯è§ï¼Œå“ªäº›å±æ€§ä¸å¯è§ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯¥æ³¨è§£å¦‚ä½•å¸®åŠ©æˆ‘ä»¬è®©ç§æœ‰å±æ€§å¯åºåˆ—åŒ–ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonAutoDetect</span>(fieldVisibility = JsonAutoDetect.Visibility.ANY)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PrivateBean</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PrivateBean</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> id, <span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonAutoDetect_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">        PrivateBean bean = <span class="keyword">new</span> PrivateBean(<span class="number">1</span>, <span class="string">"My bean"</span>);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writeValueAsString(bean);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"id":1,"name":"My bean"&#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è¿™æ ·ï¼Œç§æœ‰å±æ€§æ²¡æœ‰getæ–¹æ³•ä¹Ÿå¯ä»¥è¢«åºåˆ—åŒ–äº†ã€‚</p>
</blockquote>
<h2 id="5-Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨è§£"><a href="#5-Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨è§£" class="headerlink" title="5 Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨è§£"></a>5 Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨è§£</h2><blockquote>
<p>æ¥ä¸‹æ¥â€“è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Jacksonçš„å¤šæ€ç±»å‹å¤„ç†æ³¨é‡Šï¼š</p>
<ul>
<li>@JsonTypeInfo - æŒ‡ç¤ºè¦åœ¨åºåˆ—åŒ–ä¸­åŒ…å«å“ªäº›ç±»å‹ä¿¡æ¯çš„è¯¦ç»†ä¿¡æ¯</li>
<li>@JsonSubTypes - æŒ‡ç¤ºå¸¦æ³¨è§£ç±»å‹çš„å­ç±»å‹</li>
<li>@JsonTypeName - å®šä¹‰ç”¨äºæ³¨è§£ç±»çš„é€»è¾‘ç±»å‹åç§°</li>
</ul>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¤æ‚çš„ç¤ºä¾‹ï¼Œä½¿ç”¨<code>@JsonTypeInf</code>oï¼Œ<code>@ JsonSubTypes</code>å’Œ<code>@JsonTypeName</code>ä¸‰ä¸ªæ³¨è§£åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ä½“<code>Zoo</code>ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zoo</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zoo</span><span class="params">(<span class="keyword">final</span> Animal animal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.animal = animal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***********************ä»¥ä¸‹æ˜¯ä¸‰ä¸ªé™æ€å†…éƒ¨ç±»*********************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> barkVolume;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> likesCream;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> lives;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šæˆ‘ä»¬ä»€ä¹ˆæ³¨è§£éƒ½æ²¡æœ‰åŠ ï¼Œçœ‹åºåˆ—åŒ–åæ˜¯ä»€ä¹ˆç»“æœ<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingPolymorphic_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        Zoo.Dog dog = <span class="keyword">new</span> Zoo.Dog(<span class="string">"lacy"</span>);</span><br><span class="line">        Zoo zoo = <span class="keyword">new</span> Zoo(dog);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writeValueAsString(zoo);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"animal":&#123;"name":"lacy","barkVolume":0.0&#125;&#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è¿™æ ·åºåˆ—åŒ–åï¼Œæˆ‘ä»¬åªçŸ¥é“æ˜¯ä¸€ä¸ªåŠ¨ç‰©ï¼Œå´ä¸çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆåŠ¨ç‰©ï¼Œä¸‹é¢æˆ‘ä»¬å°±åˆ©ç”¨ä»¥ä¸Šä¸‰ä¸ªæ³¨è§£è¿›è¡Œä¿®é¥°ä¸‹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonTypeInfo</span>(</span><br><span class="line">        use = JsonTypeInfo.Id.NAME,</span><br><span class="line">        include = JsonTypeInfo.As.PROPERTY,</span><br><span class="line">        property = <span class="string">"type"</span>)</span><br><span class="line"><span class="meta">@JsonSubTypes</span>(&#123;</span><br><span class="line">        <span class="meta">@JsonSubTypes</span>.Type(value = Dog.class, name = <span class="string">"dog"</span>),</span><br><span class="line">        <span class="meta">@JsonSubTypes</span>.Type(value = Cat.class, name = <span class="string">"cat"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonTypeName</span>(<span class="string">"dog"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> barkVolume;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonTypeName</span>(<span class="string">"cat"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> likesCream;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> lives;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬åœ¨<code>Animal</code>ç±»ä¸ŠåŠ ä¸Šä»¥ä¸Šæ³¨è§£ï¼Œå†çœ‹ä¸€ä¸‹åºåˆ—åŒ–åçš„ç»“æœ<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"animal"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"dog"</span>,<span class="attr">"name"</span>:<span class="string">"lacy"</span>,<span class="attr">"barkVolume"</span>:<span class="number">0.0</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>æˆ‘ä»¬å‘ç°ä¸ºæˆ‘ä»¬å¤šåŠ äº†ä¸€ä¸ª<code>type</code>å±æ€§ã€‚</p>
<blockquote>
<p>ä¸‹é¢è¯•ä¸€ä¸‹ååºåˆ—åŒ–</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingPolymorphic_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json = <span class="string">"&#123;\"animal\":&#123;\"name\":\"lacy\",\"type\":\"cat\"&#125;&#125;"</span>;</span><br><span class="line">        <span class="comment">// &#123;"animal":&#123;"name":"lacy","type":"cat","likesCream":false,"lives":2&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">        Zoo zoo = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .readerFor(Zoo.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">"lacy"</span>, zoo.animal.name);</span><br><span class="line">        assertEquals(Zoo.Cat.class, zoo.animal.getClass());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¯ä»¥æ­£å¸¸æ‰§è¡Œé€šè¿‡ã€‚</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœå°† <code>String json = &quot;{\&quot;animal\&quot;:{\&quot;name\&quot;:\&quot;lacy\&quot;,\&quot;type\&quot;:\&quot;cat\&quot;}}&quot;;</code>æ”¹ä¸º<code>String json = &quot;{\&quot;animal\&quot;:{\&quot;name\&quot;:\&quot;lacy\&quot;,\&quot;type\&quot;:\&quot;dog\&quot;}}&quot;;</code>å°±ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<h2 id="6-Jacksonå…¶ä»–æ³¨è§£"><a href="#6-Jacksonå…¶ä»–æ³¨è§£" class="headerlink" title="6 Jacksonå…¶ä»–æ³¨è§£"></a>6 Jacksonå…¶ä»–æ³¨è§£</h2><h3 id="6-1-JsonProperty"><a href="#6-1-JsonProperty" class="headerlink" title="6.1 @JsonProperty"></a>6.1 @JsonProperty</h3><blockquote>
<p>æˆ‘ä»¬å¯ä»¥æ·»åŠ @JsonPropertyæ³¨è§£åœ¨JSONä¸­æŒ‡ç¤ºå±æ€§åç§°ã€‚å¯ä»¥çœ‹åšæ˜¯@JsonGetterå’Œ@JsonSetterçš„ç»„åˆç‰ˆ</p>
</blockquote>
<p>åœ¨å¤„ç†éæ ‡å‡†çš„getterå’Œsetteræ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonPropertyæ¥åºåˆ—åŒ–/ååºåˆ—åŒ–å±æ€§åï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="6-2-JsonFormat"><a href="#6-2-JsonFormat" class="headerlink" title="6.2 @JsonFormat"></a>6.2 @JsonFormat</h3><blockquote>
<p>@JsonFormatæ³¨è§£æŒ‡å®š<strong>åºåˆ—åŒ–</strong>æ—¶é—´ç±»å‹çš„æ ¼å¼ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventWithFormat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonFormat</span>(</span><br><span class="line">      shape = JsonFormat.Shape.STRING,</span><br><span class="line">      pattern = <span class="string">"dd-MM-yyyy hh:mm:ss"</span>)</span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>ç»æµ‹è¯•ï¼Œ<code>@JsonFormat</code>å¯¹java8æ–°å¢çš„æ—¶é—´ç±»å‹LocalDateTimeç­‰ï¼Œä¸é€‚ç”¨ã€‚</p>
<h3 id="6-3-JsonUnwrapped"><a href="#6-3-JsonUnwrapped" class="headerlink" title="6.3 @JsonUnwrapped"></a>6.3 @JsonUnwrapped</h3><blockquote>
<p>@JsonUnwrappedå®šä¹‰åœ¨<strong>åºåˆ—åŒ–</strong>/<strong>ååºåˆ—åŒ–</strong>æ—¶åº”è¯¥è§£åŒ…/å±•å¹³çš„å€¼ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnwrappedUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnwrappedUser</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnwrappedUser</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> id, <span class="keyword">final</span> Name name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String firstName;</span><br><span class="line">        <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Name</span><span class="params">(<span class="keyword">final</span> String firstName, <span class="keyword">final</span> String lastName)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">            <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>åºåˆ—åŒ–æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonUnwrapped_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        UnwrappedUser.Name name = <span class="keyword">new</span> UnwrappedUser.Name(<span class="string">"John"</span>, <span class="string">"Doe"</span>);</span><br><span class="line">        UnwrappedUser user = <span class="keyword">new</span> UnwrappedUser(<span class="number">1</span>, name);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(user);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"id":1,"firstName":"John","lastName":"Doe"&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>ååºåˆ—åŒ–æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenDeserializingUsingJsonUnwrapped_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        String json = <span class="string">"&#123;\"id\":1,\"firstName\":\"John\",\"lastName\":\"Doe\"&#125;"</span>;</span><br><span class="line">        String json1 = <span class="string">"&#123;\"id\":1,\"name\":&#123;\"firstName\":\"John\",\"lastName\":\"Doe\"&#125;&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        UnwrappedUser bean = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .readerFor(UnwrappedUser.class)</span><br><span class="line">                .readValue(json1);</span><br><span class="line">        assertEquals(<span class="string">"John"</span>,bean.name.firstName);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ç»æµ‹è¯•ï¼Œjson1å½¢å¼çš„ååºåˆ—åŒ–åï¼Œnameå±æ€§æ˜¯æ²¡æœ‰å€¼çš„ï¼Œæ‰€ä»¥ä½¿ç”¨@JsonUnwrappedæ³¨è§£åï¼Œååºåˆ—åŒ–æ—¶éœ€è¦æ³¨æ„</span></span><br></pre></td></tr></table></figure></p>
<h3 id="6-4-JsonView"><a href="#6-4-JsonView" class="headerlink" title="6.4 @JsonView"></a>6.4 @JsonView</h3><blockquote>
<p>@JsonViewè¡¨ç¤ºåŒ…å«ç”¨äº<strong>åºåˆ—åŒ–</strong>/<strong>ååºåˆ—åŒ–</strong>çš„å±æ€§çš„è§†å›¾ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡@JsonViewçš„æ–¹å¼æŒ‡å®šéœ€è¦åºåˆ—åŒ–é‚£äº›å±æ€§ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªè§†å›¾ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Views</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Public</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Internal</span> <span class="keyword">extends</span> <span class="title">Public</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonView</span>(Views.Public.class)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonView</span>(Views.Public.class)</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonView</span>(Views.Internal.class)</span><br><span class="line">    <span class="keyword">public</span> String ownerName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonView_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item(<span class="number">2</span>, <span class="string">"book"</span>, <span class="string">"John"</span>);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writerWithView(Views.Public.class)</span><br><span class="line">                .writeValueAsString(item);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        String result2 = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writerWithView(Views.Internal.class)</span><br><span class="line">                .writeValueAsString(item);</span><br><span class="line">        System.out.println(result2);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;"id":2,"itemName":"book"&#125;</span></span><br><span class="line"><span class="comment">&#123;"id":2,"itemName":"book","ownerName":"John"&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<h3 id="6-5-JsonManagedReference-JsonBackReference"><a href="#6-5-JsonManagedReference-JsonBackReference" class="headerlink" title="6.5 @JsonManagedReference, @JsonBackReference"></a>6.5 @JsonManagedReference, @JsonBackReference</h3><blockquote>
<p>@JsonManagedReferenceå’Œ@JsonBackReferenceå¯ä»¥è§£å†³åµŒå¥—å…³ç³»å’Œå¾ªç¯é—®é¢˜</p>
</blockquote>
<p>é¦–å…ˆå…ˆçœ‹è¿™ä¹ˆä¸¤ä¸ªç±»<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line">    <span class="keyword">public</span> UserWithRef owner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; userItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸¤ä¸ªç±»ä¸­çš„å±æ€§éƒ½æœ‰å„è‡ªçš„å±æ€§ã€‚å‡è®¾æˆ‘ä»¬ä¸åšçº¦æŸï¼Œçœ‹çœ‹åºåˆ—åŒ–ä¼šæœ‰ä»€ä¹ˆç»“æœ<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJacksonReferenceAnnotation_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        UserWithRef user = <span class="keyword">new</span> UserWithRef(<span class="number">1</span>, <span class="string">"John"</span>);</span><br><span class="line">        ItemWithRef item = <span class="keyword">new</span> ItemWithRef(<span class="number">2</span>, <span class="string">"book"</span>, user);</span><br><span class="line">        user.addItem(item);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ­¤æ—¶ä¼šæŠ¥é”™ä¼šæŠ¥ä¸€ä¸ªå¾ˆé•¿å¾ˆé•¿çš„é”™è¯¯ã€‚è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¸ºä¸¤ä¸ªç±»åŠ ä¸Šä¸Šé¢ä¸¤ä¸ªæ³¨è§£å†è¯•ä¸€æ¬¡ï¼Œçœ‹çœ‹ä¼šæ€ä¹ˆæ ·<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonManagedReference</span></span><br><span class="line">    <span class="keyword">public</span> UserWithRef owner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonBackReference</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; userItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ¬¡å°±å¯ä»¥æ­£å¸¸åºåˆ—åŒ–äº†<code>{&quot;id&quot;:2,&quot;itemName&quot;:&quot;book&quot;,&quot;owner&quot;:{&quot;id&quot;:1,&quot;name&quot;:&quot;John&quot;}}</code></p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>ç›´æ¥åºåˆ—åŒ–é‚£ä¸ªå¯¹è±¡çš„å±æ€§ä¸Šæ ‡æ³¨<code>@JsonManagedReference</code></p>
</blockquote>
<h3 id="6-6-JsonIdentityInfo"><a href="#6-6-JsonIdentityInfo" class="headerlink" title="6.6 @JsonIdentityInfo"></a>6.6 @JsonIdentityInfo</h3><blockquote>
<p>@JsonIdentityInfoè¡¨æ˜åœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶åº”è¯¥ä½¿ç”¨å¯¹è±¡æ ‡è¯†â€”â€”ä¾‹å¦‚ï¼Œå¤„ç†æ— é™é€’å½’ç±»å‹çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>çœ‹ä¸‹é¢ç±»ä¼¼6.5çš„ä¾‹å­<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIdentityInfo</span>(</span><br><span class="line">  generator = ObjectIdGenerators.PropertyGenerator.class,</span><br><span class="line">  property = <span class="string">"id"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line">    <span class="keyword">public</span> UserWithIdentity owner;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@JsonIdentityInfo</span>(</span><br><span class="line">  generator = ObjectIdGenerators.PropertyGenerator.class,</span><br><span class="line">  property = <span class="string">"id"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithIdentity&gt; userItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonIdentityInfo_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        UserWithIdentity user = <span class="keyword">new</span> UserWithIdentity(<span class="number">1</span>, <span class="string">"John"</span>);</span><br><span class="line">        ItemWithIdentity item = <span class="keyword">new</span> ItemWithIdentity(<span class="number">2</span>, <span class="string">"book"</span>, user);</span><br><span class="line">        user.addItem(item);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"id":2,"itemName":"book","owner":&#123;"id":1,"name":"John","userItems":[2]&#125;&#125;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    "id": 2,</span></span><br><span class="line"><span class="comment">    "itemName": "book",</span></span><br><span class="line"><span class="comment">    "owner": &#123;</span></span><br><span class="line"><span class="comment">        "id": 1,</span></span><br><span class="line"><span class="comment">        "name": "John",</span></span><br><span class="line"><span class="comment">        "userItems": [</span></span><br><span class="line"><span class="comment">            2</span></span><br><span class="line"><span class="comment">        ]</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„ç»“æœå’Œ6.5ä¸­çš„ä¸ä¸€æ ·å“¦</p>
<ul>
<li>6.5ä¸­<code>owner</code>å±æ€§ä¸­å°‘äº†<code>userItems</code>å±æ€§</li>
<li>è¿™é‡Œ<code>owner</code>å±æ€§ä¸­çš„<code>userItems</code>ä¸­ä½¿ç”¨idæ¥æ ‡è¯†ã€‚</li>
</ul>
</blockquote>
<h3 id="6-7-JsonFilter"><a href="#6-7-JsonFilter" class="headerlink" title="6.7 @JsonFilter"></a>6.7 @JsonFilter</h3><blockquote>
<p>@JsonFilteræ³¨è§£æŒ‡å®šåœ¨åºåˆ—åŒ–æœŸé—´ä½¿ç”¨çš„è¿‡æ»¤å™¨ã€‚</p>
</blockquote>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonFilter</span>(<span class="string">"myFilter"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åºåˆ—åŒ–æ—¶ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonFilter_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        BeanWithFilter bean = <span class="keyword">new</span> BeanWithFilter(<span class="number">1</span>, <span class="string">"My bean"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªåä¸º`myFilter`çš„è¿‡æ»¤å™¨ï¼Œä½œç”¨æ˜¯ï¼šé™¤äº†`name`å±æ€§ï¼Œå…¶ä»–çš„éƒ½æ’é™¤åœ¨å¤–</span></span><br><span class="line">        FilterProvider filters</span><br><span class="line">                = <span class="keyword">new</span> SimpleFilterProvider().addFilter(</span><br><span class="line">                <span class="string">"myFilter"</span>,</span><br><span class="line">                SimpleBeanPropertyFilter.filterOutAllExcept(<span class="string">"name"</span>));</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writer(filters)</span><br><span class="line">                .writeValueAsString(bean);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#123;"name":"My bean"&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="7-è‡ªå®šä¹‰Jacksonæ³¨è§£"><a href="#7-è‡ªå®šä¹‰Jacksonæ³¨è§£" class="headerlink" title="7 è‡ªå®šä¹‰Jacksonæ³¨è§£"></a>7 è‡ªå®šä¹‰Jacksonæ³¨è§£</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰Jacksonæ³¨è§£ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨@JacksonAnnotationsInsideæ³¨è§£ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(Include.NON_NULL)</span><br><span class="line"><span class="meta">@JsonPropertyOrder</span>(&#123; <span class="string">"name"</span>, <span class="string">"id"</span>, <span class="string">"dateCreated"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CustomAnnotation &#123;&#125;</span><br><span class="line"><span class="comment">// è¯´æ˜¯è‡ªå®šä¹‰ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨JacksonåŸæœ‰çš„æ³¨è§£ï¼Œå°†å…¶è¿›è¡Œç»„åˆï¼Œè¿™ä¸ªæ³¨è§£çš„ä½œç”¨ï¼šå¿½ç•¥ç©ºå€¼å±æ€§ï¼Œå¹¶æŒ‰ç…§"name", "id", "dateCreated"æ’åºã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CustomAnnotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCustomAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> Date dateCreated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingCustomAnnotation_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    BeanWithCustomAnnotation bean </span><br><span class="line">      = <span class="keyword">new</span> BeanWithCustomAnnotation(<span class="number">1</span>, <span class="string">"My bean"</span>, <span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">    String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    "name":"My bean",</span></span><br><span class="line"><span class="comment">    "id":1</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="8-Jackson-MixIn-æ³¨è§£"><a href="#8-Jackson-MixIn-æ³¨è§£" class="headerlink" title="8 Jackson MixIn æ³¨è§£"></a>8 Jackson MixIn æ³¨è§£</h2><p>çœ‹ä¸‹é¢çš„ä¾‹å­<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line">    <span class="keyword">public</span> User owner;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixInForIgnoreType</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>åºåˆ—åŒ–æ—¶ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingMixInAnnotation_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User(<span class="number">2</span>,<span class="string">"John"</span>);</span><br><span class="line"></span><br><span class="line">        Item2 item = <span class="keyword">new</span> Item2(<span class="number">1</span>, <span class="string">"book"</span>, u);</span><br><span class="line"></span><br><span class="line">        String result = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.addMixIn(User.class, MyMixInForIgnoreType.class); <span class="comment">// å°†Useråˆ—ä¸ºå¿½ç•¥çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line">        String result2 = mapper.writeValueAsString(item);</span><br><span class="line">        System.out.println(result2);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;"id":1,"itemName":"book","owner":&#123;"id":2,"name":"John"&#125;&#125;</span></span><br><span class="line"><span class="comment">&#123;"id":1,"itemName":"book"&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="9-ç¦ç”¨Jacksonæ³¨è§£"><a href="#9-ç¦ç”¨Jacksonæ³¨è§£" class="headerlink" title="9. ç¦ç”¨Jacksonæ³¨è§£"></a>9. ç¦ç”¨Jacksonæ³¨è§£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    mapper.disable(MapperFeature.USE_ANNOTATIONS);</span><br><span class="line"><span class="comment">// è¿™æ ·å°±ç¦ç”¨äº†æ³¨è§£</span></span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸ªä¾‹å­<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonInclude</span>(Include.NON_NULL)</span><br><span class="line"><span class="meta">@JsonPropertyOrder</span>(&#123; <span class="string">"name"</span>, <span class="string">"id"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyBean bean = <span class="keyword">new</span> MyBean(<span class="number">1</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä¸ç¦ç”¨æ³¨è§£åºåˆ—åŒ–ä¸ºï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¦ç”¨æ³¨è§£åçš„ç»“æœä¸ºï¼š<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">"name"</span>:<span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Jackson</category>
      </categories>
      <tags>
        <tag>Jackson</tag>
      </tags>
  </entry>
  <entry>
    <title>JT809åè®®äº¤é€š809åè®®ç®€å•å®ç°(Javaç‰ˆ)</title>
    <url>/tool/JT809%E5%8D%8F%E8%AE%AE%E4%BA%A4%E9%80%9A809%E5%8D%8F%E8%AE%AE%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0-Java%E7%89%88.html</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æœ€è¿‘å…¬å¸æœ‰ä¸ªé¡¹ç›®éœ€è¦æ¥æ”¶å…¬äº¤å…¬å¸çš„å®æ—¶æ¨é€çš„å…¬äº¤è½¦ä½ç½®æ•°æ®ã€‚äºæ˜¯å°±ç”¨Nettyç®€å•å®ç°äº†JT809åè®®çš„éƒ¨åˆ†åŠŸèƒ½ã€‚</p>
<ul>
<li><h5 id="æœåŠ¡ç«¯-ä¸Šçº§å¹³å°-ä¸»é“¾è·¯"><a href="#æœåŠ¡ç«¯-ä¸Šçº§å¹³å°-ä¸»é“¾è·¯" class="headerlink" title="æœåŠ¡ç«¯(ä¸Šçº§å¹³å°)ä¸»é“¾è·¯"></a>æœåŠ¡ç«¯(ä¸Šçº§å¹³å°)ä¸»é“¾è·¯</h5></li>
<li><h5 id="ä¸»é“¾è·¯ç™»å½•è¯·æ±‚æŠ¥æ–‡è§£æ"><a href="#ä¸»é“¾è·¯ç™»å½•è¯·æ±‚æŠ¥æ–‡è§£æ" class="headerlink" title="ä¸»é“¾è·¯ç™»å½•è¯·æ±‚æŠ¥æ–‡è§£æ"></a>ä¸»é“¾è·¯ç™»å½•è¯·æ±‚æŠ¥æ–‡è§£æ</h5></li>
<li><h5 id="ä¸»é“¾è·¯ç™»å½•åº”ç­”æ¶ˆæ¯"><a href="#ä¸»é“¾è·¯ç™»å½•åº”ç­”æ¶ˆæ¯" class="headerlink" title="ä¸»é“¾è·¯ç™»å½•åº”ç­”æ¶ˆæ¯"></a>ä¸»é“¾è·¯ç™»å½•åº”ç­”æ¶ˆæ¯</h5></li>
<li><h5 id="è½¦è¾†å®æ—¶è½¦è¾†å®šä½ä¿¡æ¯æ¶ˆæ¯æŠ¥æ–‡è§£æ"><a href="#è½¦è¾†å®æ—¶è½¦è¾†å®šä½ä¿¡æ¯æ¶ˆæ¯æŠ¥æ–‡è§£æ" class="headerlink" title="è½¦è¾†å®æ—¶è½¦è¾†å®šä½ä¿¡æ¯æ¶ˆæ¯æŠ¥æ–‡è§£æ"></a>è½¦è¾†å®æ—¶è½¦è¾†å®šä½ä¿¡æ¯æ¶ˆæ¯æŠ¥æ–‡è§£æ</h5></li>
</ul>
<h2 id="ä¸»è¦ä»£ç å’Œä½¿ç”¨"><a href="#ä¸»è¦ä»£ç å’Œä½¿ç”¨" class="headerlink" title="ä¸»è¦ä»£ç å’Œä½¿ç”¨"></a>ä¸»è¦ä»£ç å’Œä½¿ç”¨</h2><ul>
<li>é¡¹ç›®ç»“æ„</li>
</ul>
<p><img src="http://qiniu.mrain22.cn/201911101443_397.png" alt=""></p>
<h3 id="è§£ç é€‚é…å™¨"><a href="#è§£ç é€‚é…å™¨" class="headerlink" title="è§£ç é€‚é…å™¨"></a>è§£ç é€‚é…å™¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xiuminglee.jt809.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.common.util.CommonUtils;</span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.common.util.CrcUtil;</span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.common.util.PacketDecoderUtils;</span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.packet.JT809BasePacket;</span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.protocol.decoder.DecoderFactory;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.ByteToMessageDecoder;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> cn.xiuminglee.jt809.common.util.CommonUtils.PACKET_CACHE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: è§£ç é€‚é…å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JT809DecoderAdapter</span> <span class="keyword">extends</span> <span class="title">ByteToMessageDecoder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(JT809DecoderAdapter.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰å¯è¯»çš„å­—èŠ‚</span></span><br><span class="line">        <span class="keyword">if</span> (in.readableBytes() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1ã€è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = PacketDecoderUtils.decoderEscape(in);</span><br><span class="line">        <span class="comment">// 2ã€æ ¡éªŒcrc</span></span><br><span class="line">        <span class="keyword">if</span> (!CrcUtil.checkCRC(bytes))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3ã€åˆ¤æ–­æ˜¯é‚£ç§ç±»å‹çš„æ•°æ®ï¼Œäº¤ç»™å…·ä½“çš„è§£ç å™¨ç±»å®Œæˆã€‚</span></span><br><span class="line">        ByteBuf byteBuf = CommonUtils.getByteBuf(bytes);</span><br><span class="line">        byteBuf.skipBytes(<span class="number">9</span>);</span><br><span class="line">        <span class="comment">// è·å–ä¸šåŠ¡æ ‡å¿—</span></span><br><span class="line">        <span class="keyword">short</span> msgId = byteBuf.readShort();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// äº¤ç»™å…·ä½“çš„è§£ç å™¨</span></span><br><span class="line">        JT809BasePacket packet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            packet = DecoderFactory.getDecoder(msgId).decoder(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NullPointerException) &#123;</span><br><span class="line">                <span class="comment">// log.info("æ²¡æœ‰å¯ç”¨çš„è§£æå™¨ï¼Œå¿½ç•¥è¿™æ¡ä¿¡æ¯ï¼æ­¤ä¿¡æ¯ä¸åœ¨ä¸šåŠ¡èŒƒå›´å†…ã€‚");</span></span><br><span class="line">                <span class="comment">// æ²¡æœ‰å¯ç”¨çš„è§£æå™¨ï¼Œå¿½ç•¥è¿™æ¡ä¿¡æ¯ï¼æ­¤ä¿¡æ¯ä¸åœ¨ä¸šåŠ¡èŒƒå›´å†…ã€‚</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.error(<span class="string">"æŠ¥æ–‡è§£æå‡ºé”™ï¼é”™è¯¯ä¿¡æ¯ï¼š&#123;&#125;ï¼›æŠ¥æ–‡ä¿¡æ¯ï¼š&#123;&#125;ï¼›"</span>,e.getMessage(),PACKET_CACHE.get(Thread.currentThread().getName()));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        out.add(packet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªè§£ç é€‚é…å™¨ä¼šæ ¹æ®æŠ¥æ–‡çš„ä¸šåŠ¡æ ‡å¿—ä»<code>DecoderFactory</code>è·å–å…·ä½“çš„è§£ç å™¨å»è§£ææŠ¥æ–‡ã€‚</p>
<p>æ‰€ä»¥å¦‚æœéœ€è¦æ‰©å±•ï¼Œåªéœ€è¦ç¼–å†™ç›¸å…³ä¸šåŠ¡çš„è§£ç å™¨å¹¶æ·»åŠ åˆ°<code>DecoderFactory</code>å³å¯ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xiuminglee.jt809.protocol.decoder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.xiuminglee.jt809.common.Const;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: è§£ç å·¥å‚ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoderFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Short,Decoder&gt; DECODER_FACTORY = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        DECODER_FACTORY.put(Const.BusinessDataType.UP_CONNECT_REQ,<span class="keyword">new</span> LoginDecoder());</span><br><span class="line">        DECODER_FACTORY.put(Const.BusinessDataType.UP_LINKTEST_REQ,<span class="keyword">new</span> HeartbeatDecoder());</span><br><span class="line">        DECODER_FACTORY.put(Const.BusinessDataType.UP_EXG_MSG,<span class="keyword">new</span> JT809Packet0x1202Decoder());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> businessDataType ä¸šåŠ¡æ•°æ®ç±»å‹æ ‡å¿—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å…·ä½“çš„è§£ç å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Decoder <span class="title">getDecoder</span><span class="params">(<span class="keyword">short</span> businessDataType)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DECODER_FACTORY.get(businessDataType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GitHubåœ°å€"><a href="#GitHubåœ°å€" class="headerlink" title="GitHubåœ°å€"></a><a href="https://github.com/XiumingLee/MingRepository/tree/master/JT809-Server" target="_blank" rel="noopener">GitHubåœ°å€</a></h2>]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€é”®å°†å›¾ç‰‡ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘å¹¶å°†å›¾ç‰‡é“¾æ¥æ·»åŠ åˆ°ç”µè„‘ç²˜è´´æ¿</title>
    <url>/tool/%E4%B8%80%E9%94%AE%E5%B0%86%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91%E5%B9%B6%E5%B0%86%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%94%B5%E8%84%91%E7%B2%98%E8%B4%B4%E6%9D%BF.html</url>
    <content><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ç”±äºæœ¬äººå¹³æ—¶è®°ç¬”è®°å†™åšå®¢æ—¶éœ€è¦å°†ä¸€äº›ä¾‹å›¾ä¹‹ç±»çš„ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘å›¾åºŠï¼Œä¹‹å‰åœ¨Windowså¹³å°ä½¿ç”¨å¾ˆè¿˜ç”¨çš„å·¥å…·å¯ä»¥ä¸€é”®ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ï¼Œæœ€è¿‘å°†å·¥ä½œç¯å¢ƒè¿ç§»åˆ°Macç¯å¢ƒäº†ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹ä¾¿çš„å·¥å…·ï¼Œäºæ˜¯å°±å¥½äº†ä¸€ç‚¹æ—¶é—´è‡ªå·±å†™äº†ä¸€ä¸ªã€‚å…ˆçœ‹æ•ˆæœå›¾å§ã€‚</p>
<p><img src="http://qiniu.mrain22.cn/1573359587234.gif" alt=""></p>
<p>GIfå›¾æœ‰ç‚¹å¿«ã€‚å¤§ä½“è¯´ä¸€ä¸‹ï¼š</p>
<ul>
<li>æˆªå›¾åæ‰“å¼€<code>qiniu-tools</code>ç•Œé¢æŒ‰<code>Shift</code> + <code>Ctrl</code> + <code>V</code>å³å¯å°†å›¾ç‰‡ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘å›¾åºŠã€‚</li>
<li>ä¹Ÿå¯ä»¥å¤åˆ¶ç½‘é¡µä¸­çš„å›¾ç‰‡ä¸Šä¼ ã€‚</li>
<li>å½“ç„¶æœ¬åœ°å›¾ç‰‡ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</li>
<li>å½“ä½ è§‰å¾—åˆšåˆšä¸Šä¼ çš„å›¾ç‰‡ä¸åˆé€‚æ—¶ï¼Œå¯ä»¥ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼Œåˆ é™¤åˆšåˆšä¸Šä¼ çš„å›¾ç‰‡ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h3><p>å¦‚æœä½ æ˜¯ä¸€åç¨‹åºçŒ¿ï¼Œæ¨èåœ¨å®‰è£…äº†javaç¯å¢ƒä¸‹ç›´æ¥è¿è¡ŒjaråŒ…ï¼Œå°†<code>conf.properties</code>é…ç½®æ–‡ä»¶æ”¾åœ¨ä¸jaråŒçº§ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## conf.properties  é…ç½®è‡ªå·±çš„ä¸ƒç‰›äº‘ä¿¡æ¯ã€‚</span><br><span class="line">access-key=****</span><br><span class="line">secret-key=****</span><br><span class="line"># ä¸ƒç‰›é…ç½®çš„åŸŸååœ°å€</span><br><span class="line">qiniu-path=***</span><br><span class="line"># ä¸Šä¼ åˆ°é‚£ä¸ªå­˜å‚¨ç©ºé—´</span><br><span class="line">bucket-name=***</span><br></pre></td></tr></table></figure>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ol>
<li>å°†<code>qiniu-tools\app</code>ç›®å½•ä¸‹çš„<code>conf.properties</code>ä¿®æ”¹ä¸ºè‡ªå·±çš„é…ç½®ã€‚</li>
<li>è¿è¡Œ<code>qiniu-tools\</code>ç›®å½•ä¸‹çš„<code>qiniu-tools.exe</code>å³å¯ã€‚</li>
</ol>
<h3 id="MAC"><a href="#MAC" class="headerlink" title="MAC"></a>MAC</h3><ol>
<li>ä¿®æ”¹<code>qiniu-tools.app/Contents/Java</code>ä¸‹çš„<code>conf.properties</code>ä¿®æ”¹ä¸ºè‡ªå·±çš„é…ç½®ã€‚</li>
<li>è¿è¡Œ<code>qiniu-tools.app</code>å³å¯ã€‚</li>
</ol>
<h2 id="ä¸‹è½½åœ°å€"><a href="#ä¸‹è½½åœ°å€" class="headerlink" title="ä¸‹è½½åœ°å€"></a>ä¸‹è½½åœ°å€</h2><p>è¯·å‰å¾€<a href="https://github.com/XiumingLee/qiniu-tools" target="_blank" rel="noopener">GitHubåœ°å€</a>å¯»æ‰¾ä¸‹è½½åœ°å€ã€‚<a href="https://github.com/XiumingLee/qiniu-tools" target="_blank" rel="noopener">https://github.com/XiumingLee/qiniu-tools</a></p>
<p>å–œæ¬¢çš„éº»çƒ¦ç»™ä¸ªStarï¼Œä½ çš„Starå°±æ˜¯å¯¹æˆ‘å¼€æºçš„æœ€å¤§æ”¯æŒå’ŒåŠ¨åŠ›ã€‚è°¢è°¢</p>
]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Websocketå®æ—¶ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°</title>
    <url>/Spring-Boot/Spring%20Websocket%E5%AE%9E%E6%97%B6%E7%BB%9F%E8%AE%A1%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7%E6%95%B0.html</url>
    <content><![CDATA[<h1 id="GitHubæºç åœ°å€"><a href="#GitHubæºç åœ°å€" class="headerlink" title="GitHubæºç åœ°å€"></a><a href="https://github.com/XiumingLee/MingRepository/tree/master/websocket" target="_blank" rel="noopener">GitHubæºç åœ°å€</a></h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼Œéœ€è¦å®æ—¶ç»Ÿè®¡åœ¨çº¿çš„äººæ•°ï¼Œç”±äºè¯¥é¡¹ç›®å¹¶æ²¡ç”¨åˆ°å®æ—¶é€šä¿¡ï¼Œä¹Ÿåªæœ‰è¿™é‡Œéœ€è¦å®æ—¶ç»Ÿè®¡åœ¨çº¿ï¼Œæ²¡å¿…è¦å†æ­å»ºä¸€å¥—å®æ—¶é€šä¿¡æœåŠ¡ï¼Œæ‰€ä»¥ç›´æ¥æ•´åˆçš„<code>Spring Websocket</code>ã€‚ä¸‹é¢çš„<code>demo</code>æ˜¯é¡¹ç›®ä¸­çš„ç®€åŒ–ç‰ˆï¼Œä½¿ç”¨<code>Spring Boot</code>æ­å»ºçš„ç¯å¢ƒã€‚æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201908241758_370.gif" alt=""></p>
<p>ç½‘ä¸Šå¯¹<code>Websocket</code>çš„è®²è§£æœ‰å¾ˆå¤šäº†ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°ã€‚ç®€å•ç²—æš´ï¼Œç›´æ¥å¼€å¹²ã€‚</p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="pomæ–‡ä»¶"><a href="#pomæ–‡ä»¶" class="headerlink" title="pomæ–‡ä»¶"></a>pomæ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.56<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Websocketå·¥å…·ç±»"><a href="#Websocketå·¥å…·ç±»" class="headerlink" title="Websocketå·¥å…·ç±»"></a>Websocketå·¥å…·ç±»</h3><p>å…ˆå†™ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨æ¥å¤„ç†åœ¨çº¿äººæ•°çš„ç»Ÿè®¡ä»¥åŠ<code>WebSocketSession</code>çš„ç®¡ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: ç»Ÿè®¡äººæ•°ç›¸å…³å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketCountUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åœ¨çº¿è¿æ¥æ•°ã€‚å³è¿”å›å‰å°çš„äººæ•°ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Long onlineCount = <span class="number">0L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥å­˜æ”¾æ™®é€šç”¨æˆ·IDã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;String&gt; userIdSet = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥å­˜æ”¾æ™®é€šç”¨æˆ·Sessionå’Œidã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;SessionEntity&gt; usersSessionEntitySet = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥å­˜æ”¾ç®¡ç†å‘˜Sessionå’Œidã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;SessionEntity&gt; adminSessionEntitySet = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨çº¿äººæ•°å¢åŠ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onlineCountAdd</span><span class="params">(WebSocketSession session, String userId)</span> </span>&#123;</span><br><span class="line">        userIdSet.add(userId);</span><br><span class="line">        SessionEntity sessionEntity = <span class="keyword">new</span> SessionEntity(userId, session);</span><br><span class="line">        usersSessionEntitySet.add(sessionEntity);</span><br><span class="line">        onlineCountChangeIf();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨çº¿äººæ•°å‡å°‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onlineCountReduce</span><span class="params">(WebSocketSession session)</span> </span>&#123;</span><br><span class="line">        usersSessionEntitySet.forEach(sessionEntity -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (sessionEntity.getSession().getId().equals(session.getId())) &#123;</span><br><span class="line">                usersSessionEntitySet.remove(sessionEntity);</span><br><span class="line">                userIdSet.remove(sessionEntity.getUserId());</span><br><span class="line">                onlineCountChangeIf();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * adminç”¨æˆ·å¢åŠ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adminSessionAdd</span><span class="params">(WebSocketSession session, String adminUserId)</span> </span>&#123;</span><br><span class="line">        SessionEntity sessionEntity = <span class="keyword">new</span> SessionEntity(adminUserId, session);</span><br><span class="line">        adminSessionEntitySet.add(sessionEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * adminç”¨æˆ·å‡å°‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adminSessionReduce</span><span class="params">(WebSocketSession session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"adminç”¨æˆ·å‡å°‘"</span>);</span><br><span class="line">        log.info(adminSessionEntitySet.toString());</span><br><span class="line">        adminSessionEntitySet.forEach(sessionEntity -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (sessionEntity.getSession().getId().equals(session.getId())) &#123;</span><br><span class="line">                adminSessionEntitySet.remove(sessionEntity);</span><br><span class="line">                log.info(adminSessionEntitySet.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘adminæ¨é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMessageToAdmin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        adminSessionEntitySet.forEach(sessionEntity -&gt; &#123;</span><br><span class="line">            MessageEntity messageEntity = <span class="keyword">new</span> MessageEntity(<span class="string">"2"</span>, String.valueOf(getOnlineCount()));</span><br><span class="line">            String messageString = JSONObject.toJSONString(messageEntity);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sessionEntity.getSession().sendMessage(<span class="keyword">new</span> TextMessage(messageString));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                log.error(<span class="string">"å‘é€ä¿¡æ¯å¤±è´¥--&gt;&#123;&#125;"</span>, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getOnlineCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> onlineCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨çº¿äººæ•°æ˜¯å¦æ”¹å˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onlineCountChangeIf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long size = Long.valueOf(userIdSet.size());</span><br><span class="line">        <span class="keyword">if</span> (onlineCount.equals(size)) &#123;</span><br><span class="line">            <span class="comment">// åœ¨çº¿äººæ•°æ²¡æœ‰å˜</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åœ¨çº¿äººæ•°å˜äº†</span></span><br><span class="line">        onlineCount = size;</span><br><span class="line">        <span class="comment">// å‘adminå‘é€æ¶ˆæ¯</span></span><br><span class="line">        setMessageToAdmin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WebSocketHandlerç¼–å†™"><a href="#WebSocketHandlerç¼–å†™" class="headerlink" title="WebSocketHandlerç¼–å†™"></a>WebSocketHandlerç¼–å†™</h3><p><code>WebSocketHandler</code>æ˜¯æ¶ˆæ¯å’Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„å¤„ç†ç¨‹åºã€‚ä¸‹é¢ç¼–å†™äº†ä¸¤ä¸ª<code>WebSocketHandler</code>åˆ†åˆ«å¤„ç†æ™®é€šç”¨æˆ·çš„è¿æ¥å’Œç®¡ç†å‘˜çš„è¿æ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: æ™®é€šç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œè¿æ¥websocketå¤„ç†çš„Handler</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserConnectionHandler</span> <span class="keyword">implements</span> <span class="title">WebSocketHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºç«‹è¿æ¥åè§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"ç”¨æˆ·è¿æ¥æˆåŠŸ-&gt;&#123;&#125;"</span>,session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TextMessage textMessage = (TextMessage)message;</span><br><span class="line">        log.warn(<span class="string">"æ”¶åˆ°æ¶ˆæ¯-&gt;&#123;&#125;"</span>,textMessage);</span><br><span class="line">        MessageEntity messageEntity = JSONObject.parseObject(textMessage.getPayload(), MessageEntity.class);</span><br><span class="line">        WebSocketCountUtil.onlineCountAdd(session,messageEntity.getContent());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼ è¾“æ¶ˆæ¯å‡ºé”™æ—¶è§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session, Throwable exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ä¼ è¾“æ¶ˆæ¯å‡ºé”™"</span>+<span class="string">"afterConnectionClosed"</span>);</span><br><span class="line">        System.out.println(session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–­å¼€è¿æ¥åè§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"æ–­å¼€è¿æ¥-&gt;&#123;&#125;"</span>,session);</span><br><span class="line">        WebSocketCountUtil.onlineCountReduce(session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å¤„ç†åˆ†ç‰‡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsPartialMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: ç®¡ç†å‘˜è¿æ¥å¤„ç†çš„Handlerï¼Œç®¡ç†å‘˜æŸ¥çœ‹å®æ—¶ç”¨æˆ·æƒ…å†µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminConnectionHandler</span> <span class="keyword">implements</span> <span class="title">WebSocketHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"ç®¡ç†å‘˜è¿æ¥æˆåŠŸ-&gt;&#123;&#125;"</span>,session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TextMessage textMessage = (TextMessage)message;</span><br><span class="line">        log.warn(<span class="string">"æ”¶åˆ°æ¶ˆæ¯-&gt;&#123;&#125;"</span>,textMessage);</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        MessageEntity messageEntity = JSONObject.parseObject(textMessage.getPayload(), MessageEntity.class);</span><br><span class="line">        WebSocketCountUtil.adminSessionAdd(session,messageEntity.getContent());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session, Throwable exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ä¼ è¾“æ¶ˆæ¯å‡ºé”™"</span>+<span class="string">"afterConnectionClosed"</span>);</span><br><span class="line">        System.out.println(session);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"ç®¡ç†å‘˜æ–­å¼€è¿æ¥-&gt;&#123;&#125;"</span>,session);</span><br><span class="line">        WebSocketCountUtil.adminSessionReduce(session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsPartialMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WebSocketé…ç½®æ–‡ä»¶"><a href="#WebSocketé…ç½®æ–‡ä»¶" class="headerlink" title="WebSocketé…ç½®æ–‡ä»¶"></a>WebSocketé…ç½®æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>:WebSocketé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addHandler(<span class="keyword">new</span> UserConnectionHandler(),<span class="string">"/ws/userCount"</span>) <span class="comment">// æ™®é€šç”¨æˆ·websocketçš„è¿æ¥è·¯å¾„</span></span><br><span class="line">                .addInterceptors(<span class="keyword">new</span> HttpSessionHandshakeInterceptor())</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line">        registry.addHandler(<span class="keyword">new</span> AdminConnectionHandler(),<span class="string">"/ws/admin"</span>) <span class="comment">// ç®¡ç†å‘˜websocketçš„è¿æ¥è·¯å¾„</span></span><br><span class="line">                .addInterceptors(<span class="keyword">new</span> HttpSessionHandshakeInterceptor())</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»¥ä¸‹æ˜¯é…ç½®WebSocketçš„é…ç½®å±æ€§ï¼Œä¾‹å¦‚æ¶ˆæ¯ç¼“å†²åŒºå¤§å°ï¼Œç©ºé—²è¶…æ—¶ç­‰ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletServerContainerFactoryBean <span class="title">createWebSocketContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletServerContainerFactoryBean container = <span class="keyword">new</span> ServletServerContainerFactoryBean();</span><br><span class="line">        container.setMaxTextMessageBufferSize(<span class="number">8192</span>);</span><br><span class="line">        container.setMaxBinaryMessageBufferSize(<span class="number">8192</span>);</span><br><span class="line">        container.setMaxSessionIdleTimeout(<span class="number">300000L</span>);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»¥ä¸Šæ ¸å¿ƒä»£ç å·²è´´å‡ºï¼Œå®Œæ•´ä»£ç å‚è€ƒ<a href="https://github.com/XiumingLee/MingRepository/tree/master/websocket" target="_blank" rel="noopener">GitHubæºç </a>ã€‚</p>
]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»¥ä¸ƒç‰›äº‘ä¸ºä¾‹ï¼Œæ‰‹å†™ä¸€ä¸ªSpring Bootçš„Starter</title>
    <url>/Spring-Boot/%E4%BB%A5%E4%B8%83%E7%89%9B%E4%BA%91%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AASpring-Boot%E7%9A%84Starter.html</url>
    <content><![CDATA[<h1 id="GitHubæºç åœ°å€"><a href="#GitHubæºç åœ°å€" class="headerlink" title="GitHubæºç åœ°å€"></a><a href="https://github.com/XiumingLee/MingRepository" target="_blank" rel="noopener">GitHubæºç åœ°å€</a></h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æˆ‘ä»¬ä½¿ç”¨ Spring Bootï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æ²‰é†‰åœ¨å®ƒ Stater çš„æ–¹ä¾¿ä¹‹ä¸­ã€‚Starter ä¸ºæˆ‘ä»¬å¸¦æ¥äº†ä¼—å¤šçš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œæœ‰äº†è¿™äº›è‡ªåŠ¨åŒ–é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä¸è´¹å¹ç°ä¹‹åŠ›å°±èƒ½æ­å»ºä¸€ä¸ªç”Ÿäº§çº§å¼€å‘ç¯å¢ƒï¼Œå…¶å® Starter çš„æ ¸å¿ƒå°±æ˜¯æ¡ä»¶æ³¨è§£ <code>@Conditional</code> ï¼Œå½“ <code>classpath</code>ä¸‹å­˜åœ¨æŸä¸€ä¸ª<code>Class</code>æ—¶ï¼ŒæŸä¸ªé…ç½®æ‰ä¼šç”Ÿæ•ˆ,ä¸‹é¢å°±ä»¥ä¸ƒç‰›äº‘ä¸ºä¾‹ï¼Œå†™ä¸€ä¸ªç®€å•çš„<code>Spring  Boot  Starter</code>ã€‚</p>
<h2 id="é¡¹ç›®ç›®å½•ç»“æ„"><a href="#é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="é¡¹ç›®ç›®å½•ç»“æ„"></a>é¡¹ç›®ç›®å½•ç»“æ„</h2><p><img src="http://qiniu.mrain22.cn/201906021031_134.png" alt=""></p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p><strong>1ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®ï¼Œpomæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.mrain22.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä¸ƒç‰›--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.2.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2ã€ç¼–å†™ä¸€ä¸ª<code>MqiniuProperties</code>,ç”¨æ¥æ¥å— <code>application.properties</code>ä¸­æ³¨å…¥çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mrain22.qiniu;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/6/1 12:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: ä¸ƒç‰›é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"mqiniu"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqiniuProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** accessKey*/</span></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="comment">/** secretKey*/</span></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="comment">/** è¦ä¸Šä¼ çš„ç©ºé—´*/</span></span><br><span class="line">    <span class="keyword">private</span>  String bucketName;</span><br><span class="line">    <span class="comment">/** æ–‡ä»¶åœ°å€å‰ç¼€ï¼Œcdnåœ°å€*/</span></span><br><span class="line">    <span class="keyword">private</span> String filePathPrefix;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œçœç•¥äº† get/set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3ã€ç¼–å†™æ ¡éªŒç±»<code>MqiniuCondition</code>ï¼Œç”¨æ¥æ ¡éªŒç”¨æˆ·å¿…è¦çš„é…ç½®ä¿¡æ¯æ˜¯å¦å¡«å†™ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mrain22.qiniu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Condition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ConditionContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.AnnotatedTypeMetadata;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/6/1 16:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: æ ¡éªŒç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqiniuCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata annotatedTypeMetadata)</span> </span>&#123;</span><br><span class="line">        String ak = context.getEnvironment().getProperty(<span class="string">"mqiniu.access-key"</span>);</span><br><span class="line">        String sk = context.getEnvironment().getProperty(<span class="string">"mqiniu.secret-key"</span>);</span><br><span class="line">        String bucketName = context.getEnvironment().getProperty(<span class="string">"mqiniu.bucket-name"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** æ ¡éªŒç”¨æˆ·æ˜¯å¦å°†é…ç½®ä¿¡æ¯å¡«å†™å®Œæ•´*/</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(ak)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Lack of qiniuyun configuration:access-key"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isEmpty(sk)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Lack of mqiniuyun configuration:secret-key"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isEmpty(bucketName)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Lack of qiniuyun configuration:bucket-name"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4ã€ç¼–å†™ä¾›è°ƒç”¨çš„æ¥å£<code>MqiniuService</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mrain22.qiniu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/6/1 16:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: ä¸ƒç‰›ä¸Šä¼ æœåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MqiniuService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileBytes æ–‡ä»¶çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶åå¸¦åç¼€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¸Šä¼ åæ–‡ä»¶çš„urlè·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">uploadFile</span><span class="params">(<span class="keyword">byte</span>[] fileBytes, String fileName)</span> <span class="keyword">throws</span> QiniuException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key ä¸Šä¼ æ–‡ä»¶åè¿”å›çš„urlè·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">deleteByKey</span><span class="params">(String key)</span> <span class="keyword">throws</span> QiniuException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5ã€ç¼–å†™é»˜è®¤çš„å®ç°ç±»<code>MqiniuServiceImpl</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mrain22.qiniu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.BucketManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/6/1 16:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>: ä¸ƒç‰›ä¸Šä¼ åˆ é™¤å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqiniuServiceImpl</span> <span class="keyword">implements</span> <span class="title">MqiniuService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadManager uploadManager;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BucketManager bucketManager;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Auth auth;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MqiniuProperties mqiniuProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadFile</span><span class="params">(<span class="keyword">byte</span>[] fileBytes, String fileName)</span> <span class="keyword">throws</span> QiniuException </span>&#123;</span><br><span class="line">        String fileExtName = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">        String newFileName = UUID.randomUUID() + <span class="string">"."</span> + fileExtName;</span><br><span class="line">        Response response = uploadManager.put(fileBytes, newFileName, getUploadToken());</span><br><span class="line">        <span class="comment">//è§£æä¸Šä¼ æˆåŠŸçš„ç»“æœ</span></span><br><span class="line">        DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">        String key = mqiniuProperties.getFilePathPrefix() + putRet.key;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteByKey</span><span class="params">(String key)</span> <span class="keyword">throws</span> QiniuException </span>&#123;</span><br><span class="line">        key = key.replace(mqiniuProperties.getFilePathPrefix(),<span class="string">""</span>);</span><br><span class="line">        bucketManager.delete(mqiniuProperties.getBucketName(), key);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸Šä¼ å‡­è¯ï¼Œæ™®é€šä¸Šä¼ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getUploadToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.auth.uploadToken(mqiniuProperties.getBucketName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6ã€æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬çš„é‡è½´æˆï¼Œè‡ªåŠ¨é…ç½®ç±»çš„å®šä¹‰.<code>MqiniuServiceAutoConfiguration</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mrain22.qiniu;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Xiuming Lee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019/6/1 16:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Describe</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// è£…é…é…ç½®å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.Region;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.BucketManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Conditional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// è‡ªåŠ¨è£…é…è¿™ä¸ªpropertiesç±»ï¼Œè¯»å–yamlè‡ªå®šä¹‰å†…å®¹</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(MqiniuProperties.class)</span><br><span class="line"><span class="comment">// serviceç±»ï¼Œ@ConditionalOnClassæŸä¸ª Class ä½äºç±»è·¯å¾„ä¸Šï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ªBeanã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“classpathä¸‹å‘ç°è¯¥ç±»çš„æƒ…å†µä¸‹è¿›è¡Œå®ä¾‹åŒ–ã€‚</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(MqiniuService.class)</span><br><span class="line"><span class="comment">// æ ¡éªŒç±»</span></span><br><span class="line"><span class="meta">@Conditional</span>(MqiniuCondition.class)</span><br><span class="line"><span class="comment">// å½“é…ç½®æ–‡ä»¶ä¸­ mqiniu çš„å€¼ä¸º true æ—¶ï¼Œå®ä¾‹åŒ–æ­¤ç±»ã€‚å¯ä»¥ä¸å¡«</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"mqiniu"</span>, value = <span class="string">"true"</span>, matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqiniuServiceAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MqiniuProperties mqiniuProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šå®ä¾‹åŒ–æ¥å£çš„ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ConditionalOnMissingBean</span> å½“springå®¹å™¨ä¸­ä¸å­˜åœ¨MqiniuServiceçš„å®ä¾‹æ—¶ï¼Œé»˜è®¤è°ƒç”¨è¿™ä¸ªã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœä½ å®ç°äº†MqiniuServiceæ¥å£ï¼Œå¹¶æ·»åŠ åˆ°äº†Springå®¹å™¨ï¼Œåˆ™ä¼šä½¿ç”¨ä½ çš„MqiniuServiceå®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MqiniuService <span class="title">qiNiuYunService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MqiniuServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸€ä¸ªä¸ƒç‰›ä¸Šä¼ å·¥å…·å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UploadManager <span class="title">uploadManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UploadManager(<span class="keyword">new</span> com.qiniu.storage.Configuration(Region.autoRegion()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯ä¿¡æ¯å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Auth <span class="title">auth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Auth.create(mqiniuProperties.getAccessKey(), mqiniuProperties.getSecretKey());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸ƒç‰›ç©ºé—´ç®¡ç†å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BucketManager <span class="title">bucketManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BucketManager(auth(),<span class="keyword">new</span> com.qiniu.storage.Configuration(Region.autoRegion()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7ã€<strong>è®©<code>spring boot</code>åŠ è½½æˆ‘ä»¬çš„è£…é…ç±»ï¼Œéœ€è¦åœ¨<code>resource</code>ç›®å½•ä¸‹æ–°å»º<code>META-INF/spring.factories</code>å†…å®¹å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=cn.mrain22.qiniu.MqiniuServiceAutoConfiguration</span><br></pre></td></tr></table></figure>
<h2 id="æœ¬åœ°å®‰è£…"><a href="#æœ¬åœ°å®‰è£…" class="headerlink" title="æœ¬åœ°å®‰è£…"></a>æœ¬åœ°å®‰è£…</h2><p>å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œä¸€ä¸ªç®€å•<code>Spring  Boot  Starter</code>ä¹Ÿå°±å†™å®Œäº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å°†å…¶å‘å¸ƒåˆ°Mavenä»“åº“ï¼Œæˆ‘è¿™é‡Œå°±ç®€å•ç‚¹ï¼Œåªå‘å¸ƒåˆ°æœ¬åœ°ã€‚</p>
<p>æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨<code>IntelliJ IDEA</code> ä¸­ï¼Œç‚¹å‡»å³è¾¹çš„ <code>Maven Project</code>ï¼Œç„¶åé€‰æ‹© <code>Lifecycle</code> ä¸­çš„ <code>install</code>ï¼ŒåŒå‡»å³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201906021050_155.png" alt=""></p>
<p>åŒå‡»å®Œæˆåï¼Œè¿™ä¸ª <code>Starter</code>å°±å®‰è£…åˆ°æˆ‘ä»¬æœ¬åœ°ä»“åº“äº†ã€‚</p>
<h2 id="ä½¿ç”¨-Starter"><a href="#ä½¿ç”¨-Starter" class="headerlink" title="ä½¿ç”¨ Starter"></a>ä½¿ç”¨ Starter</h2><p>åœ¨æˆ‘ä»¬éœ€è¦çš„é¡¹ç›®ä¸­å¼•å…¥ä¾èµ–å³å¯ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.mrain22.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> <code>application.properties</code>ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mqiniu.access-key=your qiniu`s ak</span><br><span class="line">mqiniu.secret-key=your qiniu`s sk</span><br><span class="line">mqiniu.bucket-name=ç©ºé—´åç§°</span><br><span class="line">mqiniu.file-path-prefix=your qiniu cdn url</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> MqiniuService mqiniuService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PostMapping</span>(<span class="string">"/file"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">fileUploadTest</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="keyword">byte</span>[] fileBytes = file.getBytes();</span><br><span class="line">       String filename = file.getOriginalFilename();</span><br><span class="line">       String url = mqiniuService.uploadFile(fileBytes, filename);</span><br><span class="line">       <span class="keyword">return</span> url;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p># </p>
]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootã€SpringSecurityã€Vueæ•´åˆJWTè®¤è¯</title>
    <url>/Spring-Boot/SpringBoot%E3%80%81SpringSecurity%E3%80%81Vue%E6%95%B4%E5%90%88JWT%E8%AE%A4%E8%AF%81.html</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨å¼€å§‹è¿™ç¯‡æ–‡ç« å‰ï¼Œåšä¸»é»˜è®¤ä½ ä»¬å·²ç»å¯¹Spring Bootã€Spring Securityã€Vueä»¥åŠJWTå·²ç»äº†è§£ã€‚è¿™é‡Œå¯¹ä»¥ä¸Šæ¦‚å¿µä¹Ÿä¸å†èµ˜è¿°ã€‚ä¸‹é¢å…ˆè®²ä¸€ä¸‹æ€è·¯ã€‚</p>
<blockquote>
<p>1ã€åç«¯éœ€è¦ç¼–å†™JWTç”Ÿæˆå¤„ç†å’ŒJWTè§£æè®¤è¯å¤„ç†ã€‚</p>
<p>2ã€å‰ç«¯å¡«å†™ç”¨æˆ·åå’Œå¯†ç å‘é€ç™»å½•è¯·æ±‚ã€‚</p>
<p>3ã€ç»åç«¯Spring Securityç™»å½•è®¤è¯æˆåŠŸåï¼Œç”±JWTç”Ÿæˆå™¨ç”Ÿæˆ<code>Token</code>è¿”å›ç»™å‰ç«¯ã€‚</p>
<p>4ã€å‰ç«¯æ‹¿åˆ°<code>Token</code>ï¼Œåœ¨ä¹‹åçš„è¯·æ±‚ä¸­éœ€è¦æºå¸¦è¿™ä¸ª<code>Token</code>ã€‚</p>
<p>5ã€åç«¯ç¼–å†™JWTè¿‡æ»¤å™¨ï¼Œå¯¹è¯·æ±‚ä¸­çš„<code>Token</code>è¿›è¡Œè§£æå¤„ç†ï¼Œè§£ææˆåŠŸé€šè¿‡ï¼Œå¤±è´¥è¿”å›ç›¸åº”æç¤ºã€‚</p>
</blockquote>
<h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p><img src="http://qiniu.mrain22.cn/201905211829_763.gif" alt=""></p>
<blockquote>
<p><code>hello</code>æŒ‰é’®ä¸éœ€è¦ç™»å½•ï¼Œ<code>æµ‹è¯•1</code>å’Œ<code>æµ‹è¯•2</code>æŒ‰é’®éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ã€‚ç‚¹å‡»ç™»å½•åä¼šè·å–<code>Token</code>,ä¸‹æ¬¡å‘é€è¯·æ±‚æºå¸¦è¿™ä¸ª<code>Token</code>.</p>
<p><a href="https://github.com/XiumingLee/SpringBootVueJWT" target="_blank" rel="noopener">æºç åœ°å€</a></p>
</blockquote>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="åç«¯å®ç°"><a href="#åç«¯å®ç°" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h3><ul>
<li><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4></li>
</ul>
<h4 id="1ã€åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åä¸‹å‘Token"><a href="#1ã€åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åä¸‹å‘Token" class="headerlink" title="1ã€åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åä¸‹å‘Token"></a>1ã€åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åä¸‹å‘Token</h4><p><code>Spring Security</code>åœ¨åšç™»å½•æ“ä½œçš„æ—¶å€™å…è®¸æˆ‘ä»¬æ·»åŠ æˆ‘ä»¬çš„è‡ªå·±çš„<code>ç™»å½•æˆåŠŸå¤„ç†å™¨</code>å’Œ<code>ç™»å½•å¤±è´¥å¤„ç†å™¨</code>ã€‚è¿™é‡Œæˆ‘ç¼–å†™äº†è‡ªå·±çš„<code>æˆåŠŸå¤„ç†å™¨</code>å’Œ<code>å¤±è´¥å¤„ç†å™¨</code>ã€‚åœ¨<code>æˆåŠŸå¤„ç†å™¨</code>ä¸­æ·»åŠ äº†ç”Ÿæˆ<code>JWT</code>çš„æ“ä½œã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰çš„ç™»å½•æˆåŠŸå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"myLoginSuccessHandler"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLoginSuccessHandler</span> <span class="keyword">extends</span> <span class="title">SavedRequestAwareAuthenticationSuccessHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest httpServletRequest,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        HttpServletResponse httpServletResponse,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"ç™»å½•æˆåŠŸï¼"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        ç™»å½•æˆåŠŸåè®¾ç½®JWT</span></span><br><span class="line">        String Token = Jwts.builder()</span><br><span class="line">                <span class="comment">//è®¾ç½®tokençš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//                .setClaims(claimsMap)</span></span><br><span class="line">                <span class="comment">//å°†è®¤è¯åçš„authenticationå†™å…¥tokenï¼ŒéªŒè¯æ—¶ï¼Œç›´æ¥éªŒè¯å®ƒ</span></span><br><span class="line">                .claim(<span class="string">"authentication"</span>,authentication)</span><br><span class="line">                <span class="comment">//è®¾ç½®ä¸»é¢˜</span></span><br><span class="line">                .setSubject(<span class="string">"ä¸»é¢˜"</span>)</span><br><span class="line">                <span class="comment">//è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">1000</span>))</span><br><span class="line">                <span class="comment">//åŠ å¯†æ–¹å¼</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, <span class="string">"MyJWTtest"</span>)</span><br><span class="line">                .compact();</span><br><span class="line">        httpServletResponse.addHeader(<span class="string">"Authorization"</span>, <span class="string">"Mrain"</span> + Token);</span><br><span class="line">        <span class="comment">//è¦åšçš„å·¥ä½œå°±æ˜¯å°†Authenticationä»¥jsonçš„å½¢å¼è¿”å›ç»™å‰ç«¯ã€‚ éœ€è¦å·¥å…·ç±»ObjectMapperï¼ŒSpringå·²è‡ªåŠ¨æ³¨å…¥ã€‚</span></span><br><span class="line">        <span class="comment">//è®¾ç½®è¿”å›ç±»å‹</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">"application/json;charset=UTF-8"</span>);</span><br><span class="line">        Map&lt;String, Object&gt; tokenInfo = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        tokenInfo.put(<span class="string">"Authorization"</span>,<span class="string">"Mrain"</span> + Token);</span><br><span class="line">        <span class="comment">//å°†tokenä¿¡æ¯å†™å…¥</span></span><br><span class="line">        httpServletResponse.getWriter().write(objectMapper.writeValueAsString(tokenInfo));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"myLoginFailureHandler"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLoginFailureHandler</span> <span class="keyword">extends</span> <span class="title">SimpleUrlAuthenticationFailureHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ObjectMapperè¿™ä¸ªç±»æ˜¯javaä¸­jacksonæä¾›çš„ï¼Œä¸»è¦æ˜¯ç”¨æ¥æŠŠå¯¹è±¡è½¬æ¢æˆä¸ºä¸€ä¸ªjsonå­—ç¬¦ä¸²è¿”å›åˆ°å‰ç«¯,</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">//jsonå½¢å¼è¿”å›</span></span><br><span class="line">        <span class="comment">//æœåŠ¡å™¨å†…éƒ¨å¼‚å¸¸</span></span><br><span class="line">        response.setStatus(<span class="number">500</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®è¿”å›ç±»å‹</span></span><br><span class="line">        response.setContentType(<span class="string">"application/json;charset=UTF-8"</span>);</span><br><span class="line">        <span class="comment">//å°†é”™è¯¯ä¿¡æ¯å†™å…¥</span></span><br><span class="line">       response.getWriter().write(objectMapper.writeValueAsString(exception.getMessage()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€JWTæ‹¦æˆªå™¨"><a href="#2ã€JWTæ‹¦æˆªå™¨" class="headerlink" title="2ã€JWTæ‹¦æˆªå™¨"></a>2ã€JWTæ‹¦æˆªå™¨</h4><p>å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„<code>JWTæ‹¦æˆªå™¨</code>ï¼Œåœ¨è¯·æ±‚åˆ°è¾¾ç›®æ ‡ä¹‹å‰å¯¹<code>Token</code>è¿›è¡Œæ ¡éªŒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JWTæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–JWT</span></span><br><span class="line">        String authHeader = request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        logger.info(<span class="string">"---------&gt;"</span>+authHeader);</span><br><span class="line">        <span class="keyword">if</span> (authHeader != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è§£ætoken.</span></span><br><span class="line">            Claims claims = Jwts.parser()</span><br><span class="line">                    .setSigningKey(<span class="string">"MyJWTtest"</span>)</span><br><span class="line">                    .parseClaimsJws(authHeader.replace(<span class="string">"Mrain"</span>, <span class="string">""</span>))</span><br><span class="line">                    .getBody();</span><br><span class="line">            <span class="comment">//è·å–suject</span></span><br><span class="line"><span class="comment">//            String subject = claims.getSubject();</span></span><br><span class="line"><span class="comment">//            User user = (User) claims.get("user");</span></span><br><span class="line">            <span class="comment">//è·å–è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            Date claimsExpiration = claims.getExpiration();</span><br><span class="line">            logger.info(<span class="string">"è¿‡æœŸæ—¶é—´"</span>+claimsExpiration);</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">            Date now = <span class="keyword">new</span> Date();</span><br><span class="line">            <span class="keyword">if</span> (now.getTime() &gt; claimsExpiration.getTime()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(<span class="string">"å‡­è¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–ä¿å­˜åœ¨tokenä¸­çš„ç™»å½•è®¤è¯æˆåŠŸçš„authenticationï¼Œ</span></span><br><span class="line">            <span class="comment">// åˆ©ç”¨UsernamePasswordAuthenticationTokenç”Ÿæˆæ–°çš„authentication</span></span><br><span class="line">            <span class="comment">// æ”¾å…¥åˆ°SecurityContextHolderï¼Œè¡¨ç¤ºè®¤è¯é€šè¿‡</span></span><br><span class="line">            Object tokenInfo = claims.get(<span class="string">"authentication"</span>);</span><br><span class="line">            <span class="comment">//é€šè¿‡com.alibaba.fastjsonå°†å…¶åœ¨è½¬æ¢ã€‚</span></span><br><span class="line">            Authentication toknAuthentication = JSONObject.parseObject(JSONObject.toJSONString(tokenInfo), Authentication.class);</span><br><span class="line">            UsernamePasswordAuthenticationToken authentication = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(toknAuthentication.getPrincipal(),<span class="keyword">null</span>,toknAuthentication.getAuthorities());</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3ã€é…ç½®Spring-Securityçš„é…ç½®"><a href="#3ã€é…ç½®Spring-Securityçš„é…ç½®" class="headerlink" title="3ã€é…ç½®Spring Securityçš„é…ç½®"></a>3ã€é…ç½®Spring Securityçš„é…ç½®</h4><p>å°†<code>ä¸¤ä¸ªå¤„ç†å™¨</code>å’Œæˆ‘ä»¬çš„<code>Jwtæ‹¦æˆªå™¨</code>æ·»åŠ åˆ°<code>Spring Security</code>çš„é…ç½®ä¸­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyLoginSuccessHandler myLoginSuccessHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyLoginFailureHandler myLoginFailureHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/** JWTæ‹¦æˆªå™¨*/</span></span><br><span class="line">        JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter = <span class="keyword">new</span> JwtAuthenticationTokenFilter();</span><br><span class="line">        <span class="comment">/** å°†JWTæ‹¦æˆªå™¨æ·»åŠ åˆ°UsernamePasswordAuthenticationFilterä¹‹å‰*/</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter,UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">        http.formLogin()</span><br><span class="line">                .loginPage(<span class="string">"/loginInfo"</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">"/login"</span>)</span><br><span class="line">                .successHandler(myLoginSuccessHandler)</span><br><span class="line">                .failureHandler(myLoginFailureHandler);</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">"/hello"</span>,<span class="string">"/login"</span>,<span class="string">"/loginInfo"</span>,<span class="string">"/logoutSuccess"</span>)</span><br><span class="line">                .permitAll()</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated();</span><br><span class="line">        <span class="comment">//è®¿é—® /logout è¡¨ç¤ºç”¨æˆ·æ³¨é”€ï¼Œå¹¶æ¸…ç©ºsession</span></span><br><span class="line">        http.logout().logoutSuccessUrl(<span class="string">"/logoutSuccess"</span>);</span><br><span class="line">        <span class="comment">// å…³é—­csrf</span></span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯†ç åŠ ç›åŠ å¯†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Springè‡ªå¸¦çš„æ¯æ¬¡ä¼šéšæœºç”Ÿæˆç›å€¼ï¼Œå³ä½¿å¯†ç ç›¸åŒï¼ŒåŠ å¯†åä¹Ÿä¸åŒ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‰ç«¯å®ç°"><a href="#å‰ç«¯å®ç°" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h3><p>å‰ç«¯å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯ç™»å½•æˆåŠŸåï¼Œå°†è¿”å›çš„<code>token</code>ä¿å­˜èµ·æ¥ï¼Œä»¥åæ¯æ¬¡è®¿é—®è¯·æ±‚å¤´æºå¸¦è¿™ä¸ª<code>token</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">login() &#123;</span><br><span class="line">      <span class="keyword">this</span>.$http</span><br><span class="line">        .post(<span class="string">"/login"</span>, &#123;</span><br><span class="line">          username: <span class="number">1</span>,</span><br><span class="line">          password: <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// ç™»å½•æˆåŠŸ</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"ç™»å½•æˆåŠŸï¼"</span>);</span><br><span class="line">          <span class="built_in">console</span>.log(res.data);</span><br><span class="line">           <span class="comment">/** å°†Tokenä¿å­˜åˆ°localStorage*/</span></span><br><span class="line">          <span class="keyword">const</span> authorization = res.data.Authorization;</span><br><span class="line">          localStorage.token = authorization;</span><br><span class="line">          <span class="keyword">this</span>.msg = authorization;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"ç™»å½•å¤±è´¥ï¼"</span>);</span><br><span class="line">          <span class="built_in">console</span>.log(error);</span><br><span class="line">          <span class="keyword">this</span>.msg = error;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨axioså‘é€è¯·æ±‚çš„è®¾ç½®</span></span><br><span class="line"><span class="comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšæŸä»¶äº‹</span></span><br><span class="line">Axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä»¥ form è¡¨å•çš„å½¢å¼æäº¤å‚æ•°ï¼Œå¦‚æœä»¥JSONçš„å½¢å¼æäº¤è¡¨å•ï¼Œå¯å¿½ç•¥</span></span><br><span class="line">    <span class="keyword">if</span>(config.method  === <span class="string">'post'</span>)&#123;</span><br><span class="line">        <span class="comment">// JSON è½¬æ¢ä¸º FormData</span></span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData()</span><br><span class="line">        <span class="built_in">Object</span>.keys(config.data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> formData.append(key, config.data[key]))</span><br><span class="line">        config.data = formData</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ¬æ¡ˆä¾‹ä¸­å°†tokenä¿å­˜åˆ°äº†localStorageï¼Œå°†å…¶æ·»åŠ åˆ°è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (localStorage.token) &#123;   </span><br><span class="line">        config.headers.Authorization = localStorage.token</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;,error =&gt;&#123;</span><br><span class="line">    alert(<span class="string">"é”™è¯¯çš„ä¼ å‚"</span>, <span class="string">'fail'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a><a href="https://github.com/XiumingLee/SpringBootVueJWT" target="_blank" rel="noopener">æºç åœ°å€</a></h3>]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6ã€ES7ã€ES8ã€ES9ã€ES10æ–°ç‰¹æ€§ä¸€è§ˆ</title>
    <url>/%E8%BD%AC%E8%BD%BD/ES6%E3%80%81ES7%E3%80%81ES8%E3%80%81ES9%E3%80%81ES10%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88.html</url>
    <content><![CDATA[<blockquote>
<p>ESå…¨ç§°ECMAScriptï¼ŒECMAScriptæ˜¯ECMAåˆ¶å®šçš„æ ‡å‡†åŒ–è„šæœ¬è¯­è¨€ã€‚ç›®å‰JavaScriptä½¿ç”¨çš„ECMAScriptç‰ˆæœ¬ä¸º<a href="https://link.juejin.im?target=https%3A%2F%2Fecma-international.org%2Fpublications%2Fstandards%2FEcma-417.htm" target="_blank" rel="noopener">ECMA-417</a>ã€‚å…³äºECMAçš„æœ€æ–°èµ„è®¯å¯ä»¥æµè§ˆ <a href="https://link.juejin.im?target=https%3A%2F%2Fwww.ecma-international.org%2Fnews%2Findex.html" target="_blank" rel="noopener">ECMA news</a>æŸ¥çœ‹ã€‚</p>
</blockquote>
<p>ECMAè§„èŒƒæœ€ç»ˆç”±<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ftc39" target="_blank" rel="noopener">TC39</a>æ•²å®šã€‚TC39ç”±åŒ…æ‹¬æµè§ˆå™¨å‚å•†åœ¨å†…çš„å„æ–¹ç»„æˆï¼Œä»–ä»¬å¼€ä¼šæ¨åŠ¨JavaScriptææ¡ˆæ²¿ç€ä¸€æ¡ä¸¥æ ¼çš„å‘å±•é“è·¯å‰è¿›ã€‚ ä»ææ¡ˆåˆ°å…¥é€‰ECMAè§„èŒƒä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>Stage 0: strawmanâ€”â€”æœ€åˆæƒ³æ³•çš„æäº¤ã€‚</li>
<li>Stage 1: proposalï¼ˆææ¡ˆï¼‰â€”â€”ç”±TC39è‡³å°‘ä¸€åæˆå‘˜å€¡å¯¼çš„æ­£å¼ææ¡ˆæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…æ‹¬APIäº‹ä¾‹ã€‚</li>
<li>Stage 2: draftï¼ˆè‰æ¡ˆï¼‰â€”â€”åŠŸèƒ½è§„èŒƒçš„åˆå§‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬åŒ…å«åŠŸèƒ½è§„èŒƒçš„ä¸¤ä¸ªå®éªŒå®ç°ã€‚</li>
<li>Stage 3: candidateï¼ˆå€™é€‰ï¼‰â€”â€”ææ¡ˆè§„èŒƒé€šè¿‡å®¡æŸ¥å¹¶ä»å‚å•†é‚£é‡Œæ”¶é›†åé¦ˆ</li>
<li>Stage 4: finishedï¼ˆå®Œæˆï¼‰â€”â€”ææ¡ˆå‡†å¤‡åŠ å…¥ECMAScriptï¼Œä½†æ˜¯åˆ°æµè§ˆå™¨æˆ–è€…Nodejsä¸­å¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</li>
</ul>
<h2 id="ES6æ–°ç‰¹æ€§ï¼ˆ2015ï¼‰"><a href="#ES6æ–°ç‰¹æ€§ï¼ˆ2015ï¼‰" class="headerlink" title="ES6æ–°ç‰¹æ€§ï¼ˆ2015ï¼‰"></a>ES6æ–°ç‰¹æ€§ï¼ˆ2015ï¼‰</h2><p>ES6çš„ç‰¹æ€§æ¯”è¾ƒå¤šï¼Œåœ¨ ES5 å‘å¸ƒè¿‘ 6 å¹´ï¼ˆ2009-11 è‡³ 2015-6ï¼‰ä¹‹åæ‰å°†å…¶æ ‡å‡†åŒ–ã€‚ä¸¤ä¸ªå‘å¸ƒç‰ˆæœ¬ä¹‹é—´æ—¶é—´è·¨åº¦å¾ˆå¤§ï¼Œæ‰€ä»¥ES6ä¸­çš„ç‰¹æ€§æ¯”è¾ƒå¤šã€‚ åœ¨è¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ï¼š</p>
<ul>
<li>ç±»</li>
<li>æ¨¡å—åŒ–</li>
<li>ç®­å¤´å‡½æ•°</li>
<li>å‡½æ•°å‚æ•°é»˜è®¤å€¼</li>
<li>æ¨¡æ¿å­—ç¬¦ä¸²</li>
<li>è§£æ„èµ‹å€¼</li>
<li>å»¶å±•æ“ä½œç¬¦</li>
<li>å¯¹è±¡å±æ€§ç®€å†™</li>
<li>Promise</li>
<li>Letä¸Const</li>
</ul>
<h3 id="1-ç±»ï¼ˆclassï¼‰"><a href="#1-ç±»ï¼ˆclassï¼‰" class="headerlink" title="1.ç±»ï¼ˆclassï¼‰"></a>1.ç±»ï¼ˆclassï¼‰</h3><p>å¯¹ç†Ÿæ‚‰Javaï¼Œobject-cï¼Œc#ç­‰çº¯é¢å‘å¯¹è±¡è¯­è¨€çš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½ä¼šå¯¹classæœ‰ä¸€ç§ç‰¹æ®Šçš„æƒ…æ€€ã€‚ES6 å¼•å…¥äº†classï¼ˆç±»ï¼‰ï¼Œè®©JavaScriptçš„é¢å‘å¯¹è±¡ç¼–ç¨‹å˜å¾—æ›´åŠ ç®€å•å’Œæ˜“äºç†è§£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">   <span class="comment">// æ„é€ å‡½æ•°ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªä¸å¸¦å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°.</span></span><br><span class="line">   <span class="keyword">constructor</span>(name,color) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name = name;</span><br><span class="line">     <span class="keyword">this</span>.color = color;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// toString æ˜¯åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§</span></span><br><span class="line">   toString() &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'name:'</span> + <span class="keyword">this</span>.name + <span class="string">',color:'</span> + <span class="keyword">this</span>.color);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal(<span class="string">'dog'</span>,<span class="string">'white'</span>);<span class="comment">//å®ä¾‹åŒ–Animal</span></span><br><span class="line">animal.toString();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(animal.hasOwnProperty(<span class="string">'name'</span>)); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(animal.hasOwnProperty(<span class="string">'toString'</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(animal.__proto__.hasOwnProperty(<span class="string">'toString'</span>)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(action) &#123;</span><br><span class="line">   <span class="comment">// å­ç±»å¿…é¡»è¦åœ¨constructorä¸­æŒ‡å®šsuper å‡½æ•°ï¼Œå¦åˆ™åœ¨æ–°å»ºå®ä¾‹çš„æ—¶å€™ä¼šæŠ¥é”™.</span></span><br><span class="line">   <span class="comment">// å¦‚æœæ²¡æœ‰ç½®é¡¶consructor,é»˜è®¤å¸¦superå‡½æ•°çš„constructorå°†ä¼šè¢«æ·»åŠ ã€</span></span><br><span class="line">   <span class="keyword">super</span>(<span class="string">'cat'</span>,<span class="string">'white'</span>);</span><br><span class="line">   <span class="keyword">this</span>.action = action;</span><br><span class="line"> &#125;</span><br><span class="line"> toString() &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">super</span>.toString());</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> Cat(<span class="string">'catch'</span>)</span><br><span class="line">cat.toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹cat æ˜¯ Cat å’Œ Animal çš„å®ä¾‹ï¼Œå’ŒEs5å®Œå…¨ä¸€è‡´ã€‚</span></span><br><span class="line"><span class="built_in">console</span>.log(cat <span class="keyword">instanceof</span> Cat); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(cat <span class="keyword">instanceof</span> Animal); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="2-æ¨¡å—åŒ–-Module"><a href="#2-æ¨¡å—åŒ–-Module" class="headerlink" title="2.æ¨¡å—åŒ–(Module)"></a>2.æ¨¡å—åŒ–(Module)</h3><p>ES5ä¸æ”¯æŒåŸç”Ÿçš„æ¨¡å—åŒ–ï¼Œåœ¨ES6ä¸­æ¨¡å—ä½œä¸ºé‡è¦çš„ç»„æˆéƒ¨åˆ†è¢«æ·»åŠ è¿›æ¥ã€‚æ¨¡å—çš„åŠŸèƒ½ä¸»è¦ç”± export å’Œ import ç»„æˆã€‚æ¯ä¸€ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±å•ç‹¬çš„ä½œç”¨åŸŸï¼Œæ¨¡å—ä¹‹é—´çš„ç›¸äº’è°ƒç”¨å…³ç³»æ˜¯é€šè¿‡ export æ¥è§„å®šæ¨¡å—å¯¹å¤–æš´éœ²çš„æ¥å£ï¼Œé€šè¿‡importæ¥å¼•ç”¨å…¶å®ƒæ¨¡å—æä¾›çš„æ¥å£ã€‚åŒæ—¶è¿˜ä¸ºæ¨¡å—åˆ›é€ äº†å‘½åç©ºé—´ï¼Œé˜²æ­¢å‡½æ•°çš„å‘½åå†²çªã€‚</p>
<h4 id="å¯¼å‡º-export"><a href="#å¯¼å‡º-export" class="headerlink" title="å¯¼å‡º(export)"></a>å¯¼å‡º(export)</h4><p>ES6å…è®¸åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ä½¿ç”¨exportæ¥å¯¼å‡ºå¤šä¸ªå˜é‡æˆ–å‡½æ•°ã€‚</p>
<p><strong>å¯¼å‡ºå˜é‡</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> name = <span class="string">'Rainbow'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¿ƒå¾—ï¼šES6ä¸ä»…æ”¯æŒå˜é‡çš„å¯¼å‡ºï¼Œä¹Ÿæ”¯æŒå¸¸é‡çš„å¯¼å‡ºã€‚ <code>export const sqrt = Math.sqrt;//å¯¼å‡ºå¸¸é‡</code></p>
</blockquote>
<p>ES6å°†ä¸€ä¸ªæ–‡ä»¶è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œä¸Šé¢çš„æ¨¡å—é€šè¿‡ export å‘å¤–è¾“å‡ºäº†ä¸€ä¸ªå˜é‡ã€‚ä¸€ä¸ªæ¨¡å—ä¹Ÿå¯ä»¥åŒæ—¶å¾€å¤–é¢è¾“å‡ºå¤šä¸ªå˜é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Rainbow'</span>;</span><br><span class="line"><span class="keyword">var</span> age = <span class="string">'24'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;name, age&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>å¯¼å‡ºå‡½æ•°</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// myModule.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">myModule</span>(<span class="params">someArg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> someArg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¯¼å…¥-import"><a href="#å¯¼å…¥-import" class="headerlink" title="å¯¼å…¥(import)"></a>å¯¼å…¥(import)</h4><p>å®šä¹‰å¥½æ¨¡å—çš„è¾“å‡ºä»¥åå°±å¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªæ¨¡å—é€šè¿‡importå¼•ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;myModule&#125; <span class="keyword">from</span> <span class="string">'myModule'</span>;<span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name,age&#125; <span class="keyword">from</span> <span class="string">'test'</span>;<span class="comment">// test.js</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¿ƒå¾—:ä¸€æ¡import è¯­å¥å¯ä»¥åŒæ—¶å¯¼å…¥é»˜è®¤å‡½æ•°å’Œå…¶å®ƒå˜é‡ã€‚<code>import defaultMethod, { otherMethod } from &#39;xxx.js&#39;;</code></p>
</blockquote>
<h3 id="3-ç®­å¤´ï¼ˆArrowï¼‰å‡½æ•°"><a href="#3-ç®­å¤´ï¼ˆArrowï¼‰å‡½æ•°" class="headerlink" title="3.ç®­å¤´ï¼ˆArrowï¼‰å‡½æ•°"></a>3.ç®­å¤´ï¼ˆArrowï¼‰å‡½æ•°</h3><p>è¿™æ˜¯ES6ä¸­æœ€ä»¤äººæ¿€åŠ¨çš„ç‰¹æ€§ä¹‹ä¸€ã€‚<code>=&gt;</code>ä¸åªæ˜¯å…³é”®å­—functionçš„ç®€å†™ï¼Œå®ƒè¿˜å¸¦æ¥äº†å…¶å®ƒå¥½å¤„ã€‚ç®­å¤´å‡½æ•°ä¸åŒ…å›´å®ƒçš„ä»£ç å…±äº«åŒä¸€ä¸ª<code>this</code>,èƒ½å¸®ä½ å¾ˆå¥½çš„è§£å†³thisçš„æŒ‡å‘é—®é¢˜ã€‚æœ‰ç»éªŒçš„JavaScriptå¼€å‘è€…éƒ½ç†Ÿæ‚‰è¯¸å¦‚<code>var self = this;</code>æˆ–<code>var that = this</code>è¿™ç§å¼•ç”¨å¤–å›´thisçš„æ¨¡å¼ã€‚ä½†å€ŸåŠ©<code>=&gt;</code>ï¼Œå°±ä¸éœ€è¦è¿™ç§æ¨¡å¼äº†ã€‚</p>
<h4 id="ç®­å¤´å‡½æ•°çš„ç»“æ„"><a href="#ç®­å¤´å‡½æ•°çš„ç»“æ„" class="headerlink" title="ç®­å¤´å‡½æ•°çš„ç»“æ„"></a>ç®­å¤´å‡½æ•°çš„ç»“æ„</h4><p>ç®­å¤´å‡½æ•°çš„ç®­å¤´=&gt;ä¹‹å‰æ˜¯ä¸€ä¸ªç©ºæ‹¬å·ã€å•ä¸ªçš„å‚æ•°åã€æˆ–ç”¨æ‹¬å·æ‹¬èµ·çš„å¤šä¸ªå‚æ•°åï¼Œè€Œç®­å¤´ä¹‹åå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼Œæˆ–è€…æ˜¯ç”¨èŠ±æ‹¬å·æ‹¬èµ·çš„å‡½æ•°ä½“ï¼ˆéœ€è¦è‡ªè¡Œé€šè¿‡returnæ¥è¿”å›å€¼ï¼Œå¦åˆ™è¿”å›çš„æ˜¯undefinedï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°çš„ä¾‹å­</span></span><br><span class="line">()=&gt;<span class="number">1</span></span><br><span class="line">v=&gt;v+<span class="number">1</span></span><br><span class="line">(a,b)=&gt;a+b</span><br><span class="line">()=&gt;&#123;</span><br><span class="line">    alert(<span class="string">"foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line">e=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1000</span>/e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¿ƒå¾—ï¼šä¸è®ºæ˜¯ç®­å¤´å‡½æ•°è¿˜æ˜¯bindï¼Œæ¯æ¬¡è¢«æ‰§è¡Œéƒ½è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨ï¼Œå› æ­¤å¦‚æœä½ è¿˜éœ€è¦å‡½æ•°çš„å¼•ç”¨å»åšä¸€äº›åˆ«çš„äº‹æƒ…ï¼ˆè­¬å¦‚å¸è½½ç›‘å¬å™¨ï¼‰ï¼Œé‚£ä¹ˆä½ å¿…é¡»è‡ªå·±ä¿å­˜è¿™ä¸ªå¼•ç”¨ã€‚</p>
</blockquote>
<h4 id="å¸è½½ç›‘å¬å™¨æ—¶çš„é™·é˜±"><a href="#å¸è½½ç›‘å¬å™¨æ—¶çš„é™·é˜±" class="headerlink" title="å¸è½½ç›‘å¬å™¨æ—¶çš„é™·é˜±"></a>å¸è½½ç›‘å¬å™¨æ—¶çš„é™·é˜±</h4><blockquote>
<p><strong>é”™è¯¯çš„åšæ³•</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PauseMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>.onAppPaused.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>.onAppPaused.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused(event)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ­£ç¡®çš„åšæ³•</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PauseMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>._onAppPaused = <span class="keyword">this</span>.onAppPaused.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>._onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>._onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused(event)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤ä¸Šè¿°çš„åšæ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PauseMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>.onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(<span class="string">'change'</span>, <span class="keyword">this</span>.onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//æŠŠå‡½æ•°ç›´æ¥ä½œä¸ºä¸€ä¸ªarrow functionçš„å±æ€§æ¥å®šä¹‰ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å°±ç»‘å®šå¥½äº†thisæŒ‡é’ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸è®ºæ˜¯bindè¿˜æ˜¯ç®­å¤´å‡½æ•°ï¼Œæ¯æ¬¡è¢«æ‰§è¡Œéƒ½è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨ï¼Œå› æ­¤å¦‚æœä½ è¿˜éœ€è¦å‡½æ•°çš„å¼•ç”¨å»åšä¸€äº›åˆ«çš„äº‹æƒ…ï¼ˆè­¬å¦‚å¸è½½ç›‘å¬å™¨ï¼‰ï¼Œé‚£ä¹ˆä½ å¿…é¡»è‡ªå·±ä¿å­˜è¿™ä¸ªå¼•ç”¨ã€‚</p>
</blockquote>
<h3 id="4-å‡½æ•°å‚æ•°é»˜è®¤å€¼"><a href="#4-å‡½æ•°å‚æ•°é»˜è®¤å€¼" class="headerlink" title="4.å‡½æ•°å‚æ•°é»˜è®¤å€¼"></a>4.<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FFunctions%2Fdefault_parameters" target="_blank" rel="noopener">å‡½æ•°å‚æ•°é»˜è®¤å€¼</a></h3><p>ES6æ”¯æŒåœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™ä¸ºå…¶è®¾ç½®é»˜è®¤å€¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">height = <span class="number">50</span>, color = <span class="string">'red'</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ä½¿ç”¨é»˜è®¤å€¼ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">height, color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> height = height || <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">var</span> color = color || <span class="string">'red'</span>;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å†™ä¸€èˆ¬æ²¡é—®é¢˜ï¼Œä½†å½“<code>å‚æ•°çš„å¸ƒå°”å€¼ä¸ºfalse</code>æ—¶ï¼Œå°±ä¼šæœ‰é—®é¢˜äº†ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿™æ ·è°ƒç”¨fooå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">foo(<span class="number">0</span>, <span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>å› ä¸º<code>0çš„å¸ƒå°”å€¼ä¸ºfalse</code>ï¼Œè¿™æ ·heightçš„å–å€¼å°†æ˜¯50ã€‚åŒç†colorçš„å–å€¼ä¸ºâ€˜redâ€™ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œ<code>å‡½æ•°å‚æ•°é»˜è®¤å€¼</code>ä¸ä»…èƒ½æ˜¯ä»£ç å˜å¾—æ›´åŠ ç®€æ´è€Œä¸”èƒ½è§„é¿ä¸€äº›é—®é¢˜ã€‚</p>
<h3 id="5-æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#5-æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="5.æ¨¡æ¿å­—ç¬¦ä¸²"></a>5.æ¨¡æ¿å­—ç¬¦ä¸²</h3><p>ES6æ”¯æŒ<code>æ¨¡æ¿å­—ç¬¦ä¸²</code>ï¼Œä½¿å¾—å­—ç¬¦ä¸²çš„æ‹¼æ¥æ›´åŠ çš„ç®€æ´ã€ç›´è§‚ã€‚</p>
<blockquote>
<p>ä¸ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'Your name is '</span> + first + <span class="string">' '</span> + last + <span class="string">'.'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">`Your name is <span class="subst">$&#123;first&#125;</span> <span class="subst">$&#123;last&#125;</span>.`</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ES6ä¸­é€šè¿‡<code>${}</code>å°±å¯ä»¥å®Œæˆå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œåªéœ€è¦å°†å˜é‡æ”¾åœ¨å¤§æ‹¬å·ä¹‹ä¸­ã€‚</p>
<h3 id="6-è§£æ„èµ‹å€¼"><a href="#6-è§£æ„èµ‹å€¼" class="headerlink" title="6.è§£æ„èµ‹å€¼"></a>6.<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FDestructuring_assignment" target="_blank" rel="noopener">è§£æ„èµ‹å€¼</a></h3><p>è§£æ„èµ‹å€¼è¯­æ³•æ˜¯JavaScriptçš„ä¸€ç§è¡¨è¾¾å¼ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä»æ•°ç»„æˆ–è€…å¯¹è±¡ä¸­å¿«é€Ÿæå–å€¼èµ‹ç»™å®šä¹‰çš„å˜é‡ã€‚</p>
<h4 id="è·å–æ•°ç»„ä¸­çš„å€¼"><a href="#è·å–æ•°ç»„ä¸­çš„å€¼" class="headerlink" title="è·å–æ•°ç»„ä¸­çš„å€¼"></a>è·å–æ•°ç»„ä¸­çš„å€¼</h4><p>ä»æ•°ç»„ä¸­è·å–å€¼å¹¶èµ‹å€¼åˆ°å˜é‡ä¸­ï¼Œå˜é‡çš„é¡ºåºä¸æ•°ç»„ä¸­å¯¹è±¡é¡ºåºå¯¹åº”ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = [<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> [one, two, three] = foo;</span><br><span class="line"><span class="built_in">console</span>.log(one); <span class="comment">// "one"</span></span><br><span class="line"><span class="built_in">console</span>.log(two); <span class="comment">// "two"</span></span><br><span class="line"><span class="built_in">console</span>.log(three); <span class="comment">// "three"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœä½ è¦å¿½ç•¥æŸäº›å€¼ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å†™æ³•è·å–ä½ æƒ³è¦çš„å€¼</span></span><br><span class="line"><span class="keyword">var</span> [first, , , last] = foo;</span><br><span class="line"><span class="built_in">console</span>.log(first); <span class="comment">// "one"</span></span><br><span class="line"><span class="built_in">console</span>.log(last); <span class="comment">// "four"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™</span></span><br><span class="line"><span class="keyword">var</span> a, b; <span class="comment">//å…ˆå£°æ˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">[a, b] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰ä»æ•°ç»„ä¸­çš„è·å–åˆ°å€¼ï¼Œä½ å¯ä»¥ä¸ºå˜é‡è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">[a=<span class="number">5</span>, b=<span class="number">7</span>] = [<span class="number">1</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 7</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è§£æ„èµ‹å€¼å¯ä»¥æ–¹ä¾¿çš„äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">[a, b] = [b, a];</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h4 id="è·å–å¯¹è±¡ä¸­çš„å€¼"><a href="#è·å–å¯¹è±¡ä¸­çš„å€¼" class="headerlink" title="è·å–å¯¹è±¡ä¸­çš„å€¼"></a>è·å–å¯¹è±¡ä¸­çš„å€¼</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> student = &#123;</span><br><span class="line">  name:<span class="string">'Ming'</span>,</span><br><span class="line">  age:<span class="string">'18'</span>,</span><br><span class="line">  city:<span class="string">'Shanghai'</span>  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;name,age,city&#125; = student;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// "Ming"</span></span><br><span class="line"><span class="built_in">console</span>.log(age); <span class="comment">// "18"</span></span><br><span class="line"><span class="built_in">console</span>.log(city); <span class="comment">// "Shanghai"</span></span><br></pre></td></tr></table></figure>
<h3 id="7-å»¶å±•æ“ä½œç¬¦-Spread-operator"><a href="#7-å»¶å±•æ“ä½œç¬¦-Spread-operator" class="headerlink" title="7.å»¶å±•æ“ä½œç¬¦(Spread operator)"></a>7.å»¶å±•æ“ä½œç¬¦(Spread operator)</h3><p><code>å»¶å±•æ“ä½œç¬¦...</code>å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨/æ•°ç»„æ„é€ æ—¶, å°†æ•°ç»„è¡¨è¾¾å¼æˆ–è€…stringåœ¨è¯­æ³•å±‚é¢å±•å¼€ï¼›è¿˜å¯ä»¥åœ¨æ„é€ å¯¹è±¡æ—¶, å°†å¯¹è±¡è¡¨è¾¾å¼æŒ‰key-valueçš„æ–¹å¼å±•å¼€ã€‚</p>
<h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><blockquote>
<p>å‡½æ•°è°ƒç”¨ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">myFunction(...iterableObj);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ•°ç»„æ„é€ æˆ–å­—ç¬¦ä¸²ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[...iterableObj, <span class="string">'4'</span>, ...<span class="string">'hello'</span>, <span class="number">6</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ„é€ å¯¹è±¡æ—¶,è¿›è¡Œå…‹éš†æˆ–è€…å±æ€§æ‹·è´ï¼ˆECMAScript 2018è§„èŒƒæ–°å¢ç‰¹æ€§ï¼‰ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> objClone = &#123; ...obj &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><blockquote>
<p>åœ¨å‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨å»¶å±•æ“ä½œç¬¦</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸ä½¿ç”¨å»¶å±•æ“ä½œç¬¦</span></span><br><span class="line"><span class="built_in">console</span>.log(sum.apply(<span class="literal">null</span>, numbers));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨å»¶å±•æ“ä½œç¬¦</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(...numbers));<span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ„é€ æ•°ç»„</p>
</blockquote>
<p>æ²¡æœ‰å±•å¼€è¯­æ³•çš„æ—¶å€™ï¼Œåªèƒ½ç»„åˆä½¿ç”¨ pushï¼Œspliceï¼Œconcat ç­‰æ–¹æ³•ï¼Œæ¥å°†å·²æœ‰æ•°ç»„å…ƒç´ å˜æˆæ–°æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚æœ‰äº†å±•å¼€è¯­æ³•, æ„é€ æ–°æ•°ç»„ä¼šå˜å¾—æ›´ç®€å•ã€æ›´ä¼˜é›…ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stuendts = [<span class="string">'Jine'</span>,<span class="string">'Tom'</span>]; </span><br><span class="line"><span class="keyword">const</span> persons = [<span class="string">'Tony'</span>,... stuendts,<span class="string">'Aaron'</span>,<span class="string">'Anna'</span>];</span><br><span class="line">conslog.log(persions)<span class="comment">// ["Tony", "Jine", "Tom", "Aaron", "Anna"]</span></span><br></pre></td></tr></table></figure>
<p>å’Œå‚æ•°åˆ—è¡¨çš„å±•å¼€ç±»ä¼¼,  <code>...</code> åœ¨æ„é€ å­—æ•°ç»„æ—¶, å¯ä»¥åœ¨ä»»æ„ä½ç½®å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<blockquote>
<p>æ•°ç»„æ‹·è´</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [...arr]; <span class="comment">// ç­‰åŒäº arr.slice()</span></span><br><span class="line">arr2.push(<span class="number">4</span>); </span><br><span class="line"><span class="built_in">console</span>.log(arr2)<span class="comment">//[1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<p>å±•å¼€è¯­æ³•å’Œ Object.assign() è¡Œä¸ºä¸€è‡´, æ‰§è¡Œçš„éƒ½æ˜¯æµ…æ‹·è´(åªéå†ä¸€å±‚)ã€‚</p>
<blockquote>
<p>è¿æ¥å¤šä¸ªæ•°ç»„</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> arr3 = [...arr1, ...arr2];<span class="comment">// å°† arr2 ä¸­æ‰€æœ‰å…ƒç´ é™„åŠ åˆ° arr1 åé¢å¹¶è¿”å›</span></span><br><span class="line"><span class="comment">//ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">var</span> arr4 = arr1.concat(arr2);</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨ECMAScript-2018ä¸­å»¶å±•æ“ä½œç¬¦å¢åŠ äº†å¯¹å¯¹è±¡çš„æ”¯æŒ"><a href="#åœ¨ECMAScript-2018ä¸­å»¶å±•æ“ä½œç¬¦å¢åŠ äº†å¯¹å¯¹è±¡çš„æ”¯æŒ" class="headerlink" title="åœ¨ECMAScript 2018ä¸­å»¶å±•æ“ä½œç¬¦å¢åŠ äº†å¯¹å¯¹è±¡çš„æ”¯æŒ"></a>åœ¨ECMAScript 2018ä¸­å»¶å±•æ“ä½œç¬¦å¢åŠ äº†å¯¹å¯¹è±¡çš„æ”¯æŒ</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">x</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">foo</span>: <span class="string">'baz'</span>, <span class="attr">y</span>: <span class="number">13</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clonedObj = &#123; ...obj1 &#125;;</span><br><span class="line"><span class="comment">// å…‹éš†åçš„å¯¹è±¡: &#123; foo: "bar", x: 42 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mergedObj = &#123; ...obj1, ...obj2 &#125;;</span><br><span class="line"><span class="comment">// åˆå¹¶åçš„å¯¹è±¡: &#123; foo: "baz", x: 42, y: 13 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`javascript</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### åœ¨Reactä¸­çš„åº”ç”¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é€šå¸¸æˆ‘ä»¬åœ¨å°è£…ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä¼šå¯¹å¤–å…¬å¼€ä¸€äº› props ç”¨äºå®ç°åŠŸèƒ½ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹åœ¨å¤–éƒ¨ä½¿ç”¨éƒ½åº”æ˜¾ç¤ºçš„ä¼ é€’ props ã€‚ä½†æ˜¯å½“ä¼ é€’å¤§é‡çš„propsæ—¶ï¼Œä¼šéå¸¸ç¹çï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `</span>...(å»¶å±•æ“ä½œç¬¦,ç”¨äºå–å‡ºå‚æ•°å¯¹è±¡çš„æ‰€æœ‰å¯éå†å±æ€§)<span class="string">` æ¥è¿›è¡Œä¼ é€’ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥è¿™æ ·å†™</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">&lt;CustomComponent name =<span class="string">'Jine'</span> age =&#123;<span class="number">21</span>&#125; /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨ â€¦ ï¼Œç­‰åŒäºä¸Šé¢çš„å†™æ³•</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">	name: <span class="string">'Jine'</span>,</span><br><span class="line">	age: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;CustomComponent &#123;...params&#125; /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é…åˆè§£æ„èµ‹å€¼é¿å…ä¼ å…¥ä¸€äº›ä¸éœ€è¦çš„å‚æ•°</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> params = &#123;</span><br><span class="line">	name: <span class="string">'123'</span>,</span><br><span class="line">	title: <span class="string">'456'</span>,</span><br><span class="line">	type: <span class="string">'aaa'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123; type, ...other &#125; = params;</span><br><span class="line"></span><br><span class="line">&lt;CustomComponent type=<span class="string">'normal'</span> number=&#123;<span class="number">2</span>&#125; &#123;...other&#125; /&gt;</span><br><span class="line"><span class="comment">//ç­‰åŒäº</span></span><br><span class="line">&lt;CustomComponent type=<span class="string">'normal'</span> number=&#123;<span class="number">2</span>&#125; name=<span class="string">'123'</span> title=<span class="string">'456'</span> /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="8-å¯¹è±¡å±æ€§ç®€å†™"><a href="#8-å¯¹è±¡å±æ€§ç®€å†™" class="headerlink" title="8.å¯¹è±¡å±æ€§ç®€å†™"></a>8.å¯¹è±¡å±æ€§ç®€å†™</h3><p>åœ¨ES6ä¸­å…è®¸æˆ‘ä»¬åœ¨è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„æ—¶å€™ä¸æŒ‡å®šå±æ€§åã€‚</p>
<blockquote>
<p>ä¸ä½¿ç”¨ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name=<span class="string">'Ming'</span>,age=<span class="string">'18'</span>,city=<span class="string">'Shanghai'</span>;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">const</span> student = &#123;</span><br><span class="line">    name:name,</span><br><span class="line">    age:age,</span><br><span class="line">    city:city</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(student);<span class="comment">//&#123;name: "Ming", age: "18", city: "Shanghai"&#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹è±¡ä¸­å¿…é¡»åŒ…å«å±æ€§å’Œå€¼ï¼Œæ˜¾å¾—éå¸¸å†—ä½™ã€‚</p>
<blockquote>
<p>ä½¿ç”¨ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name=<span class="string">'Ming'</span>,age=<span class="string">'18'</span>,city=<span class="string">'Shanghai'</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> student = &#123;</span><br><span class="line">    name,</span><br><span class="line">    age,</span><br><span class="line">    city</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(student);<span class="comment">//&#123;name: "Ming", age: "18", city: "Shanghai"&#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹è±¡ä¸­ç›´æ¥å†™å˜é‡ï¼Œéå¸¸ç®€æ´ã€‚</p>
<h3 id="9-Promise"><a href="#9-Promise" class="headerlink" title="9.Promise"></a>9.<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FUsing_promises" target="_blank" rel="noopener">Promise</a></h3><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆcallbackæ›´åŠ çš„ä¼˜é›…ã€‚å®ƒæœ€æ—©ç”±ç¤¾åŒºæå‡ºå’Œå®ç°çš„ï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†Promiseå¯¹è±¡ã€‚</p>
<blockquote>
<p>ä¸ä½¿ç”¨ES6</p>
</blockquote>
<p>åµŒå¥—ä¸¤ä¸ªsetTimeoutå›è°ƒå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello'</span>); <span class="comment">// 1ç§’åè¾“å‡º"Hello"</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Hi'</span>); <span class="comment">// 2ç§’åè¾“å‡º"Hi"</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> waitSecond = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    setTimeout(resolve, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">waitSecond</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Hello"</span>); <span class="comment">// 1ç§’åè¾“å‡º"Hello"</span></span><br><span class="line">      <span class="keyword">return</span> waitSecond;</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hi"</span>); <span class="comment">// 2ç§’åè¾“å‡º"Hi"</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„çš„ä»£ç ä½¿ç”¨ä¸¤ä¸ªthenæ¥è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ä¸²è¡ŒåŒ–ï¼Œé¿å…äº†å›è°ƒåœ°ç‹±ï¼š</p>
<h3 id="10-æ”¯æŒletä¸const"><a href="#10-æ”¯æŒletä¸const" class="headerlink" title="10.æ”¯æŒletä¸const"></a>10.æ”¯æŒletä¸const</h3><p>åœ¨ä¹‹å‰JSæ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ï¼Œconstä¸letå¡«è¡¥äº†è¿™æ–¹ä¾¿çš„ç©ºç™½ï¼Œconstä¸letéƒ½æ˜¯å—çº§ä½œç”¨åŸŸã€‚</p>
<blockquote>
<p>ä½¿ç”¨varå®šä¹‰çš„å˜é‡ä¸ºå‡½æ•°çº§ä½œç”¨åŸŸï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// è¾“å‡º10</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨letä¸constå®šä¹‰çš„å˜é‡ä¸ºå—çº§ä½œç”¨åŸŸï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">//-1 or Errorâ€œReferenceError: a is not definedâ€</span></span><br></pre></td></tr></table></figure>
<h2 id="ES7æ–°ç‰¹æ€§ï¼ˆ2016ï¼‰"><a href="#ES7æ–°ç‰¹æ€§ï¼ˆ2016ï¼‰" class="headerlink" title="ES7æ–°ç‰¹æ€§ï¼ˆ2016ï¼‰"></a>ES7æ–°ç‰¹æ€§ï¼ˆ2016ï¼‰</h2><p>ES2016æ·»åŠ äº†ä¸¤ä¸ªå°çš„ç‰¹æ€§æ¥è¯´æ˜æ ‡å‡†åŒ–è¿‡ç¨‹ï¼š</p>
<ul>
<li>æ•°ç»„includes()æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li>
<li>a ** bæŒ‡æ•°è¿ç®—ç¬¦ï¼Œå®ƒä¸ Math.pow(a, b)ç›¸åŒã€‚</li>
</ul>
<h3 id="1-Array-prototype-includes"><a href="#1-Array-prototype-includes" class="headerlink" title="1.Array.prototype.includes()"></a>1.Array.prototype.includes()</h3><p><code>includes()</code> å‡½æ•°ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ã€‚</p>
<p><code>includes</code> å‡½æ•°ä¸ <code>indexOf</code> å‡½æ•°å¾ˆç›¸ä¼¼ï¼Œä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arr.includes(x)</span><br><span class="line">arr.indexOf(x) &gt;= <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ¤æ–­æ•°å­—ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ï¼š</p>
<blockquote>
<p>åœ¨ES7ä¹‹å‰çš„åšæ³•</p>
</blockquote>
<p>ä½¿ç”¨<code>indexOf()</code>éªŒè¯æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå…ƒç´ ï¼Œè¿™æ—¶éœ€è¦æ ¹æ®è¿”å›å€¼æ˜¯å¦ä¸º-1æ¥åˆ¤æ–­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'react'</span>, <span class="string">'angular'</span>, <span class="string">'vue'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (arr.indexOf(<span class="string">'react'</span>) !== <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'reactå­˜åœ¨'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨ES7çš„includes()</p>
</blockquote>
<p>ä½¿ç”¨includes()éªŒè¯æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå…ƒç´ ï¼Œè¿™æ ·æ›´åŠ ç›´è§‚ç®€å•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'react'</span>, <span class="string">'angular'</span>, <span class="string">'vue'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (arr.includes(<span class="string">'react'</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'reactå­˜åœ¨'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-æŒ‡æ•°æ“ä½œç¬¦"><a href="#2-æŒ‡æ•°æ“ä½œç¬¦" class="headerlink" title="2.æŒ‡æ•°æ“ä½œç¬¦"></a>2.æŒ‡æ•°æ“ä½œç¬¦</h3><p>åœ¨ES7ä¸­å¼•å…¥äº†æŒ‡æ•°è¿ç®—ç¬¦<code>**</code>ï¼Œ<code>**</code>å…·æœ‰ä¸<code>Math.pow(..)</code>ç­‰æ•ˆçš„è®¡ç®—ç»“æœã€‚</p>
<blockquote>
<p>ä¸ä½¿ç”¨æŒ‡æ•°æ“ä½œç¬¦</p>
</blockquote>
<p>ä½¿ç”¨è‡ªå®šä¹‰çš„é€’å½’å‡½æ•°calculateExponentæˆ–è€…Math.pow()è¿›è¡ŒæŒ‡æ•°è¿ç®—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateExponent</span>(<span class="params">base, exponent</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (exponent === <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> base;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> base * calculateExponent(base, exponent - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(calculateExponent(<span class="number">2</span>, <span class="number">10</span>)); <span class="comment">// è¾“å‡º1024</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">10</span>)); <span class="comment">// è¾“å‡º1024</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨æŒ‡æ•°æ“ä½œç¬¦</p>
</blockquote>
<p>ä½¿ç”¨æŒ‡æ•°è¿ç®—ç¬¦**ï¼Œå°±åƒ+ã€-ç­‰æ“ä½œç¬¦ä¸€æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>**<span class="number">10</span>);<span class="comment">// è¾“å‡º1024</span></span><br></pre></td></tr></table></figure>
<h2 id="ES8æ–°ç‰¹æ€§ï¼ˆ2017ï¼‰"><a href="#ES8æ–°ç‰¹æ€§ï¼ˆ2017ï¼‰" class="headerlink" title="ES8æ–°ç‰¹æ€§ï¼ˆ2017ï¼‰"></a>ES8æ–°ç‰¹æ€§ï¼ˆ2017ï¼‰</h2><ul>
<li>async/await</li>
<li><code>Object.values()</code></li>
<li><code>Object.entries()</code></li>
<li>String padding: <code>padStart()</code>å’Œ<code>padEnd()</code>ï¼Œå¡«å……å­—ç¬¦ä¸²è¾¾åˆ°å½“å‰é•¿åº¦</li>
<li>å‡½æ•°å‚æ•°åˆ—è¡¨ç»“å°¾å…è®¸é€—å·</li>
<li><code>Object.getOwnPropertyDescriptors()</code></li>
<li><code>ShareArrayBuffer</code>å’Œ<code>Atomics</code>å¯¹è±¡ï¼Œç”¨äºä»å…±äº«å†…å­˜ä½ç½®è¯»å–å’Œå†™å…¥</li>
</ul>
<h3 id="1-async-await"><a href="#1-async-await" class="headerlink" title="1.async/await"></a>1.async/await</h3><p>ES2018å¼•å…¥å¼‚æ­¥è¿­ä»£å™¨ï¼ˆasynchronous iteratorsï¼‰ï¼Œè¿™å°±åƒå¸¸è§„è¿­ä»£å™¨ï¼Œé™¤äº†<code>next()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªPromiseã€‚å› æ­¤<code>await</code>å¯ä»¥å’Œ<code>for...of</code>å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¸²è¡Œçš„æ–¹å¼è¿è¡Œå¼‚æ­¥æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">    doSomething(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Object-values"><a href="#2-Object-values" class="headerlink" title="2.Object.values()"></a>2.Object.values()</h3><p><code>Object.values()</code>æ˜¯ä¸€ä¸ªä¸<code>Object.keys()</code>ç±»ä¼¼çš„æ–°å‡½æ•°ï¼Œä½†è¿”å›çš„æ˜¯Objectè‡ªèº«å±æ€§çš„æ‰€æœ‰å€¼ï¼Œä¸åŒ…æ‹¬ç»§æ‰¿çš„å€¼ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦éå†å¦‚ä¸‹å¯¹è±¡<code>obj</code>çš„æ‰€æœ‰å€¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ä½¿ç”¨Object.values() :ES7</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vals=<span class="built_in">Object</span>.keys(obj).map(<span class="function"><span class="params">key</span>=&gt;</span>obj[key]);</span><br><span class="line"><span class="built_in">console</span>.log(vals);<span class="comment">//[1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨Object.values() :ES8</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const values=Object.values(obj1);</span><br><span class="line">console.log(values);//[1, 2, 3]</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹å‡º<code>Object.values()</code>ä¸ºæˆ‘ä»¬çœå»äº†éå†keyï¼Œå¹¶æ ¹æ®è¿™äº›keyè·å–valueçš„æ­¥éª¤ã€‚</p>
<h3 id="3-Object-entries"><a href="#3-Object-entries" class="headerlink" title="3.Object.entries()"></a>3.Object.entries()</h3><p><code>Object.entries()</code>å‡½æ•°è¿”å›ä¸€ä¸ªç»™å®šå¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹çš„æ•°ç»„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥éå†ä¸Šæ–‡ä¸­çš„<code>obj</code>å¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„keyå’Œvalueï¼š</p>
<blockquote>
<p>ä¸ä½¿ç”¨Object.entries() :ES7</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="params">key</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'key:'</span>+key+<span class="string">' value:'</span>+obj[key]);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//key:a value:1</span></span><br><span class="line"><span class="comment">//key:b value:2</span></span><br><span class="line"><span class="comment">//key:c value:3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨Object.entries() :ES8</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> [key,value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(obj1))&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`key: <span class="subst">$&#123;key&#125;</span> value:<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//key:a value:1</span></span><br><span class="line"><span class="comment">//key:b value:2</span></span><br><span class="line"><span class="comment">//key:c value:3</span></span><br></pre></td></tr></table></figure>
<h3 id="4-String-padding"><a href="#4-String-padding" class="headerlink" title="4.String padding"></a>4.String padding</h3><p>åœ¨ES8ä¸­Stringæ–°å¢äº†ä¸¤ä¸ªå®ä¾‹å‡½æ•°<code>String.prototype.padStart</code>å’Œ<code>String.prototype.padEnd</code>ï¼Œå…è®¸å°†ç©ºå­—ç¬¦ä¸²æˆ–å…¶ä»–å­—ç¬¦ä¸²æ·»åŠ åˆ°åŸå§‹å­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾ã€‚</p>
<blockquote>
<p>String.padStart(targetLength,[padString])</p>
</blockquote>
<ul>
<li>targetLength:å½“å‰å­—ç¬¦ä¸²éœ€è¦å¡«å……åˆ°çš„ç›®æ ‡é•¿åº¦ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å°äºå½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ™è¿”å›å½“å‰å­—ç¬¦ä¸²æœ¬èº«ã€‚</li>
<li>padString:(å¯é€‰)å¡«å……å­—ç¬¦ä¸²ã€‚å¦‚æœå­—ç¬¦ä¸²å¤ªé•¿ï¼Œä½¿å¡«å……åçš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡äº†ç›®æ ‡é•¿åº¦ï¼Œåˆ™åªä¿ç•™æœ€å·¦ä¾§çš„éƒ¨åˆ†ï¼Œå…¶ä»–éƒ¨åˆ†ä¼šè¢«æˆªæ–­ï¼Œæ­¤å‚æ•°çš„ç¼ºçœå€¼ä¸º â€œ â€œã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'0.0'</span>.padStart(<span class="number">4</span>,<span class="string">'10'</span>)) <span class="comment">//10.0</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'0.0'</span>.padStart(<span class="number">20</span>))<span class="comment">// 0.00</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>String.padEnd(targetLength,padString])</p>
</blockquote>
<ul>
<li>targetLength:å½“å‰å­—ç¬¦ä¸²éœ€è¦å¡«å……åˆ°çš„ç›®æ ‡é•¿åº¦ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼å°äºå½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ™è¿”å›å½“å‰å­—ç¬¦ä¸²æœ¬èº«ã€‚</li>
<li>padString:(å¯é€‰) å¡«å……å­—ç¬¦ä¸²ã€‚å¦‚æœå­—ç¬¦ä¸²å¤ªé•¿ï¼Œä½¿å¡«å……åçš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡äº†ç›®æ ‡é•¿åº¦ï¼Œåˆ™åªä¿ç•™æœ€å·¦ä¾§çš„éƒ¨åˆ†ï¼Œå…¶ä»–éƒ¨åˆ†ä¼šè¢«æˆªæ–­ï¼Œæ­¤å‚æ•°çš„ç¼ºçœå€¼ä¸º â€œ â€œï¼›</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'0.0'</span>.padEnd(<span class="number">4</span>,<span class="string">'0'</span>)) <span class="comment">//0.00    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'0.0'</span>.padEnd(<span class="number">10</span>,<span class="string">'0'</span>))<span class="comment">//0.00000000</span></span><br></pre></td></tr></table></figure>
<h3 id="5-å‡½æ•°å‚æ•°åˆ—è¡¨ç»“å°¾å…è®¸é€—å·"><a href="#5-å‡½æ•°å‚æ•°åˆ—è¡¨ç»“å°¾å…è®¸é€—å·" class="headerlink" title="5.å‡½æ•°å‚æ•°åˆ—è¡¨ç»“å°¾å…è®¸é€—å·"></a>5.å‡½æ•°å‚æ•°åˆ—è¡¨ç»“å°¾å…è®¸é€—å·</h3><p>ä¸»è¦ä½œç”¨æ˜¯æ–¹ä¾¿ä½¿ç”¨gitè¿›è¡Œå¤šäººåä½œå¼€å‘æ—¶ä¿®æ”¹åŒä¸€ä¸ªå‡½æ•°å‡å°‘ä¸å¿…è¦çš„è¡Œå˜æ›´ã€‚</p>
<h3 id="6-Object-getOwnPropertyDescriptors"><a href="#6-Object-getOwnPropertyDescriptors" class="headerlink" title="6.Object.getOwnPropertyDescriptors()"></a>6.Object.getOwnPropertyDescriptors()</h3><p><code>Object.getOwnPropertyDescriptors()</code>å‡½æ•°ç”¨æ¥è·å–ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰è‡ªèº«å±æ€§çš„æè¿°ç¬¦,å¦‚æœæ²¡æœ‰ä»»ä½•è‡ªèº«å±æ€§ï¼Œåˆ™è¿”å›ç©ºå¯¹è±¡ã€‚</p>
<blockquote>
<p>å‡½æ•°åŸå‹ï¼š</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptors(obj)</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>obj</code>å¯¹è±¡çš„æ‰€æœ‰è‡ªèº«å±æ€§çš„æè¿°ç¬¦ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è‡ªèº«å±æ€§ï¼Œåˆ™è¿”å›ç©ºå¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">	name: <span class="string">'Jine'</span>,</span><br><span class="line">	get age() &#123; <span class="keyword">return</span> <span class="string">'18'</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptors(obj2)</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   age: &#123;</span></span><br><span class="line"><span class="comment">//     configurable: true,</span></span><br><span class="line"><span class="comment">//     enumerable: true,</span></span><br><span class="line"><span class="comment">//     get: function age()&#123;&#125;, //the getter function</span></span><br><span class="line"><span class="comment">//     set: undefined</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   name: &#123;</span></span><br><span class="line"><span class="comment">//     configurable: true,</span></span><br><span class="line"><span class="comment">//     enumerable: true,</span></span><br><span class="line"><span class="comment">//		value:"Jine",</span></span><br><span class="line"><span class="comment">//		writable:true</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="7-SharedArrayBufferå¯¹è±¡"><a href="#7-SharedArrayBufferå¯¹è±¡" class="headerlink" title="7.SharedArrayBufferå¯¹è±¡"></a>7.SharedArrayBufferå¯¹è±¡</h3><p>SharedArrayBuffer å¯¹è±¡ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªé€šç”¨çš„ï¼Œå›ºå®šé•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºï¼Œç±»ä¼¼äº ArrayBuffer å¯¹è±¡ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨æ¥åœ¨å…±äº«å†…å­˜ï¼ˆshared memoryï¼‰ä¸Šåˆ›å»ºè§†å›¾ã€‚ä¸ ArrayBuffer ä¸åŒçš„æ˜¯ï¼ŒSharedArrayBuffer ä¸èƒ½è¢«åˆ†ç¦»ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; length æ‰€åˆ›å»ºçš„æ•°ç»„ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥å­—èŠ‚(byte)ä¸ºå•ä½ã€‚  </span></span><br><span class="line"><span class="comment"> * @returns &#123;SharedArrayBuffer&#125; ä¸€ä¸ªå¤§å°æŒ‡å®šçš„æ–° SharedArrayBuffer å¯¹è±¡ã€‚å…¶å†…å®¹è¢«åˆå§‹åŒ–ä¸º 0ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">new</span> SharedArrayBuffer(length)</span><br></pre></td></tr></table></figure>
<h3 id="8-Atomicså¯¹è±¡"><a href="#8-Atomicså¯¹è±¡" class="headerlink" title="8.Atomicså¯¹è±¡"></a>8.Atomicså¯¹è±¡</h3><p>Atomics å¯¹è±¡æä¾›äº†ä¸€ç»„é™æ€æ–¹æ³•ç”¨æ¥å¯¹ SharedArrayBuffer å¯¹è±¡è¿›è¡ŒåŸå­æ“ä½œã€‚</p>
<p>è¿™äº›åŸå­æ“ä½œå±äº Atomics æ¨¡å—ã€‚ä¸ä¸€èˆ¬çš„å…¨å±€å¯¹è±¡ä¸åŒï¼ŒAtomics ä¸æ˜¯æ„é€ å‡½æ•°ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ new æ“ä½œç¬¦è°ƒç”¨ï¼Œä¹Ÿä¸èƒ½å°†å…¶å½“ä½œå‡½æ•°ç›´æ¥è°ƒç”¨ã€‚Atomics çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼ˆä¸ Math  å¯¹è±¡ä¸€æ ·ï¼‰ã€‚</p>
<p>å¤šä¸ªå…±äº«å†…å­˜çš„çº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¯»å†™åŒä¸€ä½ç½®ä¸Šçš„æ•°æ®ã€‚åŸå­æ“ä½œä¼šç¡®ä¿æ­£åœ¨è¯»æˆ–å†™çš„æ•°æ®çš„å€¼æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå³ä¸‹ä¸€ä¸ªåŸå­æ“ä½œä¸€å®šä¼šåœ¨ä¸Šä¸€ä¸ªåŸå­æ“ä½œç»“æŸåæ‰ä¼šå¼€å§‹ï¼Œå…¶æ“ä½œè¿‡ç¨‹ä¸ä¼šä¸­æ–­ã€‚</p>
<ul>
<li>Atomics.add()</li>
</ul>
<blockquote>
<p>å°†æŒ‡å®šä½ç½®ä¸Šçš„æ•°ç»„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸åŠ ï¼Œå¹¶è¿”å›ç›¸åŠ å‰è¯¥å…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.and()</li>
</ul>
<blockquote>
<p>å°†æŒ‡å®šä½ç½®ä¸Šçš„æ•°ç»„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸ä¸ï¼Œå¹¶è¿”å›ä¸æ“ä½œå‰è¯¥å…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.compareExchange()</li>
</ul>
<blockquote>
<p>å¦‚æœæ•°ç»„ä¸­æŒ‡å®šçš„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸ç­‰ï¼Œåˆ™å°†å…¶æ›´æ–°ä¸ºæ–°çš„å€¼ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ åŸå…ˆçš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.exchange()</li>
</ul>
<blockquote>
<p>å°†æ•°ç»„ä¸­æŒ‡å®šçš„å…ƒç´ æ›´æ–°ä¸ºç»™å®šçš„å€¼ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ æ›´æ–°å‰çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.load()</li>
</ul>
<blockquote>
<p>è¿”å›æ•°ç»„ä¸­æŒ‡å®šå…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.or()</li>
</ul>
<blockquote>
<p>å°†æŒ‡å®šä½ç½®ä¸Šçš„æ•°ç»„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸æˆ–ï¼Œå¹¶è¿”å›æˆ–æ“ä½œå‰è¯¥å…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.store()</li>
</ul>
<blockquote>
<p>å°†æ•°ç»„ä¸­æŒ‡å®šçš„å…ƒç´ è®¾ç½®ä¸ºç»™å®šçš„å€¼ï¼Œå¹¶è¿”å›è¯¥å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.sub()</li>
</ul>
<blockquote>
<p>å°†æŒ‡å®šä½ç½®ä¸Šçš„æ•°ç»„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸å‡ï¼Œå¹¶è¿”å›ç›¸å‡å‰è¯¥å…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<ul>
<li>Atomics.xor()</li>
</ul>
<blockquote>
<p>å°†æŒ‡å®šä½ç½®ä¸Šçš„æ•°ç»„å…ƒç´ ä¸ç»™å®šçš„å€¼ç›¸å¼‚æˆ–ï¼Œå¹¶è¿”å›å¼‚æˆ–æ“ä½œå‰è¯¥å…ƒç´ çš„å€¼ã€‚</p>
</blockquote>
<p>wait() å’Œ wake() æ–¹æ³•é‡‡ç”¨çš„æ˜¯ Linux ä¸Šçš„ futexes æ¨¡å‹ï¼ˆfast user-space mutexï¼Œå¿«é€Ÿç”¨æˆ·ç©ºé—´äº’æ–¥é‡ï¼‰ï¼Œå¯ä»¥è®©è¿›ç¨‹ä¸€ç›´ç­‰å¾…ç›´åˆ°æŸä¸ªç‰¹å®šçš„æ¡ä»¶ä¸ºçœŸï¼Œä¸»è¦ç”¨äºå®ç°é˜»å¡ã€‚</p>
<ul>
<li>Atomics.wait()</li>
</ul>
<blockquote>
<p>æ£€æµ‹æ•°ç»„ä¸­æŸä¸ªæŒ‡å®šä½ç½®ä¸Šçš„å€¼æ˜¯å¦ä»ç„¶æ˜¯ç»™å®šå€¼ï¼Œæ˜¯åˆ™ä¿æŒæŒ‚èµ·ç›´åˆ°è¢«å”¤é†’æˆ–è¶…æ—¶ã€‚è¿”å›å€¼ä¸º â€œokâ€ã€â€not-equalâ€ æˆ– â€œtime-outâ€ã€‚è°ƒç”¨æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸å…è®¸é˜»å¡ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆå¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¸å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ wait()ï¼‰ã€‚</p>
</blockquote>
<ul>
<li>Atomics.wake()</li>
</ul>
<blockquote>
<p>å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­æ­£åœ¨æ•°ç»„æŒ‡å®šä½ç½®çš„å…ƒç´ ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚è¿”å›å€¼ä¸ºæˆåŠŸå”¤é†’çš„çº¿ç¨‹æ•°é‡ã€‚</p>
</blockquote>
<ul>
<li>Atomics.isLockFree(size)</li>
</ul>
<blockquote>
<p>å¯ä»¥ç”¨æ¥æ£€æµ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æ”¯æŒç¡¬ä»¶çº§çš„åŸå­æ“ä½œã€‚å¯¹äºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿæ”¯æŒç¡¬ä»¶çº§çš„åŸå­æ“ä½œï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™å°±æ„å‘³ç€å¯¹äºè¯¥æ•°ç»„ï¼ŒAtomics å¯¹è±¡ä¸­çš„å„åŸå­æ“ä½œéƒ½åªèƒ½ç”¨é”æ¥å®ç°ã€‚æ­¤å‡½æ•°é¢å‘çš„æ˜¯æŠ€æœ¯ä¸“å®¶ã€‚â€“&gt;</p>
</blockquote>
<h2 id="ES9æ–°ç‰¹æ€§ï¼ˆ2018ï¼‰"><a href="#ES9æ–°ç‰¹æ€§ï¼ˆ2018ï¼‰" class="headerlink" title="ES9æ–°ç‰¹æ€§ï¼ˆ2018ï¼‰"></a>ES9æ–°ç‰¹æ€§ï¼ˆ2018ï¼‰</h2><ul>
<li>å¼‚æ­¥è¿­ä»£</li>
<li>Promise.finally()</li>
<li>Rest/Spread å±æ€§</li>
<li><a href="https://link.juejin.im?target=http%3A%2F%2Fesnext.justjavac.com%2Fproposal%2Fregexp-named-groups.html" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„</a>ï¼ˆRegular Expression Named Capture Groupsï¼‰</li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000006824133" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€</a>ï¼ˆlookbehindï¼‰</li>
<li>æ­£åˆ™è¡¨è¾¾å¼dotAllæ¨¡å¼</li>
<li><a href="https://juejin.im/post/5b2a186cf265da596d04a648#heading-1" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰</a></li>
<li><a href="https://juejin.im/post/5b2a186cf265da596d04a648#heading-1" target="_blank" rel="noopener">éè½¬ä¹‰åºåˆ—çš„æ¨¡æ¿å­—ç¬¦ä¸²</a></li>
</ul>
<h3 id="1-å¼‚æ­¥è¿­ä»£"><a href="#1-å¼‚æ­¥è¿­ä»£" class="headerlink" title="1.å¼‚æ­¥è¿­ä»£"></a>1.å¼‚æ­¥è¿­ä»£</h3><p>åœ¨<code>async/await</code>çš„æŸäº›æ—¶åˆ»ï¼Œä½ å¯èƒ½å°è¯•åœ¨åŒæ­¥å¾ªç¯ä¸­è°ƒç”¨å¼‚æ­¥å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">    <span class="keyword">await</span> doSomething(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¸ä¼šæ­£å¸¸è¿è¡Œï¼Œä¸‹é¢è¿™æ®µåŒæ ·ä¹Ÿä¸ä¼šï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  array.forEach(<span class="keyword">async</span> i =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> doSomething(i);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¸­ï¼Œå¾ªç¯æœ¬èº«ä¾æ—§ä¿æŒåŒæ­¥ï¼Œå¹¶åœ¨åœ¨å†…éƒ¨å¼‚æ­¥å‡½æ•°ä¹‹å‰å…¨éƒ¨è°ƒç”¨å®Œæˆã€‚</p>
<p>ES2018å¼•å…¥å¼‚æ­¥è¿­ä»£å™¨ï¼ˆasynchronous iteratorsï¼‰ï¼Œè¿™å°±åƒå¸¸è§„è¿­ä»£å™¨ï¼Œé™¤äº†<code>next()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªPromiseã€‚å› æ­¤<code>await</code>å¯ä»¥å’Œ<code>for...of</code>å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¸²è¡Œçš„æ–¹å¼è¿è¡Œå¼‚æ­¥æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">    doSomething(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Promise-finally"><a href="#2-Promise-finally" class="headerlink" title="2.Promise.finally()"></a>2.Promise.finally()</h3><p>ä¸€ä¸ªPromiseè°ƒç”¨é“¾è¦ä¹ˆæˆåŠŸåˆ°è¾¾æœ€åä¸€ä¸ª<code>.then()</code>ï¼Œè¦ä¹ˆå¤±è´¥è§¦å‘<code>.catch()</code>ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ æƒ³è¦åœ¨æ— è®ºPromiseè¿è¡ŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿è¡Œç›¸åŒçš„ä»£ç ï¼Œä¾‹å¦‚æ¸…é™¤ï¼Œåˆ é™¤å¯¹è¯ï¼Œå…³é—­æ•°æ®åº“è¿æ¥ç­‰ã€‚</p>
<p><code>.finally()</code>å…è®¸ä½ æŒ‡å®šæœ€ç»ˆçš„é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  doSomething1()</span><br><span class="line">  .then(doSomething2)</span><br><span class="line">  .then(doSomething3)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br><span class="line">  .finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// finish here!</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Rest-Spread-å±æ€§"><a href="#3-Rest-Spread-å±æ€§" class="headerlink" title="3.Rest/Spread å±æ€§"></a>3.Rest/Spread å±æ€§</h3><p>ES2015å¼•å…¥äº†<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FFunctions%2FRest_parameters" target="_blank" rel="noopener">Restå‚æ•°</a>å’Œ<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FSpread_syntax" target="_blank" rel="noopener">æ‰©å±•è¿ç®—ç¬¦</a>ã€‚ä¸‰ä¸ªç‚¹ï¼ˆâ€¦ï¼‰ä»…ç”¨äºæ•°ç»„ã€‚Restå‚æ•°è¯­æ³•å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªä¸å®šæ•°é‡çš„å‚æ•°è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">restParam(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restParam</span>(<span class="params">p1, p2, ...p3</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// p1 = 1</span></span><br><span class="line">  <span class="comment">// p2 = 2</span></span><br><span class="line">  <span class="comment">// p3 = [3, 4, 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å±•å¼€æ“ä½œç¬¦ä»¥ç›¸åçš„æ–¹å¼å·¥ä½œï¼Œå°†æ•°ç»„è½¬æ¢æˆå¯ä¼ é€’ç»™å‡½æ•°çš„å•ç‹¬å‚æ•°ã€‚ä¾‹å¦‚<code>Math.max()</code>è¿”å›ç»™å®šæ•°å­—ä¸­çš„æœ€å¤§å€¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> values = [<span class="number">99</span>, <span class="number">100</span>, <span class="number">-1</span>, <span class="number">48</span>, <span class="number">16</span>];</span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">Math</span>.max(...values) ); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
<p>ES2018ä¸ºå¯¹è±¡è§£æ„æä¾›äº†å’Œæ•°ç»„ä¸€æ ·çš„Restå‚æ•°ï¼ˆï¼‰å’Œå±•å¼€æ“ä½œç¬¦ï¼Œä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myObject = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; a, ...x &#125; = myObject;</span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// x = &#123; b: 2, c: 3 &#125;</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨å®ƒç»™å‡½æ•°ä¼ é€’å‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">restParam(&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">3</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restParam</span>(<span class="params">&#123; a, ...x &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// a = 1</span></span><br><span class="line">  <span class="comment">// x = &#123; b: 2, c: 3 &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·Ÿæ•°ç»„ä¸€æ ·ï¼ŒRestå‚æ•°åªèƒ½åœ¨å£°æ˜çš„ç»“å°¾å¤„ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œå®ƒåªé€‚ç”¨äºæ¯ä¸ªå¯¹è±¡çš„é¡¶å±‚ï¼Œå¦‚æœå¯¹è±¡ä¸­åµŒå¥—å¯¹è±¡åˆ™æ— æ³•é€‚ç”¨ã€‚</p>
<p>æ‰©å±•è¿ç®—ç¬¦å¯ä»¥åœ¨å…¶ä»–å¯¹è±¡å†…ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; ...obj1, <span class="attr">z</span>: <span class="number">26</span> &#125;;</span><br><span class="line"><span class="comment">// obj2 is &#123; a: 1, b: 2, c: 3, z: 26 &#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼Œåƒæ˜¯è¿™æ ·<code>obj2 = {...obj1}</code>ï¼Œä½†æ˜¯ <strong>è¿™åªæ˜¯ä¸€ä¸ªå¯¹è±¡çš„æµ…æ‹·è´</strong>ã€‚å¦å¤–ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡Açš„å±æ€§æ˜¯å¯¹è±¡Bï¼Œé‚£ä¹ˆåœ¨å…‹éš†åçš„å¯¹è±¡cloneBä¸­ï¼Œè¯¥å±æ€§æŒ‡å‘å¯¹è±¡Bã€‚</p>
<h3 id="4-æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„"><a href="#4-æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„" class="headerlink" title="4.æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„"></a>4.æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„</h3><p>JavaScriptæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è¿”å›ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡â€”â€”ä¸€ä¸ªåŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„ç±»æ•°ç»„ï¼Œä¾‹å¦‚ï¼šä»¥<code>YYYY-MM-DD</code>çš„æ ¼å¼è§£ææ—¥æœŸï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reDate = <span class="regexp">/([0-9]&#123;4&#125;)-([0-9]&#123;2&#125;)-([0-9]&#123;2&#125;)/</span>,</span><br><span class="line">  match  = reDate.exec(<span class="string">'2018-04-30'</span>),</span><br><span class="line">  year   = match[<span class="number">1</span>], <span class="comment">// 2018</span></span><br><span class="line">  month  = match[<span class="number">2</span>], <span class="comment">// 04</span></span><br><span class="line">  day    = match[<span class="number">3</span>]; <span class="comment">// 30</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„ä»£ç å¾ˆéš¾è¯»æ‡‚ï¼Œå¹¶ä¸”æ”¹å˜æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æ„æœ‰å¯èƒ½æ”¹å˜åŒ¹é…å¯¹è±¡çš„ç´¢å¼•ã€‚</p>
<p>ES2018å…è®¸å‘½åæ•è·ç»„ä½¿ç”¨ç¬¦å·<code>?&lt;name&gt;</code>ï¼Œåœ¨æ‰“å¼€æ•è·æ‹¬å·<code>(</code>åç«‹å³å‘½åï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reDate = <span class="regexp">/(?&lt;year&gt;[0-9]&#123;4&#125;)-(?&lt;month&gt;[0-9]&#123;2&#125;)-(?&lt;day&gt;[0-9]&#123;2&#125;)/</span>,</span><br><span class="line">  match  = reDate.exec(<span class="string">'2018-04-30'</span>),</span><br><span class="line">  year   = match.groups.year,  <span class="comment">// 2018</span></span><br><span class="line">  month  = match.groups.month, <span class="comment">// 04</span></span><br><span class="line">  day    = match.groups.day;   <span class="comment">// 30</span></span><br></pre></td></tr></table></figure>
<p>ä»»ä½•åŒ¹é…å¤±è´¥çš„å‘½åç»„éƒ½å°†è¿”å›<code>undefined</code>ã€‚</p>
<p>å‘½åæ•è·ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨<code>replace()</code>æ–¹æ³•ä¸­ã€‚ä¾‹å¦‚å°†æ—¥æœŸè½¬æ¢ä¸ºç¾å›½çš„ MM-DD-YYYY æ ¼å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reDate = <span class="regexp">/(?&lt;year&gt;[0-9]&#123;4&#125;)-(?&lt;month&gt;[0-9]&#123;2&#125;)-(?&lt;day&gt;[0-9]&#123;2&#125;)/</span>,</span><br><span class="line">  d      = <span class="string">'2018-04-30'</span>,</span><br><span class="line">  usDate = d.replace(reDate, <span class="string">'$&lt;month&gt;-$&lt;day&gt;-$&lt;year&gt;'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="5-æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€"><a href="#5-æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€" class="headerlink" title="5.æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€"></a>5.æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€</h3><p>ç›®å‰JavaScriptåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ”¯æŒå…ˆè¡Œæ–­è¨€ï¼ˆlookaheadï¼‰ã€‚è¿™æ„å‘³ç€åŒ¹é…ä¼šå‘ç”Ÿï¼Œä½†ä¸ä¼šæœ‰ä»»ä½•æ•è·ï¼Œå¹¶ä¸”æ–­è¨€æ²¡æœ‰åŒ…å«åœ¨æ•´ä¸ªåŒ¹é…å­—æ®µä¸­ã€‚ä¾‹å¦‚ä»ä»·æ ¼ä¸­æ•è·è´§å¸ç¬¦å·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reLookahead = <span class="regexp">/\D(?=\d+)/</span>,</span><br><span class="line">  match       = reLookahead.exec(<span class="string">'$123.89'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( match[<span class="number">0</span>] ); <span class="comment">// $</span></span><br></pre></td></tr></table></figure>
<p>ES2018å¼•å…¥ä»¥ç›¸åŒæ–¹å¼å·¥ä½œä½†æ˜¯åŒ¹é…å‰é¢çš„åå‘æ–­è¨€ï¼ˆlookbehindï¼‰ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥å¿½ç•¥è´§å¸ç¬¦å·ï¼Œå•çº¯çš„æ•è·ä»·æ ¼çš„æ•°å­—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reLookbehind = <span class="regexp">/(?&lt;=\D)\d+/</span>,</span><br><span class="line">  match        = reLookbehind.exec(<span class="string">'$123.89'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( match[<span class="number">0</span>] ); <span class="comment">// 123.89</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯ <strong>è‚¯å®šåå‘æ–­è¨€</strong>ï¼Œéæ•°å­—<code>\D</code>å¿…é¡»å­˜åœ¨ã€‚åŒæ ·çš„ï¼Œè¿˜å­˜åœ¨ <strong>å¦å®šåå‘æ–­è¨€</strong>ï¼Œè¡¨ç¤ºä¸€ä¸ªå€¼å¿…é¡»ä¸å­˜åœ¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span></span><br><span class="line">  reLookbehindNeg = <span class="regexp">/(?&lt;!\D)\d+/</span>,</span><br><span class="line">  match           = reLookbehind.exec(<span class="string">'$123.89'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( match[<span class="number">0</span>] ); <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<h3 id="6-æ­£åˆ™è¡¨è¾¾å¼dotAllæ¨¡å¼"><a href="#6-æ­£åˆ™è¡¨è¾¾å¼dotAllæ¨¡å¼" class="headerlink" title="6.æ­£åˆ™è¡¨è¾¾å¼dotAllæ¨¡å¼"></a>6.æ­£åˆ™è¡¨è¾¾å¼dotAllæ¨¡å¼</h3><p>æ­£åˆ™è¡¨è¾¾å¼ä¸­ç‚¹<code>.</code>åŒ¹é…é™¤å›è½¦å¤–çš„ä»»ä½•å•å­—ç¬¦ï¼Œæ ‡è®°<code>s</code>æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå…è®¸è¡Œç»ˆæ­¢ç¬¦çš„å‡ºç°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">/hello.world/.test(<span class="string">'hello\nworld'</span>);  <span class="comment">// false</span></span><br><span class="line">/hello.world/s.test(<span class="string">'hello\nworld'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-æ­£åˆ™è¡¨è¾¾å¼-Unicode-è½¬ä¹‰"><a href="#7-æ­£åˆ™è¡¨è¾¾å¼-Unicode-è½¬ä¹‰" class="headerlink" title="7.æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰"></a>7.æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ¬åœ°è®¿é—® Unicode å­—ç¬¦å±æ€§æ˜¯ä¸è¢«å…è®¸çš„ã€‚ES2018æ·»åŠ äº† Unicode å±æ€§è½¬ä¹‰â€”â€”å½¢å¼ä¸º<code>\p{...}</code>å’Œ<code>\P{...}</code>ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ ‡è®° <code>u</code> (unicode) è®¾ç½®ï¼Œåœ¨<code>\p</code>å—å„¿å†…ï¼Œå¯ä»¥ä»¥é”®å€¼å¯¹çš„æ–¹å¼è®¾ç½®éœ€è¦åŒ¹é…çš„å±æ€§è€Œéå…·ä½“å†…å®¹ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reGreekSymbol = <span class="regexp">/\p&#123;Script=Greek&#125;/u</span>;</span><br><span class="line">reGreekSymbol.test(<span class="string">'Ï€'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>æ­¤ç‰¹æ€§å¯ä»¥é¿å…ä½¿ç”¨ç‰¹å®š Unicode åŒºé—´æ¥è¿›è¡Œå†…å®¹ç±»å‹åˆ¤æ–­ï¼Œæå‡å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="8-éè½¬ä¹‰åºåˆ—çš„æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#8-éè½¬ä¹‰åºåˆ—çš„æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="8.éè½¬ä¹‰åºåˆ—çš„æ¨¡æ¿å­—ç¬¦ä¸²"></a>8.éè½¬ä¹‰åºåˆ—çš„æ¨¡æ¿å­—ç¬¦ä¸²</h3><p>ä¹‹å‰ï¼Œ<code>\u</code>å¼€å§‹ä¸€ä¸ª unicode è½¬ä¹‰ï¼Œ<code>\x</code>å¼€å§‹ä¸€ä¸ªåå…­è¿›åˆ¶è½¬ä¹‰ï¼Œ<code>\</code>åè·Ÿä¸€ä¸ªæ•°å­—å¼€å§‹ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ã€‚è¿™ä½¿å¾—åˆ›å»ºç‰¹å®šçš„å­—ç¬¦ä¸²å˜å¾—ä¸å¯èƒ½ï¼Œä¾‹å¦‚Windowsæ–‡ä»¶è·¯å¾„ <code>C:\uuu\xxx\111</code>ã€‚æ›´å¤šç»†èŠ‚å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2Ftemplate_strings" target="_blank" rel="noopener">æ¨¡æ¿å­—ç¬¦ä¸²</a>ã€‚</p>
<h2 id="ES10æ–°ç‰¹æ€§ï¼ˆ2019ï¼‰"><a href="#ES10æ–°ç‰¹æ€§ï¼ˆ2019ï¼‰" class="headerlink" title="ES10æ–°ç‰¹æ€§ï¼ˆ2019ï¼‰"></a>ES10æ–°ç‰¹æ€§ï¼ˆ2019ï¼‰</h2><ul>
<li>è¡Œåˆ†éš”ç¬¦ï¼ˆU + 2028ï¼‰å’Œæ®µåˆ†éš”ç¬¦ï¼ˆU + 2029ï¼‰ç¬¦å·ç°åœ¨å…è®¸åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­ï¼Œä¸JSONåŒ¹é…</li>
<li>æ›´åŠ å‹å¥½çš„ JSON.stringify</li>
<li>æ–°å¢äº†Arrayçš„<code>flat()</code>æ–¹æ³•å’Œ<code>flatMap()</code>æ–¹æ³•</li>
<li>æ–°å¢äº†Stringçš„<code>trimStart()</code>æ–¹æ³•å’Œ<code>trimEnd()</code>æ–¹æ³•</li>
<li><code>Object.fromEntries()</code></li>
<li><code>Symbol.prototype.description</code></li>
<li><code>String.prototype.matchAll</code></li>
<li><code>Function.prototype.toString()</code>ç°åœ¨è¿”å›ç²¾ç¡®å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œæ³¨é‡Š</li>
<li>ç®€åŒ–<code>try {} catch {}</code>,ä¿®æ”¹ <code>catch</code> ç»‘å®š</li>
<li>æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹<code>BigInt</code></li>
<li>globalThis</li>
<li>import()</li>
<li>Legacy RegEx</li>
<li>ç§æœ‰çš„å®ä¾‹æ–¹æ³•å’Œè®¿é—®å™¨</li>
</ul>
<h3 id="1-è¡Œåˆ†éš”ç¬¦ï¼ˆU-2028ï¼‰å’Œæ®µåˆ†éš”ç¬¦ï¼ˆU-2029ï¼‰ç¬¦å·ç°åœ¨å…è®¸åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­ï¼Œä¸JSONåŒ¹é…"><a href="#1-è¡Œåˆ†éš”ç¬¦ï¼ˆU-2028ï¼‰å’Œæ®µåˆ†éš”ç¬¦ï¼ˆU-2029ï¼‰ç¬¦å·ç°åœ¨å…è®¸åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­ï¼Œä¸JSONåŒ¹é…" class="headerlink" title="1.è¡Œåˆ†éš”ç¬¦ï¼ˆU + 2028ï¼‰å’Œæ®µåˆ†éš”ç¬¦ï¼ˆU + 2029ï¼‰ç¬¦å·ç°åœ¨å…è®¸åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­ï¼Œä¸JSONåŒ¹é…"></a>1.è¡Œåˆ†éš”ç¬¦ï¼ˆU + 2028ï¼‰å’Œæ®µåˆ†éš”ç¬¦ï¼ˆU + 2029ï¼‰ç¬¦å·ç°åœ¨å…è®¸åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­ï¼Œä¸JSONåŒ¹é…</h3><p>ä»¥å‰ï¼Œè¿™äº›ç¬¦å·åœ¨å­—ç¬¦ä¸²æ–‡å­—ä¸­è¢«è§†ä¸ºè¡Œç»ˆæ­¢ç¬¦ï¼Œå› æ­¤ä½¿ç”¨å®ƒä»¬ä¼šå¯¼è‡´SyntaxErrorå¼‚å¸¸ã€‚</p>
<h3 id="2-æ›´åŠ å‹å¥½çš„-JSON-stringify"><a href="#2-æ›´åŠ å‹å¥½çš„-JSON-stringify" class="headerlink" title="2.æ›´åŠ å‹å¥½çš„ JSON.stringify"></a>2.æ›´åŠ å‹å¥½çš„ JSON.stringify</h3><p>å¦‚æœè¾“å…¥ Unicode æ ¼å¼ä½†æ˜¯è¶…å‡ºèŒƒå›´çš„å­—ç¬¦ï¼Œåœ¨åŸå…ˆJSON.stringifyè¿”å›æ ¼å¼é”™è¯¯çš„Unicodeå­—ç¬¦ä¸²ã€‚ç°åœ¨å®ç°äº†ä¸€ä¸ªæ”¹å˜JSON.stringifyçš„<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposal-well-formed-stringify" target="_blank" rel="noopener">ç¬¬3é˜¶æ®µææ¡ˆ</a>ï¼Œå› æ­¤å®ƒä¸ºå…¶è¾“å‡ºè½¬ä¹‰åºåˆ—ï¼Œä½¿å…¶æˆä¸ºæœ‰æ•ˆUnicodeï¼ˆå¹¶ä»¥UTF-8è¡¨ç¤ºï¼‰</p>
<h3 id="3-æ–°å¢äº†Arrayçš„flat-æ–¹æ³•å’ŒflatMap-æ–¹æ³•"><a href="#3-æ–°å¢äº†Arrayçš„flat-æ–¹æ³•å’ŒflatMap-æ–¹æ³•" class="headerlink" title="3.æ–°å¢äº†Arrayçš„flat()æ–¹æ³•å’ŒflatMap()æ–¹æ³•"></a>3.æ–°å¢äº†Arrayçš„<code>flat()</code>æ–¹æ³•å’Œ<code>flatMap()</code>æ–¹æ³•</h3><p><code>flat()</code>å’Œ<code>flatMap()</code>æœ¬è´¨ä¸Šå°±æ˜¯æ˜¯å½’çº³ï¼ˆreduceï¼‰ ä¸ åˆå¹¶ï¼ˆconcatï¼‰çš„æ“ä½œã€‚</p>
<h4 id="Array-prototype-flat"><a href="#Array-prototype-flat" class="headerlink" title="Array.prototype.flat()"></a>Array.prototype.flat()</h4><p><code>flat()</code> æ–¹æ³•ä¼šæŒ‰ç…§ä¸€ä¸ªå¯æŒ‡å®šçš„æ·±åº¦é€’å½’éå†æ•°ç»„ï¼Œå¹¶å°†æ‰€æœ‰å…ƒç´ ä¸éå†åˆ°çš„å­æ•°ç»„ä¸­çš„å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚</p>
<ul>
<li><code>flat()</code>æ–¹æ³•æœ€åŸºæœ¬çš„ä½œç”¨å°±æ˜¯æ•°ç»„é™ç»´</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]];</span><br><span class="line">arr1.flat(); </span><br><span class="line"><span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]];</span><br><span class="line">arr2.flat();</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, [5, 6]]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr3 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]];</span><br><span class="line">arr3.flat(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨ Infinity ä½œä¸ºæ·±åº¦ï¼Œå±•å¼€ä»»æ„æ·±åº¦çš„åµŒå¥—æ•°ç»„</span></span><br><span class="line">arr3.flat(<span class="literal">Infinity</span>); </span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶æ¬¡ï¼Œè¿˜å¯ä»¥åˆ©ç”¨<code>flat()</code>æ–¹æ³•çš„ç‰¹æ€§æ¥å»é™¤æ•°ç»„çš„ç©ºé¡¹</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr4 = [<span class="number">1</span>, <span class="number">2</span>, , <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr4.flat();</span><br><span class="line"><span class="comment">// [1, 2, 4, 5]</span></span><br></pre></td></tr></table></figure>
<h4 id="Array-prototype-flatMap"><a href="#Array-prototype-flatMap" class="headerlink" title="Array.prototype.flatMap()"></a>Array.prototype.flatMap()</h4><p><code>flatMap()</code> æ–¹æ³•é¦–å…ˆä½¿ç”¨æ˜ å°„å‡½æ•°æ˜ å°„æ¯ä¸ªå…ƒç´ ï¼Œç„¶åå°†ç»“æœå‹ç¼©æˆä¸€ä¸ªæ–°æ•°ç»„ã€‚å®ƒä¸ map å’Œ æ·±åº¦å€¼1çš„ flat å‡ ä¹ç›¸åŒï¼Œä½† flatMap é€šå¸¸åœ¨åˆå¹¶æˆä¸€ç§æ–¹æ³•çš„æ•ˆç‡ç¨å¾®é«˜ä¸€äº›ã€‚ è¿™é‡Œæˆ‘ä»¬æ‹¿mapæ–¹æ³•ä¸flatMapæ–¹æ³•åšä¸€ä¸ªæ¯”è¾ƒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">arr1.map(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]); </span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br><span class="line"></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åªä¼šå°† flatMap ä¸­çš„å‡½æ•°è¿”å›çš„æ•°ç»„ â€œå‹å¹³â€ ä¸€å±‚</span></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [[x * <span class="number">2</span>]]);</span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br></pre></td></tr></table></figure>
<h3 id="4-æ–°å¢äº†Stringçš„trimStart-æ–¹æ³•å’ŒtrimEnd-æ–¹æ³•"><a href="#4-æ–°å¢äº†Stringçš„trimStart-æ–¹æ³•å’ŒtrimEnd-æ–¹æ³•" class="headerlink" title="4.æ–°å¢äº†Stringçš„trimStart()æ–¹æ³•å’ŒtrimEnd()æ–¹æ³•"></a>4.æ–°å¢äº†Stringçš„<code>trimStart()</code>æ–¹æ³•å’Œ<code>trimEnd()</code>æ–¹æ³•</h3><p>æ–°å¢çš„è¿™ä¸¤ä¸ªæ–¹æ³•å¾ˆå¥½ç†è§£ï¼Œåˆ†åˆ«å»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½å­—ç¬¦ï¼Œè¿™é‡Œå°±ä¸ç”¨ä¾‹å­è¯´å£°æ˜äº†ã€‚</p>
<h3 id="5-Object-fromEntries"><a href="#5-Object-fromEntries" class="headerlink" title="5.Object.fromEntries()"></a>5.<code>Object.fromEntries()</code></h3><p><code>Object.entries()</code>æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªç»™å®šå¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹æ•°ç»„ï¼Œå…¶æ’åˆ—ä¸ä½¿ç”¨ forâ€¦in å¾ªç¯éå†è¯¥å¯¹è±¡æ—¶è¿”å›çš„é¡ºåºä¸€è‡´ï¼ˆåŒºåˆ«åœ¨äº for-in å¾ªç¯ä¹Ÿæšä¸¾åŸå‹é“¾ä¸­çš„å±æ€§ï¼‰ã€‚</p>
<p><strong>è€ŒObject.fromEntries() åˆ™æ˜¯ Object.entries() çš„åè½¬ã€‚</strong></p>
<p><code>Object.fromEntries()</code> å‡½æ•°ä¼ å…¥ä¸€ä¸ªé”®å€¼å¯¹çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸¦æœ‰è¿™äº›é”®å€¼å¯¹çš„æ–°å¯¹è±¡ã€‚è¿™ä¸ªè¿­ä»£å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå®ç°@iteratoræ–¹æ³•çš„çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚å®ƒç”Ÿæˆä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå…ƒç´ çš„ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å°†ç”¨ä½œå±æ€§é”®çš„å€¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸è¯¥å±æ€§é”®å…³è”çš„å€¼ã€‚</p>
<ul>
<li>é€šè¿‡ Object.fromEntriesï¼Œ å¯ä»¥å°† Map è½¬åŒ–ä¸º Object:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([ [<span class="string">'foo'</span>, <span class="string">'bar'</span>], [<span class="string">'baz'</span>, <span class="number">42</span>] ]);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.fromEntries(map);</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// &#123; foo: "bar", baz: 42 &#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ Object.fromEntriesï¼Œ å¯ä»¥å°† Array è½¬åŒ–ä¸º Object:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [ [<span class="string">'0'</span>, <span class="string">'a'</span>], [<span class="string">'1'</span>, <span class="string">'b'</span>], [<span class="string">'2'</span>, <span class="string">'c'</span>] ];</span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.fromEntries(arr);</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// &#123; 0: "a", 1: "b", 2: "c" &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-Symbol-prototype-description"><a href="#6-Symbol-prototype-description" class="headerlink" title="6.Symbol.prototype.description"></a>6.<code>Symbol.prototype.description</code></h3><p>é€šè¿‡å·¥å‚å‡½æ•°Symbolï¼ˆï¼‰åˆ›å»ºç¬¦å·æ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©é€šè¿‡å‚æ•°æä¾›å­—ç¬¦ä¸²ä½œä¸ºæè¿°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sym = <span class="built_in">Symbol</span>(<span class="string">'The description'</span>);</span><br></pre></td></tr></table></figure>
<p>ä»¥å‰ï¼Œè®¿é—®æè¿°çš„å”¯ä¸€æ–¹æ³•æ˜¯å°†ç¬¦å·è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">assert.equal(<span class="built_in">String</span>(sym), <span class="string">'Symbol(The description)'</span>);</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¼•å…¥äº†getter Symbol.prototype.descriptionä»¥ç›´æ¥è®¿é—®æè¿°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">assert.equal(sym.description, <span class="string">'The description'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="7-String-prototype-matchAll"><a href="#7-String-prototype-matchAll" class="headerlink" title="7.String.prototype.matchAll"></a>7.<code>String.prototype.matchAll</code></h3><p><code>matchAll()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼åŠåˆ†ç»„æ•è·ç»“æœçš„è¿­ä»£å™¨ã€‚ åœ¨ matchAll å‡ºç°ä¹‹å‰ï¼Œé€šè¿‡åœ¨å¾ªç¯ä¸­è°ƒç”¨regexp.execæ¥è·å–æ‰€æœ‰åŒ¹é…é¡¹ä¿¡æ¯ï¼ˆregexpéœ€ä½¿ç”¨/gæ ‡å¿—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="built_in">RegExp</span>(<span class="string">'foo*'</span>,<span class="string">'g'</span>);</span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'table football, foosball'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((matches = regexp.exec(str)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Found <span class="subst">$&#123;matches[<span class="number">0</span>]&#125;</span>. Next starts at <span class="subst">$&#123;regexp.lastIndex&#125;</span>.`</span>);</span><br><span class="line">  <span class="comment">// expected output: "Found foo. Next starts at 9."</span></span><br><span class="line">  <span class="comment">// expected output: "Found foo. Next starts at 19."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨matchAll ï¼Œå°±å¯ä»¥ä¸å¿…ä½¿ç”¨whileå¾ªç¯åŠ execæ–¹å¼ï¼ˆä¸”æ­£åˆ™è¡¨è¾¾å¼éœ€ä½¿ç”¨ï¼gæ ‡å¿—ï¼‰ã€‚ä½¿ç”¨matchAll ä¼šå¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨çš„è¿”å›å€¼ï¼Œé…åˆ forâ€¦of, array spread, or Array.from() å¯ä»¥æ›´æ–¹ä¾¿å®ç°åŠŸèƒ½ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="built_in">RegExp</span>(<span class="string">'foo*'</span>,<span class="string">'g'</span>); </span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'table football, foosball'</span>;</span><br><span class="line"><span class="keyword">let</span> matches = str.matchAll(regexp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> match <span class="keyword">of</span> matches) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(match);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Array [ "foo" ]</span></span><br><span class="line"><span class="comment">// Array [ "foo" ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// matches iterator is exhausted after the for..of iteration</span></span><br><span class="line"><span class="comment">// Call matchAll again to create a new iterator</span></span><br><span class="line">matches = str.matchAll(regexp);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.from(matches, m =&gt; m[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// Array [ "foo", "foo" ]</span></span><br></pre></td></tr></table></figure>
<h4 id="matchAllå¯ä»¥æ›´å¥½çš„ç”¨äºåˆ†ç»„"><a href="#matchAllå¯ä»¥æ›´å¥½çš„ç”¨äºåˆ†ç»„" class="headerlink" title="matchAllå¯ä»¥æ›´å¥½çš„ç”¨äºåˆ†ç»„"></a>matchAllå¯ä»¥æ›´å¥½çš„ç”¨äºåˆ†ç»„</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> regexp = <span class="regexp">/t(e)(st(\d?))/g</span>;</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">'test1test2'</span>;</span><br><span class="line"></span><br><span class="line">str.match(regexp); </span><br><span class="line"><span class="comment">// Array ['test1', 'test2']</span></span><br><span class="line"><span class="keyword">let</span> array = [...str.matchAll(regexp)];</span><br><span class="line"></span><br><span class="line">array[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// ['test1', 'e', 'st1', '1', index: 0, input: 'test1test2', length: 4]</span></span><br><span class="line">array[<span class="number">1</span>];</span><br><span class="line"><span class="comment">// ['test2', 'e', 'st2', '2', index: 5, input: 'test1test2', length: 4]</span></span><br></pre></td></tr></table></figure>
<h3 id="8-Function-prototype-toString-ç°åœ¨è¿”å›ç²¾ç¡®å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œæ³¨é‡Š"><a href="#8-Function-prototype-toString-ç°åœ¨è¿”å›ç²¾ç¡®å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œæ³¨é‡Š" class="headerlink" title="8.Function.prototype.toString()ç°åœ¨è¿”å›ç²¾ç¡®å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œæ³¨é‡Š"></a>8.<code>Function.prototype.toString()</code>ç°åœ¨è¿”å›ç²¾ç¡®å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œæ³¨é‡Š</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> /* <span class="title">comment</span> */ <span class="title">foo</span> /* <span class="title">another</span> <span class="title">comment</span> */(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹å‰ä¸ä¼šæ‰“å°æ³¨é‡Šéƒ¨åˆ†</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.toString()); <span class="comment">// function foo()&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES2019 ä¼šæŠŠæ³¨é‡Šä¸€åŒæ‰“å°</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.toString()); <span class="comment">// function /* comment */ foo /* another comment */ ()&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> bar <span class="comment">/* comment */</span> = <span class="comment">/* another comment */</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bar.toString()); <span class="comment">// () =&gt; &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-ä¿®æ”¹-catch-ç»‘å®š"><a href="#9-ä¿®æ”¹-catch-ç»‘å®š" class="headerlink" title="9.ä¿®æ”¹ catch ç»‘å®š"></a>9.ä¿®æ”¹ <code>catch</code> ç»‘å®š</h3><p>åœ¨ ES10 ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡è¯­æ³•ä¸º catch å­å¥ç»‘å®šå¼‚å¸¸å˜é‡ï¼Œæ— è®ºæ˜¯å¦æœ‰å¿…è¦ã€‚å¾ˆå¤šæ—¶å€™ catch å—æ˜¯å¤šä½™çš„ã€‚ ES10 ææ¡ˆä½¿æˆ‘ä»¬èƒ½å¤Ÿç®€å•çš„æŠŠå˜é‡çœç•¥æ‰ã€‚</p>
<p>ä¸ç®—å¤§çš„æ”¹åŠ¨ã€‚</p>
<p>ä¹‹å‰æ˜¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æ˜¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;&#125; <span class="keyword">catch</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹BigInt"><a href="#10-æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹BigInt" class="headerlink" title="10.æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹BigInt"></a>10.æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹<code>BigInt</code></h3><p>ç°åœ¨çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå€¼ç±»å‹ï¼‰ä¸æ­¢5ç§ï¼ˆES6ä¹‹åæ˜¯å…­ç§ï¼‰äº†å“¦ï¼åŠ ä¸ŠBigIntä¸€å…±æœ‰ä¸ƒç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š Stringã€Numberã€Booleanã€Nullã€Undefinedã€Symbolã€BigInt</p>
<p><a href="https://juejin.im/post/5b9cb3336fb9a05d290ee47e" target="_blank" rel="noopener">ES6ã€ES7ã€ES8å­¦ä¹ æŒ‡å—</a></p>
<blockquote>
<p>ä½œè€…ï¼šä¸Šæ²…å…®</p>
<p>é“¾æ¥ï¼š<a href="https://juejin.im/post/5ca2e1935188254416288eb2" target="_blank" rel="noopener">https://juejin.im/post/5ca2e1935188254416288eb2</a></p>
<p>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨å’Œç†è§£çº¿ç¨‹æ± </title>
    <url>/%E8%BD%AC%E8%BD%BD/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E7%90%86%E8%A7%A3%E7%BA%BF%E7%A8%8B%E6%B1%A0.html</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¹³æ—¶æ¥è§¦è¿‡å¤šçº¿ç¨‹å¼€å‘çš„ç«¥é‹åº”è¯¥éƒ½æˆ–å¤šæˆ–å°‘äº†è§£è¿‡çº¿ç¨‹æ± ï¼Œä¹‹å‰å‘å¸ƒçš„ã€Šé˜¿é‡Œå·´å·´ Java æ‰‹å†Œã€‹é‡Œä¹Ÿæœ‰ä¸€æ¡ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091117_449.png" alt=""></p>
<p>å¯è§çº¿ç¨‹æ± çš„é‡è¦æ€§ã€‚</p>
<p>ç®€å•æ¥è¯´ä½¿ç”¨çº¿ç¨‹æ± æœ‰ä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š</p>
<ul>
<li>çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œä¸èƒ½é¢‘ç¹çš„åˆ›å»ºã€‚</li>
<li>è§£è€¦ä½œç”¨ï¼›çº¿ç¨‹çš„åˆ›å»ºäºæ‰§è¡Œå®Œå…¨åˆ†å¼€ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li>
<li>åº”å½“å°†å…¶æ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œå¯ä»¥ç»™å…¶ä»–ä»»åŠ¡è¿›è¡Œå¤ç”¨ã€‚</li>
</ul>
<h2 id="çº¿ç¨‹æ± åŸç†"><a href="#çº¿ç¨‹æ± åŸç†" class="headerlink" title="çº¿ç¨‹æ± åŸç†"></a>çº¿ç¨‹æ± åŸç†</h2><p>è°ˆåˆ°çº¿ç¨‹æ± å°±ä¼šæƒ³åˆ°æ± åŒ–æŠ€æœ¯ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯æŠŠå®è´µçš„èµ„æºæ”¾åˆ°ä¸€ä¸ªæ± å­ä¸­ï¼›æ¯æ¬¡ä½¿ç”¨éƒ½ä»é‡Œé¢è·å–ï¼Œç”¨å®Œä¹‹ååˆæ”¾å›æ± å­ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œæœ‰ç‚¹åƒå¤§é”…é¥­çš„æ„æ€ã€‚</p>
<p>é‚£åœ¨ Java ä¸­åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>åœ¨ JDK 1.5 ä¹‹åæ¨å‡ºäº†ç›¸å…³çš„ apiï¼Œå¸¸è§çš„åˆ›å»ºçº¿ç¨‹æ± æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><code>Executors.newCachedThreadPool()</code>ï¼šæ— é™çº¿ç¨‹æ± ã€‚</li>
<li><code>Executors.newFixedThreadPool(nThreads)</code>ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚</li>
<li><code>Executors.newSingleThreadExecutor()</code>ï¼šåˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚</li>
</ul>
<p>å…¶å®çœ‹è¿™ä¸‰ç§æ–¹å¼åˆ›å»ºçš„æºç å°±ä¼šå‘ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šè¿˜æ˜¯åˆ©ç”¨ <code>ThreadPoolExecutor</code> ç±»å®ç°çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸‹ <code>ThreadPoolExecutor</code> æ˜¯æ€ä¹ˆç©çš„ã€‚</p>
<p>é¦–å…ˆæ˜¯åˆ›å»ºçº¿ç¨‹çš„ apiï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadPoolExecutor(<span class="keyword">int</span> corePoolSize, </span><br><span class="line">                   <span class="keyword">int</span> maximumPoolSize, </span><br><span class="line">                   <span class="keyword">long</span> keepAliveTime, </span><br><span class="line">                   TimeUnit unit, </span><br><span class="line">                   BlockingQueue&lt;Runnable&gt; workQueue, </span><br><span class="line">                   RejectedExecutionHandler handler)</span><br></pre></td></tr></table></figure>
<p>è¿™å‡ ä¸ªæ ¸å¿ƒå‚æ•°çš„ä½œç”¨ï¼š</p>
<ul>
<li><code>corePoolSize</code> ä¸ºçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ã€‚</li>
<li><code>maximumPoolSize</code> ä¸ºçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹å¤§å°ã€‚</li>
<li><code>keepAliveTime</code> å’Œ <code>unit</code> åˆ™æ˜¯çº¿ç¨‹ç©ºé—²åçš„å­˜æ´»æ—¶é—´ã€‚</li>
<li><code>workQueue</code> ç”¨äºå­˜æ”¾ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><code>handler</code> å½“é˜Ÿåˆ—å’Œæœ€å¤§çº¿ç¨‹æ± éƒ½æ»¡äº†ä¹‹åçš„é¥±å’Œç­–ç•¥ã€‚</li>
</ul>
<p>äº†è§£äº†è¿™å‡ ä¸ªå‚æ•°å†æ¥çœ‹çœ‹å®é™…çš„è¿ç”¨ã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">threadPool.execute(<span class="keyword">new</span> Job());</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„æ–¹å¼æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­ï¼Œæ‰€ä»¥æ ¸å¿ƒçš„é€»è¾‘å°±æ˜¯ <code>execute()</code> å‡½æ•°äº†ã€‚</p>
<p>åœ¨å…·ä½“åˆ†æä¹‹å‰å…ˆäº†è§£ä¸‹çº¿ç¨‹æ± ä¸­æ‰€å®šä¹‰çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éƒ½å’Œçº¿ç¨‹çš„æ‰§è¡Œå¯†åˆ‡ç›¸å…³ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091119_77.png" alt=""></p>
<ul>
<li><code>RUNNING</code> è‡ªç„¶æ˜¯è¿è¡ŒçŠ¶æ€ï¼ŒæŒ‡å¯ä»¥æ¥å—ä»»åŠ¡æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡</li>
<li><code>SHUTDOWN</code> æŒ‡è°ƒç”¨äº† <code>shutdown()</code> æ–¹æ³•ï¼Œä¸å†æ¥å—æ–°ä»»åŠ¡äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¾—æ‰§è¡Œå®Œæ¯•ã€‚</li>
<li><code>STOP</code> æŒ‡è°ƒç”¨äº† <code>shutdownNow()</code> æ–¹æ³•ï¼Œä¸å†æ¥å—æ–°ä»»åŠ¡ï¼ŒåŒæ—¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰ä»»åŠ¡å¹¶ä¸­æ–­æ‰€æœ‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li><code>TIDYING</code> æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œåœ¨è°ƒç”¨ <code>shutdown()/shutdownNow()</code> ä¸­éƒ½ä¼šå°è¯•æ›´æ–°ä¸ºè¿™ä¸ªçŠ¶æ€ã€‚</li>
<li><code>TERMINATED</code> ç»ˆæ­¢çŠ¶æ€ï¼Œå½“æ‰§è¡Œ <code>terminated()</code> åä¼šæ›´æ–°ä¸ºè¿™ä¸ªçŠ¶æ€ã€‚</li>
</ul>
<p>ç”¨å›¾è¡¨ç¤ºä¸ºï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091120_711.png" alt=""></p>
<p>ç„¶åçœ‹çœ‹ <code>execute()</code> æ–¹æ³•æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091120_865.png" alt=""></p>
<blockquote>
<ol>
<li>è·å–å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ã€‚</li>
<li>å½“å‰çº¿ç¨‹æ•°é‡å°äº coreSize æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿è¡Œã€‚</li>
<li>å¦‚æœå½“å‰çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”å†™å…¥é˜»å¡é˜Ÿåˆ—æˆåŠŸã€‚</li>
<li>åŒé‡æ£€æŸ¥ï¼Œå†æ¬¡è·å–çº¿ç¨‹çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹çŠ¶æ€å˜äº†ï¼ˆéè¿è¡ŒçŠ¶æ€ï¼‰å°±éœ€è¦ä»é˜»å¡é˜Ÿåˆ—ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
<li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚</li>
<li>å¦‚æœåœ¨ç¬¬ä¸‰æ­¥çš„åˆ¤æ–­ä¸ºéè¿è¡ŒçŠ¶æ€ï¼Œå°è¯•æ–°å»ºçº¿ç¨‹ï¼Œå¦‚æœå¤±è´¥åˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
</ol>
</blockquote>
<p><img src="http://qiniu.mrain22.cn/201904091123_598.png" alt=""></p>
<h3 id="å¦‚ä½•é…ç½®çº¿ç¨‹"><a href="#å¦‚ä½•é…ç½®çº¿ç¨‹" class="headerlink" title="å¦‚ä½•é…ç½®çº¿ç¨‹"></a>å¦‚ä½•é…ç½®çº¿ç¨‹</h3><p>æµç¨‹èŠå®Œäº†å†æ¥çœ‹çœ‹ä¸Šæ–‡æåˆ°äº†å‡ ä¸ªæ ¸å¿ƒå‚æ•°åº”è¯¥å¦‚ä½•é…ç½®å‘¢ï¼Ÿ</p>
<p>æœ‰ä¸€ç‚¹æ˜¯è‚¯å®šçš„ï¼Œçº¿ç¨‹æ± è‚¯å®šæ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬æ˜¯éœ€è¦æ ¹æ®è¿™æ‰¹ä»»åŠ¡æ‰§è¡Œçš„æ€§è´¨æ¥ç¡®å®šçš„ã€‚</p>
<ul>
<li>IO å¯†é›†å‹ä»»åŠ¡ï¼šç”±äºçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨è¿è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°½å¯èƒ½çš„å¤šé…ç½®çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•° * 2</li>
<li>CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆå¤§é‡å¤æ‚çš„è¿ç®—ï¼‰åº”å½“åˆ†é…è¾ƒå°‘çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•°ç›¸å½“çš„å¤§å°ã€‚</li>
</ul>
<p>å½“ç„¶è¿™äº›éƒ½æ˜¯ç»éªŒå€¼ï¼Œæœ€å¥½çš„æ–¹å¼è¿˜æ˜¯æ ¹æ®å®é™…æƒ…å†µæµ‹è¯•å¾—å‡ºæœ€ä½³é…ç½®ã€‚</p>
<h3 id="ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± "><a href="#ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± " class="headerlink" title="ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± "></a>ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± </h3><p>æœ‰è¿è¡Œä»»åŠ¡è‡ªç„¶ä¹Ÿæœ‰å…³é—­ä»»åŠ¡ï¼Œä»ä¸Šæ–‡æåˆ°çš„ 5 ä¸ªçŠ¶æ€å°±èƒ½çœ‹å‡ºå¦‚ä½•æ¥å…³é—­çº¿ç¨‹æ± ã€‚</p>
<p>å…¶å®æ— éå°±æ˜¯ä¸¤ä¸ªæ–¹æ³• <code>shutdown()/shutdownNow()</code>ã€‚</p>
<p>ä½†ä»–ä»¬æœ‰ç€é‡è¦çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>shutdown()</code> æ‰§è¡Œååœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä¼šæŠŠé˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</li>
<li><code>shutdownNow()</code> ä¹Ÿæ˜¯åœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¼šä¸­æ–­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œå°†çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º stopã€‚</li>
</ul>
<blockquote>
<p>ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šä¸­æ–­çº¿ç¨‹ï¼Œç”¨æˆ·å¯è‡ªè¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦å“åº”ä¸­æ–­ã€‚</p>
</blockquote>
<p><code>shutdownNow()</code> è¦æ›´ç®€å•ç²—æš´ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©ä¸åŒçš„æ–¹æ³•ã€‚</p>
<p>æˆ‘é€šå¸¸æ˜¯æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å…³é—­çº¿ç¨‹æ± çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">    pool.execute(<span class="keyword">new</span> Job());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pool.shutdown();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!pool.awaitTermination(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">"çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">LOGGER.info(<span class="string">"ä¸€å…±å¤„ç†äº†ã€&#123;&#125;ã€‘"</span>, (end - start));</span><br></pre></td></tr></table></figure>
<p><code>pool.awaitTermination(1, TimeUnit.SECONDS)</code> ä¼šæ¯éš”ä¸€ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼ˆçŠ¶æ€ä¸º <code>TERMINATED</code>ï¼‰ï¼Œå½“ä» while å¾ªç¯é€€å‡ºæ—¶å°±è¡¨æ˜çº¿ç¨‹æ± å·²ç»å®Œå…¨ç»ˆæ­¢äº†ã€‚</p>
<h2 id="SpringBoot-ä½¿ç”¨çº¿ç¨‹æ± "><a href="#SpringBoot-ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="SpringBoot ä½¿ç”¨çº¿ç¨‹æ± "></a>SpringBoot ä½¿ç”¨çº¿ç¨‹æ± </h2><p>æ—¢ç„¶ç”¨äº† SpringBoot ï¼Œé‚£è‡ªç„¶å¾—å‘æŒ¥ Spring çš„ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦ Spring æ¥å¸®æˆ‘ä»¬ç®¡ç†çº¿ç¨‹æ± ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreadPoolConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆè´¹é˜Ÿåˆ—çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(value = <span class="string">"consumerQueueThreadPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorService <span class="title">buildConsumerQueueThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ThreadFactory namedThreadFactory = <span class="keyword">new</span> ThreadFactoryBuilder()</span><br><span class="line">                .setNameFormat(<span class="string">"consumer-queue-thread-%d"</span>).build();</span><br><span class="line"></span><br><span class="line">        ExecutorService pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">5</span>),namedThreadFactory,<span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pool ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ—¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"consumerQueueThreadPool"</span>)</span><br><span class="line"><span class="keyword">private</span> ExecutorService consumerQueueThreadPool;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¶ˆè´¹é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        consumerQueueThreadPool.execute(<span class="keyword">new</span> ConsumerQueueThread());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®ä¹ŸæŒºç®€å•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± çš„ beanï¼Œåœ¨ä½¿ç”¨æ—¶ç›´æ¥ä» Spring ä¸­å–å‡ºå³å¯ã€‚</p>
<h2 id="ç›‘æ§çº¿ç¨‹æ± "><a href="#ç›‘æ§çº¿ç¨‹æ± " class="headerlink" title="ç›‘æ§çº¿ç¨‹æ± "></a>ç›‘æ§çº¿ç¨‹æ± </h2><p>è°ˆåˆ°äº† SpringBootï¼Œä¹Ÿå¯åˆ©ç”¨å®ƒ actuator ç»„ä»¶æ¥åšçº¿ç¨‹æ± çš„ç›‘æ§ã€‚</p>
<p>çº¿ç¨‹æ€ä¹ˆè¯´éƒ½æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¯¹çº¿ç¨‹æ± çš„ç›‘æ§å¯ä»¥çŸ¥é“è‡ªå·±ä»»åŠ¡æ‰§è¡Œçš„çŠ¶å†µã€æ•ˆç‡ç­‰ã€‚</p>
<p>å…³äº actuator å°±ä¸å†ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹<a href="http://mp.weixin.qq.com/s?__biz=MzIyMzgyODkxMQ==&amp;mid=2247483762&amp;idx=1&amp;sn=c7c25589c57a826508a6f0f62030c936&amp;chksm=e8190fb2df6e86a4363d0157cb9158a4357732dd730a66c719f13747f038ed05c1abccbd8f9d&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">è¿™ç¯‡</a>ï¼Œæœ‰è¯¦ç»†æ•´ç†è¿‡å¦‚ä½•æš´éœ²ç›‘æ§ç«¯ç‚¹ã€‚</p>
<p>å…¶å® ThreadPool æœ¬èº«å·²ç»æä¾›äº†ä¸å°‘ api å¯ä»¥è·å–çº¿ç¨‹çŠ¶æ€ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091125_167.png" alt=""></p>
<p>å¾ˆå¤šæ–¹æ³•çœ‹åå­—å°±çŸ¥é“å…¶å«ä¹‰ï¼Œåªéœ€è¦å°†è¿™äº›ä¿¡æ¯æš´éœ²åˆ° SpringBoot çš„ç›‘æ§ç«¯ç‚¹ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¯è§†åŒ–é¡µé¢æŸ¥çœ‹å½“å‰çš„çº¿ç¨‹æ± çŠ¶æ€äº†ã€‚</p>
<p>ç”šè‡³æˆ‘ä»¬å¯ä»¥ç»§æ‰¿çº¿ç¨‹æ± æ‰©å±•å…¶ä¸­çš„å‡ ä¸ªå‡½æ•°æ¥è‡ªå®šä¹‰ç›‘æ§é€»è¾‘ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091125_214.png" alt=""></p>
<p><img src="http://qiniu.mrain22.cn/201904091125_224.png" alt=""></p>
<p>çœ‹è¿™äº›åç§°å’Œå®šä¹‰éƒ½çŸ¥é“ï¼Œè¿™æ˜¯è®©å­ç±»æ¥å®ç°çš„ã€‚</p>
<p>å¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œå‰ã€åã€ç»ˆæ­¢çŠ¶æ€æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<h2 id="çº¿ç¨‹æ± éš”ç¦»"><a href="#çº¿ç¨‹æ± éš”ç¦»" class="headerlink" title="çº¿ç¨‹æ± éš”ç¦»"></a>çº¿ç¨‹æ± éš”ç¦»</h2><blockquote>
<p>çº¿ç¨‹æ± çœ‹ä¼¼å¾ˆç¾å¥½ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬å¾ˆå¤šä¸šåŠ¡éƒ½ä¾èµ–äºåŒä¸€ä¸ªçº¿ç¨‹æ± ,å½“å…¶ä¸­ä¸€ä¸ªä¸šåŠ¡å› ä¸ºå„ç§ä¸å¯æ§çš„åŸå› æ¶ˆè€—äº†æ‰€æœ‰çš„çº¿ç¨‹ï¼Œå¯¼è‡´çº¿ç¨‹æ± å…¨éƒ¨å æ»¡ã€‚</p>
<p>è¿™æ ·å…¶ä»–çš„ä¸šåŠ¡ä¹Ÿå°±ä¸èƒ½æ­£å¸¸è¿è½¬äº†ï¼Œè¿™å¯¹ç³»ç»Ÿçš„æ‰“å‡»æ˜¯å·¨å¤§çš„ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ Tomcat æ¥å—è¯·æ±‚çš„çº¿ç¨‹æ± ï¼Œå‡è®¾å…¶ä¸­ä¸€äº›å“åº”ç‰¹åˆ«æ…¢ï¼Œçº¿ç¨‹èµ„æºå¾—ä¸åˆ°å›æ”¶é‡Šæ”¾ï¼›çº¿ç¨‹æ± æ…¢æ…¢è¢«å æ»¡ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯æ•´ä¸ªåº”ç”¨éƒ½ä¸èƒ½æä¾›æœåŠ¡ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†çº¿ç¨‹æ± <strong>è¿›è¡Œéš”ç¦»</strong>ã€‚</p>
<p>é€šå¸¸çš„åšæ³•æ˜¯æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼š</p>
<blockquote>
<p>æ¯”å¦‚ä¸‹å•çš„ä»»åŠ¡ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè·å–æ•°æ®çš„ä»»åŠ¡ç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™æ ·å³ä½¿å…¶ä¸­ä¸€ä¸ªå‡ºç°é—®é¢˜æŠŠçº¿ç¨‹æ± è€—å°½ï¼Œé‚£ä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„ä»»åŠ¡è¿è¡Œã€‚</p>
</blockquote>
<h3 id="hystrix-éš”ç¦»"><a href="#hystrix-éš”ç¦»" class="headerlink" title="hystrix éš”ç¦»"></a>hystrix éš”ç¦»</h3><p>è¿™æ ·çš„éœ€æ±‚ Hystrix å·²ç»å¸®æˆ‘ä»¬å®ç°äº†ã€‚</p>
<blockquote>
<p>Hystrix æ˜¯ä¸€æ¬¾å¼€æºçš„å®¹é”™æ’ä»¶ï¼Œå…·æœ‰ä¾èµ–éš”ç¦»ã€ç³»ç»Ÿå®¹é”™é™çº§ç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<p>ä¸‹é¢æ¥çœ‹çœ‹ <code>Hystrix</code> ç®€å•çš„åº”ç”¨ï¼š</p>
<p>é¦–å…ˆéœ€è¦å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œåˆ†åˆ«ç”¨äºæ‰§è¡Œè®¢å•ã€å¤„ç†ç”¨æˆ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Function:è®¢å•æœåŠ¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> crossoverJie</span></span><br><span class="line"><span class="comment"> *         Date: 2018/7/28 16:43</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandOrder</span> <span class="keyword">extends</span> <span class="title">HystrixCommand</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOGGER = LoggerFactory.getLogger(CommandOrder.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String orderName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommandOrder</span><span class="params">(String orderName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>(Setter.withGroupKey(</span><br><span class="line">                <span class="comment">//æœåŠ¡åˆ†ç»„</span></span><br><span class="line">                HystrixCommandGroupKey.Factory.asKey(<span class="string">"OrderGroup"</span>))</span><br><span class="line">                <span class="comment">//çº¿ç¨‹åˆ†ç»„</span></span><br><span class="line">                .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey(<span class="string">"OrderPool"</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">//çº¿ç¨‹æ± é…ç½®</span></span><br><span class="line">                .andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter()</span><br><span class="line">                        .withCoreSize(<span class="number">10</span>)</span><br><span class="line">                        .withKeepAliveTimeMinutes(<span class="number">5</span>)</span><br><span class="line">                        .withMaxQueueSize(<span class="number">10</span>)</span><br><span class="line">                        .withQueueSizeRejectionThreshold(<span class="number">10000</span>))</span><br><span class="line"></span><br><span class="line">                .andCommandPropertiesDefaults(</span><br><span class="line">                        HystrixCommandProperties.Setter()</span><br><span class="line">                                .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD))</span><br><span class="line">        )</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">this</span>.orderName = orderName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">"orderName=[&#123;&#125;]"</span>, orderName);</span><br><span class="line"></span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OrderName="</span> + orderName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Function:ç”¨æˆ·æœåŠ¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> crossoverJie</span></span><br><span class="line"><span class="comment"> *         Date: 2018/7/28 16:43</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandUser</span> <span class="keyword">extends</span> <span class="title">HystrixCommand</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOGGER = LoggerFactory.getLogger(CommandUser.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommandUser</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>(Setter.withGroupKey(</span><br><span class="line">                <span class="comment">//æœåŠ¡åˆ†ç»„</span></span><br><span class="line">                HystrixCommandGroupKey.Factory.asKey(<span class="string">"UserGroup"</span>))</span><br><span class="line">                <span class="comment">//çº¿ç¨‹åˆ†ç»„</span></span><br><span class="line">                .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey(<span class="string">"UserPool"</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">//çº¿ç¨‹æ± é…ç½®</span></span><br><span class="line">                .andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter()</span><br><span class="line">                        .withCoreSize(<span class="number">10</span>)</span><br><span class="line">                        .withKeepAliveTimeMinutes(<span class="number">5</span>)</span><br><span class="line">                        .withMaxQueueSize(<span class="number">10</span>)</span><br><span class="line">                        .withQueueSizeRejectionThreshold(<span class="number">10000</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">//çº¿ç¨‹æ± éš”ç¦»</span></span><br><span class="line">                .andCommandPropertiesDefaults(</span><br><span class="line">                        HystrixCommandProperties.Setter()</span><br><span class="line">                                .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD))</span><br><span class="line">        )</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">"userName=[&#123;&#125;]"</span>, userName);</span><br><span class="line"></span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"userName="</span> + userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><code>api</code> ç‰¹åˆ«ç®€æ´æ˜“æ‡‚ï¼Œå…·ä½“è¯¦æƒ…è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>ç„¶åæ¨¡æ‹Ÿè¿è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    CommandOrder commandPhone = <span class="keyword">new</span> CommandOrder(<span class="string">"æ‰‹æœº"</span>);</span><br><span class="line">    CommandOrder command = <span class="keyword">new</span> CommandOrder(<span class="string">"ç”µè§†"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜»å¡æ–¹å¼æ‰§è¡Œ</span></span><br><span class="line">    String execute = commandPhone.execute();</span><br><span class="line">    LOGGER.info(<span class="string">"execute=[&#123;&#125;]"</span>, execute);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚æ­¥éé˜»å¡æ–¹å¼</span></span><br><span class="line">    Future&lt;String&gt; queue = command.queue();</span><br><span class="line">    String value = queue.get(<span class="number">200</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    LOGGER.info(<span class="string">"value=[&#123;&#125;]"</span>, value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    CommandUser commandUser = <span class="keyword">new</span> CommandUser(<span class="string">"å¼ ä¸‰"</span>);</span><br><span class="line">    String name = commandUser.execute();</span><br><span class="line">    LOGGER.info(<span class="string">"name=[&#123;&#125;]"</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091126_640.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä»»åŠ¡åˆ†æˆäº†ä¸¤ä¸ªçº¿ç¨‹æ± è¿è¡Œï¼Œä»–ä»¬ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚</p>
<p>è·å–ä»»åŠ¡ä»»åŠ¡ç»“æœæ”¯æŒåŒæ­¥é˜»å¡å’Œå¼‚æ­¥éé˜»å¡æ–¹å¼ï¼Œå¯è‡ªè¡Œé€‰æ‹©ã€‚</p>
<p>å®ƒçš„å®ç°åŸç†å…¶å®å®¹æ˜“çŒœåˆ°ï¼š</p>
<blockquote>
<p>åˆ©ç”¨ä¸€ä¸ª Map æ¥å­˜æ”¾ä¸åŒä¸šåŠ¡å¯¹åº”çš„çº¿ç¨‹æ± ã€‚</p>
</blockquote>
<p>é€šè¿‡åˆšæ‰çš„æ„é€ å‡½æ•°ä¹Ÿèƒ½è¯æ˜ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201904091127_556.png" alt=""></p>
<p>è¿˜è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š</p>
<blockquote>
<p>è‡ªå®šä¹‰çš„ Command å¹¶ä¸æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œæ¯æ¬¡æ‰§è¡Œéœ€è¦ new ä¸€ä¸ªå®ä¾‹ï¼Œä¸ç„¶ä¼šæŠ¥ <code>This instance can only be executed once. Please instantiate a new instance.</code> å¼‚å¸¸ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼š crossoverJie<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/kbOV0mkE_NMypEQK6rZW3A" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/kbOV0mkE_NMypEQK6rZW3A</a><br><strong>ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„</strong></p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>Java ä¸­15ç§é”çš„ä»‹ç»ï¼šå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç‹¬äº«é”ï¼Œäº’æ–¥é”ï¼Œä¹è§‚é”ï¼Œåˆ†æ®µé”ï¼Œè‡ªæ—‹é”ç­‰ç­‰</title>
    <url>/%E8%BD%AC%E8%BD%BD/Java-%E4%B8%AD15%E7%A7%8D%E9%94%81%E7%9A%84%E4%BB%8B%E7%BB%8D%EF%BC%9A%E5%85%AC%E5%B9%B3%E9%94%81%EF%BC%8C%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%EF%BC%8C%E7%8B%AC%E4%BA%AB%E9%94%81%EF%BC%8C%E4%BA%92%E6%96%A5%E9%94%81%EF%BC%8C%E4%B9%90%E8%A7%82%E9%94%81%EF%BC%8C%E5%88%86%E6%AE%B5%E9%94%81%EF%BC%8C%E8%87%AA%E6%97%8B%E9%94%81%E7%AD%89%E7%AD%89.html</url>
    <content><![CDATA[<p>åœ¨è¯»å¾ˆå¤šå¹¶å‘æ–‡ç« ä¸­ï¼Œä¼šæåŠå„ç§å„æ ·é”å¦‚å…¬å¹³é”ï¼Œä¹è§‚é”ç­‰ç­‰ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å„ç§é”çš„åˆ†ç±»ã€‚ä»‹ç»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å…¬å¹³é” / éå…¬å¹³é”</li>
<li>å¯é‡å…¥é” / ä¸å¯é‡å…¥é”</li>
<li>ç‹¬äº«é” / å…±äº«é”</li>
<li>äº’æ–¥é” / è¯»å†™é”</li>
<li>ä¹è§‚é” / æ‚²è§‚é”</li>
<li>åˆ†æ®µé”</li>
<li>åå‘é” / è½»é‡çº§é” / é‡é‡çº§é”</li>
<li>è‡ªæ—‹é”</li>
</ul>
<p>ä¸Šé¢æ˜¯å¾ˆå¤šé”çš„åè¯ï¼Œè¿™äº›åˆ†ç±»å¹¶ä¸æ˜¯å…¨æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œæœ‰çš„æŒ‡é”çš„ç‰¹æ€§ï¼Œæœ‰çš„æŒ‡é”çš„è®¾è®¡ï¼Œä¸‹é¢æ€»ç»“çš„å†…å®¹æ˜¯å¯¹æ¯ä¸ªé”çš„åè¯è¿›è¡Œä¸€å®šçš„è§£é‡Šã€‚</p>
<h2 id="å…¬å¹³é”-éå…¬å¹³é”"><a href="#å…¬å¹³é”-éå…¬å¹³é”" class="headerlink" title="å…¬å¹³é” / éå…¬å¹³é”"></a>å…¬å¹³é” / éå…¬å¹³é”</h2><p><strong>å…¬å¹³é”</strong></p>
<ul>
<li>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚</li>
</ul>
<p><strong>éå…¬å¹³é”</strong></p>
<ul>
<li>éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚</li>
</ul>
<p>å¯¹äº<code>Java ReentrantLock</code>è€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºååé‡æ¯”å…¬å¹³é”å¤§ã€‚<br>å¯¹äº<code>Synchronized</code>è€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚ç”±äºå…¶å¹¶ä¸åƒ<code>ReentrantLock</code>æ˜¯é€šè¿‡<code>AQS</code>çš„æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚</p>
<h2 id="å¯é‡å…¥é”-ä¸å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”-ä¸å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é” / ä¸å¯é‡å…¥é”"></a>å¯é‡å…¥é” / ä¸å¯é‡å…¥é”</h2><p><strong>å¯é‡å…¥é”</strong></p>
<p>å¹¿ä¹‰ä¸Šçš„å¯é‡å…¥é”æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼ˆå‰æå¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œè¿™æ ·çš„é”å°±å«åšå¯é‡å…¥é”ã€‚<code>ReentrantLock</code>å’Œ<code>synchronized</code>éƒ½æ˜¯å¯é‡å…¥é”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setA</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    setB();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setB</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå¯é‡å…¥é”çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå¦‚æœä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼ŒsetBå¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œå¯èƒ½é€ æˆæ­»é”ã€‚</p>
<p><strong>ä¸å¯é‡å…¥é”</strong></p>
<p>ä¸å¯é‡å…¥é”ï¼Œä¸å¯é‡å…¥é”ç›¸åï¼Œä¸å¯é€’å½’è°ƒç”¨ï¼Œé€’å½’è°ƒç”¨å°±å‘ç”Ÿæ­»é”ã€‚çœ‹åˆ°ä¸€ä¸ªç»å…¸çš„è®²è§£ï¼Œä½¿ç”¨è‡ªæ—‹é”æ¥æ¨¡æ‹Ÿä¸€ä¸ªä¸å¯é‡å…¥é”ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnreentrantLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Thread&gt; owner = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="comment">//è¿™å¥æ˜¯å¾ˆç»å…¸çš„â€œè‡ªæ—‹â€è¯­æ³•ï¼ŒAtomicIntegerä¸­ä¹Ÿæœ‰</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!owner.compareAndSet(<span class="keyword">null</span>, current)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        owner.compareAndSet(current, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨åŸå­å¼•ç”¨æ¥å­˜æ”¾çº¿ç¨‹ï¼ŒåŒä¸€çº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨lock()æ–¹æ³•ï¼Œå¦‚æœä¸æ‰§è¡Œunlock()é‡Šæ”¾é”çš„è¯ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è‡ªæ—‹çš„æ—¶å€™å°±ä¼šäº§ç”Ÿæ­»é”ï¼Œè¿™ä¸ªé”å°±ä¸æ˜¯å¯é‡å…¥çš„ï¼Œè€Œå®é™…ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹ä¸å¿…æ¯æ¬¡éƒ½å»é‡Šæ”¾é”å†æ¥è·å–é”ï¼Œè¿™æ ·çš„è°ƒåº¦åˆ‡æ¢æ˜¯å¾ˆè€—èµ„æºçš„ã€‚</p>
<p><strong>æŠŠå®ƒå˜æˆä¸€ä¸ªå¯é‡å…¥é”</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnreentrantLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Thread&gt; owner = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span> (current == owner.get()) &#123;</span><br><span class="line">            state++;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿™å¥æ˜¯å¾ˆç»å…¸çš„â€œè‡ªæ—‹â€å¼è¯­æ³•ï¼ŒAtomicIntegerä¸­ä¹Ÿæœ‰</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!owner.compareAndSet(<span class="keyword">null</span>, current)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span> (current == owner.get()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (state != <span class="number">0</span>) &#123;</span><br><span class="line">                state--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                owner.compareAndSet(current, <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰§è¡Œæ¯æ¬¡æ“ä½œä¹‹å‰ï¼Œåˆ¤æ–­å½“å‰é”æŒæœ‰è€…æ˜¯å¦æ˜¯å½“å‰å¯¹è±¡ï¼Œé‡‡ç”¨stateè®¡æ•°ï¼Œä¸ç”¨æ¯æ¬¡å»é‡Šæ”¾é”ã€‚</p>
<p><strong>ReentrantLockä¸­å¯é‡å…¥é”å®ç°</strong></p>
<p>è¿™é‡Œçœ‹éå…¬å¹³é”çš„é”è·å–æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123;</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°±æ˜¯è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªprivate volatile int stateæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œé¿å…äº†é¢‘ç¹çš„æŒæœ‰é‡Šæ”¾æ“ä½œï¼Œè¿™æ ·æ—¢æå‡äº†æ•ˆç‡ï¼Œåˆé¿å…äº†æ­»é”ã€‚</p>
<h2 id="ç‹¬äº«é”-å…±äº«é”"><a href="#ç‹¬äº«é”-å…±äº«é”" class="headerlink" title="ç‹¬äº«é” / å…±äº«é”"></a>ç‹¬äº«é” / å…±äº«é”</h2><p>ç‹¬äº«é”å’Œå…±äº«é”åœ¨ä½ å»è¯»C.U.TåŒ…ä¸‹çš„ReeReentrantLockå’ŒReentrantReadWriteLockä½ å°±ä¼šå‘ç°ï¼Œå®ƒä¿©ä¸€ä¸ªæ˜¯ç‹¬äº«ä¸€ä¸ªæ˜¯å…±äº«é”ã€‚</p>
<ul>
<li><strong>ç‹¬äº«é”</strong>ï¼šè¯¥é”æ¯ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚</li>
<li><strong>å…±äº«é”</strong>ï¼šè¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹å…±æœ‰ï¼Œå…¸å‹çš„å°±æ˜¯ReentrantReadWriteLocké‡Œçš„è¯»é”ï¼Œå®ƒçš„è¯»é”æ˜¯å¯ä»¥è¢«å…±äº«çš„ï¼Œä½†æ˜¯å®ƒçš„å†™é”ç¡®æ¯æ¬¡åªèƒ½è¢«ç‹¬å ã€‚</li>
</ul>
<p>å¦å¤–è¯»é”çš„å…±äº«å¯ä¿è¯å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œä½†æ˜¯è¯»å†™å’Œå†™å†™ï¼Œå†™è¯»éƒ½æ˜¯äº’æ–¥çš„ã€‚</p>
<p>ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚<br>å¯¹äºSynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬äº«é”ã€‚</p>
<h2 id="äº’æ–¥é”-è¯»å†™é”"><a href="#äº’æ–¥é”-è¯»å†™é”" class="headerlink" title="äº’æ–¥é” / è¯»å†™é”"></a>äº’æ–¥é” / è¯»å†™é”</h2><p><strong>äº’æ–¥é”</strong></p>
<p>åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰å¯¹è¿›è¡ŒåŠ é”æ“ä½œï¼Œåœ¨è®¿é—®å®Œæˆä¹‹åè¿›è¡Œè§£é”æ“ä½œã€‚ åŠ é”åï¼Œä»»ä½•å…¶ä»–è¯•å›¾å†æ¬¡åŠ é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰è¿›ç¨‹è§£é”ã€‚</p>
<p>å¦‚æœè§£é”æ—¶æœ‰ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥é”ä¸Šçš„çº¿ç¨‹éƒ½è¢«ç¼–ç¨‹å°±ç»ªçŠ¶æ€ï¼Œ ç¬¬ä¸€ä¸ªå˜ä¸ºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åˆæ‰§è¡ŒåŠ é”æ“ä½œï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åˆä¼šè¿›å…¥ç­‰å¾…ã€‚ åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®è¢«äº’æ–¥é”ä¿æŠ¤çš„èµ„æº</p>
<p><strong>è¯»å†™é”</strong></p>
<p>è¯»å†™é”æ—¢æ˜¯äº’æ–¥é”ï¼Œåˆæ˜¯å…±äº«é”ï¼Œreadæ¨¡å¼æ˜¯å…±äº«ï¼Œwriteæ˜¯äº’æ–¥(æ’å®ƒé”)çš„ã€‚</p>
<p><strong>è¯»å†™é”æœ‰ä¸‰ç§çŠ¶æ€</strong>ï¼šè¯»åŠ é”çŠ¶æ€ã€å†™åŠ é”çŠ¶æ€å’Œä¸åŠ é”çŠ¶æ€</p>
<p><strong>è¯»å†™é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯</strong><code>ReadWriteLock</code></p>
<p>ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”ã€‚<br>åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™çŠ¶æ€çš„é”ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å æœ‰è¯»çŠ¶æ€é”ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥å®ç°é«˜å¹¶å‘çš„åŸå› ã€‚å½“å…¶å¤„äºå†™çŠ¶æ€é”ä¸‹ï¼Œä»»ä½•æƒ³è¦å°è¯•è·å¾—é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å†™çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›å¦‚æœæ˜¯å¤„äºè¯»çŠ¶æ€é”ä¸‹ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—å®ƒçš„è¯»çŠ¶æ€é”ï¼Œä½†æ˜¯ä¸å…è®¸è·å¾—å®ƒçš„å†™çŠ¶æ€é”ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹çš„è¯»çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›ä¸ºäº†é¿å…æƒ³è¦å°è¯•å†™æ“ä½œçš„çº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°å†™çŠ¶æ€é”ï¼Œå½“è¯»å†™é”æ„ŸçŸ¥åˆ°æœ‰çº¿ç¨‹æƒ³è¦è·å¾—å†™çŠ¶æ€é”æ—¶ï¼Œä¾¿ä¼šé˜»å¡å…¶åæ‰€æœ‰æƒ³è¦è·å¾—è¯»çŠ¶æ€é”çš„çº¿ç¨‹ã€‚æ‰€ä»¥è¯»å†™é”éå¸¸é€‚åˆèµ„æºçš„è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„æƒ…å†µã€‚</p>
<h2 id="ä¹è§‚é”-æ‚²è§‚é”"><a href="#ä¹è§‚é”-æ‚²è§‚é”" class="headerlink" title="ä¹è§‚é” / æ‚²è§‚é”"></a>ä¹è§‚é” / æ‚²è§‚é”</h2><p><strong>æ‚²è§‚é”</strong></p>
<p>æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚<code>Java</code>ä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p>
<p><strong>ä¹è§‚é”</strong></p>
<p>æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹<strong>è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äº<code>write_condition</code>æœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨<code>Java</code>ä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹é¢çš„<strong>åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„</strong>ã€‚</p>
<h2 id="åˆ†æ®µé”"><a href="#åˆ†æ®µé”" class="headerlink" title="åˆ†æ®µé”"></a>åˆ†æ®µé”</h2><p>åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äº<code>ConcurrentHashMap</code>è€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚</p>
<p>å¹¶å‘å®¹å™¨ç±»çš„åŠ é”æœºåˆ¶æ˜¯åŸºäºç²’åº¦æ›´å°çš„åˆ†æ®µé”ï¼Œåˆ†æ®µé”ä¹Ÿæ˜¯æå‡å¤šå¹¶å‘ç¨‹åºæ€§èƒ½çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚</p>
<p>åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä¸²è¡Œæ“ä½œæ˜¯ä¼šé™ä½å¯ä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šå‡ä½æ€§èƒ½ã€‚åœ¨é”ä¸Šå‘ç”Ÿç«äº‰æ—¶å°†é€šæ°´å¯¼è‡´è¿™ä¸¤ç§é—®é¢˜ï¼Œä½¿ç”¨ç‹¬å é”æ—¶ä¿æŠ¤å—é™èµ„æºçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šæ˜¯é‡‡ç”¨ä¸²è¡Œæ–¹å¼â€”-æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å®ƒã€‚æ‰€ä»¥å¯¹äºå¯ä¼¸ç¼©æ€§æ¥è¯´æœ€å¤§çš„å¨èƒå°±æ˜¯ç‹¬å é”ã€‚</p>
<p><strong>æˆ‘ä»¬ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼é™ä½é”çš„ç«äº‰ç¨‹åº¦</strong>ï¼š<br>1ã€å‡å°‘é”çš„æŒæœ‰æ—¶é—´<br>2ã€é™ä½é”çš„è¯·æ±‚é¢‘ç‡<br>3ã€ä½¿ç”¨å¸¦æœ‰åè°ƒæœºåˆ¶çš„ç‹¬å é”ï¼Œè¿™äº›æœºåˆ¶å…è®¸æ›´é«˜çš„å¹¶å‘æ€§ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å°†é”åˆ†è§£æŠ€æœ¯è¿›ä¸€æ­¥æ‰©å±•ä¸ºä¸€ç»„ç‹¬ç«‹å¯¹è±¡ä¸Šçš„é”è¿›è¡Œåˆ†è§£ï¼Œè¿™æˆä¸ºåˆ†æ®µé”ã€‚</p>
<p><strong>å…¶å®è¯´çš„ç®€å•ä¸€ç‚¹å°±æ˜¯</strong>ï¼š</p>
<p>å®¹å™¨é‡Œæœ‰å¤šæŠŠé”ï¼Œæ¯ä¸€æŠŠé”ç”¨äºé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé‚£ä¹ˆå½“å¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®æ—¶ï¼Œçº¿ç¨‹é—´å°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¹¶å‘è®¿é—®æ•ˆç‡ï¼Œè¿™å°±æ˜¯<code>ConcurrentHashMap</code>æ‰€ä½¿ç”¨çš„é”åˆ†æ®µæŠ€æœ¯ï¼Œé¦–å…ˆå°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p>
<p>æ¯”å¦‚ï¼šåœ¨ConcurrentHashMapä¸­ä½¿ç”¨äº†ä¸€ä¸ªåŒ…å«16ä¸ªé”çš„æ•°ç»„ï¼Œæ¯ä¸ªé”ä¿æŠ¤æ‰€æœ‰æ•£åˆ—æ¡¶çš„1/16ï¼Œå…¶ä¸­ç¬¬Nä¸ªæ•£åˆ—æ¡¶ç”±ç¬¬ï¼ˆN mod 16ï¼‰ä¸ªé”æ¥ä¿æŠ¤ã€‚å‡è®¾ä½¿ç”¨åˆç†çš„æ•£åˆ—ç®—æ³•ä½¿å…³é”®å­—èƒ½å¤Ÿå‡åŒ€çš„åˆ†éƒ¨ï¼Œé‚£ä¹ˆè¿™å¤§çº¦èƒ½ä½¿å¯¹é”çš„è¯·æ±‚å‡å°‘åˆ°è¶Šæ¥çš„1/16ã€‚ä¹Ÿæ­£æ˜¯è¿™é¡¹æŠ€æœ¯ä½¿å¾—ConcurrentHashMapæ”¯æŒå¤šè¾¾16ä¸ªå¹¶å‘çš„å†™å…¥çº¿ç¨‹ã€‚</p>
<h2 id="åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”"><a href="#åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”" class="headerlink" title="åå‘é” / è½»é‡çº§é” / é‡é‡çº§é”"></a>åå‘é” / è½»é‡çº§é” / é‡é‡çº§é”</h2><p><strong>é”çš„çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>æ— é”çŠ¶æ€</li>
<li>åå‘é”çŠ¶æ€</li>
<li>è½»é‡çº§é”çŠ¶æ€</li>
<li>é‡é‡çº§é”çŠ¶æ€</li>
</ul>
<p>é”çš„çŠ¶æ€æ˜¯é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜çš„ã€‚<br>å››ç§çŠ¶æ€ä¼šéšç€ç«äº‰çš„æƒ…å†µé€æ¸å‡çº§ï¼Œè€Œä¸”æ˜¯ä¸å¯é€†çš„è¿‡ç¨‹ï¼Œå³ä¸å¯é™çº§ã€‚<br><strong>è¿™å››ç§çŠ¶æ€éƒ½ä¸æ˜¯Javaè¯­è¨€ä¸­çš„é”</strong>ï¼Œè€Œæ˜¯Jvmä¸ºäº†æé«˜é”çš„è·å–ä¸é‡Šæ”¾æ•ˆç‡è€Œåšçš„ä¼˜åŒ–(<strong>ä½¿ç”¨synchronizedæ—¶</strong>)ã€‚</p>
<p><strong>åå‘é”</strong></p>
<ul>
<li>åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚</li>
</ul>
<p><strong>è½»é‡çº§</strong></p>
<ul>
<li>è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚</li>
</ul>
<p><strong>é‡é‡çº§é”</strong></p>
<ul>
<li>é‡é‡çº§é”æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚</li>
</ul>
<h2 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h2><p>æˆ‘ä»¬çŸ¥é“CASç®—æ³•æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒCASç®—æ³•ä¸­åˆæ¶‰åŠåˆ°è‡ªæ—‹é”ï¼Œæ‰€ä»¥è¿™é‡Œç»™å¤§å®¶è®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ã€‚</p>
<h3 id="ç®€å•å›é¡¾ä¸€ä¸‹CASç®—æ³•"><a href="#ç®€å•å›é¡¾ä¸€ä¸‹CASç®—æ³•" class="headerlink" title="ç®€å•å›é¡¾ä¸€ä¸‹CASç®—æ³•"></a>ç®€å•å›é¡¾ä¸€ä¸‹CASç®—æ³•</h3><p><code>CAS</code>æ˜¯è‹±æ–‡å•è¯<code>Compare and Swap</code>ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æœ‰åçš„æ— é”ç®—æ³•ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆ<code>Non-blocking Synchronization</code>ï¼‰ã€‚CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°</p>
<ul>
<li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V</li>
<li>è¿›è¡Œæ¯”è¾ƒçš„å€¼ A</li>
<li>æ‹Ÿå†™å…¥çš„æ–°å€¼ B</li>
</ul>
<p>æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­çš„é‡è¯•ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ</h3><p><strong>è‡ªæ—‹é”ï¼ˆspinlockï¼‰ï¼šæ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹åœ¨è·å–é”çš„æ—¶å€™ï¼Œå¦‚æœé”å·²ç»è¢«å…¶å®ƒçº¿ç¨‹è·å–ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†å¾ªç¯ç­‰å¾…ï¼Œç„¶åä¸æ–­çš„åˆ¤æ–­é”æ˜¯å¦èƒ½å¤Ÿè¢«æˆåŠŸè·å–ï¼Œç›´åˆ°è·å–åˆ°é”æ‰ä¼šé€€å‡ºå¾ªç¯</strong>ã€‚</p>
<p>å®ƒæ˜¯ä¸ºå®ç°ä¿æŠ¤å…±äº«èµ„æºè€Œæå‡ºä¸€ç§é”æœºåˆ¶ã€‚å…¶å®ï¼Œè‡ªæ—‹é”ä¸äº’æ–¥é”æ¯”è¾ƒç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†è§£å†³å¯¹æŸé¡¹èµ„æºçš„äº’æ–¥ä½¿ç”¨ã€‚<strong>æ— è®ºæ˜¯äº’æ–¥é”ï¼Œè¿˜æ˜¯è‡ªæ—‹é”ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¿æŒè€…ï¼Œä¹Ÿå°±è¯´ï¼Œåœ¨ä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œå•å…ƒè·å¾—é”</strong>ã€‚ä½†æ˜¯ä¸¤è€…åœ¨è°ƒåº¦æœºåˆ¶ä¸Šç•¥æœ‰ä¸åŒã€‚å¯¹äºäº’æ–¥é”ï¼Œå¦‚æœèµ„æºå·²ç»è¢«å ç”¨ï¼Œèµ„æºç”³è¯·è€…åªèƒ½è¿›å…¥ç¡çœ çŠ¶æ€ã€‚ä½†æ˜¯è‡ªæ—‹é”ä¸ä¼šå¼•èµ·è°ƒç”¨è€…ç¡çœ ï¼Œå¦‚æœè‡ªæ—‹é”å·²ç»è¢«åˆ«çš„æ‰§è¡Œå•å…ƒä¿æŒï¼Œè°ƒç”¨è€…å°±ä¸€ç›´å¾ªç¯åœ¨é‚£é‡Œçœ‹æ˜¯å¦è¯¥è‡ªæ—‹é”çš„ä¿æŒè€…å·²ç»é‡Šæ”¾äº†é”ï¼Œâ€è‡ªæ—‹â€ä¸€è¯å°±æ˜¯å› æ­¤è€Œå¾—åã€‚</p>
<h3 id="Javaå¦‚ä½•å®ç°è‡ªæ—‹é”ï¼Ÿ"><a href="#Javaå¦‚ä½•å®ç°è‡ªæ—‹é”ï¼Ÿ" class="headerlink" title="Javaå¦‚ä½•å®ç°è‡ªæ—‹é”ï¼Ÿ"></a>Javaå¦‚ä½•å®ç°è‡ªæ—‹é”ï¼Ÿ</h3><p>ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpinLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Thread&gt; cas = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="comment">// åˆ©ç”¨CAS</span></span><br><span class="line">        <span class="keyword">while</span> (!cas.compareAndSet(<span class="keyword">null</span>, current)) &#123;</span><br><span class="line">            <span class="comment">// DO nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        cas.compareAndSet(current, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>lockï¼ˆ)æ–¹æ³•åˆ©ç”¨çš„CASï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹Aè·å–é”çš„æ—¶å€™ï¼Œèƒ½å¤ŸæˆåŠŸè·å–åˆ°ï¼Œä¸ä¼šè¿›å…¥whileå¾ªç¯ï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹Aæ²¡æœ‰é‡Šæ”¾é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹Båˆæ¥è·å–é”ï¼Œæ­¤æ—¶ç”±äºä¸æ»¡è¶³CASï¼Œæ‰€ä»¥å°±ä¼šè¿›å…¥whileå¾ªç¯ï¼Œä¸æ–­åˆ¤æ–­æ˜¯å¦æ»¡è¶³CASï¼Œç›´åˆ°Açº¿ç¨‹è°ƒç”¨unlockæ–¹æ³•é‡Šæ”¾äº†è¯¥é”ã€‚</p>
<h3 id="è‡ªæ—‹é”å­˜åœ¨çš„é—®é¢˜"><a href="#è‡ªæ—‹é”å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="è‡ªæ—‹é”å­˜åœ¨çš„é—®é¢˜"></a>è‡ªæ—‹é”å­˜åœ¨çš„é—®é¢˜</h3><p>1ã€å¦‚æœæŸä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒç­‰å¾…è·å–é”çš„çº¿ç¨‹è¿›å…¥å¾ªç¯ç­‰å¾…ï¼Œæ¶ˆè€—CPUã€‚ä½¿ç”¨ä¸å½“ä¼šé€ æˆCPUä½¿ç”¨ç‡æé«˜ã€‚<br>2ã€ä¸Šé¢Javaå®ç°çš„è‡ªæ—‹é”ä¸æ˜¯å…¬å¹³çš„ï¼Œå³æ— æ³•æ»¡è¶³ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚ä¸å…¬å¹³çš„é”å°±ä¼šå­˜åœ¨â€œçº¿ç¨‹é¥¥é¥¿â€é—®é¢˜ã€‚</p>
<h3 id="è‡ªæ—‹é”çš„ä¼˜ç‚¹"><a href="#è‡ªæ—‹é”çš„ä¼˜ç‚¹" class="headerlink" title="è‡ªæ—‹é”çš„ä¼˜ç‚¹"></a>è‡ªæ—‹é”çš„ä¼˜ç‚¹</h3><p>1ã€è‡ªæ—‹é”ä¸ä¼šä½¿çº¿ç¨‹çŠ¶æ€å‘ç”Ÿåˆ‡æ¢ï¼Œä¸€ç›´å¤„äºç”¨æˆ·æ€ï¼Œå³çº¿ç¨‹ä¸€ç›´éƒ½æ˜¯activeçš„ï¼›ä¸ä¼šä½¿çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰§è¡Œé€Ÿåº¦å¿«<br>2ã€éè‡ªæ—‹é”åœ¨è·å–ä¸åˆ°é”çš„æ—¶å€™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä»è€Œè¿›å…¥å†…æ ¸æ€ï¼Œå½“è·å–åˆ°é”çš„æ—¶å€™éœ€è¦ä»å†…æ ¸æ€æ¢å¤ï¼Œéœ€è¦çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ï¼ˆçº¿ç¨‹è¢«é˜»å¡åä¾¿è¿›å…¥å†…æ ¸ï¼ˆLinuxï¼‰è°ƒåº¦çŠ¶æ€ï¼Œè¿™ä¸ªä¼šå¯¼è‡´ç³»ç»Ÿåœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä¸¥é‡å½±å“é”çš„æ€§èƒ½ï¼‰</p>
<h3 id="å¯é‡å…¥çš„è‡ªæ—‹é”å’Œä¸å¯é‡å…¥çš„è‡ªæ—‹é”"><a href="#å¯é‡å…¥çš„è‡ªæ—‹é”å’Œä¸å¯é‡å…¥çš„è‡ªæ—‹é”" class="headerlink" title="å¯é‡å…¥çš„è‡ªæ—‹é”å’Œä¸å¯é‡å…¥çš„è‡ªæ—‹é”"></a>å¯é‡å…¥çš„è‡ªæ—‹é”å’Œä¸å¯é‡å…¥çš„è‡ªæ—‹é”</h3><p>æ–‡ç« å¼€å§‹çš„æ—¶å€™çš„é‚£æ®µä»£ç ï¼Œä»”ç»†åˆ†æä¸€ä¸‹å°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯ä¸æ”¯æŒé‡å…¥çš„ï¼Œå³å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡å·²ç»è·å–åˆ°äº†è¯¥é”ï¼Œåœ¨é”é‡Šæ”¾ä¹‹å‰åˆä¸€æ¬¡é‡æ–°è·å–è¯¥é”ï¼Œç¬¬äºŒæ¬¡å°±ä¸èƒ½æˆåŠŸè·å–åˆ°ã€‚ç”±äºä¸æ»¡è¶³CASï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è·å–ä¼šè¿›å…¥whileå¾ªç¯ç­‰å¾…ï¼Œè€Œå¦‚æœæ˜¯å¯é‡å…¥é”ï¼Œç¬¬äºŒæ¬¡ä¹Ÿæ˜¯åº”è¯¥èƒ½å¤ŸæˆåŠŸè·å–åˆ°çš„ã€‚</p>
<p>è€Œä¸”ï¼Œå³ä½¿ç¬¬äºŒæ¬¡èƒ½å¤ŸæˆåŠŸè·å–ï¼Œé‚£ä¹ˆå½“ç¬¬ä¸€æ¬¡é‡Šæ”¾é”çš„æ—¶å€™ï¼Œç¬¬äºŒæ¬¡è·å–åˆ°çš„é”ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œè€Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p>
<p>ä¸ºäº†å®ç°å¯é‡å…¥é”ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨æ¥è®°å½•è·å–é”çš„çº¿ç¨‹æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantSpinLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Thread&gt; cas = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span> (current == cas.get()) &#123; <span class="comment">// å¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–åˆ°äº†é”ï¼Œçº¿ç¨‹æ•°å¢åŠ ä¸€ï¼Œç„¶åè¿”å›</span></span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡è·å–åˆ°é”ï¼Œåˆ™é€šè¿‡CASè‡ªæ—‹</span></span><br><span class="line">        <span class="keyword">while</span> (!cas.compareAndSet(<span class="keyword">null</span>, current)) &#123;</span><br><span class="line">            <span class="comment">// DO nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread cur = Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span> (cur == cas.get()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;<span class="comment">// å¦‚æœå¤§äº0ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å¤šæ¬¡è·å–äº†è¯¥é”ï¼Œé‡Šæ”¾é”é€šè¿‡countå‡ä¸€æ¥æ¨¡æ‹Ÿ</span></span><br><span class="line">                count--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;<span class="comment">// å¦‚æœcount==0ï¼Œå¯ä»¥å°†é”é‡Šæ”¾ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è·å–é”çš„æ¬¡æ•°ä¸é‡Šæ”¾é”çš„æ¬¡æ•°æ˜¯ä¸€è‡´çš„äº†ã€‚</span></span><br><span class="line">                cas.compareAndSet(cur, <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è‡ªæ—‹é”ä¸äº’æ–¥é”"><a href="#è‡ªæ—‹é”ä¸äº’æ–¥é”" class="headerlink" title="è‡ªæ—‹é”ä¸äº’æ–¥é”"></a>è‡ªæ—‹é”ä¸äº’æ–¥é”</h3><ul>
<li>è‡ªæ—‹é”ä¸äº’æ–¥é”éƒ½æ˜¯ä¸ºäº†å®ç°ä¿æŠ¤èµ„æºå…±äº«çš„æœºåˆ¶ã€‚</li>
<li>æ— è®ºæ˜¯è‡ªæ—‹é”è¿˜æ˜¯äº’æ–¥é”ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œéƒ½æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¿æŒè€…ã€‚</li>
<li>è·å–äº’æ–¥é”çš„çº¿ç¨‹ï¼Œå¦‚æœé”å·²ç»è¢«å ç”¨ï¼Œåˆ™è¯¥çº¿ç¨‹å°†è¿›å…¥ç¡çœ çŠ¶æ€ï¼›è·å–è‡ªæ—‹é”çš„çº¿ç¨‹åˆ™ä¸ä¼šç¡çœ ï¼Œè€Œæ˜¯ä¸€ç›´å¾ªç¯ç­‰å¾…é”é‡Šæ”¾ã€‚</li>
</ul>
<h3 id="è‡ªæ—‹é”æ€»ç»“"><a href="#è‡ªæ—‹é”æ€»ç»“" class="headerlink" title="è‡ªæ—‹é”æ€»ç»“"></a>è‡ªæ—‹é”æ€»ç»“</h3><ul>
<li>è‡ªæ—‹é”ï¼šçº¿ç¨‹è·å–é”çš„æ—¶å€™ï¼Œå¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹å°†å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°é”ã€‚</li>
<li>è‡ªæ—‹é”ç­‰å¾…æœŸé—´ï¼Œçº¿ç¨‹çš„çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œçº¿ç¨‹ä¸€ç›´æ˜¯ç”¨æˆ·æ€å¹¶ä¸”æ˜¯æ´»åŠ¨çš„(active)ã€‚</li>
<li>è‡ªæ—‹é”å¦‚æœæŒæœ‰é”çš„æ—¶é—´å¤ªé•¿ï¼Œåˆ™ä¼šå¯¼è‡´å…¶å®ƒç­‰å¾…è·å–é”çš„çº¿ç¨‹è€—å°½CPUã€‚</li>
<li>è‡ªæ—‹é”æœ¬èº«æ— æ³•ä¿è¯å…¬å¹³æ€§ï¼ŒåŒæ—¶ä¹Ÿæ— æ³•ä¿è¯å¯é‡å…¥æ€§ã€‚</li>
<li>åŸºäºè‡ªæ—‹é”ï¼Œå¯ä»¥å®ç°å…·å¤‡å…¬å¹³æ€§å’Œå¯é‡å…¥æ€§è´¨çš„é”ã€‚</li>
</ul>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼š æœäº‘åº“æŠ€æœ¯å›¢é˜Ÿ<br>åŸæ–‡é“¾æ¥ï¼š <a href="https://segmentfault.com/a/1190000017766364" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017766364</a><br><strong>ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„</strong></p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>è½»æ¾ææ‡‚äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
    <url>/%E8%BD%AC%E8%BD%BD/%E8%BD%BB%E6%9D%BE%E6%90%9E%E6%87%82%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB.html</url>
    <content><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡?"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡?</h3><p>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p>
<p>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼šå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒï¼Œå°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒã€‚ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚</p>
<h3 id="äº‹åŠ¡çš„ç‰¹æ€§-ACID"><a href="#äº‹åŠ¡çš„ç‰¹æ€§-ACID" class="headerlink" title="äº‹åŠ¡çš„ç‰¹æ€§(ACID)"></a>äº‹åŠ¡çš„ç‰¹æ€§(ACID)</h3><p><img src="http://qiniu.mrain22.cn/201904091005_59.png" alt=""></p>
<ul>
<li><strong>åŸå­æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li>
<li><strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼›</li>
<li><strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹ç‰©ä¸è¢«å…¶ä»–äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</li>
<li><strong>æŒä¹…æ€§:</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li>
</ul>
<h3 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜</h3><p>åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹ç»Ÿä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚</p>
<ul>
<li><strong>è„è¯»ï¼ˆDirty readï¼‰:</strong> å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚</li>
<li><strong>ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰:</strong> æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡1è¯»å–æŸè¡¨ä¸­çš„æ•°æ®A=20ï¼Œäº‹åŠ¡2ä¹Ÿè¯»å–A=20ï¼Œäº‹åŠ¡1ä¿®æ”¹A=A-1ï¼Œäº‹åŠ¡2ä¹Ÿä¿®æ”¹A=A-1ï¼Œæœ€ç»ˆç»“æœA=19ï¼Œäº‹åŠ¡1çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚</li>
<li><strong>ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatablereadï¼‰:</strong> æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</li>
<li><strong>å¹»è¯»ï¼ˆPhantom readï¼‰:</strong> å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚</li>
</ul>
<h4 id="ä¸å¯é‡å¤åº¦å’Œå¹»è¯»åŒºåˆ«ï¼š"><a href="#ä¸å¯é‡å¤åº¦å’Œå¹»è¯»åŒºåˆ«ï¼š" class="headerlink" title="ä¸å¯é‡å¤åº¦å’Œå¹»è¯»åŒºåˆ«ï¼š"></a><strong>ä¸å¯é‡å¤åº¦å’Œå¹»è¯»åŒºåˆ«ï¼š</strong></h4><p>ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤ã€‚</p>
<p><strong>ä¾‹1</strong>ï¼ˆåŒæ ·çš„æ¡ä»¶, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘ç°å€¼ä¸ä¸€æ ·äº† ï¼‰ï¼šäº‹åŠ¡1ä¸­çš„Aå…ˆç”Ÿè¯»å–è‡ªå·±çš„å·¥èµ„ä¸º 1000çš„æ“ä½œè¿˜æ²¡å®Œæˆï¼Œäº‹åŠ¡2ä¸­çš„Bå…ˆç”Ÿå°±ä¿®æ”¹äº†Açš„å·¥èµ„ä¸º2000ï¼Œå¯¼ è‡´Aå†è¯»è‡ªå·±çš„å·¥èµ„æ—¶å·¥èµ„å˜ä¸º 2000ï¼›è¿™å°±æ˜¯ä¸å¯é‡å¤è¯»ã€‚</p>
<p><strong>ä¾‹2</strong>ï¼ˆåŒæ ·çš„æ¡ä»¶, ç¬¬1æ¬¡å’Œç¬¬2æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ · ï¼‰ï¼šå‡æŸå·¥èµ„å•è¡¨ä¸­å·¥èµ„å¤§äº3000çš„æœ‰4äººï¼Œäº‹åŠ¡1è¯»å–äº†æ‰€æœ‰å·¥èµ„å¤§äº3000çš„äººï¼Œå…±æŸ¥åˆ°4æ¡è®°å½•ï¼Œè¿™æ—¶äº‹åŠ¡2 åˆæ’å…¥äº†ä¸€æ¡å·¥èµ„å¤§äº3000çš„è®°å½•ï¼Œäº‹åŠ¡1å†æ¬¡è¯»å–æ—¶æŸ¥åˆ°çš„è®°å½•å°±å˜ä¸ºäº†5æ¡ï¼Œè¿™æ ·å°±å¯¼è‡´äº†å¹»è¯»ã€‚</p>
<h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p><strong>SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</strong></p>
<ul>
<li><strong>READ-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼š</strong> æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<em>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</em></li>
<li><strong>READ-COMMITTED(è¯»å–å·²æäº¤):</strong> å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<em>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</em></li>
<li><strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰:</strong> å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<em>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</em></li>
<li><strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–):</strong> æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<em>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚</em></li>
</ul>
<p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>SELECT @@tx_isolation;</code>å‘½ä»¤æ¥æŸ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ SQL æ ‡å‡†ä¸åŒçš„åœ°æ–¹åœ¨äºInnoDB å­˜å‚¨å¼•æ“åœ¨ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä½¿ç”¨çš„æ˜¯Next-Key Lock é”ç®—æ³•ï¼Œå› æ­¤å¯ä»¥é¿å…å¹»è¯»çš„äº§ç”Ÿï¼Œè¿™ä¸å…¶ä»–æ•°æ®åº“ç³»ç»Ÿ(å¦‚ SQL Server)æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥è¯´InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong> å·²ç»å¯ä»¥å®Œå…¨ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§è¦æ±‚ï¼Œå³è¾¾åˆ°äº† SQLæ ‡å‡†çš„<strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)</strong>éš”ç¦»çº§åˆ«ã€‚</p>
<p>å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯<strong>READ-COMMITTED(è¯»å–æäº¤å†…å®¹):</strong>ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</p>
<p>InnoDB å­˜å‚¨å¼•æ“åœ¨ <strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong> çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ°<strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)</strong>éš”ç¦»çº§åˆ«ã€‚</p>
</blockquote>
<h3 id="å®é™…æƒ…å†µæ¼”ç¤º"><a href="#å®é™…æƒ…å†µæ¼”ç¤º" class="headerlink" title="å®é™…æƒ…å†µæ¼”ç¤º"></a>å®é™…æƒ…å†µæ¼”ç¤º</h3><p>MySQL å‘½ä»¤è¡Œçš„é»˜è®¤é…ç½®ä¸­äº‹åŠ¡éƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œå³æ‰§è¡ŒSQLè¯­å¥åå°±ä¼šé©¬ä¸Šæ‰§è¡Œ COMMIT æ“ä½œã€‚å¦‚æœè¦æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä½¿ç”¨å‘½ä»¤ï¼š<code>START TARNSACTION</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®éš”ç¦»çº§åˆ«ã€‚</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨ä¸‹é¢å®é™…æ“ä½œä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›å¹¶å‘æ§åˆ¶è¯­å¥:</p>
<p>â€¢<code>START TARNSACTION</code> |<code>BEGIN</code>:æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚â€¢<code>COMMIT</code>:æäº¤äº‹åŠ¡ï¼Œä½¿å¾—å¯¹æ•°æ®åº“åšçš„æ‰€æœ‰ä¿®æ”¹æˆä¸ºæ°¸ä¹…æ€§ã€‚â€¢<code>ROLLBACK</code> å›æ»šä¼šç»“æŸç”¨æˆ·çš„äº‹åŠ¡ï¼Œå¹¶æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ã€‚</p>
<p><strong>åœ¨ä¸‹é¢æˆ‘ä¼šä½¿ç”¨ 2 ä¸ªå‘½ä»¤è¡Œ MySQL ï¼Œæ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼ˆå¤šäº‹åŠ¡ï¼‰ã€‚</strong></p>
<h4 id="è„è¯»-è¯»æœªæäº¤"><a href="#è„è¯»-è¯»æœªæäº¤" class="headerlink" title="è„è¯»(è¯»æœªæäº¤)"></a>è„è¯»(è¯»æœªæäº¤)</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8xIXqZW7X0t4r6L1rz2fySn4GJDNQKmKXYLWw6xiaEnhLTemyI8gkDFMg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p>
<h4 id="é¿å…è„è¯»-è¯»å·²æäº¤"><a href="#é¿å…è„è¯»-è¯»å·²æäº¤" class="headerlink" title="é¿å…è„è¯»(è¯»å·²æäº¤)"></a>é¿å…è„è¯»(è¯»å·²æäº¤)</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8xI1w1ew6rmr64fpl2ldueVgO8nId7PeEwViaibcjejVHlRZCW2floPe9w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p>
<h4 id="ä¸å¯é‡å¤è¯»"><a href="#ä¸å¯é‡å¤è¯»" class="headerlink" title="ä¸å¯é‡å¤è¯»"></a>ä¸å¯é‡å¤è¯»</h4><p>è¿˜æ˜¯åˆšæ‰ä¸Šé¢çš„è¯»å·²æäº¤çš„å›¾ï¼Œè™½ç„¶é¿å…äº†è¯»æœªæäº¤ï¼Œä½†æ˜¯å´å‡ºç°äº†ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸï¼Œå°±å‘ç”Ÿäº† ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8xPO0sKQUAqx3NWriabBicbQzLwYnpBEsULiacFibuibuBe8TC2USy5tKDeOw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p>
<h4 id="å¯é‡å¤è¯»"><a href="#å¯é‡å¤è¯»" class="headerlink" title="å¯é‡å¤è¯»"></a>å¯é‡å¤è¯»</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8x5kTMec5bOHcdIP0CCoU0BCc1anWNYsUxjT2a5rnblia0GDUS0libaficw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p>
<h4 id="é˜²æ­¢å¹»è¯»-å¯é‡å¤è¯»"><a href="#é˜²æ­¢å¹»è¯»-å¯é‡å¤è¯»" class="headerlink" title="é˜²æ­¢å¹»è¯»(å¯é‡å¤è¯»)"></a>é˜²æ­¢å¹»è¯»(å¯é‡å¤è¯»)</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8xg1ADPPKhaKfIicKYTTPqkqOIJmM258ZGq3cWStaqHmjWv9nnKcdiaic4w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p>
<p>ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œè¿™ç§æ“ä½œçš„èŒƒå›´æ˜¯æ•°æ®åº“çš„å…¨éƒ¨è¡Œï¼Œç„¶åç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿåœ¨å¯¹è¿™ä¸ªæ•°æ®åº“æ“ä½œï¼Œè¿™ç§æ“ä½œå¯ä»¥æ˜¯æ’å…¥ä¸€è¡Œè®°å½•æˆ–åˆ é™¤ä¸€è¡Œè®°å½•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ˜¯äº‹åŠ¡å°±ä¼šè§‰å¾—è‡ªå·±å‡ºç°äº†å¹»è§‰ï¼Œæ€ä¹ˆè¿˜æœ‰æ²¡æœ‰å¤„ç†çš„è®°å½•å‘¢? æˆ–è€… æ€ä¹ˆå¤šå¤„ç†äº†ä¸€è¡Œè®°å½•å‘¢?</p>
<p>å¹»è¯»å’Œä¸å¯é‡å¤è¯»æœ‰äº›ç›¸ä¼¼ä¹‹å¤„ ï¼Œä½†æ˜¯ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼š SnailClimb<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/WhK3SrkMDTj1_o2zp64ArQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/WhK3SrkMDTj1_o2zp64ArQ</a><br><strong>ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„</strong></p>
</blockquote>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 8ä¸­å­—ç¬¦ä¸²æ‹¼æ¥æ–°å§¿åŠ¿:StringJoiner</title>
    <url>/%E8%BD%AC%E8%BD%BD/Java-8%E4%B8%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%96%B0%E5%A7%BF%E5%8A%BF-StringJoiner.html</url>
    <content><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>StringJoineræ˜¯java.utilåŒ…ä¸­çš„ä¸€ä¸ªç±»ï¼Œç”¨äºæ„é€ ä¸€ä¸ªç”±åˆ†éš”ç¬¦åˆ†éš”çš„å­—ç¬¦åºåˆ—ï¼ˆå¯é€‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä»æä¾›çš„å‰ç¼€å¼€å§‹å¹¶ä»¥æä¾›çš„åç¼€ç»“å°¾ã€‚è™½ç„¶è¿™ä¹Ÿå¯ä»¥åœ¨StringBuilderç±»çš„å¸®åŠ©ä¸‹åœ¨æ¯ä¸ªå­—ç¬¦ä¸²ä¹‹åé™„åŠ åˆ†éš”ç¬¦ï¼Œä½†StringJoineræä¾›äº†ç®€å•çš„æ–¹æ³•æ¥å®ç°ï¼Œè€Œæ— éœ€ç¼–å†™å¤§é‡ä»£ç ã€‚</p>
<p>StringJoinerç±»å…±æœ‰2ä¸ªæ„é€ å‡½æ•°ï¼Œ5ä¸ªå…¬æœ‰æ–¹æ³•ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯addæ–¹æ³•å’ŒtoStringæ–¹æ³•ï¼Œç±»ä¼¼äºStringBuilderä¸­çš„appendæ–¹æ³•å’ŒtoStringæ–¹æ³•ã€‚</p>
<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>StringJoinerçš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨StringJoinerè¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringJoinerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringJoiner sj = <span class="keyword">new</span> StringJoiner(<span class="string">"Hollis"</span>);</span><br><span class="line"></span><br><span class="line">        sj.add(<span class="string">"hollischuang"</span>);</span><br><span class="line">        sj.add(<span class="string">"Javaå¹²è´§"</span>);</span><br><span class="line">        System.out.println(sj.toString());</span><br><span class="line"></span><br><span class="line">        StringJoiner sj1 = <span class="keyword">new</span> StringJoiner(<span class="string">":"</span>,<span class="string">"["</span>,<span class="string">"]"</span>);</span><br><span class="line"></span><br><span class="line">        sj1.add(<span class="string">"Hollis"</span>).add(<span class="string">"hollischuang"</span>).add(<span class="string">"Javaå¹²è´§"</span>);</span><br><span class="line">        System.out.println(sj1.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">hollischuangHollisJavaå¹²è´§</span><br><span class="line">[Hollis:hollischuang:Javaå¹²è´§]</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬<code>StringJoiner(CharSequence delimiter)</code>åˆå§‹åŒ–ä¸€ä¸ª<code>StringJoiner</code>çš„æ—¶å€™ï¼Œè¿™ä¸ª<code>delimiter</code>å…¶å®æ˜¯åˆ†éš”ç¬¦ï¼Œå¹¶ä¸æ˜¯å¯å˜å­—ç¬¦ä¸²çš„åˆå§‹å€¼ã€‚</p>
<p><code>StringJoiner(CharSequence delimiter,CharSequence prefix,CharSequence suffix)</code>çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æ‹¼æ¥åçš„å­—ç¬¦ä¸²çš„å‰ç¼€å’Œåç¼€ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ä»‹ç»äº†ç®€å•çš„ç”¨æ³•ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªStringJoinerçš„åŸç†ï¼Œçœ‹çœ‹ä»–åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ã€‚ä¸»è¦çœ‹ä¸€ä¸‹addæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringJoiner <span class="title">add</span><span class="params">(CharSequence newElement)</span> </span>&#123;</span><br><span class="line">    prepareBuilder().append(newElement);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> StringBuilder <span class="title">prepareBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">        value.append(delimiter);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = <span class="keyword">new</span> StringBuilder().append(prefix);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†ä¸€ä¸ªç†Ÿæ‚‰çš„èº«å½±â€”â€”StringBuilder ï¼Œæ²¡é”™ï¼ŒStringJoinerå…¶å®å°±æ˜¯ä¾èµ–StringBuilderå®ç°çš„ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»è¿‡StringBuilderçš„å®ç°åŸç†ï¼Œæœ¬æ–‡ä¸åœ¨èµ˜è¿°ã€‚</p>
<p>å½“æˆ‘ä»¬å‘ç°StringJoinerå…¶å®æ˜¯é€šè¿‡StringBuilderå®ç°ä¹‹åï¼Œæˆ‘ä»¬å¤§æ¦‚å°±å¯ä»¥çŒœåˆ°ï¼Œ<strong>ä»–çš„æ€§èƒ½æŸè€—åº”è¯¥å’Œç›´æ¥ä½¿ç”¨StringBuilderå·®ä¸å¤š</strong>ï¼</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦StringJoiner"><a href="#ä¸ºä»€ä¹ˆéœ€è¦StringJoiner" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦StringJoiner"></a>ä¸ºä»€ä¹ˆéœ€è¦StringJoiner</h3><p>åœ¨äº†è§£äº†StringJoinerçš„ç”¨æ³•å’ŒåŸç†åï¼Œå¯èƒ½å¾ˆå¤šè¯»è€…å°±ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Œæ˜æ˜å·²ç»æœ‰ä¸€ä¸ªStringBuilderäº†ï¼Œä¸ºä»€ä¹ˆJava 8ä¸­è¿˜è¦å®šä¹‰ä¸€ä¸ªStringJoinerå‘¢ï¼Ÿåˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>
<p>å¦‚æœè¯»è€…è¶³å¤Ÿäº†è§£Java 8çš„è¯ï¼Œæˆ–è®¸å¯ä»¥çŒœå‡ºä¸ªå¤§æ¦‚ï¼Œè¿™è‚¯å®šå’ŒStreamæœ‰å…³ã€‚</p>
<p>ä½œè€…ä¹Ÿåœ¨<a href="https://docs.oracle.com/javase/8/docs/api/java/util/StringJoiner.html" target="_blank" rel="noopener">Java doc</a>ä¸­æ‰¾åˆ°äº†ç­”æ¡ˆï¼š</p>
<blockquote>
<p>A StringJoiner may be employed to create formatted output from a Stream using Collectors.joining(CharSequence)</p>
</blockquote>
<p>è¯•æƒ³ï¼Œåœ¨Javaä¸­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªListï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = ImmutableList.of(<span class="string">"Hollis"</span>,<span class="string">"hollischuang"</span>,<span class="string">"Javaå¹²è´§"</span>);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠä»–æ‹¼æ¥æˆä¸€ä¸ªä»¥ä¸‹å½¢å¼çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Hollis,hollischuang,Javaå¹²è´§</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!list.isEmpty()) &#123;</span><br><span class="line">    builder.append(list.get(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, n = list.size(); i &lt; n; i++) &#123;</span><br><span class="line">        builder.append(<span class="string">","</span>).append(list.get(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">builder.toString();</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().reduce(<span class="keyword">new</span> StringBuilder(), (sb, s) -&gt; sb.append(s).append(<span class="string">','</span>), StringBuilder::append).toString();</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¾“å‡ºç»“æœç¨æœ‰äº›ä¸åŒï¼Œéœ€è¦è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Hollis,hollischuang,Javaå¹²è´§,</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥ä½¿ç”¨â€+â€è¿›è¡Œæ‹¼æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().reduce((a,b)-&gt;a + <span class="string">","</span> + b).toString();</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå‡ ç§æ–¹å¼ï¼Œè¦ä¹ˆæ˜¯ä»£ç å¤æ‚ï¼Œè¦ä¹ˆæ˜¯æ€§èƒ½ä¸é«˜ï¼Œæˆ–è€…æ— æ³•ç›´æ¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚</p>
<p>ä¸ºäº†æ»¡è¶³ç±»ä¼¼è¿™æ ·çš„éœ€æ±‚ï¼ŒJava 8ä¸­æä¾›çš„StringJoinerå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä»¥ä¸Šéœ€æ±‚åªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().collect(Collectors.joining(<span class="string">":"</span>))</span><br></pre></td></tr></table></figure>
<p>å³å¯ã€‚ä¸Šé¢ç”¨çš„è¡¨è¾¾å¼ä¸­ï¼ŒCollectors.joiningçš„æºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Collector&lt;CharSequence, ?, String&gt; joining(CharSequence delimiter,</span><br><span class="line">                                                         CharSequence prefix,</span><br><span class="line">                                                         CharSequence suffix) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CollectorImpl&lt;&gt;(</span><br><span class="line">            () -&gt; <span class="keyword">new</span> StringJoiner(delimiter, prefix, suffix),</span><br><span class="line">            StringJoiner::add, StringJoiner::merge,</span><br><span class="line">            StringJoiner::toString, CH_NOID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®ç°åŸç†å°±æ˜¯å€ŸåŠ©äº†StringJoinerã€‚</p>
<p>å½“ç„¶ï¼Œæˆ–è®¸åœ¨<code>Collector</code>ä¸­ç›´æ¥ä½¿ç”¨<code>StringBuilder</code>ä¼¼ä¹ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåªä¸è¿‡ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚æ‰€ä»¥ï¼ŒJava 8ä¸­æä¾›äº†<code>StringJoiner</code>æ¥ä¸°å¯Œ<code>Stream</code>çš„ç”¨æ³•ã€‚</p>
<p>è€Œä¸”<code>StringJoiner</code>ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„å¢åŠ å‰ç¼€å’Œåç¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„å­—ç¬¦ä¸²æ˜¯<code>[Hollis,hollischuang,Javaå¹²è´§]</code>è€Œä¸æ˜¯<code>Hollis,hollischuang,Java</code>å¹²è´§çš„è¯ï¼ŒStringJoinerçš„ä¼˜åŠ¿å°±æ›´åŠ æ˜æ˜¾äº†ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†Java 8ä¸­æä¾›çš„å¯å˜å­—ç¬¦ä¸²ç±»â€”â€”<code>StringJoiner</code>ï¼Œå¯ä»¥ç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p>
<p><code>StringJoiner</code>å…¶å®æ˜¯é€šè¿‡<code>StringBuilder</code>å®ç°çš„ï¼Œæ‰€ä»¥ä»–çš„æ€§èƒ½å’Œ<code>StringBuilder</code>å·®ä¸å¤šï¼Œä»–ä¹Ÿæ˜¯<code>éçº¿ç¨‹å®‰å…¨</code>çš„ã€‚</p>
<p>å¦‚æœæ—¥å¸¸å¼€å‘ä¸­ä¸­ï¼Œéœ€è¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ</p>
<p>1ã€å¦‚æœåªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€ƒè™‘ç›´æ¥ä½¿ç”¨<code>+</code>å³å¯ã€‚</p>
<p>2ã€å¦‚æœæ˜¯åœ¨<code>forå¾ªç¯</code>ä¸­è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€ƒè™‘ä½¿ç”¨<code>StringBuilder</code>å’Œ<code>StringBuffer</code>ã€‚</p>
<p>3ã€å¦‚æœæ˜¯é€šè¿‡ä¸€ä¸ª<code>List</code>è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨<code>StringJoiner</code>ã€‚</p>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå­—ç¬¦ä¸²æ‹¼æ¥çš„å®ç°åŸç†(append,concat,+,StringUtils.join)</title>
    <url>/%E8%BD%AC%E8%BD%BD/Java%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-append-concat-StringUtils-join.html</url>
    <content><![CDATA[<h3 id="å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥"></a>å­—ç¬¦ä¸²æ‹¼æ¥</h3><p>å­—ç¬¦ä¸²æ‹¼æ¥æ˜¯æˆ‘ä»¬åœ¨Javaä»£ç ä¸­æ¯”è¾ƒç»å¸¸è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥åˆ°ä¸€èµ·ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<strong>Stringæ˜¯Javaä¸­ä¸€ä¸ªä¸å¯å˜çš„ç±»</strong>ï¼Œæ‰€ä»¥ä»–ä¸€æ—¦è¢«å®ä¾‹åŒ–å°±æ— æ³•è¢«ä¿®æ”¹ã€‚</p>
<blockquote>
<p>ä¸å¯å˜ç±»çš„å®ä¾‹ä¸€æ—¦åˆ›å»ºï¼Œå…¶æˆå‘˜å˜é‡çš„å€¼å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™æ ·è®¾è®¡æœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚å¯ä»¥ç¼“å­˜hashcodeã€ä½¿ç”¨æ›´åŠ ä¾¿åˆ©ä»¥åŠæ›´åŠ å®‰å…¨ç­‰ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œæ—¢ç„¶å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²æ‹¼æ¥åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>
<p><strong>å­—ç¬¦ä¸²ä¸å˜æ€§ä¸å­—ç¬¦ä¸²æ‹¼æ¥</strong></p>
<p>å…¶å®ï¼Œæ‰€æœ‰çš„æ‰€è°“å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéƒ½æ˜¯é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚ä¸‹é¢ä¸€æ®µå­—ç¬¦ä¸²æ‹¼æ¥ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">"abcd"</span>;</span><br><span class="line">s = s.concat(<span class="string">"ef"</span>);</span><br></pre></td></tr></table></figure>
<p>å…¶å®æœ€åæˆ‘ä»¬å¾—åˆ°çš„<code>s</code>å·²ç»æ˜¯ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²äº†ã€‚å¦‚ä¸‹å›¾</p>
<p><img src="http://qiniu.mrain22.cn/201903250917_507.png" alt=""></p>
<p>sä¸­ä¿å­˜çš„æ˜¯ä¸€ä¸ªé‡æ–°åˆ›å»ºå‡ºæ¥çš„Stringå¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨Javaä¸­ï¼Œåˆ°åº•å¦‚ä½•è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥å‘¢ï¼Ÿå­—ç¬¦ä¸²æ‹¼æ¥æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œè¿™é‡Œç®€å•ä»‹ç»å‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„ã€‚</p>
<p><strong>ä½¿ç”¨+æ‹¼æ¥å­—ç¬¦ä¸²</strong></p>
<p>åœ¨Javaä¸­ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´æ¥ä½¿ç”¨ç¬¦å·<code>+</code>æ¥æ‹¼æ¥ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String wechat = <span class="string">"Hollis"</span>;</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">String hollis = wechat + <span class="string">","</span> + introduce;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦ç‰¹åˆ«è¯´æ˜ä¸€ç‚¹ï¼Œæœ‰äººæŠŠJavaä¸­ä½¿ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²çš„åŠŸèƒ½ç†è§£ä¸º<strong>è¿ç®—ç¬¦é‡è½½</strong>ã€‚å…¶å®å¹¶ä¸æ˜¯ï¼Œ<strong>Javaæ˜¯ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½çš„</strong>ã€‚è¿™å…¶å®åªæ˜¯Javaæä¾›çš„ä¸€ä¸ª<strong>è¯­æ³•ç³–</strong>ã€‚åé¢å†è¯¦ç»†ä»‹ç»ã€‚</p>
<blockquote>
<p>è¿ç®—ç¬¦é‡è½½ï¼šåœ¨è®¡ç®—æœºç¨‹åºè®¾è®¡ä¸­ï¼Œè¿ç®—ç¬¦é‡è½½ï¼ˆè‹±è¯­ï¼šoperator overloadingï¼‰æ˜¯å¤šæ€çš„ä¸€ç§ã€‚è¿ç®—ç¬¦é‡è½½ï¼Œå°±æ˜¯å¯¹å·²æœ‰çš„è¿ç®—ç¬¦é‡æ–°è¿›è¡Œå®šä¹‰ï¼Œèµ‹äºˆå…¶å¦ä¸€ç§åŠŸèƒ½ï¼Œä»¥é€‚åº”ä¸åŒçš„æ•°æ®ç±»å‹ã€‚</p>
<p>è¯­æ³•ç³–ï¼šè¯­æ³•ç³–ï¼ˆSyntactic sugarï¼‰ï¼Œä¹Ÿè¯‘ä¸ºç³–è¡£è¯­æ³•ï¼Œæ˜¯ç”±è‹±å›½è®¡ç®—æœºç§‘å­¦å®¶å½¼å¾—Â·å…°ä¸å‘æ˜çš„ä¸€ä¸ªæœ¯è¯­ï¼ŒæŒ‡è®¡ç®—æœºè¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ã€‚è¯­æ³•ç³–è®©ç¨‹åºæ›´åŠ ç®€æ´ï¼Œæœ‰æ›´é«˜çš„å¯è¯»æ€§ã€‚</p>
</blockquote>
<p><strong>concat</strong><br>é™¤äº†ä½¿ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Stringç±»ä¸­çš„æ–¹æ³•concatæ–¹æ³•æ¥æ‹¼æ¥å­—ç¬¦ä¸²ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String wechat = <span class="string">"Hollis"</span>;</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">String hollis = wechat.concat(<span class="string">","</span>).concat(introduce);</span><br></pre></td></tr></table></figure>
<p><strong>StringBuffer</strong></p>
<p>å…³äºå­—ç¬¦ä¸²ï¼ŒJavaä¸­é™¤äº†å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥ç”¨æ¥å®šä¹‰<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>çš„<code>String</code>ç±»ä»¥å¤–ï¼Œè¿˜æä¾›äº†å¯ä»¥ç”¨æ¥å®šä¹‰<strong>å­—ç¬¦ä¸²å˜é‡</strong>çš„<code>StringBuffer</code>ç±»ï¼Œå®ƒçš„å¯¹è±¡æ˜¯å¯ä»¥æ‰©å……å’Œä¿®æ”¹çš„ã€‚</p>
<p>ä½¿ç”¨<code>StringBuffer</code>å¯ä»¥æ–¹ä¾¿çš„å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuffer wechat = <span class="keyword">new</span> StringBuffer(<span class="string">"Hollis"</span>);</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">StringBuffer hollis = wechat.append(<span class="string">","</span>).append(introduce);</span><br></pre></td></tr></table></figure>
<p><strong>StringBuilder</strong><br>é™¤äº†<code>StringBuffer</code>ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç±»<code>StringBuilder</code>ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå…¶ç”¨æ³•å’Œ<code>StringBuffer</code>ç±»ä¼¼ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuilder wechat = <span class="keyword">new</span> StringBuilder(<span class="string">"Hollis"</span>);</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">StringBuilder hollis = wechat.append(<span class="string">","</span>).append(introduce);</span><br></pre></td></tr></table></figure>
<p><strong>StringUtils.join</strong><br>é™¤äº†JDKä¸­å†…ç½®çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å¼€æºç±»åº“ä¸­æä¾›çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•åï¼Œå¦‚<code>apache.commonsä¸­</code>æä¾›çš„<code>StringUtils</code>ç±»ï¼Œå…¶ä¸­çš„<code>join</code>æ–¹æ³•å¯ä»¥æ‹¼æ¥å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String wechat = <span class="string">"Hollis"</span>;</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">System.out.println(StringUtils.join(wechat, <span class="string">","</span>, introduce));</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼ŒStringUtilsä¸­æä¾›çš„joinæ–¹æ³•ï¼Œæœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼šå°†æ•°ç»„æˆ–é›†åˆä»¥æŸæ‹¼æ¥ç¬¦æ‹¼æ¥åˆ°ä¸€èµ·å½¢æˆæ–°çš„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String []list  =&#123;&quot;Hollis&quot;,&quot;æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« &quot;&#125;;</span><br><span class="line">String result= StringUtils.join(list,&quot;,&quot;);</span><br><span class="line">System.out.println(result);</span><br><span class="line">//ç»“æœï¼šHollis,æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« </span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”ï¼ŒJava8ä¸­çš„Stringç±»ä¸­ä¹Ÿæä¾›äº†ä¸€ä¸ªé™æ€çš„joinæ–¹æ³•ï¼Œç”¨æ³•å’ŒStringUtils.joinç±»ä¼¼ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„äº”ç§åœ¨Javaç§æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œé‚£ä¹ˆåˆ°åº•å“ªç§æ›´å¥½ç”¨å‘¢ï¼Ÿä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­ä¸å»ºè®®åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨<code>+</code>è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥å‘¢ï¼Ÿ</p>
<p><img src="http://qiniu.mrain22.cn/201903250919_383.png" alt=""></p>
<p>(é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­å…³äºå­—ç¬¦ä¸²æ‹¼æ¥çš„è§„çº¦)</p>
<h3 id="ä½¿ç”¨-æ‹¼æ¥å­—ç¬¦ä¸²çš„å®ç°åŸç†"><a href="#ä½¿ç”¨-æ‹¼æ¥å­—ç¬¦ä¸²çš„å®ç°åŸç†" class="headerlink" title="ä½¿ç”¨+æ‹¼æ¥å­—ç¬¦ä¸²çš„å®ç°åŸç†"></a>ä½¿ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²çš„å®ç°åŸç†</h3><p>å‰é¢æåˆ°è¿‡ï¼Œä½¿ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå…¶å®åªæ˜¯Javaæä¾›çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±æ¥è§£ä¸€è§£è¿™ä¸ªè¯­æ³•ç³–ï¼Œçœ‹çœ‹ä»–çš„å†…éƒ¨åŸç†åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<p>è¿˜æ˜¯è¿™æ ·ä¸€æ®µä»£ç ã€‚æˆ‘ä»¬æŠŠä»–ç”Ÿæˆçš„å­—èŠ‚ç è¿›è¡Œåç¼–è¯‘ï¼Œçœ‹çœ‹ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String wechat = <span class="string">"Hollis"</span>;</span><br><span class="line">String introduce = <span class="string">"æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« "</span>;</span><br><span class="line">String hollis = wechat + <span class="string">","</span> + introduce;</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘åçš„å†…å®¹å¦‚ä¸‹ï¼Œåç¼–è¯‘å·¥å…·ä¸ºjadã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String wechat = <span class="string">"Hollis"</span>;</span><br><span class="line">String introduce = <span class="string">"\u6BCF\u65E5\u66F4\u65B0Java\u76F8\u5173\u6280\u672F\u6587\u7AE0"</span>;<span class="comment">//æ¯æ—¥æ›´æ–°Javaç›¸å…³æŠ€æœ¯æ–‡ç« </span></span><br><span class="line">String hollis = (<span class="keyword">new</span> StringBuilder()).append(wechat).append(<span class="string">","</span>).append(introduce).toString();</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æŸ¥çœ‹åç¼–è¯‘ä»¥åçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒåŸæ¥å­—ç¬¦ä¸²å¸¸é‡åœ¨æ‹¼æ¥è¿‡ç¨‹ä¸­ï¼Œæ˜¯å°†Stringè½¬æˆäº†StringBuilderåï¼Œä½¿ç”¨å…¶appendæ–¹æ³•è¿›è¡Œå¤„ç†çš„ã€‚</p>
<p>é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒJavaä¸­çš„<code>+</code>å¯¹å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œå…¶å®ç°åŸç†æ˜¯ä½¿ç”¨<code>StringBuilder.append</code>ã€‚</p>
<h3 id="concatæ˜¯å¦‚ä½•å®ç°çš„"><a href="#concatæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="concatæ˜¯å¦‚ä½•å®ç°çš„"></a>concatæ˜¯å¦‚ä½•å®ç°çš„</h3><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹concatæ–¹æ³•çš„æºä»£ç ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åˆæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">concat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> otherLen = str.length();</span><br><span class="line">    <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = value.length;</span><br><span class="line">    <span class="keyword">char</span> buf[] = Arrays.copyOf(value, len + otherLen);</span><br><span class="line">    str.getChars(buf, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œé•¿åº¦æ˜¯å·²æœ‰å­—ç¬¦ä¸²å’Œå¾…æ‹¼æ¥å­—ç¬¦ä¸²çš„é•¿åº¦ä¹‹å’Œï¼Œå†æŠŠä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼å¤åˆ¶åˆ°æ–°çš„å­—ç¬¦æ•°ç»„ä¸­ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªå­—ç¬¦æ•°ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡å¹¶è¿”å›ã€‚</p>
<p>é€šè¿‡æºç æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡concatæ–¹æ³•ï¼Œå…¶å®æ˜¯newäº†ä¸€ä¸ªæ–°çš„Stringï¼Œè¿™ä¹Ÿå°±å‘¼åº”åˆ°å‰é¢æˆ‘ä»¬è¯´çš„å­—ç¬¦ä¸²çš„ä¸å˜æ€§é—®é¢˜ä¸Šäº†ã€‚</p>
<h3 id="StringBufferå’ŒStringBuilderçš„å®ç°"><a href="#StringBufferå’ŒStringBuilderçš„å®ç°" class="headerlink" title="StringBufferå’ŒStringBuilderçš„å®ç°"></a>StringBufferå’ŒStringBuilderçš„å®ç°</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹<code>StringBuffer</code>å’Œ<code>StringBuilder</code>çš„å®ç°åŸç†ã€‚</p>
<p>å’Œ<code>String</code>ç±»ç±»ä¼¼ï¼Œ<code>StringBuilder</code>ç±»ä¹Ÿå°è£…äº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span>[] value;</span><br></pre></td></tr></table></figure>
<p>ä¸<code>String</code>ä¸åŒçš„æ˜¯ï¼Œå®ƒå¹¶ä¸æ˜¯<code>final</code>çš„ï¼Œæ‰€ä»¥ä»–æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚å¦å¤–ï¼Œä¸<code>String</code>ä¸åŒï¼Œå­—ç¬¦æ•°ç»„ä¸­ä¸ä¸€å®šæ‰€æœ‰ä½ç½®éƒ½å·²ç»è¢«ä½¿ç”¨ï¼Œå®ƒæœ‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè¡¨ç¤ºæ•°ç»„ä¸­å·²ç»ä½¿ç”¨çš„å­—ç¬¦ä¸ªæ•°ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> count;</span><br></pre></td></tr></table></figure>
<p>å…¶appendæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥ç±»ç»§æ‰¿äº†<code>AbstractStringBuilder</code>ç±»ï¼Œçœ‹ä¸‹å…¶<code>append</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    <span class="keyword">int</span> len = str.length();</span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>appendä¼šç›´æ¥æ‹·è´å­—ç¬¦åˆ°å†…éƒ¨çš„å­—ç¬¦æ•°ç»„ä¸­ï¼Œå¦‚æœå­—ç¬¦æ•°ç»„é•¿åº¦ä¸å¤Ÿï¼Œä¼šè¿›è¡Œæ‰©å±•ã€‚</p>
<p><code>StringBuffer</code>å’Œ<code>StringBuilder</code>ç±»ä¼¼ï¼Œæœ€å¤§çš„åŒºåˆ«å°±æ˜¯<code>StringBuffer</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œçœ‹ä¸€ä¸‹<code>StringBuffer</code>çš„<code>append</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    toStringCache = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•ä½¿ç”¨<code>synchronized</code>è¿›è¡Œå£°æ˜ï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ–¹æ³•ã€‚è€Œ<code>StringBuilder</code>åˆ™ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h3 id="StringUtils-joinæ˜¯å¦‚ä½•å®ç°çš„"><a href="#StringUtils-joinæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="StringUtils.joinæ˜¯å¦‚ä½•å®ç°çš„"></a>StringUtils.joinæ˜¯å¦‚ä½•å®ç°çš„</h3><p>é€šè¿‡æŸ¥çœ‹<code>StringUtils.join</code>çš„æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®ä»–ä¹Ÿæ˜¯é€šè¿‡<code>StringBuilder</code>æ¥å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(<span class="keyword">final</span> Object[] array, String separator, <span class="keyword">final</span> <span class="keyword">int</span> startIndex, <span class="keyword">final</span> <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (separator == <span class="keyword">null</span>) &#123;</span><br><span class="line">        separator = EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// endIndex - startIndex &gt; 0:   Len = NofStrings *(len(firstString) + len(separator))</span></span><br><span class="line">    <span class="comment">//           (Assuming that all Strings are roughly equally long)</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> noOfItems = endIndex - startIndex;</span><br><span class="line">    <span class="keyword">if</span> (noOfItems &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> StringBuilder buf = <span class="keyword">new</span> StringBuilder(noOfItems * <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = startIndex; i &lt; endIndex; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; startIndex) &#123;</span><br><span class="line">            buf.append(separator);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (array[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">            buf.append(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•ˆç‡æ¯”è¾ƒ"><a href="#æ•ˆç‡æ¯”è¾ƒ" class="headerlink" title="æ•ˆç‡æ¯”è¾ƒ"></a>æ•ˆç‡æ¯”è¾ƒ</h3><p>æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šç§å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåˆ°åº•å“ªä¸€ç§æ•ˆç‡æœ€é«˜å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç®€å•å¯¹æ¯”ä¸€ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line"><span class="comment">//è¿™é‡Œæ˜¯åˆå§‹å­—ç¬¦ä¸²å®šä¹‰</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> t2 = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">"cost:"</span> + (t2 - t1));</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä½¿ç”¨å½¢å¦‚ä»¥ä¸Šå½¢å¼çš„ä»£ç ï¼Œåˆ†åˆ«æµ‹è¯•ä¸‹äº”ç§å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç çš„è¿è¡Œæ—¶é—´ã€‚å¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">+ cost:<span class="number">5119</span></span><br><span class="line">StringBuilder cost:<span class="number">3</span></span><br><span class="line">StringBuffer cost:<span class="number">4</span></span><br><span class="line">concat cost:<span class="number">3623</span></span><br><span class="line">StringUtils.join cost:<span class="number">25726</span></span><br></pre></td></tr></table></figure>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç”¨æ—¶ä»çŸ­åˆ°é•¿çš„å¯¹æ¯”æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuilder`&lt;`StringBuffer`&lt;`concat`&lt;`+`&lt;`StringUtils.join</span><br></pre></td></tr></table></figure>
<p><code>StringBuffer</code>åœ¨<code>StringBuilder</code>çš„åŸºç¡€ä¸Šï¼Œåšäº†åŒæ­¥å¤„ç†ï¼Œæ‰€ä»¥åœ¨è€—æ—¶ä¸Šä¼šç›¸å¯¹å¤šä¸€äº›ã€‚</p>
<p>StringUtils.joinä¹Ÿæ˜¯ä½¿ç”¨äº†StringBuilderï¼Œå¹¶ä¸”å…¶ä¸­è¿˜æ˜¯æœ‰å¾ˆå¤šå…¶ä»–æ“ä½œï¼Œæ‰€ä»¥è€—æ—¶è¾ƒé•¿ï¼Œè¿™ä¸ªä¹Ÿå®¹æ˜“ç†è§£ã€‚å…¶å®StringUtils.joinæ›´æ“…é•¿å¤„ç†å­—ç¬¦ä¸²æ•°ç»„æˆ–è€…åˆ—è¡¨çš„æ‹¼æ¥ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‰é¢æˆ‘ä»¬åˆ†æè¿‡ï¼Œå…¶å®ä½¿ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²çš„å®ç°åŸç†ä¹Ÿæ˜¯ä½¿ç”¨çš„<code>StringBuilder</code>ï¼Œé‚£ä¸ºä»€ä¹ˆç»“æœç›¸å·®è¿™ä¹ˆå¤šï¼Œé«˜è¾¾1000å¤šå€å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å†æŠŠä»¥ä¸‹ä»£ç åç¼–è¯‘ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">String str = <span class="string">"hollis"</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">    String s = String.valueOf(i);</span><br><span class="line">    str += s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> t2 = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">"+ cost:"</span> + (t2 - t1));</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">String str = <span class="string">"hollis"</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    String s = String.valueOf(i);</span><br><span class="line">    str = (<span class="keyword">new</span> StringBuilder()).append(str).append(s).toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> t2 = System.currentTimeMillis();</span><br><span class="line">System.out.println((<span class="keyword">new</span> StringBuilder()).append(<span class="string">"+ cost:"</span>).append(t2 - t1).toString());</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåç¼–è¯‘åçš„ä»£ç ï¼Œåœ¨<code>for</code>å¾ªç¯ä¸­ï¼Œæ¯æ¬¡éƒ½æ˜¯<code>new</code>äº†ä¸€ä¸ª<code>StringBuilder</code>ï¼Œç„¶åå†æŠŠ<code>String</code>è½¬æˆ<code>StringBuilder</code>ï¼Œå†è¿›è¡Œ<code>append</code>ã€‚</p>
<p>è€Œé¢‘ç¹çš„æ–°å»ºå¯¹è±¡å½“ç„¶è¦è€—è´¹å¾ˆå¤šæ—¶é—´äº†ï¼Œä¸ä»…ä»…ä¼šè€—è´¹æ—¶é—´ï¼Œé¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ï¼Œè¿˜ä¼šé€ æˆå†…å­˜èµ„æºçš„æµªè´¹ã€‚</p>
<p>æ‰€ä»¥ï¼Œé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œå»ºè®®ï¼šå¾ªç¯ä½“å†…ï¼Œå­—ç¬¦ä¸²çš„è¿æ¥æ–¹å¼ï¼Œä½¿ç”¨ <code>StringBuilder</code> çš„ <code>append</code> æ–¹æ³•è¿›è¡Œæ‰©å±•ã€‚è€Œä¸è¦ä½¿ç”¨<code>+</code>ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè™½ç„¶å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡æ–°å»ºå­—ç¬¦ä¸²çš„æ–¹å¼æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥ã€‚</p>
<p>å¸¸ç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼æœ‰äº”ç§ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨<code>+</code>ã€ä½¿ç”¨<code>concat</code>ã€ä½¿ç”¨<code>StringBuilder</code>ã€ä½¿ç”¨<code>StringBuffer</code>ä»¥åŠä½¿ç”¨<code>StringUtils.join</code>ã€‚</p>
<p>ç”±äºå­—ç¬¦ä¸²æ‹¼æ¥è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¦‚æœè¦åœ¨ä¸€ä¸ªå¾ªç¯ä½“ä¸­è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°±è¦è€ƒè™‘å†…å­˜é—®é¢˜å’Œæ•ˆç‡é—®é¢˜ã€‚</p>
<p>å› æ­¤ï¼Œç»è¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç›´æ¥ä½¿ç”¨<code>StringBuilder</code>çš„æ–¹å¼æ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚å› ä¸º<code>StringBuilder</code>å¤©ç”Ÿå°±æ˜¯è®¾è®¡æ¥å®šä¹‰å¯å˜å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²çš„å˜åŒ–æ“ä½œçš„ã€‚</p>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Springé›¶é…ç½®ä¹‹@Configurationæ³¨è§£è¯¦è§£</title>
    <url>/%E8%BD%AC%E8%BD%BD/Spring%E9%9B%B6%E9%85%8D%E7%BD%AE%E4%B9%8B@Configuration%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3.html</url>
    <content><![CDATA[<h3 id="Configurationä»‹ç»"><a href="#Configurationä»‹ç»" class="headerlink" title="@Configurationä»‹ç»"></a>@Configurationä»‹ç»</h3><blockquote>
<p>Spring3.0ä¹‹å‰è¦ä½¿ç”¨Springå¿…é¡»è¦æœ‰ä¸€ä¸ªxmlé…ç½®æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯Springçš„æ ¸å¿ƒæ–‡ä»¶ï¼Œè€ŒSpring3.0ä¹‹åå¯ä»¥ä¸è¦é…ç½®æ–‡ä»¶äº†ï¼Œé€šè¿‡æ³¨è§£@Configurationå®Œå…¨æå®šã€‚</p>
<p><img src="http://qiniu.mrain22.cn/201903161641_996.png" alt=""></p>
<p>@Configurationå³ç”¨æ¥ä»£æ›¿Springé…ç½®æ–‡ä»¶çš„ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª@Componentç»„ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ªvalueå€¼ä¹Ÿå°±æ˜¯beançš„åå­—ï¼Œvalueå¯ä»¥ä¸å¡«ã€‚</p>
</blockquote>
<h3 id="Configurationä½¿ç”¨"><a href="#Configurationä½¿ç”¨" class="headerlink" title="@Configurationä½¿ç”¨"></a>@Configurationä½¿ç”¨</h3><blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨å®ä¾‹ï¼Œåˆ›å»ºäº†ä¸€ä¸ªuserServiceå’ŒaccountServiceçš„å®ä¾‹ï¼ŒaccountServiceå®ä¾‹å¼•ç”¨userServiceå®ä¾‹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"cn.mrain22.web"</span>&#125;)</span><br><span class="line"><span class="meta">@Import</span>(UserConfg.class)</span><br><span class="line"><span class="meta">@ImportResource</span>(locations = &#123;<span class="string">"classpath:config/spring-beans.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfg</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">	<span class="meta">@Bean</span>(name = <span class="string">"userService"</span>, initMethod = <span class="string">"init"</span>, destroyMethod = <span class="string">"destroy"</span>)</span><br><span class="line">	<span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> UserService <span class="title">userService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> UserService();</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AccountService <span class="title">accountService</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">		AccountService as = <span class="keyword">new</span> AccountService();</span><br><span class="line">		as.setUserService(userService);</span><br><span class="line">		<span class="keyword">return</span> as;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨è§£è¯´æ˜</p>
<p>@Configurationï¼šä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚</p>
<p>@ComponentScanï¼šç”¨æ¥æ‰«ææŒ‡å®šåŒ…ä¸‹é¢çš„æ³¨è§£ç±»ã€‚</p>
<p>@Importï¼šç”¨æ¥å¯¼å…¥å…¶ä»–çš„@Configurationé…ç½®ç±»ã€‚</p>
<p>@ImportResourceï¼šç”¨æ¥å¯¼å…¥xmlé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æŸäº›é…ç½®ä¸€å®šè¦xmlé…ç½®ã€‚</p>
<p>@Beanï¼šç”¨æ¥å®šä¹‰ä¸€ä¸ªbeanï¼Œå¯ä»¥æŒ‡å®šåˆå§‹ã€é”€æ¯æ–¹æ³•ï¼ŒåŠbeanèŒƒå›´ç­‰ã€‚</p>
</blockquote>
<p>è¿™äº›æ³¨è§£éƒ½åœ¨spring-contextåŒ…ä¸‹ï¼Œè¿˜æœ‰å…¶ä»–æ³¨è§£ç”¨æ¥è§£æ”¾xmlå½¢å¼çš„é…ç½®ï¼Œå¤§é‡xmlé…ç½®å¯javaé…ç½®åŒ–ï¼Œåªè¦å®šä¹‰å¥½ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æåŒ…ä¸‹é¢çš„@Configurationæ³¨è§£çš„é…ç½®æ–‡ä»¶ç±»æ¥è£…é…ã€‚</p>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>è·å–Springçš„ApplicationContextçš„å‡ ç§æ–¹å¼</title>
    <url>/%E8%BD%AC%E8%BD%BD/%E8%8E%B7%E5%8F%96Spring%E7%9A%84ApplicationContext%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F.html</url>
    <content><![CDATA[<h3 id="Application-Contextå®šä¹‰"><a href="#Application-Contextå®šä¹‰" class="headerlink" title="Application Contextå®šä¹‰"></a>Application Contextå®šä¹‰</h3><blockquote>
<p>ç®€å•æ¥è¯´å°±æ˜¯Springä¸­çš„é«˜çº§å®¹å™¨ï¼Œå¯ä»¥è·å–å®¹å™¨ä¸­çš„å„ç§beanç»„ä»¶ï¼Œæ³¨å†Œç›‘å¬äº‹ä»¶ï¼ŒåŠ è½½èµ„æºæ–‡ä»¶ç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 id="Application-Contextè·å–çš„å‡ ç§æ–¹å¼"><a href="#Application-Contextè·å–çš„å‡ ç§æ–¹å¼" class="headerlink" title="Application Contextè·å–çš„å‡ ç§æ–¹å¼"></a>Application Contextè·å–çš„å‡ ç§æ–¹å¼</h3><h4 id="1ã€ç›´æ¥æ³¨å…¥"><a href="#1ã€ç›´æ¥æ³¨å…¥" class="headerlink" title="1ã€ç›´æ¥æ³¨å…¥"></a>1ã€ç›´æ¥æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> ApplicationContext ctx;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€å®ç°ApplicationContextAwareæ¥å£ï¼ˆæ¨èï¼‰"><a href="#2ã€å®ç°ApplicationContextAwareæ¥å£ï¼ˆæ¨èï¼‰" class="headerlink" title="2ã€å®ç°ApplicationContextAwareæ¥å£ï¼ˆæ¨èï¼‰"></a>2ã€å®ç°ApplicationContextAwareæ¥å£ï¼ˆæ¨èï¼‰</h4><p><img src="http://qiniu.mrain22.cn/201903161607_1.png" alt=""></p>
<h4 id="3ã€WebApplicationContextUtilså·¥å…·ç±»"><a href="#3ã€WebApplicationContextUtilså·¥å…·ç±»" class="headerlink" title="3ã€WebApplicationContextUtilså·¥å…·ç±»"></a>3ã€WebApplicationContextUtilså·¥å…·ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(request.getSession().getServletContext());</span><br></pre></td></tr></table></figure>
<h4 id="4ã€ä»å½“å‰çº¿ç¨‹ç»‘å®šè·å–ï¼ˆSpring-bootä¸æ”¯æŒï¼‰"><a href="#4ã€ä»å½“å‰çº¿ç¨‹ç»‘å®šè·å–ï¼ˆSpring-bootä¸æ”¯æŒï¼‰" class="headerlink" title="4ã€ä»å½“å‰çº¿ç¨‹ç»‘å®šè·å–ï¼ˆSpring bootä¸æ”¯æŒï¼‰"></a>4ã€ä»å½“å‰çº¿ç¨‹ç»‘å®šè·å–ï¼ˆSpring bootä¸æ”¯æŒï¼‰</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext ctx = ContextLoader.getCurrentWebApplicationContext();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>Springä¸­çš„å„ç§Utils(äºŒ)ï¼šPropertiesLoaderUtilsè¯¦è§£</title>
    <url>/Spring%E7%B3%BB%E5%88%97/Spring%E4%B8%AD%E7%9A%84%E5%90%84%E7%A7%8DUtils-%E4%BA%8C-%EF%BC%9APropertiesLoaderUtils%E8%AF%A6%E8%A7%A3.html</url>
    <content><![CDATA[<p>ä»Šå¤©ä»‹ç»çš„æ˜¯PropertiesLoaderUtilsï¼Œè¿™ä¸ªå·¥å…·ç±»ä¸»è¦æ˜¯é’ˆå¯¹Propertiesæ–‡ä»¶çš„åŠ è½½æ“ä½œï¼Œåœ¨Springå¯¹.propertiesæ–‡ä»¶å’Œ.factoriesæ–‡ä»¶çš„æ“ä½œéƒ½æœ‰ä½¿ç”¨åˆ°ã€‚</p>
<p>å…ˆæ¥ç®€å•çœ‹çœ‹è¿™ä¸ªç±»æä¾›çš„æœ‰ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»ä¸€ä¸ªèµ„æºæ–‡ä»¶åŠ è½½Propertiesï¼›</span></span><br><span class="line"><span class="function">Properties <span class="title">loadProperties</span><span class="params">(Resource resource)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ è½½èµ„æºæ–‡ä»¶ï¼Œä¼ å…¥çš„æ˜¯æä¾›äº†ç¼–ç çš„èµ„æºç±»ï¼ˆEncodedResourceï¼‰ï¼›å’Œä¸Šé¢æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼›</span></span><br><span class="line"><span class="function">Properties <span class="title">loadProperties</span><span class="params">(EncodedResource resource)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»ä¸€ä¸ªèµ„æºç±»ä¸­åŠ è½½èµ„æºï¼Œå¹¶å¡«å……åˆ°æŒ‡å®šçš„Propertieså¯¹è±¡ä¸­ï¼›</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fillProperties</span><span class="params">(Properties props, Resource resource)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»ä¸€ä¸ªç¼–ç èµ„æºç±»ä¸­åŠ è½½èµ„æºï¼Œå¹¶å¡«å……åˆ°æŒ‡å®šçš„Propertieså¯¹è±¡ä¸­ï¼›å’Œä¸Šé¢æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼›</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fillProperties</span><span class="params">(Properties props, EncodedResource resource)</span><span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®èµ„æºæ–‡ä»¶åç§°ï¼ŒåŠ è½½å¹¶åˆå¹¶classpathä¸­çš„æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="function">Properties <span class="title">loadAllProperties</span><span class="params">(String resourceName)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»æŒ‡å®šçš„ClassLoaderä¸­ï¼Œæ ¹æ®èµ„æºæ–‡ä»¶åç§°ï¼ŒåŠ è½½å¹¶åˆå¹¶classpathä¸­çš„æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="function">Properties <span class="title">loadAllProperties</span><span class="params">(String resourceName, ClassLoader classLoader)</span> <span class="keyword">throws</span> IOExceptionï¼›</span></span><br></pre></td></tr></table></figure>
<h2 id="loadProperties"><a href="#loadProperties" class="headerlink" title="loadProperties"></a>loadProperties</h2><p>æµ‹è¯•æ–¹æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬é¦–å…ˆå‡†å¤‡ä¸€ä¸ªtest.propertiesæ–‡ä»¶ï¼Œæ”¾åˆ°resourcesä¸‹é¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#test.properties</span><br><span class="line">key=value</span><br><span class="line">key2=ä¸­æ–‡</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadPropertiesResource</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Properties ret = PropertiesLoaderUtils</span><br><span class="line">            .loadProperties(<span class="keyword">new</span> ClassPathResource(<span class="string">"test.properties"</span>));</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key"</span>));</span><br><span class="line">    assertEquals(<span class="string">"ä¸­æ–‡"</span>, ret.getProperty(<span class="string">"key2"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•å®Œæˆã€‚æ²¡æœ‰å¤ªå¤§éš¾åº¦ï¼›<br>ä½†æ˜¯ï¼Œå…¶å®Propertieså¯¹è±¡ä¸ä»…ä»…æ”¯æŒ.propertiesæ–‡ä»¶ï¼Œè¿˜æ”¯æŒXMLæ ¼å¼çš„èµ„æºé…ç½®æ–‡ä»¶ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æœ‰ä»¥ä¸‹æµ‹è¯•ã€‚åˆ›å»ºä¸€ä¸ªtext.xmlæ–‡ä»¶åœ¨classpathä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment</span>&gt;</span>ä¸€äº›è‡ªå®šä¹‰è¯´æ˜<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key"</span>&gt;</span>value<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key2"</span>&gt;</span>ä¸­æ–‡<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadPropertiesResourceXml</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Properties ret = PropertiesLoaderUtils</span><br><span class="line">            .loadProperties(<span class="keyword">new</span> ClassPathResource(<span class="string">"test.xml"</span>));</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key"</span>));</span><br><span class="line">    assertEquals(<span class="string">"ä¸­æ–‡"</span>, ret.getProperty(<span class="string">"key2"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•é€šè¿‡ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æ˜¯éå¸¸ä¸å»ºè®®ä½¿ç”¨XMLçš„æ–¹å¼æ¥åšé…ç½®çš„ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨EncodeResourceæ¥æµ‹è¯•ï¼ŒEncodeResourceåœ¨Resourceä¸Šå¢åŠ äº†å­—ç¬¦ç¼–ç è®¾ç½®ã€‚åŒæ ·ä½¿ç”¨ä¹‹å‰çš„test.propertiesï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadPropertiesEncodedResource</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Properties ret = PropertiesLoaderUtils.loadProperties(</span><br><span class="line">            <span class="keyword">new</span> EncodedResource(<span class="keyword">new</span> ClassPathResource(<span class="string">"test.properties"</span>),</span><br><span class="line">                    <span class="string">"UTF-8"</span>));</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key"</span>));</span><br><span class="line">    assertEquals(<span class="string">"ä¸­æ–‡"</span>, ret.getProperty(<span class="string">"key2"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯åœ¨ä¹‹å‰çš„ClassPathResourceåŸºç¡€ä¹‹ä¸ŠåŒ…è£…äº†UTF-8å­—ç¬¦ç¼–ç çš„EncodeResourceï¼›</p>
<h2 id="loadAllProperties"><a href="#loadAllProperties" class="headerlink" title="loadAllProperties"></a>loadAllProperties</h2><p>loadPropertiesæ–¹æ³•ï¼Œæ˜¯ä»å½“å‰classpathä¸‹åŠ è½½propertiesæ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨loadAllPropertiesï¼Œå¯ä»¥ä»å½“å‰classpathä¸‹åŠ è½½æ‰€æœ‰çš„ç›¸åŒåç§°çš„propertiesæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œåˆå¹¶ã€‚</p>
<p>æ¥å®Œæˆä¸€ä¸ªæµ‹è¯•ã€‚æŠŠä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„test.propertiesæ–‡ä»¶ä¿ç•™ï¼Œæ”¾åˆ°src/main/resourcesä¸­ï¼›ç„¶ååœ¨src/test/resourcesç›®å½•ä¸‹å†åˆ›å»ºä¸€ä¸ªtest.propertiesæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">key3=value</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadAllPropertiesString</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Properties ret = PropertiesLoaderUtils</span><br><span class="line">            .loadAllProperties(<span class="string">"test.properties"</span>);</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key"</span>));</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key3"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæµ‹è¯•é€šè¿‡ï¼›å¯ä»¥çœ‹åˆ°ï¼Œmainä¸‹çš„test.propertieså’Œtestä¸‹çš„test.propertieséƒ½è¢«è¯†åˆ«å¹¶æ‰§è¡Œäº†åˆå¹¶ï¼›</p>
<p>é‚£å¦‚æœåœ¨test/resourcesä¸­çš„test.propertiesä¸­å¢åŠ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">key=update</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡æ‰§è¡Œæµ‹è¯•ï¼Œä»ç„¶é€šè¿‡ã€‚</p>
<p>è¯´æ˜åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­å¦‚æœæœ‰é‡å¤keyï¼Œä»¥æœ€è¿‘çš„classpathä¸ºå‡†ï¼ˆæ¯”å¦‚å½“å‰åº”ç”¨çš„propertieså†…å®¹ä¼šä¼˜å…ˆäºjaråŒ…ä¸­çš„propertiesï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœè¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨loadPropertiesæ–¹æ³•ï¼Œé‚£ä¹ˆåªä¼šåŠ è½½åˆ°test/resourcesä¸­çš„test.propertiesï¼›</p>
<h2 id="fillProperties"><a href="#fillProperties" class="headerlink" title="fillProperties"></a>fillProperties</h2><p>fillPropertiesæ–¹æ³•å…¶å®æ˜¯loadPropertiesæ–¹æ³•çš„çœŸæ­£è°ƒç”¨æ–¹æ³•ã€‚å…ˆæ¥çœ‹çœ‹æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFillPropertiesPropertiesResource</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Resource res = <span class="keyword">new</span> ClassPathResource(<span class="string">"test.properties"</span>);</span><br><span class="line">    Properties ret = <span class="keyword">new</span> Properties();</span><br><span class="line">    PropertiesLoaderUtils.fillProperties(ret, res);</span><br><span class="line">    assertEquals(<span class="string">"value"</span>, ret.getProperty(<span class="string">"key"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨éå¸¸ç®€å•ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹loadPropertiesæ–¹æ³•çš„æºä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Properties <span class="title">loadProperties</span><span class="params">(EncodedResource resource)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    fillProperties(props, resource);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®è°ƒç”¨çš„å°±æ˜¯filePropertiesæ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å…¶å®ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fillProperties</span><span class="params">(Properties props, EncodedResource resource)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    fillProperties(props, resource, <span class="keyword">new</span> DefaultPropertiesPersister());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç†ç»™äº†fillProperties(Properties props, EncodedResource resource, PropertiesPersister persister)æ–¹æ³•ï¼›åªæ˜¯æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªPropertiesPersisterï¼ŒæŠ½å–äº†ä¸€ä¸ªç»Ÿä¸€çš„ä»XMLæˆ–è€…propertiesèµ„æºåŠ è½½å’Œè£…è½½æ¥å£ï¼›æ¥çœ‹çœ‹å…·ä½“å®ç°ï¼ˆæˆ‘åªä¿ç•™äº†æœ€åŸºæœ¬çš„å…³é”®ä»£ç ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fillProperties</span><span class="params">(Properties props, EncodedResource resource, PropertiesPersister persister)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    InputStream stream = <span class="keyword">null</span>;</span><br><span class="line">    Reader reader = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String filename = resource.getResource().getFilename();</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯XMLæ–‡ä»¶ï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (filename != <span class="keyword">null</span> &amp;&amp; filename.endsWith(XML_FILE_EXTENSION)) &#123;</span><br><span class="line">            stream = resource.getInputStream();</span><br><span class="line">            persister.loadFromXml(props, stream);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            stream = resource.getInputStream();</span><br><span class="line">            persister.load(props, stream);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//closeæ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨äº†PropertiesPersisterçš„loadFromXmlå’Œloadæ–¹æ³•æ¥åˆ†åˆ«åŠ è½½XMLæˆ–propertiesï¼›</p>
<p>æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥çœ‹çœ‹DefaultPropertiesPersisterçš„ç›¸å…³çš„è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶å®æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨Propertieså¯¹è±¡çš„loadå’ŒloadFromXMLæ–¹æ³•å®Œæˆçš„ã€‚</p>
]]></content>
      <categories>
        <category>Springç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Springä¸­Utilsçš„ä½¿ç”¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šStringUtils</title>
    <url>/Spring%E7%B3%BB%E5%88%97/Spring%E4%B8%ADUtils%E7%9A%84%E4%BD%BF%E7%94%A8%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AStringUtils.html</url>
    <content><![CDATA[<p>åœ¨Springä¸­ï¼Œæœ‰éå¸¸å¤šUtilså·¥å…·ç±»ï¼Œè¿™äº›å·¥å…·ç±»æœ‰çš„æ˜¯ä¸ºäº†å¼€å‘è€…ä½¿ç”¨çš„ï¼Œæœ‰çš„åªæ˜¯æä¾›ç»™Springæ¡†æ¶ä½¿ç”¨çš„ã€‚äº†è§£è¿™äº›å·¥å…·ç±»ï¼Œåœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨è¿™äº›å·¥å…·ç±»ï¼Œå¯¹æˆ‘ä»¬å¹³æ—¶çš„å¼€å‘è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œèƒ½æå¤§æ–¹ä¾¿æˆ‘ä»¬çš„å¼€å‘ã€‚</p>
<p>Springçš„å·¥å…·ç±»éƒ½æ˜¯ä»¥Utilsç»“å°¾ï¼Œæ‰€ä»¥è¦æŸ¥çœ‹è¿™äº›å·¥å…·ç±»ï¼Œåªéœ€è¦åœ¨APIæ–‡æ¡£ä¸­æŸ¥è¯¢æ‰€æœ‰*Utilså³å¯ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¤šè¾¾å‡ åä¸ªã€‚åœ¨åé¢çš„å‡ ç¯‡æ–‡ç« ä¸­æˆ‘ä¼šé€‰æ‹©å‡ ä¸ªå¸¸ç”¨çš„Utilsï¼Œç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹Springä¸­çš„å·¥å…·ç±»çš„æœ‰ç”¨å’Œå¸¸ç”¨æ–¹æ³•ã€‚</p>
<h2 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h2><p>å±äºè¯¥ç»„çš„æ–¹æ³•éƒ½æ˜¯åœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¸€äº›åˆ¤å®šæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// boolean isEmpty(Object str):å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºæˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼š""</span></span><br><span class="line"><span class="comment">// boolean hasLength(CharSequence str):å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…é•¿åº¦ä¸º0</span></span><br><span class="line"><span class="comment">// boolean hasText(String str):å­—ç¬¦ä¸²æ˜¯å¦æœ‰å†…å®¹ï¼ˆä¸ä¸ºç©ºï¼Œä¸”ä¸å…¨ä¸ºç©ºæ ¼ï¼‰</span></span><br><span class="line">assertFalse(StringUtils.hasText(<span class="string">"   "</span>));</span><br><span class="line"><span class="comment">// boolean containsWhitespace(String str):å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«ç©ºæ ¼</span></span><br><span class="line">assertTrue(StringUtils.containsWhitespace(<span class="string">"a b"</span>));</span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²å¤´å°¾æ“ä½œ"><a href="#å­—ç¬¦ä¸²å¤´å°¾æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²å¤´å°¾æ“ä½œ"></a>å­—ç¬¦ä¸²å¤´å°¾æ“ä½œ</h2><p>å±äºè¯¥ç±»åˆ«çš„æ–¹æ³•ï¼Œéƒ½æ˜¯å¯¹å­—ç¬¦ä¸²å‰ï¼Œæˆ–è€…å­—ç¬¦ä¸²åçš„å†…å®¹è¿›è¡Œåˆ¤å®šæˆ–è€…æ“ä½œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å­—ç¬¦ä¸²å¤´å°¾æ“ä½œ</span></span><br><span class="line"><span class="comment">// String trimWhitespace(String str):å»æ‰å­—ç¬¦ä¸²å‰åçš„ç©ºæ ¼</span></span><br><span class="line">assertEquals(<span class="string">"abc"</span>, StringUtils.trimWhitespace(<span class="string">" abc "</span>));</span><br><span class="line"><span class="comment">// String trimAllWhitespace(String str):å»æ‰å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„ç©ºæ ¼</span></span><br><span class="line">assertEquals(<span class="string">"abc"</span>, StringUtils.trimAllWhitespace(<span class="string">" a b c "</span>));</span><br><span class="line"><span class="comment">// String trimLeadingWhitespace(String str):å»æ‰å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºæ ¼</span></span><br><span class="line"><span class="comment">// String trimTrailingWhitespace(String str):å»æ‰å­—ç¬¦ä¸²ç»“æŸçš„ç©ºæ ¼</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// String trimLeadingCharacter(String str, char leadingCharacter):å»æ‰å­—ç¬¦ä¸²å¼€å¤´çš„æŒ‡å®šå­—ç¬¦ï¼›</span></span><br><span class="line"><span class="comment">// String trimTrailingCharacter(String str, char trailingCharacter):å»æ‰å­—ç¬¦ä¸²ç»“å°¾çš„æŒ‡å®šå­—ç¬¦ï¼›</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// boolean startsWithIgnoreCase(String str, String prefix):</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šå­—ç¬¦ä¸²å¼€å¤´ï¼Œå¿½ç•¥å¤§å°å†™</span></span><br><span class="line">assertTrue(StringUtils.startsWithIgnoreCase(<span class="string">"abcd"</span>, <span class="string">"AB"</span>));</span><br><span class="line"><span class="comment">// boolean endsWithIgnoreCase(String str, String suffix):</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šå­—ç¬¦ä¸²ç»“å°¾ï¼Œå¿½ç•¥å¤§å°å†™</span></span><br></pre></td></tr></table></figure>
<h2 id="æ–‡ä»¶è·¯å¾„åç§°ç›¸å…³æ“ä½œ"><a href="#æ–‡ä»¶è·¯å¾„åç§°ç›¸å…³æ“ä½œ" class="headerlink" title="æ–‡ä»¶è·¯å¾„åç§°ç›¸å…³æ“ä½œ"></a>æ–‡ä»¶è·¯å¾„åç§°ç›¸å…³æ“ä½œ</h2><p>æ–‡ä»¶è·¯å¾„åç§°ç›¸å…³æ“ä½œï¼Œæ˜¯é’ˆå¯¹æ–‡ä»¶åï¼Œæ–‡ä»¶è·¯å¾„ï¼Œæ–‡ä»¶åç¼€ç­‰å¸¸è§æ–‡ä»¶æ“ä½œä¸­éœ€è¦ç”¨åˆ°çš„æ–¹æ³•è¿›è¡Œå°è£…ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// String unqualify(String qualifiedName):</span></span><br><span class="line"><span class="comment">// å¾—åˆ°ä»¥.åˆ†å‰²çš„æœ€åä¸€ä¸ªå€¼ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–ç±»ä¼¼ç±»åæˆ–è€…æ–‡ä»¶åç¼€</span></span><br><span class="line">assertEquals(<span class="string">"java"</span>, StringUtils.unqualify(<span class="string">"cn.wolfcode.java"</span>));</span><br><span class="line">assertEquals(<span class="string">"java"</span>, StringUtils.unqualify(<span class="string">"cn/wolfcode/Hello.java"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String unqualify(String qualifiedName, char separator):</span></span><br><span class="line"><span class="comment">// å¾—åˆ°ä»¥ç»™å®šå­—ç¬¦åˆ†å‰²çš„æœ€åä¸€ä¸ªå€¼ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–ç±»ä¼¼æ–‡ä»¶å</span></span><br><span class="line">assertEquals(<span class="string">"Hello.java"</span>, StringUtils</span><br><span class="line">        .unqualify(<span class="string">"cn/wolfcode/Hello.java"</span>, File.separatorChar));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String capitalize(String str):é¦–å­—æ¯å¤§å†™</span></span><br><span class="line">assertEquals(<span class="string">"Wolfcode"</span>, StringUtils.capitalize(<span class="string">"wolfcode"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String uncapitalize(String str):å–æ¶ˆé¦–å­—æ¯å¤§å†™</span></span><br><span class="line">assertEquals(<span class="string">"java"</span>, StringUtils.uncapitalize(<span class="string">"Java"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String getFilename(String path):è·å–æ–‡ä»¶å,å°±ä¸éœ€è¦å†ä½¿ç”¨FilenameUtils</span></span><br><span class="line">assertEquals(<span class="string">"myfile.txt"</span>,</span><br><span class="line">        StringUtils.getFilename(<span class="string">"mypath/myfile.txt"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String getFilenameExtension(String path):è·å–æ–‡ä»¶åç¼€å</span></span><br><span class="line">assertEquals(<span class="string">"txt"</span>,</span><br><span class="line">        StringUtils.getFilenameExtension(<span class="string">"mypath/myfile.txt"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String stripFilenameExtension(String path):æˆªå–æ‰æ–‡ä»¶è·¯å¾„åç¼€</span></span><br><span class="line">assertEquals(<span class="string">"mypath/myfile"</span>,</span><br><span class="line">        StringUtils.stripFilenameExtension(<span class="string">"mypath/myfile.txt"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String applyRelativePath(String path, String relativePath):</span></span><br><span class="line"><span class="comment">// æ‰¾åˆ°ç»™å®šçš„æ–‡ä»¶ï¼Œå’Œå¦ä¸€ä¸ªç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼Œè¿”å›ç¬¬äºŒä¸ªæ–‡ä»¶çš„å…¨è·¯å¾„</span></span><br><span class="line"><span class="comment">// æ‰“å°ï¼šd:/java/wolfcode/other/Some.java</span></span><br><span class="line">System.out.println(StringUtils.applyRelativePath(</span><br><span class="line">        <span class="string">"d:/java/wolfcode/Test.java"</span>, <span class="string">"other/Some.java"</span>));</span><br><span class="line"><span class="comment">// ä½†æ˜¯ä¸æ”¯æŒé‡æ–°å®šä½ç»å¯¹è·¯å¾„å’Œä¸Šçº§ç›®å½•ç­‰å¤æ‚ä¸€äº›çš„ç›¸å¯¹è·¯å¾„å†™æ³•ï¼š</span></span><br><span class="line"><span class="comment">// ä»ç„¶æ‰“å°ï¼šd:/java/wolfcode/../other/Some.java</span></span><br><span class="line">System.out.println(StringUtils.applyRelativePath(</span><br><span class="line">        <span class="string">"d:/java/wolfcode/Test.java"</span>, <span class="string">"../other/Some.java"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String cleanPath(String path):</span></span><br><span class="line"><span class="comment">// æ¸…ç†æ–‡ä»¶è·¯å¾„,è¿™ä¸ªæ–¹æ³•é…åˆapplyRelativePathå°±å¯ä»¥è®¡ç®—ä¸€äº›ç®€å•çš„ç›¸å¯¹è·¯å¾„äº†</span></span><br><span class="line"><span class="comment">// æ‰“å°:d:/java/other/Some.java</span></span><br><span class="line">System.out.println(</span><br><span class="line">        StringUtils.cleanPath(<span class="string">"d:/java/wolfcode/../other/Some.java"</span>));</span><br><span class="line"><span class="comment">// éœ€æ±‚ï¼šè·å–d:/java/wolfcode/Test.javaç›¸å¯¹è·¯å¾„ä¸º../../other/Some.javaçš„æ–‡ä»¶å…¨è·¯å¾„ï¼š</span></span><br><span class="line"><span class="comment">// æ‰“å°ï¼šd:/other/Some.java</span></span><br><span class="line">System.out.println(StringUtils.cleanPath(StringUtils.applyRelativePath(</span><br><span class="line">        <span class="string">"d:/java/wolfcode/Test.java"</span>, <span class="string">"../../other/Some.java"</span>)));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// boolean pathEquals(String path1, String path2):</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶è·¯å¾„æ˜¯å¦ç›¸åŒï¼Œä¼šå…ˆæ‰§è¡ŒcleanPathä¹‹åå†æ¯”è¾ƒ</span></span><br><span class="line">assertTrue(StringUtils.pathEquals(<span class="string">"d:/wolfcode.txt"</span>,</span><br><span class="line">        <span class="string">"d:/somefile/../wolfcode.txt"</span>))</span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²å’Œå­ä¸²çš„æ“ä½œ"><a href="#å­—ç¬¦ä¸²å’Œå­ä¸²çš„æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²å’Œå­ä¸²çš„æ“ä½œ"></a>å­—ç¬¦ä¸²å’Œå­ä¸²çš„æ“ä½œ</h2><p>è¯¥ç»„æ–¹æ³•ä¸­ä¸»è¦æ˜¯æä¾›äº†å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²å­ä¸²çš„æ“ä½œï¼Œæ¯”å¦‚å­ä¸²çš„åŒ¹é…ï¼Œå­ä¸²çš„æ›¿æ¢ï¼›å­ä¸²çš„åˆ é™¤ç­‰ç­‰æ“ä½œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// boolean substringMatch(CharSequence str, int index, CharSequence</span></span><br><span class="line"><span class="comment">// substring):åˆ¤æ–­ä»æŒ‡å®šç´¢å¼•å¼€å§‹ï¼Œæ˜¯å¦åŒ¹é…å­å­—ç¬¦ä¸²</span></span><br><span class="line">assertTrue(StringUtils.substringMatch(<span class="string">"aabbccdd"</span>, <span class="number">1</span>, <span class="string">"abb"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// int countOccurrencesOf(String str, String sub):åˆ¤æ–­å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">assertEquals(<span class="number">4</span>, StringUtils.countOccurrencesOf(<span class="string">"ababaabab"</span>, <span class="string">"ab"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String replace(String inString, String oldPattern, String</span></span><br><span class="line"><span class="comment">// newPattern):åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å­å­—ç¬¦ä¸²æ›¿æ¢</span></span><br><span class="line">assertEquals(<span class="string">"cdcdacdcd"</span>, StringUtils.replace(<span class="string">"ababaabab"</span>, <span class="string">"ab"</span>, <span class="string">"cd"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String delete(String inString, String pattern):åˆ é™¤æ‰€æœ‰åŒ¹é…çš„å­å­—ç¬¦ä¸²ï¼›</span></span><br><span class="line">assertEquals(<span class="string">"a"</span>, StringUtils.delete(<span class="string">"ababaabab"</span>, <span class="string">"ab"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String deleteAny(String inString, String charsToDelete):åˆ é™¤å­å­—ç¬¦ä¸²ä¸­ä»»æ„å‡ºç°çš„å­—ç¬¦</span></span><br><span class="line">assertEquals(<span class="string">""</span>, StringUtils.deleteAny(<span class="string">"ababaabab"</span>, <span class="string">"bar"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String quote(String str) :åœ¨å­—ç¬¦ä¸²å‰åå¢åŠ å•å¼•å·,æ¯”è¾ƒé€‚åˆåœ¨æ—¥å¿—æ—¶å€™ä½¿ç”¨ï¼›</span></span><br><span class="line">assertEquals(<span class="string">"'hello'"</span>, StringUtils.quote(<span class="string">"hello"</span>));</span><br></pre></td></tr></table></figure>
<h2 id="æœ¬åœ°åŒ–ç›¸å…³"><a href="#æœ¬åœ°åŒ–ç›¸å…³" class="headerlink" title="æœ¬åœ°åŒ–ç›¸å…³"></a>æœ¬åœ°åŒ–ç›¸å…³</h2><p>å’ŒLocaleç›¸å…³çš„ä¸€äº›å­—ç¬¦ä¸²æ“ä½œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Locale parseLocaleString(String localeString):</span></span><br><span class="line"><span class="comment">// ä»æœ¬åœ°åŒ–å­—ç¬¦ä¸²ä¸­è§£æå‡ºæœ¬åœ°åŒ–ä¿¡æ¯ï¼Œç›¸å½“äºLocale.toString()çš„é€†å‘æ–¹æ³•</span></span><br><span class="line">assertEquals(Locale.CHINA, StringUtils.parseLocaleString(<span class="string">"zh_CN"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String toLanguageTag(Locale locale):æŠŠLocaleè½¬åŒ–æˆHTTPä¸­Accept-Languageèƒ½æ¥å—çš„æœ¬åœ°åŒ–æ ‡å‡†ï¼›</span></span><br><span class="line"><span class="comment">// æ¯”å¦‚æ ‡å‡†çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²ä¸ºï¼šzh_CNï¼Œæ›´æ”¹ä¸ºzh-CN</span></span><br><span class="line">System.out.println(StringUtils</span><br><span class="line">        .toLanguageTag(StringUtils.parseLocaleString(<span class="string">"zh_CN"</span>)));</span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²å’ŒProperties"><a href="#å­—ç¬¦ä¸²å’ŒProperties" class="headerlink" title="å­—ç¬¦ä¸²å’ŒProperties"></a>å­—ç¬¦ä¸²å’ŒProperties</h2><p>æŠŠå­—ç¬¦ä¸²å’ŒPropertieså¯¹è±¡ä¹‹é—´çš„ç›¸äº’è½¬åŒ–æŠ½å–å‡ºçš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Properties splitArrayElementsIntoProperties(String[] array, String delimiter):</span></span><br><span class="line"><span class="comment">// æŠŠå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ç…§ç»™å®šçš„åˆ†éš”ç¬¦è£…é…åˆ°ä¸€ä¸ªPropertiesä¸­</span></span><br><span class="line">String[] strs=<span class="keyword">new</span> String[]&#123;<span class="string">"key:value"</span>,<span class="string">"key2:ä¸­æ–‡"</span>&#125;;</span><br><span class="line">Properties ps=StringUtils.splitArrayElementsIntoProperties(strs, <span class="string">":"</span>);</span><br><span class="line"><span class="comment">//æ‰“å°è¾“å‡ºï¼š&#123;key=value, key2=ä¸­æ–‡&#125;</span></span><br><span class="line">System.out.println(ps);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//Properties splitArrayElementsIntoProperties(String[] array, String delimiter, String charsToDelete)</span></span><br><span class="line"><span class="comment">//æŠŠå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ç…§ç»™å®šçš„åˆ†éš”ç¬¦è£…é…åˆ°ä¸€ä¸ªPropertiesä¸­,å¹¶åˆ é™¤æŒ‡å®šå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æ‹¬å·ä¹‹ç±»çš„ï¼›</span></span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²å’Œæ•°ç»„ä¹‹é—´çš„åŸºæœ¬æ“ä½œ"><a href="#å­—ç¬¦ä¸²å’Œæ•°ç»„ä¹‹é—´çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°ç»„ä¹‹é—´çš„åŸºæœ¬æ“ä½œ"></a>å­—ç¬¦ä¸²å’Œæ•°ç»„ä¹‹é—´çš„åŸºæœ¬æ“ä½œ</h2><p>è¯¥ç»„æ–¹æ³•ä¸»è¦æ˜¯å®Œæˆå­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²æ•°ç»„ä¹‹é—´çš„åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚è¿½åŠ ï¼Œåˆ é™¤ï¼Œæ’åºç­‰ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// String[] addStringToArray(String[] array, String str):æŠŠä¸€ä¸ªå­—ç¬¦ä¸²æ·»åŠ åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­</span></span><br><span class="line"><span class="comment">// æ‰“å°ï¼š[a, b, c, d]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils</span><br><span class="line">        .addStringToArray(<span class="keyword">new</span> String[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span> &#125;, <span class="string">"d"</span>)));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// String[] concatenateStringArrays(String[] array1, String[]array2):è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="comment">//æ‰“å°ï¼š[a, b, c, a, b, c]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.concatenateStringArrays(</span><br><span class="line">        <span class="keyword">new</span> String[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> String[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>,<span class="string">"d"</span> &#125;)));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] mergeStringArrays(String[] array1, String[] array2)ï¼šè¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå»æ‰é‡å¤å…ƒç´ </span></span><br><span class="line"><span class="comment">//æ‰“å°ï¼š[a, b, c, d]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.mergeStringArrays(</span><br><span class="line">        <span class="keyword">new</span> String[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> String[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>,<span class="string">"d"</span> &#125;)));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] sortStringArray(String[] array):å­—ç¬¦ä¸²æ•°ç»„æ’åº</span></span><br><span class="line"><span class="comment">//æ‰“å°ï¼š[a, b, c, d]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.sortStringArray(<span class="keyword">new</span> String[]&#123;<span class="string">"d"</span>,<span class="string">"c"</span>,<span class="string">"b"</span>,<span class="string">"a"</span>&#125;)));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] toStringArray(Collection&lt;String&gt; collection):æŠŠå­—ç¬¦ä¸²é›†åˆå˜æˆå­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="comment">//String[] toStringArray(Enumeration&lt;String&gt; enumeration):æŠŠå­—ç¬¦ä¸²æšä¸¾ç±»å‹å˜æˆå­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="comment">//String[] trimArrayElements(String[] array):æŠŠå­—ç¬¦ä¸²æ•°ç»„ä¸­æ‰€æœ‰å­—ç¬¦ä¸²æ‰§è¡ŒtrimåŠŸèƒ½ï¼›</span></span><br><span class="line"><span class="comment">//String[] removeDuplicateStrings(String[] array):å»æ‰ç»™å®šå­—ç¬¦ä¸²æ•°ç»„ä¸­é‡å¤çš„å…ƒç´ ï¼Œèƒ½ä¿æŒåŸé¡ºåºï¼›</span></span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ›´å¤šæ–¹æ³•"><a href="#å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ›´å¤šæ–¹æ³•" class="headerlink" title="å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ›´å¤šæ–¹æ³•"></a>å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ›´å¤šæ–¹æ³•</h2><p>åœ¨è¯¥ç»„æ–¹æ³•ä¸­ï¼Œæä¾›äº†æ›´å¤šå­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ–¹æ³•ï¼Œä¸»è¦æ¶‰åŠåˆ°å­—ç¬¦ä¸²æ•°ç»„çš„åˆå¹¶ï¼Œå­—ç¬¦ä¸²çš„æŒ‰è§„åˆ™æ‹†åˆ†ï¼Œå­—ç¬¦ä¸²å’Œé›†åˆä¹‹é—´çš„ç›¸äº’è½¬åŒ–ç­‰æ“ä½œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//String[] split(String toSplit, String delimiter):æŒ‰ç…§æŒ‡å®šå­—ç¬¦ä¸²åˆ†å‰²å­—ç¬¦ä¸²ï¼›</span></span><br><span class="line">assertArrayEquals(<span class="keyword">new</span> String[]&#123;<span class="string">"wolfcode"</span>,<span class="string">"cn"</span>&#125;, StringUtils.split(<span class="string">"wolfcode.cn"</span>, <span class="string">"."</span>));</span><br><span class="line"><span class="comment">//åªåˆ†å‰²ç¬¬ä¸€æ¬¡ï¼Œæ‰“å°ï¼š[www, wolfcode.cn]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.split(<span class="string">"www.wolfcode.cn"</span>, <span class="string">"."</span>)));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] tokenizeToStringArray(String str, String delimiters)</span></span><br><span class="line"><span class="comment">//ä¼šå¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œtrimæ“ä½œï¼Œå¹¶å»æ‰ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨çš„æ˜¯StringTokenizerå®Œæˆï¼Œ</span></span><br><span class="line"><span class="comment">//æ‰“å°[b, c, d]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.tokenizeToStringArray(<span class="string">"aa,ba,ca,da"</span>, <span class="string">"a,"</span>)));</span><br><span class="line"><span class="comment">//String[] tokenizeToStringArray(String str, String delimiters, boolean trimTokens, boolean ignoreEmptyTokens)</span></span><br><span class="line"><span class="comment">//åé¢ä¸¤ä¸ªå‚æ•°åœ¨é™å®šæ˜¯å¦å¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œtrimæ“ä½œï¼Œæ˜¯å¦å»æ‰ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] delimitedListToStringArray(String str, String delimiter):åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä¼šæŠŠdelimiterä½œä¸ºæ•´ä½“åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment">//æ‰“å°ï¼š[a, b, c, da]</span></span><br><span class="line">System.out.println(Arrays.toString(StringUtils.delimitedListToStringArray(<span class="string">"aa,ba,ca,da"</span>, <span class="string">"a,"</span>)));</span><br><span class="line"><span class="comment">//String[] delimitedListToStringArray(String str, String delimiter, String charsToDelete)</span></span><br><span class="line"><span class="comment">//åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä¼šæŠŠdelimiterä½œä¸ºæ•´ä½“åˆ†éš”ç¬¦ï¼Œå¢åŠ ä¸€ä¸ªè¦ä»åˆ†å‰²å­—ç¬¦ä¸²ä¸­åˆ é™¤çš„å­—ç¬¦ï¼›</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//String[] commaDelimitedListToStringArray(String str):ä½¿ç”¨é€—å·åˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//æ˜¯delimitedListToStringArray(str, ",")çš„ç®€å•æ–¹æ³•</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Set&lt;String&gt; commaDelimitedListToSet(String str)ï¼šä½¿ç”¨é€—å·åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¹¶æ”¾åˆ°setä¸­å»é‡</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨LinkedHashSet;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//String collectionToDelimitedString(Collection&lt;?&gt; coll, String delim, String prefix, String suffix)</span></span><br><span class="line"><span class="comment">//å°†ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ ï¼Œä½¿ç”¨å‰ç¼€ï¼Œåç¼€ï¼Œåˆ†éš”ç¬¦æ‹¼è£…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå‰ç¼€ååç¼€æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„</span></span><br><span class="line">String[] arrs=<span class="keyword">new</span> String[]&#123;<span class="string">"aa"</span>,<span class="string">"bb"</span>,<span class="string">"cc"</span>,<span class="string">"dd"</span>&#125;;</span><br><span class="line">assertEquals(<span class="string">"&#123;aa&#125;,&#123;bb&#125;,&#123;cc&#125;,&#123;dd&#125;"</span>, StringUtils.collectionToDelimitedString(Arrays.asList(arrs),<span class="string">","</span>,<span class="string">"&#123;"</span>,<span class="string">"&#125;"</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//String collectionToDelimitedString(Collection&lt;?&gt; coll, String delim)ï¼šé›†åˆå˜æˆæŒ‡å®šå­—ç¬¦ä¸²è¿æ¥çš„å­—ç¬¦ä¸²ï¼›</span></span><br><span class="line"><span class="comment">//æ˜¯collectionToDelimitedString(coll, delim, "", "")çš„ç®€å†™ï¼›</span></span><br><span class="line"><span class="comment">//String collectionToCommaDelimitedString(Collection&lt;?&gt; coll)ï¼šé›†åˆå˜æˆé€—å·è¿æ¥çš„å­—ç¬¦ä¸²ï¼›</span></span><br><span class="line"><span class="comment">//æ˜¯collectionToDelimitedString(coll, ",");çš„ç®€å†™ï¼›</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//String arrayToDelimitedString(Object[] arr, String delim)ï¼šæ•°ç»„ä½¿ç”¨æŒ‡å®šå­—ç¬¦ä¸²è¿æ¥ï¼›</span></span><br><span class="line"><span class="comment">//String arrayToCommaDelimitedString(Object[] arr)ï¼šä½¿ç”¨é€—å·è¿æ¥æ•°ç»„ï¼Œæ‹¼æˆå­—ç¬¦ä¸²ï¼›</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Springç³»åˆ—</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux(CentOS7)ä¸‹Dockerçš„å®‰è£…ä¸å¸è½½</title>
    <url>/Linux/Linux-CentOS7-%E4%B8%8BDocker%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD.html</url>
    <content><![CDATA[<p>å®˜æ–¹åœ°å€</p>
<p>è‹±æ–‡ï¼š<a href="https://docs.docker.com/install/" target="_blank" rel="noopener">https://docs.docker.com/install/</a></p>
<p>ä¸­æ–‡ï¼š<a href="https://docs.docker-cn.com/engine/installation/" target="_blank" rel="noopener">https://docs.docker-cn.com/engine/installation/</a></p>
<h2 id="ç¡®å®šä½ æ˜¯CentOS7ç‰ˆæœ¬"><a href="#ç¡®å®šä½ æ˜¯CentOS7ç‰ˆæœ¬" class="headerlink" title="ç¡®å®šä½ æ˜¯CentOS7ç‰ˆæœ¬"></a>ç¡®å®šä½ æ˜¯CentOS7ç‰ˆæœ¬</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/redhat-release</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301645_330.png" alt=""></p>
<h2 id="yumå®‰è£…gccç›¸å…³"><a href="#yumå®‰è£…gccç›¸å…³" class="headerlink" title="yumå®‰è£…gccç›¸å…³"></a>yumå®‰è£…gccç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>
<h2 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h2><p>æ­¤å¸è½½å’Œå®‰è£…å®Œæˆåçš„å¸è½½æœ‰äº›ä¸ä¸€æ ·ã€‚é˜²æ­¢å‡ºç°é”™è¯¯ï¼Œæœ€å¥½åœ¨å®‰è£…å‰å¸è½½æ—§ç‰ˆæœ¬ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨å­˜å‚¨åº“å®‰è£…"><a href="#ä½¿ç”¨å­˜å‚¨åº“å®‰è£…" class="headerlink" title="ä½¿ç”¨å­˜å‚¨åº“å®‰è£…"></a>ä½¿ç”¨å­˜å‚¨åº“å®‰è£…</h2><h3 id="å®‰è£…æ‰€éœ€çš„åŒ…"><a href="#å®‰è£…æ‰€éœ€çš„åŒ…" class="headerlink" title="å®‰è£…æ‰€éœ€çš„åŒ…"></a>å®‰è£…æ‰€éœ€çš„åŒ…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®ç¨³å®šå­˜å‚¨åº“"><a href="#è®¾ç½®ç¨³å®šå­˜å‚¨åº“" class="headerlink" title="è®¾ç½®ç¨³å®šå­˜å‚¨åº“"></a>è®¾ç½®<strong>ç¨³å®š</strong>å­˜å‚¨åº“</h3><p>è¿™æ­¥å¾ˆå…³é”®</p>
<p>å®˜ç½‘å‘½ä»¤æ˜¯ï¼ˆ<strong>å¤§å‘</strong>ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo  #ä¸æ¨èä½¿ç”¨</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®˜ç½‘ç”¨çš„æ˜¯å¤–å›½çš„åœ°å€ï¼Œç”±äºæˆ‘ä»¬ä¼Ÿå¤§å¢™çš„åŸå› ï¼Œæœ‰æ—¶ä¼šä¸ç¨³å®šï¼Œæ‰€ä»¥å»ºè®®å°†å…¶æ”¹ä¸ºå›½å†…åœ°å€ã€‚å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo  #æ¨èä½¿ç”¨</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301702_658.png" alt=""></p>
<h2 id="æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•"><a href="#æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•" class="headerlink" title="æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•"></a>æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum makecache fast</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301753_868.png" alt=""></p>
<h2 id="å®‰è£…Docker-CE"><a href="#å®‰è£…Docker-CE" class="headerlink" title="å®‰è£…Docker  CE"></a>å®‰è£…Docker  CE</h2><h3 id="å®‰è£…æœ€æ–°ç‰ˆ"><a href="#å®‰è£…æœ€æ–°ç‰ˆ" class="headerlink" title="å®‰è£…æœ€æ–°ç‰ˆ"></a>å®‰è£…æœ€æ–°ç‰ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…æŒ‡å®šç‰ˆæœ¬"><a href="#å®‰è£…æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301759_704.png" alt=""></p>
<blockquote>
<p>è¿”å›çš„åˆ—è¡¨å–å†³äºå¯ç”¨çš„å­˜å‚¨åº“ï¼Œå¹¶ä¸”ç‰¹å®šäºæ‚¨çš„CentOSç‰ˆæœ¬ï¼ˆ<code>.el7</code>åœ¨æ­¤ç¤ºä¾‹ä¸­ä»¥åç¼€è¡¨ç¤ºï¼‰</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>sudo yum install docker-ce-&lt;VERSION STRING&gt;</span><br><span class="line">sudo yum install docker-ce-18.03.0.ce</span><br></pre></td></tr></table></figure>
<h2 id="å¯åŠ¨Docker"><a href="#å¯åŠ¨Docker" class="headerlink" title="å¯åŠ¨Docker"></a>å¯åŠ¨Docker</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">docker version   #æ£€æŸ¥dockerç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301807_307.png" alt=""></p>
<h2 id="é…ç½®é•œåƒåŠ é€Ÿ"><a href="#é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="é…ç½®é•œåƒåŠ é€Ÿ"></a>é…ç½®é•œåƒåŠ é€Ÿ</h2><p>å®‰è£…å®Œæˆä¹‹åï¼Œé»˜è®¤ä¸‹è½½é•œåƒçš„ä»“åº“æ˜¯å›½å¤–çš„ï¼Œåˆå› ä¸ºæˆ‘ä»¬ä¼Ÿå¤§çš„å¢™ï¼Œæ‰€ä»¥æˆ‘ä»¬é…ç½®å›½å†…çš„é•œåƒåŠ é€Ÿã€‚æ¨èé˜¿é‡Œäº‘å’Œç½‘æ˜“åŠ é€Ÿã€‚è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">&#123;</span><br><span class="line">  "registry-mirrors": ["https://xxxx.mirror.aliyuncs.com"]  #xxxxæ­¤å¤„éœ€è¦ç™»å½•è‡ªå·±çš„é˜¿é‡Œäº‘æŸ¥æ‰¾</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿåœ°å€ï¼š<a href="https://cr.console.aliyun.com/cn-hangzhou/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/mirrors</a></p>
<h2 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line">sudo yum remove docker-ce</span><br><span class="line">sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘Linuxä¸‹å®‰è£…MySql5.6ã€5.7ã€8.0ç‰ˆæœ¬å’Œå¸è½½ä»¥åŠè¿œç¨‹è¿æ¥</title>
    <url>/Linux/%E9%98%BF%E9%87%8C%E4%BA%91Linux%E4%B8%8B%E5%AE%89%E8%A3%85MySql5-6%E3%80%815-7%E3%80%818-0%E7%89%88%E6%9C%AC%E5%92%8C%E5%8D%B8%E8%BD%BD%E4%BB%A5%E5%8F%8A%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5.html</url>
    <content><![CDATA[<p>åœ¨å®‰è£…çš„æ—¶å€™å‚è€ƒäº†å¾ˆå¤šåšå®¢ï¼Œä½†æ˜¯å‘ç°è¿˜æ˜¯ MySqlçš„å®˜ç½‘ç»™çš„æ­¥éª¤æœ€æœ‰æ•ˆï¼Œæœ€æƒå¨ã€‚</p>
<p>å®˜æ–¹åœ°å€ï¼š<a href="https://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/" target="_blank" rel="noopener">https://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/</a></p>
<p>Debian 7,8,9</p>
<p>Ubuntu 14.04,16.04,17.10,18.04</p>
<p>ä¸‹é¢è®°å½•ä¸‹æˆ‘å®‰è£…çš„æ­¥éª¤ï¼š</p>
<h2 id="æ·»åŠ -MySQL-APTå­˜å‚¨åº“"><a href="#æ·»åŠ -MySQL-APTå­˜å‚¨åº“" class="headerlink" title="æ·»åŠ  MySQL APTå­˜å‚¨åº“"></a>æ·»åŠ  MySQL APTå­˜å‚¨åº“</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‹è½½ MySQL APT å­˜å‚¨åº“ï¼Œ MySQL APT å­˜å‚¨åº“æä¾›äº†ä¸€ç§ä½¿ç”¨Apt æœ€æ–°è½¯ä»¶åŒ…å®‰è£…å’Œæ›´æ–°MySQL äº§å“çš„ç®€å•æ–¹ä¾¿çš„æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ 0.8.10_1 ç‰ˆæœ¬ï¼Œå¯èƒ½éšæ‰¾æ—¶é—´çš„å˜åŒ–ï¼Œç‰ˆæœ¬ä¼šä¸åŒï¼ŒæŸ¥çœ‹ç‰ˆæœ¬çš„åœ°å€ï¼š</p>
<p><a href="https://dev.mysql.com/downloads/repo/apt/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/repo/apt/</a></p>
<p><img src="http://qiniu.mrain22.cn/201811301528_47.png" alt=""></p>
<p>å‘½ä»¤ä¸‹è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo wget -P /root/Downloads http://dev.mysql.com/get/mysql-apt-config_0.8.10-1_all.deb</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…å‘å¸ƒåŒ…"><a href="#å®‰è£…å‘å¸ƒåŒ…" class="headerlink" title="å®‰è£…å‘å¸ƒåŒ…"></a>å®‰è£…å‘å¸ƒåŒ…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i /root/Downloads/mysql-apt-config_0.8.10-1_all.deb  #æ³¨æ„è·¯å¾„å’Œç‰ˆæœ¬å·è¦ä¸ä¸‹è½½æ—¶çš„ä¸€è‡´ã€‚</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¼šå¼¹å‡ºçª—å£ï¼Œéœ€è¦é€‰æ‹©ç‰ˆæœ¬çš„å°±å¥½<br>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ä¸Šä¸‹é”®ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªï¼ŒæŒ‰å›è½¦é”® </p>
<p><img src="http://qiniu.mrain22.cn/201811301532_941.png" alt=""></p>
<p>ç„¶åï¼Œå†é€‰æ‹©ä½ æƒ³å®‰è£…çš„ç‰ˆæœ¬</p>
<p><img src="http://qiniu.mrain22.cn/201811301533_948.png" alt=""></p>
<p>ç„¶åé€‰æ‹© OK</p>
<p><img src="http://qiniu.mrain22.cn/201811301534_535.png" alt=""></p>
<h2 id="æ‰§è¡Œapt-get-update"><a href="#æ‰§è¡Œapt-get-update" class="headerlink" title="æ‰§è¡Œapt-get update"></a>æ‰§è¡Œapt-get update</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<p>è¿™å¥æ˜¯å¿…é¡»æ‰§è¡Œçš„ï¼Œå¦‚æœä¸æ‰§è¡Œï¼Œé‚£ä¹ˆåˆšæ‰çš„æ“ä½œç›¸å½“äºæ²¡åšã€‚</p>
<h2 id="ä½¿ç”¨APTå®‰è£…MySQL"><a href="#ä½¿ç”¨APTå®‰è£…MySQL" class="headerlink" title="ä½¿ç”¨APTå®‰è£…MySQL"></a>ä½¿ç”¨APTå®‰è£…MySQL</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure>
<p>è¿™å°†å®‰è£…çš„MySQL æœåŠ¡å™¨çš„åŒ…ï¼Œä»¥åŠå®¢æˆ·ç«¯å’Œæ•°æ®åº“å…¬å…±æ–‡ä»¶çš„åŒ…ã€‚</p>
<p>å®‰è£…çš„è¿‡ç¨‹ä¼šé—®ä½  â€œ æ˜¯â€æˆ–â€œ å¦â€ï¼Œè‡ªç„¶æ˜¯é€‰æ‹©â€œ æ˜¯â€ã€‚</p>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šè¦æ±‚æ‚¨ä¸ºæ ¹ç”¨æˆ·æä¾›çš„MySQL å®‰è£…çš„å¯†ç ã€‚</p>
<p><img src="http://qiniu.mrain22.cn/201811301536_836.png" alt=""></p>
<h2 id="å¯åŠ¨å’Œåœæ­¢çš„MySQLçš„æœåŠ¡å™¨"><a href="#å¯åŠ¨å’Œåœæ­¢çš„MySQLçš„æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨å’Œåœæ­¢çš„MySQLçš„æœåŠ¡å™¨"></a>å¯åŠ¨å’Œåœæ­¢çš„MySQLçš„æœåŠ¡å™¨</h2><p>MySQLæœåŠ¡å™¨åœ¨å®‰è£…åè‡ªåŠ¨å¯åŠ¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥MySQLæœåŠ¡å™¨çš„çŠ¶æ€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service mysql status</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœæ­¢MySQLæœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service mysql stop</span><br></pre></td></tr></table></figure>
<p>è¦é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service mysql start</span><br></pre></td></tr></table></figure>
<h2 id="ç™»å½•MySQL"><a href="#ç™»å½•MySQL" class="headerlink" title="ç™»å½•MySQL"></a>ç™»å½•MySQL</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥ç™»å½•MySql</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¾“å…¥åˆšæ‰å®‰è£…æ—¶è¾“å…¥çš„å¯†ç å³å¯ç™»å½•æˆåŠŸã€‚</p>
<h2 id="å»ºç«‹è¿œç¨‹è¿æ¥"><a href="#å»ºç«‹è¿œç¨‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿œç¨‹è¿æ¥"></a>å»ºç«‹è¿œç¨‹è¿æ¥</h2><p>åœ¨äº‘æœåŠ¡ä¸Šå®‰è£…MySQLåæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è®¾ç½®æ¥é€šè¿‡æœ¬åœ°è¿æ¥æœåŠ¡å™¨ä¸Šçš„MySQLã€‚</p>
<h3 id="æˆæƒä¸»æœºè®¿é—®"><a href="#æˆæƒä¸»æœºè®¿é—®" class="headerlink" title="æˆæƒä¸»æœºè®¿é—®"></a>æˆæƒä¸»æœºè®¿é—®</h3><p>åœ¨ç™»å½•è¿›mysqlåï¼Œè¾“å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;ä½ çš„å¯†ç &apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301540_200.png" alt=""></p>
<p>åœ¨â€œä½ çš„å¯†ç â€å¤„ï¼Œå¡«å†™ä½ è‡ªå·±çš„å¯†ç ã€‚å›è½¦ã€‚</p>
<p>åˆ·æ–°æƒé™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MySQL&gt;FLUSH PRIVILEGES;    å›è½¦</span><br></pre></td></tr></table></figure>
<p>é€€å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MySQL&gt;EXIT;    å›è½¦</span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹MySQLé…ç½®"><a href="#ä¿®æ”¹MySQLé…ç½®" class="headerlink" title="ä¿®æ”¹MySQLé…ç½®"></a>ä¿®æ”¹MySQLé…ç½®</h3><p>è¾“å…¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi  /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure>
<p><img src="http://qiniu.mrain22.cn/201811301554_427.png" alt=""></p>
<p>å°†çº¢è‰²æ ‡æ³¨çš„åœ°æ–¹æ³¨é‡Šæ‰ï¼ˆå‰é¢åŠ #ï¼Œå›¾ä¸­æˆ‘å·²ç»æ³¨é‡Šæ‰ï¼‰</p>
<p>æŒ‰ESC è¾“å…¥  ï¼šwq! å›è½¦ä¿å­˜ã€‚</p>
<p>é‡å¯mysqlã€‚</p>
<h3 id="åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰å…¨ç»„è§„åˆ™ä¸­æ‰“å¼€3306ç«¯å£"><a href="#åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰å…¨ç»„è§„åˆ™ä¸­æ‰“å¼€3306ç«¯å£" class="headerlink" title="åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰å…¨ç»„è§„åˆ™ä¸­æ‰“å¼€3306ç«¯å£"></a>åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰å…¨ç»„è§„åˆ™ä¸­æ‰“å¼€3306ç«¯å£</h3><p>ç™»å½•é˜¿é‡Œäº‘ï¼Œæ‰¾åˆ°æœåŠ¡å™¨çš„å®‰å…¨ç»„è§„åˆ™ï¼Œæ·»åŠ å®‰å…¨ç»„è§„åˆ™ã€‚</p>
<p><img src="http://qiniu.mrain22.cn/201811301555_568.png" alt=""></p>
<p>è¿™æ ·å°±å¯ä»¥é€šè¿‡æœ¬åœ°è¿æ¥æœåŠ¡å™¨ä¸Šçš„MySQLçš„äº†</p>
<h2 id="å¸è½½MySQL"><a href="#å¸è½½MySQL" class="headerlink" title="å¸è½½MySQL"></a>å¸è½½MySQL</h2><p>å…ˆè¾“å…¥æŒ‡ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get remove mysql-server</span><br></pre></td></tr></table></figure>
<p>å¾…æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•å†è¾“å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get autoremove</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ¸…ç†æ®‹ç•™çš„æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dpkg -l |grep ^rc|awk '&#123;print $2&#125;' |sudo xargs dpkg -P</span><br></pre></td></tr></table></figure>
<p>å®ƒä¼šè·³å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä½ é€‰æ‹©yeså°±å¥½äº†ã€‚</p>
<p>è¿™æ ·å°±å½»åº•å¸è½½äº†MySqläº†ï¼Œæƒ³è¦å®‰è£…çš„è¯ï¼ŒæŒ‰ç…§ç¬¬ä¸€æ­¥é‡æ–°å®‰è£…ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript è¿è¡Œæœºåˆ¶Event Loopï¼ˆæµè§ˆå™¨ä¸nodeç¯å¢ƒçš„ä¸åŒï¼‰</title>
    <url>/JavaScript/JavaScript-%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6Event-Loop%EF%BC%88%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8Enode%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%89.html</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>JavaScriptè¯­è¨€çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªæ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ã€‚å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰ä¼šæ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰ç€ã€‚å¦‚æœæ’é˜Ÿæ˜¯å› ä¸ºè®¡ç®—é‡å¤§ï¼ŒCPUå¿™ä¸è¿‡æ¥ï¼Œå€’ä¹Ÿç®—äº†ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™CPUæ˜¯é—²ç€çš„ï¼Œå› ä¸ºIOè®¾å¤‡ï¼ˆè¾“å…¥è¾“å‡ºè®¾å¤‡ï¼‰å¾ˆæ…¢ï¼ˆæ¯”å¦‚Ajaxæ“ä½œä»ç½‘ç»œè¯»å–æ•°æ®ï¼‰ï¼Œä¸å¾—ä¸ç­‰ç€ç»“æœå‡ºæ¥ï¼Œå†å¾€ä¸‹æ‰§è¡Œã€‚JavaScriptè¯­è¨€çš„è®¾è®¡è€…æ„è¯†åˆ°ï¼Œè¿™æ—¶ä¸»çº¿ç¨‹å®Œå…¨å¯ä»¥ä¸ç®¡IOè®¾å¤‡ï¼ŒæŒ‚èµ·å¤„äºç­‰å¾…ä¸­çš„ä»»åŠ¡ï¼Œå…ˆè¿è¡Œæ’åœ¨åé¢çš„ä»»åŠ¡ã€‚ç­‰åˆ°IOè®¾å¤‡è¿”å›äº†ç»“æœï¼Œå†å›è¿‡å¤´ï¼ŒæŠŠæŒ‚èµ·çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>
<p>äºæ˜¯ï¼Œæ‰€æœ‰ä»»åŠ¡å¯ä»¥åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯åŒæ­¥ä»»åŠ¡ï¼ˆsynchronousï¼‰ï¼Œå¦ä¸€ç§æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼ˆasynchronousï¼‰ã€‚</p>
<ul>
<li>åŒæ­¥ä»»åŠ¡ï¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ’é˜Ÿæ‰§è¡Œçš„ä»»åŠ¡ï¼Œåªæœ‰å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ï¼›</li>
<li>å¼‚æ­¥ä»»åŠ¡ï¼šä¸è¿›å…¥ä¸»çº¿ç¨‹ã€è€Œè¿›å…¥â€ä»»åŠ¡é˜Ÿåˆ—â€ï¼ˆtask queueï¼‰çš„ä»»åŠ¡ï¼Œåªæœ‰â€ä»»åŠ¡é˜Ÿåˆ—â€é€šçŸ¥ä¸»çº¿ç¨‹ï¼ŒæŸä¸ªå¼‚æ­¥ä»»åŠ¡å¯ä»¥æ‰§è¡Œäº†ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œ</li>
</ul>
<p>å…·ä½“æ¥è¯´ï¼Œå¼‚æ­¥æ‰§è¡Œçš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹ã€‚ï¼ˆåŒæ­¥æ‰§è¡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«è§†ä¸ºæ²¡æœ‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œã€‚ï¼‰</p>
<blockquote>
<p>ï¼ˆ1ï¼‰æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªâ€ä»»åŠ¡é˜Ÿåˆ—â€ï¼ˆtask queueï¼‰ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨â€ä»»åŠ¡é˜Ÿåˆ—â€ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚</p>
<p>ï¼ˆ3ï¼‰ä¸€æ—¦â€æ‰§è¡Œæ ˆâ€ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–â€ä»»åŠ¡é˜Ÿåˆ—â€ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›äº‹ä»¶ã€‚é‚£äº›å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡ï¼Œäºæ˜¯ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œã€‚</p>
<p>ï¼ˆ4ï¼‰ä¸»çº¿ç¨‹ä¸æ–­é‡å¤ä¸Šé¢çš„ç¬¬ä¸‰æ­¥ã€‚</p>
</blockquote>
<p><strong>ä¸»çº¿ç¨‹ä»â€ä»»åŠ¡é˜Ÿåˆ—â€ä¸­è¯»å–äº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„ï¼Œæ‰€ä»¥æ•´ä¸ªçš„è¿™ç§è¿è¡Œæœºåˆ¶åˆç§°ä¸ºEvent Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ã€‚ä½†æ˜¯æµè§ˆå™¨çš„Event loopå’ŒNodeçš„Event loopæ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚</strong></p>
<p>åœ¨JavaScriptä¸­ï¼Œâ€œä»»åŠ¡é˜Ÿåˆ—â€ä»»åŠ¡é˜Ÿåˆ—è¢«åˆ†ä¸ºMacroTaskï¼ˆå®ä»»åŠ¡ï¼‰å’ŒMicroTaskï¼ˆå¾®ä»»åŠ¡ï¼‰ä¸¤ç§ã€‚å®ƒä»¬åˆ†åˆ«åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><p><strong>MacroTask</strong>: script(æ•´ä½“ä»£ç ), setTimeout, setInterval, setImmediateï¼ˆnodeç‹¬æœ‰ï¼‰, I/O, UI rendering</p>
</li>
<li><p><strong>MicroTask</strong>: process.nextTickï¼ˆnodeç‹¬æœ‰ï¼‰, Promises, Object.observe(åºŸå¼ƒ), MutationObserver</p>
</li>
</ul>
<h2 id="æµè§ˆå™¨ä¸­"><a href="#æµè§ˆå™¨ä¸­" class="headerlink" title="æµè§ˆå™¨ä¸­"></a>æµè§ˆå™¨ä¸­</h2><p>åœ¨æµè§ˆå™¨ä¸­â€æ‰§è¡Œæ ˆâ€ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå»â€œä»»åŠ¡é˜Ÿåˆ—â€æ‰¾è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œé¦–å…ˆæ‰¾MicroTaskï¼ˆå¾®ä»»åŠ¡ï¼‰é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæœ‰åˆ™<strong>å…¨éƒ¨æ‰§è¡Œ</strong>ï¼Œç„¶åå†æ‰¾MacroTaskï¼ˆå®ä»»åŠ¡ï¼‰é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰åˆ™æ‰§è¡ŒMacroTaskï¼ˆå®ä»»åŠ¡ï¼‰é˜Ÿåˆ—çš„<strong>ç¬¬ä¸€ä¸ª</strong>ï¼Œå†å»æ‰§è¡ŒMicroTaskï¼ˆå¾®ä»»åŠ¡ï¼‰é˜Ÿåˆ—ä¸­çš„<strong>æ‰€æœ‰</strong>å¾®ä»»åŠ¡ã€‚</p>
<blockquote>
<p>åŒæ­¥ä»£ç â€”&gt;MicroTaskâ€”&gt;MacroTask</p>
</blockquote>
<p>æ¯æ‰§è¡Œå®Œä¸€ä¸ªMacrotaskéƒ½ä¼šæ£€æŸ¥Microtaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼ˆæ‰§è¡Œå®Œä¸€ä¸ªMacrotaskçš„å…·ä½“æ ‡å¿—æ˜¯å‡½æ•°æ‰§è¡Œæ ˆä¸ºç©ºï¼‰ï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™ä¼šä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ‰€æœ‰Microtaskã€‚ç„¶åå†è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯å»MacroTaskï¼ˆå®ä»»åŠ¡ï¼‰é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªMacroTaskï¼ˆå®ä»»åŠ¡ï¼‰æ‰§è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p><img src="http://qiniu.mrain22.cn/201811301501_536.png" alt=""></p>
<ul>
<li>ä»£ç  1.1</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'å¼€å§‹'</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">Â <span class="built_in">console</span>.log(<span class="string">'timer1'</span>)</span><br><span class="line">Â </span><br><span class="line">Â <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">Â Â Â <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">Â &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">Â <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">Â Â Â <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">Â &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å¼€å§‹</span></span><br><span class="line"><span class="comment">promise1</span></span><br><span class="line"><span class="comment">timer1</span></span><br><span class="line"><span class="comment">promise2</span></span><br><span class="line"><span class="comment">timer2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è§£æï¼š</strong></p>
<p>1ã€é¦–å…ˆä¸»çº¿ç¨‹çš„æ‰§è¡Œæ ˆå¼€å§‹å·¥ä½œï¼Œä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œè¾“å‡ºâ€œ1ã€å¼€å§‹â€ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªsetTimeoutï¼Œå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œå®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­ã€‚é‡åˆ°ç¬¬äºŒä¸ªsetTimeoutï¼Œä¹Ÿå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œå®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­æ’åœ¨ç¬¬äºŒä½ã€‚é‡åˆ°Promiseï¼Œå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­ã€‚è‡³æ­¤ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå»â€œä»»åŠ¡é˜Ÿåˆ—â€æ‰¾ä»»åŠ¡ã€‚</p>
<p>2ã€â€œä»»åŠ¡é˜Ÿåˆ—â€ä¸­â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œï¼Œè¾“å‡ºâ€œ2ã€promise1â€ã€‚å¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†å»æ‰¾â€œå®ä»»åŠ¡â€é˜Ÿåˆ—ã€‚</p>
<p>3ã€æ‰§è¡Œâ€œå®ä»»åŠ¡â€é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼ˆç¬¬ä¸€ä¸ªsetTimeoutï¼‰ï¼Œè¾“å‡ºâ€œ3ã€timer1â€ï¼Œå°†Promiseæ¨åˆ°â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ã€‚æ‰§è¡Œå®Œä¸€ä¸ªâ€œå®ä»»åŠ¡â€ï¼Œæ‰§è¡Œæ‰€æœ‰â€œå¾®ä»»åŠ¡â€ï¼Œè¾“å‡ºâ€œ4ã€promise2â€ã€‚</p>
<p>4ã€æ‰§è¡Œå®Œæ‰€æœ‰â€œå¾®ä»»åŠ¡åâ€ï¼Œå†å»æ£€æŸ¥â€œå®ä»»åŠ¡â€ï¼Œæ‰§è¡Œç¬¬äºŒä¸ªsetTimeoutï¼Œè¾“å‡ºâ€œ5ã€timer2â€ã€‚å…¨éƒ¨ä»»åŠ¡ç»“æŸã€‚</p>
</blockquote>
<h2 id="Nodeç¯å¢ƒä¸­"><a href="#Nodeç¯å¢ƒä¸­" class="headerlink" title="Nodeç¯å¢ƒä¸­"></a>Nodeç¯å¢ƒä¸­</h2><p>nodejsçš„event loopåˆ†ä¸º6ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<p><img src="http://qiniu.mrain22.cn/201811301504_417.png" alt=""></p>
<blockquote>
<ol>
<li>timersï¼šæ‰§è¡ŒsetTimeout() å’Œ setInterval()ä¸­åˆ°æœŸçš„callbackã€‚</li>
<li>I/O callbacksï¼šä¸Šä¸€è½®å¾ªç¯ä¸­æœ‰å°‘æ•°çš„I/Ocallbackä¼šè¢«å»¶è¿Ÿåˆ°è¿™ä¸€è½®çš„è¿™ä¸€é˜¶æ®µæ‰§è¡Œ</li>
<li>idle, prepareï¼šé˜Ÿåˆ—çš„ç§»åŠ¨ï¼Œä»…å†…éƒ¨ä½¿ç”¨</li>
<li>pollï¼šæœ€ä¸ºé‡è¦çš„é˜¶æ®µï¼Œæ‰§è¡ŒI/O callbackï¼Œåœ¨é€‚å½“çš„æ¡ä»¶ä¸‹ä¼šé˜»å¡åœ¨è¿™ä¸ªé˜¶æ®µ</li>
<li>checkï¼šæ‰§è¡ŒsetImmediateçš„callback</li>
<li>close callbacksï¼šæ‰§è¡Œcloseäº‹ä»¶çš„callbackï¼Œä¾‹å¦‚socket.on(â€œcloseâ€,func)</li>
</ol>
</blockquote>
<p>ä¸åŒäºæµè§ˆå™¨çš„æ˜¯ï¼Œåœ¨<strong>æ¯ä¸ªé˜¶æ®µå®Œæˆæ‰€æœ‰é˜¶æ®µä»»åŠ¡å</strong>ï¼ˆè€Œä¸æ˜¯MacroTaskä»»åŠ¡å®Œæˆåï¼Œæ¯ä¸ªé˜¶æ®µå¯èƒ½ä¼šæœ‰å¥½å¤šä»»åŠ¡ï¼Œå¯ä»¥æŠŠ6ä¸ªé˜¶æ®µçœ‹åšå®ä»»åŠ¡ï¼ˆMacroTaskï¼‰çš„æ’åºï¼‰microTaské˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡å°±ä¼šè¢«æ‰§è¡Œã€‚è¿™å°±å¯¼è‡´äº†åŒæ ·çš„ä»£ç åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸‹ä¼šå‡ºç°ä¸åŒçš„ç»“æœã€‚</p>
<p><img src="http://qiniu.mrain22.cn/201811301508_15.png" alt=""></p>
<p>å¦‚ä¸Šé¢ä»£ç 1.1ï¼Œåœ¨nodeç¯å¢ƒä¸‹è¿è¡Œç»“æœä¸ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å¼€å§‹</span></span><br><span class="line"><span class="comment">promise1</span></span><br><span class="line"><span class="comment">timer1</span></span><br><span class="line"><span class="comment">timer2</span></span><br><span class="line"><span class="comment">promise2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è§£æï¼š</strong></p>
<p>1ã€é¦–å…ˆä¸»çº¿ç¨‹çš„æ‰§è¡Œæ ˆå¼€å§‹å·¥ä½œï¼Œä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œè¾“å‡ºâ€œ1ã€å¼€å§‹â€ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªsetTimeoutï¼Œå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œtimeré˜¶æ®µâ€é˜Ÿåˆ—ä¸­ã€‚é‡åˆ°ç¬¬äºŒä¸ªsetTimeoutï¼Œä¹Ÿå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œtimeré˜¶æ®µâ€é˜Ÿåˆ—ä¸­æ’åœ¨ç¬¬äºŒä½ã€‚é‡åˆ°Promiseï¼Œå°†å…¶æ¨åˆ°â€œä»»åŠ¡é˜Ÿåˆ—â€çš„â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­ã€‚è‡³æ­¤ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå»â€œä»»åŠ¡é˜Ÿåˆ—â€æ‰¾ä»»åŠ¡ã€‚</p>
<p>2ã€â€œä»»åŠ¡é˜Ÿåˆ—â€ä¸­â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œï¼Œè¾“å‡ºâ€œ2ã€promise1â€ã€‚å¾®ä»»åŠ¡â€é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†å»æ‰¾â€œtimeré˜¶æ®µâ€é˜Ÿåˆ—ã€‚</p>
<p>3ã€æ‰§è¡Œâ€œtimeré˜¶æ®µâ€é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼ˆç¬¬ä¸€ä¸ªsetTimeoutï¼‰ï¼Œè¾“å‡ºâ€œ3ã€timer1â€ï¼Œå°†Promiseæ¨åˆ°â€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—ã€‚æ‰§è¡Œâ€œtimeré˜¶æ®µâ€é˜Ÿåˆ—çš„ç¬¬äºŒä¸ªä»»åŠ¡ï¼ˆå³ç¬¬äºŒä¸ªsetTimeoutï¼‰ï¼Œè¾“å‡ºâ€œ4ã€timer2â€ã€‚è‡³æ­¤â€œtimeré˜¶æ®µâ€çš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>4ã€æ‰§è¡Œâ€œå¾®ä»»åŠ¡â€é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œè¾“å‡ºâ€œ5ã€promise2â€å…¨éƒ¨ä»»åŠ¡ç»“æŸã€‚</p>
</blockquote>
<ul>
<li>ä»£ç 1.2</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'å¼€å§‹'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>);</span><br><span class="line"></span><br><span class="line">   process.nextTick(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯setTimeoutå†…éƒ¨çš„process.nextTick'</span>);</span><br><span class="line">       </span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   setImmediate(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'å†…éƒ¨setImmediate'</span>);</span><br><span class="line">       </span><br><span class="line">   &#125;)</span><br><span class="line">   </span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯å¤–éƒ¨çš„process.nextTick'</span>);</span><br><span class="line">   </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setImmediate(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'setImmediate'</span>);</span><br><span class="line"></span><br><span class="line">   process.nextTick(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯setImmediateå†…éƒ¨çš„process.nextTick'</span>);</span><br><span class="line">       </span><br><span class="line">   &#125;)</span><br><span class="line">   </span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¼€å§‹</span></span><br><span class="line"><span class="comment">æˆ‘æ˜¯å¤–éƒ¨çš„process.nextTick</span></span><br><span class="line"><span class="comment">setTimeout</span></span><br><span class="line"><span class="comment">æˆ‘æ˜¯setTimeoutå†…éƒ¨çš„process.nextTick</span></span><br><span class="line"><span class="comment">setImmediate</span></span><br><span class="line"><span class="comment">å†…éƒ¨setImmediate</span></span><br><span class="line"><span class="comment">æˆ‘æ˜¯setImmediateå†…éƒ¨çš„process.nextTick</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è§£æï¼š</strong></p>
<p>ï¼ˆ1ï¼‰ å…ˆæ‰§è¡ŒåŒæ­¥ è¾“å‡ºâ€œ1ã€å¼€å§‹â€ï¼Œå°†setTimeoutæ¨åˆ°timeré˜¶æ®µçš„é˜Ÿåˆ—ä¸­ï¼Œå°†process.nextTickæ¨åˆ°micro-task(å¾®ä»»åŠ¡)ï¼Œå°†setImmediateæ¨åˆ°check é˜¶æ®µçš„é˜Ÿåˆ—ä¸­<strong>ã€‚</strong></p>
<p>ï¼ˆ2ï¼‰ åŒæ­¥æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œmicro-taskï¼Œæ‰§è¡Œprocess.nextTickï¼Œè¾“å‡ºâ€œ<strong>2ã€</strong>æˆ‘æ˜¯å¤–éƒ¨çš„process.nextTickâ€ï¼Œæ­¤æ—¶å¾®æœåŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡äº†ã€‚</p>
<p>ï¼ˆ3ï¼‰æŒ‰6ä¸ªé˜¶æ®µé¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œtimeré˜¶æ®µé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œæ­¤æ—¶é˜Ÿåˆ—ä¸­åªæœ‰setTimeoutä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œè¾“å‡ºâ€œ3ã€setTimeoutâ€ï¼Œå°†å…¶å†…éƒ¨çš„process.nextTickæ¨é€åˆ°micro-task(å¾®ä»»åŠ¡)é˜Ÿåˆ—ä¸­ï¼Œå°†å…¶å†…éƒ¨çš„setImmediateæ¨é€åˆ°checké˜¶æ®µçš„é˜Ÿåˆ—ä¸­ï¼ˆæ³¨æ„ï¼šæ­¤æ—¶checké˜Ÿåˆ—ä¸­æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªæ˜¯å¤–éƒ¨çš„setImmediateï¼Œä¸€ä¸ªæ˜¯å†…éƒ¨çš„setImmediateï¼‰ã€‚setTimeoutï¼ˆtimeré˜¶æ®µï¼‰æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œmicro-task(å¾®ä»»åŠ¡)é˜Ÿåˆ—ï¼Œè¾“å‡ºâ€œ4ã€æˆ‘æ˜¯setTimeoutå†…éƒ¨çš„process.nextTickâ€ã€‚micro-task(å¾®ä»»åŠ¡)é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>ï¼ˆ4ï¼‰è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œç”±äºæ²¡æœ‰i/oè¯»å†™ç­‰æ“ä½œï¼Œç›´æ¥åˆ°checké˜¶æ®µï¼Œæ‰§è¡Œchecké˜¶æ®µé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå¤–éƒ¨çš„setImmediateï¼Œè¾“å‡ºâ€œ5ã€setImmediateâ€ï¼Œå¹¶å°†å…¶å†…éƒ¨çš„process.nextTickæ¨é€åˆ°micro-task(å¾®ä»»åŠ¡)é˜Ÿåˆ—ä¸­ï¼Œæ‰§è¡Œchecké˜¶æ®µé˜Ÿåˆ—ä¸­çš„ç¬¬äºŒä¸ªä»»åŠ¡setImmediateï¼ˆå†…éƒ¨çš„setImmediateï¼‰ï¼Œè¾“å‡ºâ€œ6ã€å†…éƒ¨çš„setImmediateâ€ã€‚checké˜¶æ®µé˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡äº†ï¼Œæ‰§è¡Œmicro-task(å¾®ä»»åŠ¡)é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè¾“å‡ºâ€œ7ã€æˆ‘æ˜¯setImmediateå†…éƒ¨çš„process.nextTickâ€</p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸‹ï¼ŒMicroTaskä¼šæ¯”MacroTaskå…ˆè¿è¡Œ</li>
<li>ç„¶åæµè§ˆå™¨æŒ‰ç…§ä¸€ä¸ªMacroTaskä»»åŠ¡ï¼Œæ‰€æœ‰MicroTaskçš„é¡ºåºè¿è¡Œï¼ŒNodeæŒ‰ç…§å…­ä¸ªé˜¶æ®µçš„é¡ºåºè¿è¡Œï¼Œå¹¶åœ¨æ¯ä¸ªé˜¶æ®µåé¢éƒ½ä¼šè¿è¡ŒMicroTaské˜Ÿåˆ—</li>
<li>åŒä¸ªMicroTaské˜Ÿåˆ—ä¸‹<code>process.tick()</code>ä¼šä¼˜äº<code>Promise</code></li>
</ol>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>ä»¥ä¸Šä»…æ˜¯æˆ‘ä¸ªäººåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ€»ç»“çš„è‡ªå·±çš„è®¤è¯†ï¼Œéš¾å…ä¼šæœ‰é”™è¯¯ï¼Œæœ‰ä»»ä½•é—®é¢˜è¿˜æœ›ä¸åæŒ‡å‡ºã€‚</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">ã€ŠJavaScript è¿è¡Œæœºåˆ¶è¯¦è§£ï¼šå†è°ˆEvent Loopã€‹â€”â€“é˜®ä¸€å³°</a></li>
<li><a href="https://funteas.com/topic/5ac0343e60897ba7206a9ce8" target="_blank" rel="noopener">ã€Šä¸€ç¯‡æ–‡ç« æ•™ä¼šä½ Event loopâ€”â€”æµè§ˆå™¨å’ŒNodeã€‹</a></li>
<li><a href="https://juejin.im/post/59e85eebf265da430d571f89" target="_blank" rel="noopener">ã€Šè¿™ä¸€æ¬¡ï¼Œå½»åº•å¼„æ‡‚ JavaScript æ‰§è¡Œæœºåˆ¶ã€‹</a></li>
</ul>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
</search>
